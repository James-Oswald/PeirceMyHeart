/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const D of f.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&r(D)}).observe(document,{childList:!0,subtree:!0});function n(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=n(i);fetch(i.href,f)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}toString(){return"("+this.x+", "+this.y+")"}}function U(e,t){return je(e,t)||W(t,e)}function je(e,t){if(e instanceof X)return t instanceof X?Xe(e,t):Ae(t,e);if(t instanceof X)return Ae(e,t);if(Xe(e.boundingBox,t.boundingBox)||W(t.boundingBox,e.boundingBox)){const n=qe(e);let r;for(let i=0;i<n.length;i++)if(r=le(t,n[i]),r<=0)return!0;return!1}return!1}function Ae(e,t){const n=t.getCorners(),r=ne(e,n[0].x,1),i=ne(e,n[1].x,1),f=ne(e,n[0].x,-1),D=ne(e,n[1].x,-1);if(n[0].y<r&&r<n[2].y||n[0].y<f&&f<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<D&&D<n[2].y)return!0;const P=-1/Math.pow(e.radiusX,2),k=2*e.center.x/Math.pow(e.radiusX,2),te=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),$e=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),pe=(-k+Math.sqrt(Math.pow(k,2)-4*P*te))/(2*P),xe=(-k-Math.sqrt(Math.pow(k,2)-4*P*te))/(2*P),me=(-k+Math.sqrt(Math.pow(k,2)-4*P*$e))/(2*P),Me=(-k-Math.sqrt(Math.pow(k,2)-4*P*$e))/(2*P);return!isNaN(pe)&&n[0].x<pe&&pe<n[1].x||!isNaN(xe)&&n[0].x<xe&&xe<n[1].x||!isNaN(me)&&n[0].x<me&&me<n[1].x||!isNaN(Me)&&n[0].x<Me&&Me<n[1].x}function W(e,t){if(e instanceof X)if(t instanceof X){const n=t.getCorners();for(let r=0;r<4;r++)if(!Te(e,n[r]))return!1;return!0}else{const n=yt(t);for(let r=0;r<4;r++)if(!Te(e,n[r]))return!1;return!0}else if(t instanceof X){const n=t.getCorners();let r;for(let i=0;i<4;i++)if(r=le(e,n[i]),!(r<0))return!1;return!0}else{const n=qe(t);let r;for(let i=0;i<n.length;i++)if(r=le(e,n[i]),!(r<0))return!1;return!0}}function Xe(e,t){const n=e.getCorners(),r=t.getCorners();return(n[0].y<=r[0].y&&n[2].y>=r[0].y||n[0].y<=r[2].y&&n[2].y>=r[2].y||r[0].y<=n[0].y&&r[2].y>=n[0].y||r[0].y<=n[2].y&&r[2].y>=n[2].y)&&(n[0].x<=r[0].x&&n[1].x>=r[0].x||n[0].x<=r[1].x&&n[1].x>=r[1].x||r[0].x<=n[0].x&&r[1].x>=n[0].x||r[0].x<=n[1].x&&r[1].x>=n[1].x)}function Te(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function le(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function yt(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function qe(e){const t=[];let n,r,i=1;for(let f=0;f<360;f++)n=e.center.x+e.radiusX*Math.cos(f*(Math.PI/180)),f>180&&(i=-1),r=ne(e,n,i),t[f]=new c(n,r);return t}function ne(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class X{constructor(t,n,r){if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(r!==void 0&&r<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=r}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Te(this,t)}overlaps(t){return U(this,t)}contains(t){return W(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class d{constructor(t,n,r,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=r,this.internalHeight=i}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new X(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const r=this.internalChildren[n];if(r instanceof a&&r.containsNode(t))return r.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof d?W(this.internalEllipse,t.calcRect()):W(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const r=this.internalChildren[n];for(let i=0;i<r.children.length;i++)if(r.children[i].containsPoint(t))return r.getLowestParent(t);return this}}return null}getLevel(t,n){for(let r=0;r<this.internalChildren.length;r++){if(this.internalChildren[r]===t)return n;if(this.internalChildren[r]instanceof a&&this.internalChildren[r].containsNode(t))return this.internalChildren[r].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof d||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let r=0;r<this.children[n].children.length;r++)if(this.children[n].children[r].containsPoint(t))if(this.children[n].children[r]instanceof d)this.children[n].children.splice(r,1);else return this.children[n].children[r].remove(t);return this.children.splice(n,1),!0}return!1}clear(){this.internalChildren=[]}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof d?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class ee{constructor(t){this.internalSheet=new a(null),t instanceof a&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let r=n+1;r<t.children.length;r++)if(this.overlaps(t.children[n],t.children[r]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let r=0;r<n.children.length;r++)if(this.intersects(t,n.children[r]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),r=[...n.children];if(n.child=t,t instanceof a)for(let i=r.length-1;i>=0;i--)t.containsNode(r[i])&&(t.child=r[i],n.children.splice(i,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const r=t instanceof d?t.calcRect():t.ellipse,i=n instanceof d?n.calcRect():n.ellipse;return je(r,i)}overlaps(t,n){let r,i;return t instanceof d?n instanceof d?U(t.calcRect(),n.calcRect()):(r=n.ellipse,U(t.calcRect(),r)):n instanceof d?(r=t.ellipse,U(r,n.calcRect())):(r=t.ellipse,i=n.ellipse,U(r,i))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.toProofMode=11]="toProofMode",e[e.doubleCutInsertionTool=12]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=13]="doubleCutDeletionTool",e[e.erasureTool=14]="erasureTool",e))(s||{});class o{}o.tree=new ee;o.selectForProof=new ee;o.toolState=0;class z{constructor(t,n,r){if(this.center=t,this.radiusX=n,this.radiusY=r,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new X(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return le(this,t)<0}overlaps(t){return U(this,t)}contains(t){return W(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const gt=document.getElementById("theme-select");function G(e){return getComputedStyle(document.body).getPropertyValue(e)}let Je=G("--good-placement"),Ke=G("--bad-placement"),Ze=G("--canvas-items");function Qe(){setTimeout(()=>{Je=G("--good-placement"),Ke=G("--bad-placement"),Ze=G("--canvas-items"),u(o.tree)})}gt.addEventListener("input",()=>{Qe()});window.addEventListener("DOMContentLoaded",()=>{Qe()});function w(){return Ke}function b(){return Je}function _e(){return Ze}const Ee=document.getElementById("canvas"),et=Ee.getContext("2d");if(et===null)throw Error("2d rendering context not supported");const h=et;h.font="35pt arial";const pt=document.getElementById("graphString"),xt=document.getElementById("atomBox"),tt=document.getElementById("atomBoxes");tt.addEventListener("input",mt);function T(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const r=n.center;h.beginPath(),h.ellipse(r.x+l.x,r.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function E(e,t,n){h.textBaseline="bottom";const r=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(tt.checked||xt.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-r.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function nt(e,t,n){h.beginPath(),h.strokeStyle=n;const r=e.x-t.x+l.x,i=e.y-t.y+l.y;h.rect(e.x,e.y,-r,-i),h.stroke()}function mt(){u(o.tree)}function rt(){h.clearRect(0,0,Ee.width,Ee.height)}function u(e){pt.innerHTML=e.toString(),rt(),ot(e.sheet)}function ot(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof d?Mt(e.children[t]):ot(e.children[t]);e.ellipse instanceof z&&(h.strokeStyle=_e(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function Mt(e){E(e,_e(),!1)}let Pe,l=new c(0,0),Se;function bt(e){Pe=new c(e.x-l.x,e.y-l.y),Se=!1}function Ct(e){Se||(l=new c(e.x-Pe.x,e.y-Pe.y),u(o.tree))}function Tt(){Se=!0,u(o.tree)}const Et=document.getElementById("showRect"),Pt=document.getElementById("mode");let ce,fe;function kt(e){ce=new c(e.clientX-l.x,e.clientY-l.y),fe=!1}function St(e){const t=new a(new z(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(u(o.tree),t.ellipse=de(ce,n),!fe){const i=o.tree.canInsert(t)&&F(t.ellipse)?b():w();T(t,i),Et.checked&&nt(ce,n,i)}}function It(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(de(ce,t));o.tree.canInsert(n)&&!fe&&F(n.ellipse)&&o.tree.insert(n),u(o.tree)}function Lt(){fe=!0,u(o.tree)}function de(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),r=e.x-t.x,i=e.y-t.y,f=Math.abs(r),D=Math.abs(i);let P,k;if(Pt.value==="circumscribed"){const te=Math.floor(n.distance(t));k=Math.floor(te*(D/f)),P=Math.floor(te*(f/D))}else P=f/2,k=D/2;return new z(n,P,k)}function F(e){return e.radiusX>15&&e.radiusY>15}const Dt=document.getElementById("canvas"),it=Dt.getContext("2d");if(it===null)throw Error("2d rendering context not supported");const vt=it,Ot=document.getElementById("atomDisplay");let he,Ie,m=oe("A",new c(0,0));function Bt(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(m=oe(e.key,new c(m.origin.x,m.origin.y)),m.origin.x!==0&&m.origin.y!==0&&Ie&&Le())}function $t(e){he=!1,Ie=!0,m=oe(m.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Le()}function At(e){m=oe(m.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Le()}function Xt(e){m=oe(m.identifier,new c(e.clientX-l.x,e.clientY-l.y)),o.tree.canInsert(m)&&!he&&o.tree.insert(m),u(o.tree),Ie=!1}function Yt(){he=!0,u(o.tree)}function oe(e,t){Ot.innerHTML=e;const n=vt.measureText(e);return new d(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Le(){u(o.tree),he||(o.tree.canInsert(m)?E(m,b(),!0):E(m,w(),!0))}async function Ft(e,t){const n=JSON.stringify(t,null,"	"),r=await e.createWritable();await r.write(n),await r.close()}function ke(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,r=new ee,i=[];return n.forEach(f=>{Object.prototype.hasOwnProperty.call(f,"internalEllipse")?i.push(st(f)):i.push(lt(f))}),r.sheet.children=i,r}return null}function st(e){const t=new z(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(r=>{"internalEllipse"in r?n.push(st(r)):n.push(lt(r))}),new a(t,n)}function lt(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new d(t,n,e.internalWidth,e.internalHeight)}function ie(e,t){if(e.ellipse!==null){const n=N(e,t);if(!o.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof a&&e.children[n].ellipse!==null&&!ie(e.children[n],t))return!1;if(e.children[n]instanceof d){let r=e.children[n];if(r=L(r,t),!o.tree.canInsert(r))return!1}}return!0}function De(e,t,n){if(e instanceof a&&e.ellipse!==null){const r=N(e,n);if(T(r,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)De(e.children[i],t,n)}else if(e instanceof d){const r=L(e,n);E(r,t,!0)}}function ve(e,t){if(e instanceof a&&e.ellipse!==null){const n=N(e,t);if(o.tree.insert(n),e.children.length!==0)for(let r=0;r<e.children.length;r++)ve(e.children[r],t)}else if(e instanceof d){const n=L(e,t);o.tree.insert(n)}}function N(e,t){if(e.ellipse!==null)return new a(new z(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function L(e,t){return new d(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function we(e,t){if(e instanceof d)E(e,t,!0);else if(e instanceof a){T(e,t);for(let n=0;n<e.children.length;n++)we(e.children[n],t)}}let B,y=null,H;function Nt(e){if(B=new c(e.x-l.x,e.y-l.y),y=o.tree.getLowestNode(B),y!==o.tree.sheet&&y!==null){const t=o.tree.getLowestParent(B);if(t!==null&&t.remove(B),y instanceof a&&y.children.length!==0){for(let n=0;n<y.children.length;n++)o.tree.insert(y.children[n]);y.children=[]}H=!0}else H=!1}function Ht(e){if(H){const t=new c(e.x-B.x,e.y-B.y);if(y instanceof a){const n=N(y,t);u(o.tree);const r=o.tree.canInsert(n)?b():w();T(n,r)}else if(y instanceof d){const n=L(y,t);u(o.tree);const r=o.tree.canInsert(n)?b():w();E(n,r,!0)}}}function Rt(e){if(H){const t=new c(e.x-B.x,e.y-B.y);if(y instanceof a){const n=N(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}else if(y instanceof d){const n=L(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}u(o.tree)}H=!1}function zt(){H&&y!==null&&o.tree.insert(y),H=!1,u(o.tree)}let $,p=null,R;function Ut(e){if($=new c(e.x-l.x,e.y-l.y),p=o.tree.getLowestNode($),p!==o.tree.sheet&&p!==null){const t=o.tree.getLowestParent($);t!==null&&t.remove($),R=!0}else R=!1}function Vt(e){if(R){const t=new c(e.x-$.x,e.y-$.y);if(u(o.tree),p instanceof a){const n=ie(p,t)?b():w();De(p,n,t)}else if(p instanceof d){const n=L(p,t),r=o.tree.canInsert(n)?b():w();E(n,r,!0)}}}function Gt(e){if(R){const t=new c(e.x-$.x,e.y-$.y);if(p instanceof a)ie(p,t)?ve(p,t):o.tree.insert(p);else if(p instanceof d){const n=L(p,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(p)}}u(o.tree),R=!1}function Wt(){R&&p!==null&&o.tree.insert(p),R=!1,u(o.tree)}let j,S=null,q;function jt(e){j=new c(e.x-l.x,e.y-l.y);const t=o.tree.getLowestNode(j);t!==o.tree.sheet&&t!==null?(t instanceof a?(S=N(t,new c(0,0)),S.children=[]):t instanceof d&&(S=t),q=!0):q=!1}function qt(e){if(q){const t=new c(e.x-j.x,e.y-j.y);if(S instanceof a){const n=N(S,t);u(o.tree);const r=o.tree.canInsert(n)?b():w();T(n,r)}else if(S instanceof d){const n=L(S,t);u(o.tree);const r=o.tree.canInsert(n)?b():w();E(n,r,!0)}}}function Jt(e){if(q){const t=new c(e.x-j.x,e.y-j.y);if(S instanceof a&&S.ellipse!==null){const n=N(S,t);o.tree.canInsert(n)&&o.tree.insert(n)}else if(S instanceof d){const n=L(S,t);o.tree.canInsert(n)&&o.tree.insert(n)}u(o.tree)}q=!1}function Kt(){q=!1,u(o.tree)}let J,C=null,K;function Zt(e){J=new c(e.x-l.x,e.y-l.y),C=o.tree.getLowestNode(J),C!==o.tree.sheet&&C!==null?K=!0:K=!1}function Qt(e){if(K){const t=new c(e.x-J.x,e.y-J.y);if(u(o.tree),C instanceof a){const n=ie(C,t)?b():w();De(C,n,t)}else if(C instanceof d){const n=L(C,t),r=o.tree.canInsert(n)?b():w();E(n,r,!0)}}}function _t(e){if(K){const t=new c(e.x-J.x,e.y-J.y);if(C instanceof a)ie(C,t)&&ve(C,t);else if(C instanceof d){const n=L(C,t);o.tree.canInsert(n)&&o.tree.insert(n)}}u(o.tree),K=!1}function en(){K=!1,u(o.tree)}let Ye,g=null,Z;function tn(e){Ye=new c(e.x-l.x,e.y-l.y),g=o.tree.getLowestNode(Ye),g!==null&&(Z=!0,g instanceof d?E(g,w(),!0):T(g,w()))}function nn(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);g!==null&&g!==n&&(Z=!0,u(o.tree),n===null?(g=null,Z=!1):(g=n,g instanceof d?E(g,w(),!0):T(g,w())))}function rn(e){const t=new c(e.x-l.x,e.y-l.y);if(Z){const n=o.tree.getLowestParent(t);if(n!==null&&n.remove(t),g!==o.tree.sheet&&g instanceof a&&g.children.length!==0)for(let r=0;r<g.children.length;r++)o.tree.insert(g.children[r])}u(o.tree),g=null,Z=!1}function on(){g=null,Z=!1}let Fe,v=null,Q;function sn(e){Fe=new c(e.x-l.x,e.y-l.y),v=o.tree.getLowestNode(Fe),v!==null&&(Q=!0,we(v,w()))}function ln(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);v!==null&&v!==o.tree.getLowestNode(t)&&(Q=!0,u(o.tree),n===null?(v=null,Q=!1):(v=n,we(v,w())))}function cn(e){const t=new c(e.x-l.x,e.y-l.y);if(Q){const n=o.tree.getLowestParent(t);n!==null?n.remove(t):o.tree.clear(),u(o.tree)}v=null,Q=!1}function an(){v=null,Q=!1}let se,M=null,ye;function un(e){if(o.selectForProof.sheet=new ee().sheet,se=new c(e.x,e.y),M=o.tree.getLowestNode(se),M!==null){if(ye=!0,M!==o.tree.sheet){const t=o.tree.getLowestParent(se);t!==null&&t.remove(se),u(o.tree)}else rt();M instanceof d?E(M,b(),!0):ct(M,b()),M!==o.tree.sheet&&o.tree.insert(M)}}function fn(){M=null,ye=!1,u(o.tree)}function dn(){if(ye){if(M instanceof a&&M.ellipse===null)for(let e=0;e<M.children.length;e++)o.selectForProof.insert(M.children[e]);else o.selectForProof.insert(M);u(o.tree),alert("Graph selected, you may now toggle to proof mode")}}function hn(){M=null,ye=!1,u(o.tree)}function ct(e,t){if(e instanceof d)E(e,t,!0);else if(e instanceof a){T(e,t);for(let n=0;n<e.children.length;n++)ct(e.children[n],t)}}const wn=document.getElementById("showRect");let ae,ge;function yn(e){ae=new c(e.clientX-l.x,e.clientY-l.y),ge=!1}function gn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(de(ae,t)),r=new a(at(n.ellipse));if(u(o.tree),!ge&&n.ellipse!==null&&r.ellipse!==null){const f=o.tree.canInsert(n)&&F(n.ellipse)&&o.tree.canInsert(r)&&F(r.ellipse)?b():w();T(n,f),T(r,f),wn.checked&&nt(ae,t,f)}}function pn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(de(ae,t)),r=new a(at(n.ellipse));!ge&&n.ellipse!==null&&r.ellipse!==null&&o.tree.canInsert(n)&&F(n.ellipse)&&o.tree.canInsert(r)&&F(r.ellipse)&&(o.tree.insert(n),o.tree.insert(r)),u(o.tree)}function xn(){ge=!0,u(o.tree)}function at(e){return new z(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let Y=null,ue;function mn(e){const t=new c(e.x-l.x,e.y-l.y);Y=o.tree.getLowestNode(t),ut()}function Mn(e){const t=new c(e.x-l.x,e.y-l.y);Y=o.tree.getLowestNode(t),u(o.tree),ut()}function bn(e){const t=new c(e.x-l.x,e.y-l.y);if(ue&&Y instanceof a){const n=o.tree.getLowestParent(t),r=Y.children[0];if(n!==null&&r instanceof a){n.remove(t);for(let i=0;i<r.children.length;i++)o.tree.insert(r.children[i])}}u(o.tree)}function Cn(){ue=!1,u(o.tree)}function Tn(e){return e.children.length===1&&e.children[0]instanceof a&&Y!==o.tree.sheet}function En(e){T(e,w()),e.children[0]instanceof a&&T(e.children[0],w())}function ut(){Y instanceof a&&Tn(Y)?(ue=!0,En(Y)):ue=!1}let A=null,re;function Pn(e){const t=new c(e.x-l.x,e.y-l.y);A=o.tree.getLowestNode(t),ft()}function kn(e){const t=new c(e.x-l.x,e.y-l.y);A=o.tree.getLowestNode(t),u(o.tree),ft()}function Sn(e){if(re){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestParent(t);n!==null&&n.remove(t),u(o.tree)}A=null,re=!1}function In(){A=null,re=!1,u(o.tree)}function ft(){A!==o.tree.sheet&&A!==null&&o.tree.getLevel(A)%2===0?(re=!0,we(A,w())):re=!1}let be=!0,Ne=null,He=null,Re=s.none,ze=s.none;const Ue=document.getElementById("DrawButtons"),Ve=document.getElementById("ProofButtons");function Ln(){if(be=!be,be){Ue.style.display="block",Ve.style.display="none",He=JSON.stringify(o.tree),ze=o.toolState;const e=ke(Ne);if(e!==null)o.tree.sheet=e.sheet;else throw Error("invalid cached AEG");o.toolState=Re}else{Ue.style.display="none",Ve.style.display="block",Ne=JSON.stringify(o.tree),Re=o.toolState;const e=ke(He);if(e!==null){o.tree.sheet=e.sheet;for(let t=0;t<o.selectForProof.sheet.children.length;t++){const n=o.selectForProof.sheet.children[t];try{o.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else o.tree.sheet=o.selectForProof.sheet;o.toolState=ze,o.selectForProof.sheet=new ee().sheet}u(o.tree)}let I,x=null,_;const V=new c(1,1);function Dn(e){if(I=new c(e.x-l.x,e.y-l.y),x=o.tree.getLowestNode(I),x!==o.tree.sheet&&x instanceof a){_=!0;const t=o.tree.getLowestParent(I);t!==null&&t.remove(I);for(let n=0;n<x.children.length;n++)o.tree.insert(x.children[n]);$n(),x.children=[]}}function vn(e){if(_){const t=new c((e.x-l.x-I.x)/2,(e.y-l.y-I.y)/2);if(x instanceof a){const n=dt(x,t);if(n.ellipse!==null){u(o.tree);const i=o.tree.canInsert(n)&&F(n.ellipse)?b():w();T(n,i)}}}}function On(e){if(_){const t=new c((e.x-l.x-I.x)/2,(e.y-l.y-I.y)/2);if(x instanceof a){const n=dt(x,t);n.ellipse!==null&&(o.tree.canInsert(n)&&F(n.ellipse)?o.tree.insert(n):o.tree.insert(x))}u(o.tree),_=!1}}function Bn(){_&&x!==null&&o.tree.insert(x),_=!1,u(o.tree)}function dt(e,t){if(e.ellipse!==null)return new a(new z(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),e.ellipse.radiusX+t.x*V.x,e.ellipse.radiusY+t.y*V.y));throw new Error("Cannot alter the position of a cut without an ellipse.")}function $n(){if(x instanceof a&&x.ellipse!==null){const e=x.ellipse,t=[new c(e.center.x-e.radiusX,e.center.y),new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY)];t[0].distance(I)>=t[2].distance(I)?V.x=1:V.x=-1,t[1].distance(I)>=t[3].distance(I)?V.y=1:V.y=-1}}const O=document.getElementById("canvas");O.width=window.innerWidth;O.height=window.innerHeight;const ht=O.getContext("2d");if(ht===null)throw Error("2d rendering context not supported");const An=ht;An.font="35pt arial";const Ce=document.getElementById("cutTools"),Ge=document.getElementById("atomTools");window.addEventListener("keydown",Nn);O.addEventListener("mousedown",Hn);O.addEventListener("mousemove",Rn);O.addEventListener("mouseup",zn);O.addEventListener("mouseout",Un);O.addEventListener("mouseenter",Vn);let Oe=!1,Be=!0;window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.saveMode=wt;window.loadMode=Fn;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.erasureTool=s.erasureTool;window.setTool=Yn;window.setHighlight=Xn;window.toggleHandler=Ln;function Xn(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const We=document.querySelectorAll(".modeButton");We.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),We.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function Yn(e){switch(o.toolState=e,Ce.style.display="none",Ge.style.display="none",o.toolState){case s.atomTool:Ge.style.display="block";break;case s.cutTool:Ce.style.display="block";break;case s.doubleCutInsertionTool:Ce.style.display="block";break}}async function wt(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Ft(e,o.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(o.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function Fn(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const r=n.result,i=ke(r);i instanceof ee&&(o.tree=i,u(o.tree))}),n.readAsText(t)}function Nn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),wt();else switch(o.toolState){case s.atomTool:Bt(e);break}}function Hn(e){switch(o.toolState){case s.cutTool:kt(e);break;case s.atomTool:$t(e);break;case s.dragTool:bt(e);break;case s.moveSingleTool:Nt(e);break;case s.moveMultiTool:Ut(e);break;case s.copySingleTool:jt(e);break;case s.copyMultiTool:Zt(e);break;case s.deleteSingleTool:tn(e);break;case s.deleteMultiTool:sn(e);break;case s.resizeTool:Dn(e);break;case s.toProofMode:un(e);break;case s.doubleCutInsertionTool:yn(e);break;case s.doubleCutDeletionTool:mn(e);break;case s.erasureTool:Pn(e);break}Oe=!0}function Rn(e){if(Oe&&Be)switch(o.toolState){case s.cutTool:St(e);break;case s.atomTool:At(e);break;case s.dragTool:Ct(e);break;case s.moveSingleTool:Ht(e);break;case s.moveMultiTool:Vt(e);break;case s.copySingleTool:qt(e);break;case s.copyMultiTool:Qt(e);break;case s.deleteSingleTool:nn(e);break;case s.deleteMultiTool:ln(e);break;case s.resizeTool:vn(e);break;case s.toProofMode:fn();break;case s.doubleCutInsertionTool:gn(e);break;case s.doubleCutDeletionTool:Mn(e);break;case s.erasureTool:kn(e);break}}function zn(e){switch(o.toolState){case s.cutTool:It(e);break;case s.atomTool:Xt(e);break;case s.moveSingleTool:Rt(e);break;case s.moveMultiTool:Gt(e);break;case s.copySingleTool:Jt(e);break;case s.copyMultiTool:_t(e);break;case s.deleteSingleTool:rn(e);break;case s.deleteMultiTool:cn(e);break;case s.resizeTool:On(e);break;case s.toProofMode:dn();break;case s.doubleCutInsertionTool:pn(e);break;case s.doubleCutDeletionTool:bn(e);break;case s.erasureTool:Sn(e);break}Oe=!1}function Un(){switch(o.toolState){case s.cutTool:Lt();break;case s.atomTool:Yt();break;case s.dragTool:Tt();break;case s.moveSingleTool:zt();break;case s.moveMultiTool:Wt();break;case s.copySingleTool:Kt();break;case s.copyMultiTool:en();break;case s.deleteSingleTool:on();break;case s.deleteMultiTool:an();break;case s.resizeTool:Bn();break;case s.toProofMode:hn();break;case s.doubleCutInsertionTool:xn();break;case s.doubleCutDeletionTool:Cn();break;case s.erasureTool:In();break}Be=!1}function Vn(){Be=!0}function Gn(){O.width=window.innerWidth,O.height=window.innerHeight}window.onresize=Gn;
