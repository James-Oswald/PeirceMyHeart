(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function De(e,t){return rn(e,t)||Be(t,e)}function rn(e,t){if(e instanceof be)return t instanceof be?Vt(e,t):Ut(t,e);if(t instanceof be)return Ut(e,t);if(Vt(e.boundingBox,t.boundingBox)||Be(t.boundingBox,e.boundingBox)){const n=ln(e);let o;for(let i=0;i<n.length;i++)if(o=lt(t,n[i]),o<=0)return!0;return!1}return!1}function Ut(e,t){const n=t.getCorners(),o=je(e,n[0].x,1),i=je(e,n[1].x,1),u=je(e,n[0].x,-1),p=je(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<u&&u<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<p&&p<n[2].y)return!0;const h=-1/Math.pow(e.radiusX,2),y=2*e.center.x/Math.pow(e.radiusX,2),b=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),H=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),We=(-y+Math.sqrt(Math.pow(y,2)-4*h*b))/(2*h),mt=(-y-Math.sqrt(Math.pow(y,2)-4*h*b))/(2*h),xt=(-y+Math.sqrt(Math.pow(y,2)-4*h*H))/(2*h),bt=(-y-Math.sqrt(Math.pow(y,2)-4*h*H))/(2*h);return!isNaN(We)&&n[0].x<We&&We<n[1].x||!isNaN(mt)&&n[0].x<mt&&mt<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x||!isNaN(bt)&&n[0].x<bt&&bt<n[1].x}function Be(e,t){if(e instanceof be)if(t instanceof be){const n=t.getCorners();for(let o=0;o<4;o++)if(!It(e,n[o]))return!1;return!0}else{const n=$n(t);for(let o=0;o<4;o++)if(!It(e,n[o]))return!1;return!0}else if(t instanceof be){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=lt(e,n[i]),!(o<0))return!1;return!0}else{const n=ln(t);let o;for(let i=0;i<n.length;i++)if(o=lt(e,n[i]),!(o<0))return!1;return!0}}function Vt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function It(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function lt(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function $n(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function ln(e){const t=[];let n,o,i=1;for(let u=0;u<360;u++)n=e.center.x+e.radiusX*Math.cos(u*(Math.PI/180)),u>180&&(i=-1),o=je(e,n,i),t[u]=new c(n,o);return t}function je(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class be{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return It(this,t)}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new f(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new be(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class ce{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new be(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return lt(this,t)<0}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new ce(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof f,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?Be(this.internalEllipse,t.calcRect()):Be(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let u=0;u<o.length;u++){if(n[i]instanceof f&&o[u]instanceof f&&n[i].isEqualTo(o[u])||n[i]instanceof a&&o[u]instanceof a&&n[i].isEqualTo(o[u])){n.splice(i,1),o.splice(u,1),i--;break}if(u===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class ${constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return rn(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?De(t.calcRect(),n.calcRect()):(o=n.ellipse,De(t.calcRect(),o)):n instanceof f?(o=t.ellipse,De(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,De(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class U{constructor(t,n){this.appliedRule=n??"",this.tree=new $(t==null?void 0:t.sheet),this.index=r.proof.length}}var l=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.clearProofTool=22]="clearProofTool",e))(l||{});const ne=class ne{static getLastProofStep(){return ne.proof.length===0?new U(new $):ne.proof[ne.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;Ct(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),mn(t)}static clearProof(){Ct(-1),this.proof=[],this.pushToProof(new U),this.currentProofStep=this.proof[0]}};ne.tree=new $,ne.proof=[],ne.selectForProof=new $,ne.toolState=0,ne.modeState="Draw";let r=ne,kt,s=new c(0,0),At;function Bn(){d("cursor: grab")}function Nn(e){d("cursor: grabbing"),kt=new c(e.x-s.x,e.y-s.y),At=!1}function On(e){At||(d("cursor: grabbing"),s=new c(e.x-kt.x,e.y-kt.y),sn())}function Rn(){d("cursor: grab")}function Fn(){d("cursor: default"),At=!0,sn()}function sn(){r.modeState==="Proof"?m():g(r.tree)}var cn={exports:{}};(function(e,t){function n(){var p=document.querySelector("[data-toggle-theme]"),h=p?p.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){localStorage.getItem(h||"theme")&&(document.documentElement.setAttribute("data-theme",y),p&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(b=>{b.classList.add(p.getAttribute("data-act-class"))}))})(),p&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(y=>{y.addEventListener("click",function(){var b=y.getAttribute("data-toggle-theme");if(b){var H=b.split(",");document.documentElement.getAttribute("data-theme")==H[0]?H.length==1?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem(h||"theme")):(document.documentElement.setAttribute("data-theme",H[1]),localStorage.setItem(h||"theme",H[1])):(document.documentElement.setAttribute("data-theme",H[0]),localStorage.setItem(h||"theme",H[0]))}[...document.querySelectorAll("[data-toggle-theme]")].forEach(We=>{We.classList.toggle(this.getAttribute("data-act-class"))})})})}function o(){var p=document.querySelector("[data-set-theme='']"),h=p?p.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){if(y!=null&&y!="")if(localStorage.getItem(h||"theme")&&localStorage.getItem(h||"theme")!=""){document.documentElement.setAttribute("data-theme",y);var b=document.querySelector("[data-set-theme='"+y.toString()+"']");b&&([...document.querySelectorAll("[data-set-theme]")].forEach(H=>{H.classList.remove(H.getAttribute("data-act-class"))}),b.getAttribute("data-act-class")&&b.classList.add(b.getAttribute("data-act-class")))}else{var b=document.querySelector("[data-set-theme='']");b.getAttribute("data-act-class")&&b.classList.add(b.getAttribute("data-act-class"))}})(),[...document.querySelectorAll("[data-set-theme]")].forEach(y=>{y.addEventListener("click",function(){document.documentElement.setAttribute("data-theme",this.getAttribute("data-set-theme")),localStorage.setItem(h||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("[data-set-theme]")].forEach(b=>{b.classList.remove(b.getAttribute("data-act-class"))}),y.getAttribute("data-act-class")&&y.classList.add(y.getAttribute("data-act-class"))})})}function i(){var p=document.querySelector("select[data-choose-theme]"),h=p?p.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){if(localStorage.getItem(h||"theme")){document.documentElement.setAttribute("data-theme",y);var b=document.querySelector("select[data-choose-theme] [value='"+y.toString()+"']");b&&[...document.querySelectorAll("select[data-choose-theme] [value='"+y.toString()+"']")].forEach(H=>{H.selected=!0})}})(),p&&[...document.querySelectorAll("select[data-choose-theme]")].forEach(y=>{y.addEventListener("change",function(){document.documentElement.setAttribute("data-theme",this.value),localStorage.setItem(h||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("select[data-choose-theme] [value='"+localStorage.getItem(h||"theme")+"']")].forEach(b=>{b.selected=!0})})})}function u(p=!0){p===!0?document.addEventListener("DOMContentLoaded",function(h){n(),i(),o()}):(n(),i(),o())}e.exports={themeChange:u}})(cn);var Xn=cn.exports;const Hn=document.getElementById("theme-select");Xn.themeChange();let an=Ae("--good-placement"),un=Ae("--bad-placement"),fn=Ae("--canvas-items");function Ae(e){return getComputedStyle(document.body).getPropertyValue(e)}function dn(){setTimeout(()=>{an=Ae("--good-placement"),un=Ae("--bad-placement"),fn=Ae("--canvas-items"),r.modeState==="Draw"?g(r.tree):m()})}Hn.addEventListener("input",()=>{dn()});window.addEventListener("DOMContentLoaded",()=>{dn()});function w(){return un}function x(){return an}function hn(){return fn}const st=document.getElementById("canvas"),gn=st.getContext("2d");if(gn===null)throw Error("2d rendering context not supported.");const S=gn;S.font="35pt arial";const qn=document.getElementById("graphString"),zn=document.getElementById("proofString"),Yn=document.getElementById("atomBox"),pn=document.getElementById("atomBoxes");pn.addEventListener("input",Vn);function R(e,t){const n=e.ellipse;if(n!==null){S.strokeStyle=t;const o=n.center;S.beginPath(),S.ellipse(o.x+s.x,o.y+s.y,n.radiusX,n.radiusY,0,0,2*Math.PI),S.stroke()}}function F(e,t,n){S.textBaseline="bottom";const o=S.measureText(e.identifier);S.fillStyle=t,S.strokeStyle=t,S.beginPath(),S.fillText(e.identifier,e.origin.x+s.x,e.origin.y+s.y),(pn.checked||Yn.checked&&n)&&S.rect(e.origin.x+s.x,e.origin.y+s.y-o.actualBoundingBoxAscent,e.width,e.height),S.stroke()}function wn(e,t,n){S.beginPath(),S.strokeStyle=n;const o=e.x-t.x+s.x,i=e.y-t.y+s.y;S.rect(e.x,e.y,-o,-i),S.stroke()}function d(e){st.style.cssText=e}function Un(e,t,n){return e===x()?t:n}function C(e,t,n){d(Un(e,t,n))}function Vn(){g(r.tree)}function ft(){S.clearRect(0,0,st.width,st.height)}function g(e,t){qn.innerHTML=e.toString(),ft(),$t(e.sheet,t),window.treeString=yt(e)}function $t(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof f?Gn(e.children[n]):$t(e.children[n]);e.ellipse instanceof ce&&(S.strokeStyle=t||hn(),S.beginPath(),S.ellipse(e.ellipse.center.x+s.x,e.ellipse.center.y+s.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),S.stroke())}function Gn(e){F(e,hn(),!1)}function m(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new $:e=r.currentProofStep.tree,ft(),zn.innerHTML=e.toString(),$t(e.sheet)}function le(e,t){if(e instanceof f)F(e,t,!1);else if(e instanceof a){R(e,t);for(let n=0;n<e.children.length;n++)le(e.children[n],t)}}function yn(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function mn(e,t){var p;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Wn(e)};const u=document.createElement("Text");u.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(u),n.appendChild(i),(p=document.getElementById("proofHistoryBar"))==null||p.appendChild(n)}function Wn(e){r.currentProofStep=e,m()}function Ct(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}async function jn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Lt(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Gt(o)}else{const o=[];let i;for(i of n){const u=i.tree.internalSheet.internalChildren;o.push(new U(Gt(u),i.appliedRule))}return o}}function Gt(e){const t=new $,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(xn(o)):n.push(bn(o));return t.sheet.children=n,t}function xn(e){const t=new ce(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(xn(o)):n.push(bn(o));return new a(t,n)}function bn(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}let Mt=!0,Tt=null,Pt=null,Wt=l.none,jt=l.none;const Jt=document.getElementById("DrawButtons"),Kt=document.getElementById("ProofButtons"),Zt=document.getElementById("proofHistoryBar");function Jn(){if(Mt=!Mt,Mt){Jt.style.display="block",en.style.display="block",Kt.style.display="none",tn.style.display="none",Zt.style.display="none",r.modeState="Draw",Pt=JSON.stringify(r.proof),jt=r.toolState;let e=null;if(Tt!==null&&(e=Lt(r.modeState,Tt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=Wt,g(r.tree)}else{Jt.style.display="none",en.style.display="none",Kt.style.display="block",tn.style.display="block",Zt.style.display="block",r.modeState="Proof",Tt=JSON.stringify(r.tree),Wt=r.toolState,r.proof.length===0&&r.pushToProof(new U);let e=null;Pt!==null&&(e=Lt(r.modeState,Pt)),e!==null&&(r.proof=e),r.toolState=jt,m()}}const Kn=document.getElementById("mode");function Me(e,t,n){if(t.ellipse!==null){const o=Z(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!Me(e,t.children[o],n))return!1;if(t.children[o]instanceof f){let i=t.children[o];if(i=k(i,n),!e.canInsert(i))return!1}}return!0}function Y(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=Z(e,n);if(R(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Y(e.children[i],t,n)}else if(e instanceof f){const o=k(e,n);F(o,t,!0)}}function tt(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=Z(e,t);if(o.insert(i),e.children.length!==0)for(let u=0;u<e.children.length;u++)tt(e.children[u],t,n)}else if(e instanceof f){const i=k(e,t);o.insert(i)}}function Qe(e,t){return e instanceof f?k(e,t):Z(e,t)}function Z(e,t){if(e.ellipse!==null)return new a(new ce(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Bt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(Bt(e.children[o],t)):e.children[o]instanceof f&&n.push(k(e.children[o],t));return new a(new ce(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function k(e,t){return new f(e.identifier,new c(e.origin.x+t.x-s.x,e.origin.y+t.y-s.y),e.width,e.height)}function dt(e,t,n){if(e.ellipse!==null)return new a(new ce(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),Math.abs(e.ellipse.radiusX+t.x*n.x),Math.abs(e.ellipse.radiusY+t.y*n.y)));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function nt(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function ve(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&nt(e,t),g(e))}function ht(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,u=Math.abs(o),p=Math.abs(i);let h,y;if(Kn.value==="circumscribed"){const b=Math.floor(n.distance(t));y=Math.floor(b*(p/u)),h=Math.floor(b*(u/p))}else h=u/2,y=p/2;return new ce(n,h,y)}function ge(e){return e.radiusX>15&&e.radiusY>15}const Zn=document.getElementById("showRect");let ct,gt;function Qn(){d("cursor: crosshair")}function _n(e){ct=new c(e.clientX-s.x,e.clientY-s.y),gt=!1}function eo(e){const t=new a(new ce(new c(0,0),0,0)),n=new c(e.clientX-s.x,e.clientY-s.y);if(g(r.tree),t.ellipse=ht(ct,n),!gt){const i=r.tree.canInsert(t)&&ge(t.ellipse)?x():w();C(i,"cursor: crosshair","cursor: no-drop"),R(t,i),Zn.checked&&wn(ct,n,i)}}function to(e){d("cursor: default");const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(ht(ct,t));r.tree.canInsert(n)&&!gt&&ge(n.ellipse)&&r.tree.insert(n),g(r.tree)}function no(){d("cursor: default"),gt=!0,g(r.tree)}const oo=document.getElementById("canvas"),Mn=oo.getContext("2d");if(Mn===null)throw Error("2d rendering context not supported.");const ro=Mn,io=document.getElementById("atomDisplay");let pt,Nt,N=ot("A",new c(0,0));function lo(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=ot(e.key,new c(N.origin.x,N.origin.y)),N.origin.x!==0&&N.origin.y!==0&&Nt&&Ot())}function so(e){pt=!1,Nt=!0,N=ot(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Ot()}function co(e){N=ot(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Ot()}function ao(e){d("cursor: default"),N=ot(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),r.tree.canInsert(N)&&!pt&&r.tree.insert(N),g(r.tree),Nt=!1}function uo(){d("cursor: default"),pt=!0,g(r.tree)}function ot(e,t){io.innerHTML=e;const n=ro.measureText(e);return new f(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Ot(){g(r.tree),pt||(r.tree.canInsert(N)?(d("cursor: default"),F(N,x(),!0)):(d("cursor: no-drop"),F(N,w(),!0)))}let pe,P=null,Ie;function fo(e){if(pe=new c(e.x-s.x,e.y-s.y),P=r.tree.getLowestNode(pe),P!==r.tree.sheet&&P!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(pe);if(t!==null&&t.remove(pe),P instanceof a&&P.children.length!==0){for(let n=0;n<P.children.length;n++)r.tree.insert(P.children[n]);P.children=[]}Ie=!0,g(r.tree),P instanceof f?F(P,x(),!0):R(P,x())}else Ie=!1}function ho(e){if(Ie){const t=new c(e.x-pe.x,e.y-pe.y);if(P instanceof a){const n=Z(P,t);g(r.tree);const o=r.tree.canInsert(n)?x():w();R(n,o),C(o,"cursor: grabbing","cursor: no-drop")}else if(P instanceof f){const n=k(P,t);g(r.tree);const o=r.tree.canInsert(n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function go(e){if(d("cursor: default"),Ie){const t=new c(e.x-pe.x,e.y-pe.y);if(P instanceof a){const n=Z(P,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(P)}else if(P instanceof f){const n=k(P,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(P)}g(r.tree)}Ie=!1}function po(){d("cursor: default"),Ie&&P!==null&&r.tree.insert(P),Ie=!1,g(r.tree)}let we,v=null,ke;function wo(e){if(we=new c(e.x-s.x,e.y-s.y),v=r.tree.getLowestNode(we),v!==r.tree.sheet&&v!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(we);t!==null&&t.remove(we),ke=!0,g(r.tree),le(v,x())}else ke=!1}function yo(e){if(ke){const t=new c(e.x-we.x,e.y-we.y);if(g(r.tree),v instanceof a){const n=Me(r.tree,v,t)?x():w();Y(v,n,t),C(n,"cursor: grabbing","cursor: no-drop")}else if(v instanceof f){const n=k(v,t),o=r.tree.canInsert(n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function mo(e){if(d("cursor: default"),ke){const t=new c(e.x-we.x,e.y-we.y);if(v instanceof a)Me(r.tree,v,t)?tt(v,t):r.tree.insert(v);else if(v instanceof f){const n=k(v,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(v)}}g(r.tree),ke=!1}function xo(){d("cursor: default"),ke&&v!==null&&r.tree.insert(v),ke=!1,g(r.tree)}let ye,J=null,Ne;function bo(e){ye=new c(e.x-s.x,e.y-s.y);const t=r.tree.getLowestNode(ye),n=new c(e.x-ye.x,e.y-ye.y);t!==r.tree.sheet&&t!==null?(d("cursor: copy"),t instanceof a?(J=Z(t,n),J.children=[]):t instanceof f&&(J=t),Ne=!0):Ne=!1}function Mo(e){if(Ne){const t=new c(e.x-ye.x,e.y-ye.y);if(J instanceof a){const n=Z(J,t);g(r.tree);const o=r.tree.canInsert(n)?x():w();R(n,o),C(o,"cursor: grabbing","cursor: no-drop")}else if(J instanceof f){const n=k(J,t);g(r.tree);const o=r.tree.canInsert(n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function To(e){if(d("cursor: default"),Ne){const t=new c(e.x-ye.x,e.y-ye.y);if(J instanceof a&&J.ellipse!==null){const n=Z(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(J instanceof f){const n=k(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}g(r.tree)}Ne=!1}function Po(){d("cursor: default"),Ne=!1,g(r.tree)}let Oe,G=null,Re;function So(e){Oe=new c(e.x-s.x,e.y-s.y),G=r.tree.getLowestNode(Oe),G!==r.tree.sheet&&G!==null?(d("cursor: copy"),Re=!0):Re=!1}function Eo(e){if(Re){const t=new c(e.x-Oe.x,e.y-Oe.y);if(g(r.tree),G instanceof a){const n=Me(r.tree,G,t)?x():w();Y(G,n,t),C(n,"cursor: grabbing","cursor: no-drop")}else if(G instanceof f){const n=k(G,t),o=r.tree.canInsert(n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function Io(e){if(d("cursor: default"),Re){const t=new c(e.x-Oe.x,e.y-Oe.y);if(G instanceof a)Me(r.tree,G,t)&&tt(G,t);else if(G instanceof f){const n=k(G,t);r.tree.canInsert(n)&&r.tree.insert(n)}}g(r.tree),Re=!1}function ko(){d("cursor: default"),Re=!1,g(r.tree)}let rt,T=null,oe;function Co(e){if(rt=new c(e.x-s.x,e.y-s.y),T=r.tree.getLowestNode(rt),T!==null){const t=r.tree.getLowestParent(rt);t!==null&&t.remove(rt),T instanceof a&&T.children.length!==0&&T!==r.tree.sheet&&nt(r.tree,T),g(r.tree),T instanceof f?F(T,w(),!0):R(T,w()),oe=!0}else oe=!1}function Lo(e){oe&&T!==null&&T.ellipse!==null&&ve(r.tree,T);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);oe&&T!==null&&o!==null&&(oe=!0,g(r.tree),n===null?(T=null,oe=!1):(o.remove(t),T=n,T instanceof a&&T.children.length!==0&&(nt(r.tree,T),T.children=[]),g(r.tree),T instanceof f?F(T,w(),!0):R(T,w())))}function vo(e){const t=new c(e.x-s.x,e.y-s.y);if(oe){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&nt(r.tree,n),g(r.tree)}T=null,oe=!1}function Do(){oe&&T!==null&&ve(r.tree,T),T=null,oe=!1,g(r.tree)}let it,B=null,_;function Ao(e){if(it=new c(e.x-s.x,e.y-s.y),B=r.tree.getLowestNode(it),B!==null){const t=r.tree.getLowestParent(it);t!==null?t.remove(it):(B=r.tree.sheet.copy(),r.tree.clear()),_=!0,g(r.tree),le(B,w())}}function $o(e){_&&B!==null&&ve(r.tree,B);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);_&&B!==null&&o!==null?(_=!0,n===null?(B=null,_=!1):(o.remove(t),B=n,_=!0,g(r.tree),le(B,w()))):_&&o===null&&(B=r.tree.sheet.copy(),r.tree.clear(),g(r.tree),le(B,w()))}function Bo(e){const t=new c(e.x-s.x,e.y-s.y);if(_){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),g(r.tree)}B=null,_=!1}function No(){_&&B!==null&&ve(r.tree,B),B=null,_=!1,g(r.tree)}let Fe,A=null,Xe,Je;const Oo=document.getElementById("selectionString");function Ro(e){Je=new $(r.tree.sheet),r.selectForProof.sheet=new $().sheet,Fe=new c(e.x-s.x,e.y-s.y),A=r.tree.getLowestNode(Fe),Tn()}function Fo(e){Xe&&(g(r.tree),Fe=new c(e.x-s.x,e.y-s.y),A=r.tree.getLowestNode(Fe),Tn())}function Xo(){if(d("cursor: default"),Xe&&A!==null){if(A instanceof a&&A.ellipse===null)for(let e=0;e<A.children.length;e++)r.selectForProof.insert(A.children[e]);else r.selectForProof.insert(A);g(r.tree)}A=null,Xe=!1}function Ho(){d("cursor: default"),A=null,Xe=!1,g(r.tree)}function Tn(){const e=new $;let t=!1;if(A!==null){if(Xe=!0,A instanceof f||!A.isEqualTo(Je.sheet)){e.insert(A);const n=Je.getLowestParent(Fe);n!==null&&(n.remove(Fe),t=!0),g(Je)}else e.sheet=A,ft();le(A,x()),d("cursor: copy"),t&&Je.insert(A)}else Xe=!1;Oo.innerHTML=e.toString()}function Q(){const e=new $;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function He(e,t){return e.canInsert(t)&&Pn(new $(e.sheet),t)}function Pn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new $(r.currentProofStep.tree.sheet))):!1}const qo=document.getElementById("showRect");let at,wt,Te;function zo(){d("cursor: crosshair")}function Yo(e){at=new c(e.clientX-s.x,e.clientY-s.y),Te=Q(),wt=!1}function Uo(e){const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(ht(at,t)),o=new a(Sn(n.ellipse));if(m(),!wt&&n.ellipse!==null&&o.ellipse!==null){const u=Te.canInsert(n)&&ge(n.ellipse)&&Te.canInsert(o)&&ge(o.ellipse)?x():w();R(n,u),R(o,u),C(u,"cursor: crosshair","cursor: no-drop"),qo.checked&&wn(at,t,u)}}function Vo(e){d("cursor: crosshair");const t=new c(e.clientX-s.x,e.clientY-s.y);Te=Q();const n=new a(ht(at,t)),o=new a(Sn(n.ellipse)),i=new U(Te,"DC Insert");!wt&&n.ellipse!==null&&o.ellipse!==null&&Te.canInsert(n)&&ge(n.ellipse)&&Te.canInsert(o)&&ge(o.ellipse)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),m()}function Go(){d("cursor: default"),wt=!0,m()}function Sn(e){return new ce(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let fe,W=null,_e,Pe,$e;function Wo(e){fe=new c(e.x-s.x,e.y-s.y),Pe=Q(),$e=new $(Pe.sheet),W=Pe.getLowestNode(fe),En()}function jo(e){fe=new c(e.x-s.x,e.y-s.y),$e=new $(Pe.sheet),W!==null&&(W=Pe.getLowestNode(fe),m(),En())}function Jo(e){const t=new U(Pe,"DC Delete");if(fe=new c(e.x-s.x,e.y-s.y),_e&&W instanceof a){const n=t.tree.getLowestParent(fe),o=W.children[0];if(n!==null&&o instanceof a){n.remove(fe);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}m()}function Ko(){_e&&W!==null&&ve($e,W),W=null,_e=!1,m()}function Zo(e){return e.children.length===1&&e.children[0]instanceof a&&W!==Pe.sheet}function Qo(e){R(e,w()),e.children[0]instanceof a&&R(e.children[0],w())}function En(){if(W instanceof a&&Zo(W)){_e=!0;const e=$e.getLowestParent(fe);if(e!==null){e.remove(fe);const t=W.children[0].copy();nt($e,t),t.children=[]}g($e),Qo(W)}else _e=!1}let M,L,z,D,qe;function _o(e){z=Q();const t=r.selectForProof.sheet.children,n=new c(e.x-s.x,e.y-s.y);if(r.proof.length>0&&t.length===1){qe=!0,M=t[0];const o=Rt(e,M),i=z.getLowestNode(n),u=z.getLowestParent(n);if(L=i instanceof f?u:i,o){const p=Qe(M,o);if(L!==null&&!L.containsNode(p))d("cursor: no-drop"),D=!1,Y(M,w(),o);else if(L!==null&&L instanceof a&&L.ellipse!==null&&z.getLevel(L)%2===0){if(p instanceof a){D=!0;for(let h=0;h<L.children.length;h++)if(p.containsNode(L.children[h])){D=!1;break}}else D=!0;if(D){let h="";if(M instanceof a)h=Me(z,M,o)?x():w();else if(M instanceof f){const y=Qe(M,o);h=z.canInsert(y)?x():w()}D=h===x(),Y(M,h,o),C(h,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),Y(M,w(),o)}else d("cursor: no-drop"),D=!1,Y(M,w(),o)}}else D=!1,qe=!1,Y(M,w(),n)}function er(e){if(qe){const t=new c(e.x-s.x,e.y-s.y);m();const n=Rt(e,M),o=z.getLowestNode(t),i=z.getLowestParent(t);if(L=o instanceof f?i:o,n){const u=Qe(M,n);if(L!==null&&!L.containsNode(u))d("cursor: no-drop"),D=!1,Y(M,w(),n);else if(L!==null&&L instanceof a&&L.ellipse!==null&&z.getLevel(L)%2===0){if(u instanceof a){D=!0;for(let p=0;p<L.children.length;p++)if(u.containsNode(L.children[p])){D=!1;break}}else D=!0;if(D){let p="";if(M instanceof a)p=Me(z,M,n)?x():w();else if(M instanceof f){const h=Qe(M,n);p=z.canInsert(h)?x():w()}D=p===x(),Y(M,p,n),C(p,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),Y(M,w(),n)}else d("cursor: no-drop"),D=!1,Y(M,w(),n)}}else D=!1}function tr(e){if(d("cursor: default"),qe&&D){const t=Rt(e,M);if(t){if(M instanceof a)tt(M,t,z);else if(M instanceof f){const n=Qe(M,t);z.insert(n)}r.pushToProof(new U(z,"Insertion"))}}m(),qe=!1}function nr(){d("cursor: default"),qe=!1,m()}function Rt(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof f)return new c(e.x-t.origin.x,e.y-t.origin.y)}let de,K=null,ze,Se,Ke;function or(e){de=new c(e.x-s.x,e.y-s.y),Se=Q(),Ke=new $(Se.sheet),K=Se.getLowestNode(de),In()}function rr(e){de=new c(e.x-s.x,e.y-s.y),K!==null&&(K=Se.getLowestNode(de),m(),In())}function ir(e){if(ze){const t=new U(Se,"Erasure");de=new c(e.x-s.x,e.y-s.y);const n=t.tree.getLowestParent(de);n!==null&&n.remove(de),r.pushToProof(t),m()}K=null,ze=!1}function lr(){ze&&K!==null&&ve(Ke,K),K=null,ze=!1,m()}function In(){if(K!==Se.sheet&&K!==null&&Se.getLevel(K)%2===0){ze=!0;const e=Ke.getLowestParent(de);e!==null&&e.remove(de),g(Ke),le(K,w()),Ke.insert(K)}else ze=!1}let ae,q=null,Ye,Ft=new c(1,1);function sr(e){if(ae=new c(e.x-s.x,e.y-s.y),q=r.tree.getLowestNode(ae),q instanceof a&&q.ellipse!==null){Ye=!0;const t=r.tree.getLowestParent(ae);t!==null&&t.remove(ae);for(let n=0;n<q.children.length;n++)r.tree.insert(q.children[n]);Ft=yn(q,ae),q.children=[]}}function cr(e){if(Ye){const t=new c((e.x-s.x-ae.x)/2,(e.y-s.y-ae.y)/2);if(q instanceof a){const n=dt(q,t,Ft);if(n.ellipse!==null){g(r.tree);const i=r.tree.canInsert(n)&&ge(n.ellipse)?x():w();C(i,"cursor: crosshair","cursor: no-drop"),R(n,i)}}}}function ar(e){if(d("cursor: default"),Ye){const t=new c((e.x-s.x-ae.x)/2,(e.y-s.y-ae.y)/2);if(q instanceof a){const n=dt(q,t,Ft);n.ellipse!==null&&(r.tree.canInsert(n)&&ge(n.ellipse)?r.tree.insert(n):r.tree.insert(q))}g(r.tree),Ye=!1}}function ur(){d("cursor: default"),Ye&&q!==null&&r.tree.insert(q),Ye=!1,g(r.tree)}let me,E=null,Ce,j;function fr(e){if(j=Q(),me=new c(e.x-s.x,e.y-s.y),E=j.getLowestNode(me),E!==j.sheet&&E!==null){d("cursor: grabbing");const t=j.getLowestParent(me);if(t!==null&&t.remove(me),E instanceof a&&E.children.length!==0){for(let n=0;n<E.children.length;n++)j.insert(E.children[n]);E.children=[]}Ce=!0,g(j),E instanceof f?F(E,x(),!0):R(E,x())}else Ce=!1}function dr(e){if(Ce){const t=new c(e.x-me.x,e.y-me.y);if(g(j),E instanceof a){const n=Z(E,t),o=He(j,n)?x():w();R(n,o),C(o,"cursor: grabbing","cursor: no-drop")}else if(E instanceof f){const n=k(E,t),o=He(j,n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function hr(e){if(Ce){d("cursor: default");const t=new U(j,"Single Move"),n=new c(e.x-me.x,e.y-me.y);let o=null;E instanceof a?o=Z(E,n):E instanceof f&&(o=k(E,n)),o!==null&&He(j,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Ce=!1}function gr(){d("cursor: default"),Ce&&E!==null&&j.insert(E),Ce=!1,m()}let xe,X=null,St=null,Le,ee;function pr(e){ee=Q(),xe=new c(e.x-s.x,e.y-s.y),X=ee.getLowestNode(xe),X!==ee.sheet&&X!==null?(d("cursor: grabbing"),St=ee.getLowestParent(xe),St!==null&&St.remove(xe),Le=!0,g(ee),le(X,x())):Le=!1}function wr(e){if(Le){const t=new c(e.x-xe.x,e.y-xe.y);if(g(ee),X instanceof a){const n=Bt(X,t),o=He(ee,n)?x():w();Y(X,o,t),C(o,"cursor: grabbing","cursor: no-drop")}else if(X instanceof f){const n=k(X,t),o=He(ee,n)?x():w();F(n,o,!0),C(o,"cursor: grabbing","cursor: no-drop")}}}function yr(e){if(Le){d("cursor: default");const t=new U(ee,"Multi Move"),n=new c(e.x-xe.x,e.y-xe.y);let o=null;X instanceof a?o=Bt(X,n):X instanceof f&&(o=k(X,n)),o!==null&&He(ee,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Le=!1}function mr(){d("cursor: default"),Le&&X!==null&&ee.insert(X),Le=!1,m()}let vt,ut,et;function xr(){ut=Q(),vt=r.selectForProof.sheet,vt.children.length>0&&r.proof.length===1&&ut.sheet.isEmptySheet()&&(et=!0,d("cursor: copy"))}function br(){d("cursor: default"),et=!1,m()}function Mr(){et&&(d("cursor: default"),ut.sheet=vt,r.pushToProof(new U(ut,"Pasted"))),et=!1,m()}function Tr(){d("cursor: default"),et=!1,m()}let Ee,O=null,Dt=null,Ue,re;function Pr(e){re=Q(),Ee=new c(e.x-s.x,e.y-s.y),O=re.getLowestNode(Ee),Dt=re.getLowestParent(Ee),Ue=O!==re.sheet&&O!==null,Ue&&d("cursor: copy")}function Sr(e){if(Ue){const t=new c(e.x-Ee.x,e.y-Ee.y);m();const n=new c(e.x-s.x,e.y-s.y),o=kn(t,n)?x():w();if(O instanceof a)Y(O,o,t);else if(O instanceof f){const i=k(O,t);F(i,o,!0)}C(o,"cursor: grabbing","cursor: no-drop")}}function Er(e){if(Ue){d("cursor: default");const t=new c(e.x-Ee.x,e.y-Ee.y);if(kn(t,new c(e.x-s.x,e.y-s.y))){if(O instanceof a)tt(O,t,re);else if(O instanceof f){const n=k(O,t);re.insert(n)}r.pushToProof(new U(re,"Iteration"))}}m(),Ue=!1}function Ir(){d("cursor: default"),Ue=!1,m()}function kn(e,t){return Dt!==null&&Dt.containsPoint(t)&&(O instanceof a&&Me(re,O,e)&&Cn(re.sheet,Z(O,e).ellipse)||O instanceof f&&re.canInsert(k(O,e)))}function Cn(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof ce&&(t.contains(e.children[n].ellipse)||!Cn(e.children[n],t)))return!1}else if(e.children[n]instanceof f&&t.contains(e.children[n].calcRect()))return!1;return!0}let ue,V=null,Ve,Xt=new c(1,1),ie;function kr(e){if(ie=Q(),ue=new c(e.x-s.x,e.y-s.y),V=ie.getLowestNode(ue),V instanceof a&&V.ellipse!==null){Ve=!0;const t=ie.getLowestParent(ue);t!==null&&t.remove(ue);for(let n=0;n<V.children.length;n++)ie.insert(V.children[n]);Xt=yn(V,ue),V.children=[]}}function Cr(e){if(Ve){const t=new c((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof a){const n=dt(V,t,Xt);if(n.ellipse!==null){g(ie);const o=Ln(n)?x():w();R(n,o),C(o,"cursor: crosshair","cursor: no-drop")}}}}function Lr(e){if(Ve){d("cursor: default");const t=new c((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof a){const n=dt(V,t,Xt);n.ellipse!==null&&Ln(n)&&(ie.insert(n),r.pushToProof(new U(ie,"Resize")))}m(),Ve=!1}}function vr(){d("cursor: default"),Ve&&V!==null&&ie.insert(V),Ve=!1,m()}function Ln(e){return ie.canInsert(e)&&ge(e.ellipse)&&Pn(new $(ie.sheet),e)}let he,I=null,Ge,te,Ze;function Dr(e){he=new c(e.x-s.x,e.y-s.y),te=Q(),Ze=new $(te.sheet),I=te.getLowestNode(he),vn()}function Ar(e){he=new c(e.x-s.x,e.y-s.y),I!==null&&(I=te.getLowestNode(he),m(),vn())}function $r(e){if(Ge&&(he=new c(e.x-s.x,e.y-s.y),I!==null&&Ht(te.sheet,te.getLevel(I)))){const t=te.getLowestParent(he);t instanceof a&&t.remove(he),r.pushToProof(new U(te,"Deiteration"))}Ge=!1,m()}function Br(){Ge&&I!==null&&ve(Ze,I),Ge=!1,I=null,m()}function vn(){if(I!==null&&!(I instanceof a&&I.ellipse===null)&&Ht(te.sheet,te.getLevel(I))){Ge=!0;const e=Ze.getLowestParent(he);e!==null&&e.remove(he),g(Ze),le(I,w()),Ze.insert(I)}else Ge=!1}function Ht(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&I instanceof a&&I.isEqualTo(e.children[o])&&I.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof f&&I instanceof f&&e.children[o].identifier===I.identifier&&e.children[o].toString()!==I.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(I)&&te.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Ht(n,t):!1}let Qt,qt;function Nr(){Qt=Q(),qt=!0,ft(),le(Qt.sheet,w())}function Or(){qt&&(Ct(-1),r.clearProof(),m())}function Rr(){qt=!1,m()}const se=document.getElementById("canvas");se.width=window.innerWidth;se.height=window.innerHeight;const Dn=se.getContext("2d");if(Dn===null)throw Error("2d rendering context not supported");const Fr=Dn;Fr.font="35pt arial";const Et=document.getElementById("cutTools"),_t=document.getElementById("atomTools"),en=document.getElementById("graphString"),tn=document.getElementById("proofString"),nn=document.getElementById("toProofTools");window.addEventListener("keydown",zr);se.addEventListener("mousedown",Ur);se.addEventListener("mousemove",Vr);se.addEventListener("mouseup",Gr);se.addEventListener("mouseout",Wr);se.addEventListener("mouseenter",Yr);let zt=!1,Yt=!0;window.tree=r.tree;window.treeString=yt(window.tree);window.atomTool=l.atomTool;window.cutTool=l.cutTool;window.dragTool=l.dragTool;window.aegStringify=yt;window.saveMode=An;window.loadMode=qr;window.moveSingleTool=l.moveSingleTool;window.moveMultiTool=l.moveMultiTool;window.copySingleTool=l.copySingleTool;window.copyMultiTool=l.copyMultiTool;window.deleteSingleTool=l.deleteSingleTool;window.deleteMultiTool=l.deleteMultiTool;window.copyFromDrawTool=l.copyFromDrawTool;window.pasteInProofTool=l.pasteInProofTool;window.doubleCutInsertionTool=l.doubleCutInsertionTool;window.resizeTool=l.resizeTool;window.doubleCutDeletionTool=l.doubleCutDeletionTool;window.insertionTool=l.insertionTool;window.erasureTool=l.erasureTool;window.proofMoveSingleTool=l.proofMoveSingleTool;window.proofMoveMultiTool=l.proofMoveMultiTool;window.proofResizeTool=l.proofResizeTool;window.iterationTool=l.iterationTool;window.deiterationTool=l.deiterationTool;window.clearProofTool=l.clearProofTool;window.setTool=Hr;window.setHighlight=Xr;window.toggleHandler=Jn;function Xr(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const on=document.querySelectorAll(".toolButton");on.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),on.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Hr(e){switch(r.toolState=e,Et.style.display="none",_t.style.display="none",nn.style.display="none",r.toolState){case l.atomTool:_t.style.display="block";break;case l.cutTool:Et.style.display="block";break;case l.copyFromDrawTool:nn.style.display="block";break;case l.doubleCutInsertionTool:Et.style.display="block";break}}function yt(e){return JSON.stringify(e,null,"	")}async function An(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});jn(n,t)}else{const n=document.createElement("a");n.href=yt(t),n.download=e+".json",n.click()}}catch{}}async function qr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const u=Lt(r.modeState,o);if(r.modeState==="Draw")r.tree=u,g(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=u,(i=document.getElementById("Row: 1"))==null||i.remove();for(let p=0;p<r.proof.length;p++)mn(r.proof[p],p+1);r.currentProofStep=r.proof[r.proof.length-1],m()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}function zr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),An();else switch(r.toolState){case l.atomTool:lo(e);break}}function Yr(){switch(r.toolState){case l.cutTool:Qn();break;case l.dragTool:Bn();break;case l.doubleCutInsertionTool:zo();break}Yt=!0}function Ur(e){switch(r.toolState){case l.cutTool:_n(e);break;case l.atomTool:so(e);break;case l.dragTool:Nn(e);break;case l.moveSingleTool:fo(e);break;case l.moveMultiTool:wo(e);break;case l.copySingleTool:bo(e);break;case l.copyMultiTool:So(e);break;case l.deleteSingleTool:Co(e);break;case l.deleteMultiTool:Ao(e);break;case l.resizeTool:sr(e);break;case l.copyFromDrawTool:Ro(e);break;case l.pasteInProofTool:xr();break;case l.doubleCutInsertionTool:Yo(e);break;case l.doubleCutDeletionTool:Wo(e);break;case l.insertionTool:_o(e);break;case l.erasureTool:or(e);break;case l.proofMoveSingleTool:fr(e);break;case l.proofMoveMultiTool:pr(e);break;case l.proofResizeTool:kr(e);break;case l.iterationTool:Pr(e);break;case l.deiterationTool:Dr(e);break;case l.clearProofTool:Nr();break}zt=!0}function Vr(e){if(zt&&Yt)switch(r.toolState){case l.cutTool:eo(e);break;case l.atomTool:co(e);break;case l.dragTool:On(e);break;case l.moveSingleTool:ho(e);break;case l.moveMultiTool:yo(e);break;case l.copySingleTool:Mo(e);break;case l.copyMultiTool:Eo(e);break;case l.deleteSingleTool:Lo(e);break;case l.deleteMultiTool:$o(e);break;case l.resizeTool:cr(e);break;case l.copyFromDrawTool:Fo(e);break;case l.pasteInProofTool:br();break;case l.doubleCutInsertionTool:Uo(e);break;case l.doubleCutDeletionTool:jo(e);break;case l.insertionTool:er(e);break;case l.erasureTool:rr(e);break;case l.proofMoveSingleTool:dr(e);break;case l.proofMoveMultiTool:wr(e);break;case l.proofResizeTool:Cr(e);break;case l.iterationTool:Sr(e);break;case l.deiterationTool:Ar(e);break}}function Gr(e){switch(r.toolState){case l.cutTool:to(e);break;case l.atomTool:ao(e);break;case l.dragTool:Rn();break;case l.moveSingleTool:go(e);break;case l.moveMultiTool:mo(e);break;case l.copySingleTool:To(e);break;case l.copyMultiTool:Io(e);break;case l.deleteSingleTool:vo(e);break;case l.deleteMultiTool:Bo(e);break;case l.resizeTool:ar(e);break;case l.copyFromDrawTool:Xo();break;case l.pasteInProofTool:Mr();break;case l.doubleCutInsertionTool:Vo(e);break;case l.doubleCutDeletionTool:Jo(e);break;case l.insertionTool:tr(e);break;case l.erasureTool:ir(e);break;case l.proofMoveSingleTool:hr(e);break;case l.proofMoveMultiTool:yr(e);break;case l.proofResizeTool:Lr(e);break;case l.iterationTool:Er(e);break;case l.deiterationTool:$r(e);break;case l.clearProofTool:Or();break}zt=!1}function Wr(){switch(r.toolState){case l.cutTool:no();break;case l.atomTool:uo();break;case l.dragTool:Fn();break;case l.moveSingleTool:po();break;case l.moveMultiTool:xo();break;case l.copySingleTool:Po();break;case l.copyMultiTool:ko();break;case l.deleteSingleTool:Do();break;case l.deleteMultiTool:No();break;case l.resizeTool:ur();break;case l.copyFromDrawTool:Ho();break;case l.pasteInProofTool:Tr();break;case l.doubleCutInsertionTool:Go();break;case l.doubleCutDeletionTool:Ko();break;case l.insertionTool:nr();break;case l.erasureTool:lr();break;case l.proofMoveSingleTool:gr();break;case l.proofMoveMultiTool:mr();break;case l.proofResizeTool:vr();break;case l.iterationTool:Ir();break;case l.deiterationTool:Br();break;case l.clearProofTool:Rr();break}Yt=!1}function jr(){se.width=window.innerWidth,se.height=window.innerHeight}window.onresize=jr;
