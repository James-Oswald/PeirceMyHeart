/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function Ee(e,t){return on(e,t)||De(t,e)}function on(e,t){if(e instanceof pe)return t instanceof pe?qt(e,t):Ut(t,e);if(t instanceof pe)return Ut(e,t);if(qt(e.boundingBox,t.boundingBox)||De(t.boundingBox,e.boundingBox)){const n=rn(e);let o;for(let i=0;i<n.length;i++)if(o=ot(t,n[i]),o<=0)return!0;return!1}return!1}function Ut(e,t){const n=t.getCorners(),o=Ue(e,n[0].x,1),i=Ue(e,n[1].x,1),u=Ue(e,n[0].x,-1),p=Ue(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<u&&u<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<p&&p<n[2].y)return!0;const m=-1/Math.pow(e.radiusX,2),D=2*e.center.x/Math.pow(e.radiusX,2),Ce=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),Ht=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),wt=(-D+Math.sqrt(Math.pow(D,2)-4*m*Ce))/(2*m),pt=(-D-Math.sqrt(Math.pow(D,2)-4*m*Ce))/(2*m),gt=(-D+Math.sqrt(Math.pow(D,2)-4*m*Ht))/(2*m),yt=(-D-Math.sqrt(Math.pow(D,2)-4*m*Ht))/(2*m);return!isNaN(wt)&&n[0].x<wt&&wt<n[1].x||!isNaN(pt)&&n[0].x<pt&&pt<n[1].x||!isNaN(gt)&&n[0].x<gt&&gt<n[1].x||!isNaN(yt)&&n[0].x<yt&&yt<n[1].x}function De(e,t){if(e instanceof pe)if(t instanceof pe){const n=t.getCorners();for(let o=0;o<4;o++)if(!bt(e,n[o]))return!1;return!0}else{const n=$n(t);for(let o=0;o<4;o++)if(!bt(e,n[o]))return!1;return!0}else if(t instanceof pe){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=ot(e,n[i]),!(o<0))return!1;return!0}else{const n=rn(t);let o;for(let i=0;i<n.length;i++)if(o=ot(e,n[i]),!(o<0))return!1;return!0}}function qt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function bt(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function ot(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function $n(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function rn(e){const t=[];let n,o,i=1;for(let u=0;u<360;u++)n=e.center.x+e.radiusX*Math.cos(u*(Math.PI/180)),u>180&&(i=-1),o=Ue(e,n,i),t[u]=new c(n,o);return t}function Ue(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class pe{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return bt(this,t)}overlaps(t){return Ee(this,t)}contains(t){return De(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new f(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new pe(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class oe{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new pe(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return ot(this,t)<0}overlaps(t){return Ee(this,t)}contains(t){return De(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new oe(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof f,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?De(this.internalEllipse,t.calcRect()):De(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let u=0;u<o.length;u++){if(n[i]instanceof f&&o[u]instanceof f&&n[i].isEqualTo(o[u])||n[i]instanceof a&&o[u]instanceof a&&n[i].isEqualTo(o[u])){n.splice(i,1),o.splice(u,1),i--;break}if(u===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class L{constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return on(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?Ee(t.calcRect(),n.calcRect()):(o=n.ellipse,Ee(t.calcRect(),o)):n instanceof f?(o=t.ellipse,Ee(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,Ee(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class z{constructor(t,n){this.appliedRule=n??"",this.tree=new L(t==null?void 0:t.sheet),this.index=r.proof.length}}let St,s=new c(0,0),Dt;function vn(e){St=new c(e.x-s.x,e.y-s.y),Dt=!1}function Bn(e){Dt||(s=new c(e.x-St.x,e.y-St.y),ln())}function Nn(){Dt=!0,ln()}function ln(){r.modeState==="Proof"?w():d(r.tree)}const On=document.getElementById("theme-select");function Ie(e){return getComputedStyle(document.body).getPropertyValue(e)}let sn=Ie("--good-placement"),cn=Ie("--bad-placement"),an=Ie("--canvas-items");function un(){setTimeout(()=>{sn=Ie("--good-placement"),cn=Ie("--bad-placement"),an=Ie("--canvas-items"),r.modeState==="Draw"?d(r.tree):w()})}On.addEventListener("input",()=>{un()});window.addEventListener("DOMContentLoaded",()=>{un()});function h(){return cn}function g(){return sn}function fn(){return an}const kt=document.getElementById("canvas"),dn=kt.getContext("2d");if(dn===null)throw Error("2d rendering context not supported.");const T=dn;T.font="35pt arial";const Rn=document.getElementById("graphString"),An=document.getElementById("proofString"),Fn=document.getElementById("atomBox"),hn=document.getElementById("atomBoxes");hn.addEventListener("input",Xn);function N(e,t){const n=e.ellipse;if(n!==null){T.strokeStyle=t;const o=n.center;T.beginPath(),T.ellipse(o.x+s.x,o.y+s.y,n.radiusX,n.radiusY,0,0,2*Math.PI),T.stroke()}}function O(e,t,n){T.textBaseline="bottom";const o=T.measureText(e.identifier);T.fillStyle=t,T.strokeStyle=t,T.beginPath(),T.fillText(e.identifier,e.origin.x+s.x,e.origin.y+s.y),(hn.checked||Fn.checked&&n)&&T.rect(e.origin.x+s.x,e.origin.y+s.y-o.actualBoundingBoxAscent,e.width,e.height),T.stroke()}function wn(e,t,n){T.beginPath(),T.strokeStyle=n;const o=e.x-t.x+s.x,i=e.y-t.y+s.y;T.rect(e.x,e.y,-o,-i),T.stroke()}function Xn(){d(r.tree)}function st(){T.clearRect(0,0,kt.width,kt.height)}function d(e,t){Rn.innerHTML=e.toString(),st(),$t(e.sheet,t),window.treeString=ht(e)}function $t(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof f?zn(e.children[n]):$t(e.children[n]);e.ellipse instanceof oe&&(T.strokeStyle=t||fn(),T.beginPath(),T.ellipse(e.ellipse.center.x+s.x,e.ellipse.center.y+s.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),T.stroke())}function zn(e){O(e,fn(),!1)}function w(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new L:e=r.currentProofStep.tree,st(),An.innerHTML=e.toString(),$t(e.sheet)}function te(e,t){if(e instanceof f)O(e,t,!1);else if(e instanceof a){N(e,t);for(let n=0;n<e.children.length;n++)te(e.children[n],t)}}function pn(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function gn(e,t){var p;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Yn(e)};const u=document.createElement("Text");u.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(u),n.appendChild(i),(p=document.getElementById("proofHistoryBar"))==null||p.appendChild(n)}function Yn(e){r.currentProofStep=e,w()}function Ct(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}var l=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.clearProofTool=22]="clearProofTool",e))(l||{});const He=class nt{static getLastProofStep(){return nt.proof.length===0?new z(new L):nt.proof[nt.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;Ct(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),gn(t)}static clearProof(){Ct(-1),this.proof=[],this.pushToProof(new z),this.currentProofStep=this.proof[0]}};He.tree=new L;He.proof=[];He.selectForProof=new L;He.toolState=0;He.modeState="Draw";let r=He;async function Hn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Et(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Vt(o)}else{const o=[];let i;for(i of n){const u=i.tree.internalSheet.internalChildren;o.push(new z(Vt(u),i.appliedRule))}return o}}function Vt(e){const t=new L,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(yn(o)):n.push(xn(o));return t.sheet.children=n,t}function yn(e){const t=new oe(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(yn(o)):n.push(xn(o));return new a(t,n)}function xn(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}let xt=!0,mt=null,Mt=null,Gt=l.none,Wt=l.none;const jt=document.getElementById("DrawButtons"),Jt=document.getElementById("ProofButtons"),Kt=document.getElementById("proofHistoryBar");function Un(){if(xt=!xt,xt){jt.style.display="block",_t.style.display="block",Jt.style.display="none",en.style.display="none",Kt.style.display="none",r.modeState="Draw",Mt=JSON.stringify(r.proof),Wt=r.toolState;let e=null;if(mt!==null&&(e=Et(r.modeState,mt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=Gt,d(r.tree)}else{jt.style.display="none",_t.style.display="none",Jt.style.display="block",en.style.display="block",Kt.style.display="block",r.modeState="Proof",mt=JSON.stringify(r.tree),Gt=r.toolState,r.proof.length===0&&r.pushToProof(new z);let e=null;Mt!==null&&(e=Et(r.modeState,Mt)),e!==null&&(r.proof=e),r.toolState=Wt,w()}}const qn=document.getElementById("mode");function ge(e,t,n){if(t.ellipse!==null){const o=W(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!ge(e,t.children[o],n))return!1;if(t.children[o]instanceof f){let i=t.children[o];if(i=S(i,n),!e.canInsert(i))return!1}}return!0}function X(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=W(e,n);if(N(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)X(e.children[i],t,n)}else if(e instanceof f){const o=S(e,n);O(o,t,!0)}}function Ze(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=W(e,t);if(o.insert(i),e.children.length!==0)for(let u=0;u<e.children.length;u++)Ze(e.children[u],t,n)}else if(e instanceof f){const i=S(e,t);o.insert(i)}}function We(e,t){return e instanceof f?S(e,t):W(e,t)}function W(e,t){if(e.ellipse!==null)return new a(new oe(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function vt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(vt(e.children[o],t)):e.children[o]instanceof f&&n.push(S(e.children[o],t));return new a(new oe(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function S(e,t){return new f(e.identifier,new c(e.origin.x+t.x-s.x,e.origin.y+t.y-s.y),e.width,e.height)}function ct(e,t,n){if(e.ellipse!==null)return new a(new oe(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),e.ellipse.radiusX+t.x*n.x,e.ellipse.radiusY+t.y*n.y));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function Qe(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function ke(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&Qe(e,t),d(e))}function at(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,u=Math.abs(o),p=Math.abs(i);let m,D;if(qn.value==="circumscribed"){const Ce=Math.floor(n.distance(t));D=Math.floor(Ce*(p/u)),m=Math.floor(Ce*(u/p))}else m=u/2,D=p/2;return new oe(n,m,D)}function ae(e){return e.radiusX>15&&e.radiusY>15}const Vn=document.getElementById("showRect");let rt,ut;function Gn(e){rt=new c(e.clientX-s.x,e.clientY-s.y),ut=!1}function Wn(e){const t=new a(new oe(new c(0,0),0,0)),n=new c(e.clientX-s.x,e.clientY-s.y);if(d(r.tree),t.ellipse=at(rt,n),!ut){const i=r.tree.canInsert(t)&&ae(t.ellipse)?g():h();N(t,i),Vn.checked&&wn(rt,n,i)}}function jn(e){const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(at(rt,t));r.tree.canInsert(n)&&!ut&&ae(n.ellipse)&&r.tree.insert(n),d(r.tree)}function Jn(){ut=!0,d(r.tree)}const Kn=document.getElementById("canvas"),mn=Kn.getContext("2d");if(mn===null)throw Error("2d rendering context not supported");const Zn=mn,Qn=document.getElementById("atomDisplay");let ft,Bt,v=_e("A",new c(0,0));function _n(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(v=_e(e.key,new c(v.origin.x,v.origin.y)),v.origin.x!==0&&v.origin.y!==0&&Bt&&Nt())}function eo(e){ft=!1,Bt=!0,v=_e(v.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Nt()}function to(e){v=_e(v.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Nt()}function no(e){v=_e(v.identifier,new c(e.clientX-s.x,e.clientY-s.y)),r.tree.canInsert(v)&&!ft&&r.tree.insert(v),d(r.tree),Bt=!1}function oo(){ft=!0,d(r.tree)}function _e(e,t){Qn.innerHTML=e;const n=Zn.measureText(e);return new f(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Nt(){d(r.tree),ft||(r.tree.canInsert(v)?O(v,g(),!0):O(v,h(),!0))}let ue,M=null,Te;function ro(e){if(ue=new c(e.x-s.x,e.y-s.y),M=r.tree.getLowestNode(ue),M!==r.tree.sheet&&M!==null){const t=r.tree.getLowestParent(ue);if(t!==null&&t.remove(ue),M instanceof a&&M.children.length!==0){for(let n=0;n<M.children.length;n++)r.tree.insert(M.children[n]);M.children=[]}Te=!0,d(r.tree),M instanceof f?O(M,g(),!0):N(M,g())}else Te=!1}function io(e){if(Te){const t=new c(e.x-ue.x,e.y-ue.y);if(M instanceof a){const n=W(M,t);d(r.tree);const o=r.tree.canInsert(n)?g():h();N(n,o)}else if(M instanceof f){const n=S(M,t);d(r.tree);const o=r.tree.canInsert(n)?g():h();O(n,o,!0)}}}function lo(e){if(Te){const t=new c(e.x-ue.x,e.y-ue.y);if(M instanceof a){const n=W(M,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(M)}else if(M instanceof f){const n=S(M,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(M)}d(r.tree)}Te=!1}function so(){Te&&M!==null&&r.tree.insert(M),Te=!1,d(r.tree)}let fe,C=null,Pe;function co(e){if(fe=new c(e.x-s.x,e.y-s.y),C=r.tree.getLowestNode(fe),C!==r.tree.sheet&&C!==null){const t=r.tree.getLowestParent(fe);t!==null&&t.remove(fe),Pe=!0,d(r.tree),te(C,g())}else Pe=!1}function ao(e){if(Pe){const t=new c(e.x-fe.x,e.y-fe.y);if(d(r.tree),C instanceof a){const n=ge(r.tree,C,t)?g():h();X(C,n,t)}else if(C instanceof f){const n=S(C,t),o=r.tree.canInsert(n)?g():h();O(n,o,!0)}}}function uo(e){if(Pe){const t=new c(e.x-fe.x,e.y-fe.y);if(C instanceof a)ge(r.tree,C,t)?Ze(C,t):r.tree.insert(C);else if(C instanceof f){const n=S(C,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(C)}}d(r.tree),Pe=!1}function fo(){Pe&&C!==null&&r.tree.insert(C),Pe=!1,d(r.tree)}let de,V=null,$e;function ho(e){de=new c(e.x-s.x,e.y-s.y);const t=r.tree.getLowestNode(de),n=new c(e.x-de.x,e.y-de.y);t!==r.tree.sheet&&t!==null?(t instanceof a?(V=W(t,n),V.children=[]):t instanceof f&&(V=t),$e=!0):$e=!1}function wo(e){if($e){const t=new c(e.x-de.x,e.y-de.y);if(V instanceof a){const n=W(V,t);d(r.tree);const o=r.tree.canInsert(n)?g():h();N(n,o)}else if(V instanceof f){const n=S(V,t);d(r.tree);const o=r.tree.canInsert(n)?g():h();O(n,o,!0)}}}function po(e){if($e){const t=new c(e.x-de.x,e.y-de.y);if(V instanceof a&&V.ellipse!==null){const n=W(V,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(V instanceof f){const n=S(V,t);r.tree.canInsert(n)&&r.tree.insert(n)}d(r.tree)}$e=!1}function go(){$e=!1,d(r.tree)}let ve,H=null,Be;function yo(e){ve=new c(e.x-s.x,e.y-s.y),H=r.tree.getLowestNode(ve),H!==r.tree.sheet&&H!==null?Be=!0:Be=!1}function xo(e){if(Be){const t=new c(e.x-ve.x,e.y-ve.y);if(d(r.tree),H instanceof a){const n=ge(r.tree,H,t)?g():h();X(H,n,t)}else if(H instanceof f){const n=S(H,t),o=r.tree.canInsert(n)?g():h();O(n,o,!0)}}}function mo(e){if(Be){const t=new c(e.x-ve.x,e.y-ve.y);if(H instanceof a)ge(r.tree,H,t)&&Ze(H,t);else if(H instanceof f){const n=S(H,t);r.tree.canInsert(n)&&r.tree.insert(n)}}d(r.tree),Be=!1}function Mo(){Be=!1,d(r.tree)}let et,x=null,Q;function To(e){if(et=new c(e.x-s.x,e.y-s.y),x=r.tree.getLowestNode(et),x!==null){const t=r.tree.getLowestParent(et);t!==null&&t.remove(et),x instanceof a&&x.children.length!==0&&x!==r.tree.sheet&&Qe(r.tree,x),d(r.tree),x instanceof f?O(x,h(),!0):N(x,h()),Q=!0}else Q=!1}function Po(e){Q&&x!==null&&x.ellipse!==null&&ke(r.tree,x);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);Q&&x!==null&&o!==null&&(Q=!0,d(r.tree),n===null?(x=null,Q=!1):(o.remove(t),x=n,x instanceof a&&x.children.length!==0&&(Qe(r.tree,x),x.children=[]),d(r.tree),x instanceof f?O(x,h(),!0):N(x,h())))}function bo(e){const t=new c(e.x-s.x,e.y-s.y);if(Q){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&Qe(r.tree,n),d(r.tree)}x=null,Q=!1}function So(){Q&&x!==null&&ke(r.tree,x),x=null,Q=!1,d(r.tree)}let tt,$=null,J;function ko(e){if(tt=new c(e.x-s.x,e.y-s.y),$=r.tree.getLowestNode(tt),$!==null){const t=r.tree.getLowestParent(tt);t!==null?t.remove(tt):($=r.tree.sheet.copy(),r.tree.clear()),J=!0,d(r.tree),te($,h())}}function Co(e){J&&$!==null&&ke(r.tree,$);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);J&&$!==null&&o!==null?(J=!0,n===null?($=null,J=!1):(o.remove(t),$=n,J=!0,d(r.tree),te($,h()))):J&&o===null&&($=r.tree.sheet.copy(),r.tree.clear(),d(r.tree),te($,h()))}function Eo(e){const t=new c(e.x-s.x,e.y-s.y);if(J){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),d(r.tree)}$=null,J=!1}function Io(){J&&$!==null&&ke(r.tree,$),$=null,J=!1,d(r.tree)}let Ne,I=null,Oe,qe;const Lo=document.getElementById("selectionString");function Do(e){qe=new L(r.tree.sheet),r.selectForProof.sheet=new L().sheet,Ne=new c(e.x-s.x,e.y-s.y),I=r.tree.getLowestNode(Ne),Mn()}function $o(e){Oe&&(d(r.tree),Ne=new c(e.x-s.x,e.y-s.y),I=r.tree.getLowestNode(Ne),Mn())}function vo(){if(Oe&&I!==null){if(I instanceof a&&I.ellipse===null)for(let e=0;e<I.children.length;e++)r.selectForProof.insert(I.children[e]);else r.selectForProof.insert(I);d(r.tree)}I=null,Oe=!1}function Bo(){I=null,Oe=!1,d(r.tree)}function Mn(){const e=new L;let t=!1;if(I!==null){if(Oe=!0,I instanceof f||!I.isEqualTo(qe.sheet)){e.insert(I);const n=qe.getLowestParent(Ne);n!==null&&(n.remove(Ne),t=!0),d(qe)}else e.sheet=I,st();te(I,g()),t&&qe.insert(I)}else Oe=!1;Lo.innerHTML=e.toString()}function j(){const e=new L;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function Re(e,t){return e.canInsert(t)&&Tn(new L(e.sheet),t)}function Tn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new L(r.currentProofStep.tree.sheet))):!1}const No=document.getElementById("showRect");let it,dt,ye;function Oo(e){it=new c(e.clientX-s.x,e.clientY-s.y),ye=j(),dt=!1}function Ro(e){const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(at(it,t)),o=new a(Pn(n.ellipse));if(w(),!dt&&n.ellipse!==null&&o.ellipse!==null){const u=ye.canInsert(n)&&ae(n.ellipse)&&ye.canInsert(o)&&ae(o.ellipse)?g():h();N(n,u),N(o,u),No.checked&&wn(it,t,u)}}function Ao(e){const t=new c(e.clientX-s.x,e.clientY-s.y);ye=j();const n=new a(at(it,t)),o=new a(Pn(n.ellipse)),i=new z(ye,"DC Insert");!dt&&n.ellipse!==null&&o.ellipse!==null&&ye.canInsert(n)&&ae(n.ellipse)&&ye.canInsert(o)&&ae(o.ellipse)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),w()}function Fo(){dt=!0,w()}function Pn(e){return new oe(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let U=null,je,xe,Le,le;function Xo(e){le=new c(e.x-s.x,e.y-s.y),xe=j(),Le=new L(xe.sheet),U=xe.getLowestNode(le),bn()}function zo(e){le=new c(e.x-s.x,e.y-s.y),Le=new L(xe.sheet),U!==null&&(U=xe.getLowestNode(le),w(),bn())}function Yo(e){const t=new z(xe,"DC Delete");if(le=new c(e.x-s.x,e.y-s.y),je&&U instanceof a){const n=t.tree.getLowestParent(le),o=U.children[0];if(n!==null&&o instanceof a){n.remove(le);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}w()}function Ho(){je&&U!==null&&ke(Le,U),U=null,je=!1,w()}function Uo(e){return e.children.length===1&&e.children[0]instanceof a&&U!==xe.sheet}function qo(e){N(e,h()),e.children[0]instanceof a&&N(e.children[0],h())}function bn(){if(U instanceof a&&Uo(U)){je=!0;const e=Le.getLowestParent(le);if(e!==null){e.remove(le);const t=U.children[0].copy();Qe(Le,t),t.children=[]}d(Le),qo(U)}else je=!1}let y,k,F,E,Ae;function Vo(e){F=j();const t=r.selectForProof.sheet.children,n=new c(e.x-s.x,e.y-s.y);if(r.proof.length>0&&t.length===1){Ae=!0,y=t[0];const o=Ot(e,y),i=F.getLowestNode(n),u=F.getLowestParent(n);if(k=i instanceof f?u:i,o){const p=We(y,o);if(k!==null&&!k.containsNode(p))E=!1,X(y,h(),o);else if(k!==null&&k instanceof a&&k.ellipse!==null&&F.getLevel(k)%2===0){if(p instanceof a){E=!0;for(let m=0;m<k.children.length;m++)if(p.containsNode(k.children[m])){E=!1;break}}else E=!0;if(E){let m="";if(y instanceof a)m=ge(F,y,o)?g():h();else if(y instanceof f){const D=We(y,o);m=F.canInsert(D)?g():h()}E=m===g(),X(y,m,o)}else X(y,h(),o)}else E=!1,X(y,h(),o)}}else E=!1,Ae=!1,X(y,h(),n)}function Go(e){if(Ae){const t=new c(e.x-s.x,e.y-s.y);w();const n=Ot(e,y),o=F.getLowestNode(t),i=F.getLowestParent(t);if(k=o instanceof f?i:o,n){const u=We(y,n);if(k!==null&&!k.containsNode(u))E=!1,X(y,h(),n);else if(k!==null&&k instanceof a&&k.ellipse!==null&&F.getLevel(k)%2===0){if(u instanceof a){E=!0;for(let p=0;p<k.children.length;p++)if(u.containsNode(k.children[p])){E=!1;break}}else E=!0;if(E){let p="";if(y instanceof a)p=ge(F,y,n)?g():h();else if(y instanceof f){const m=We(y,n);p=F.canInsert(m)?g():h()}E=p===g(),X(y,p,n)}else X(y,h(),n)}else E=!1,X(y,h(),n)}}else E=!1}function Wo(e){if(Ae&&E){const t=Ot(e,y);if(t){if(y instanceof a)Ze(y,t,F);else if(y instanceof f){const n=We(y,t);F.insert(n)}r.pushToProof(new z(F,"Insertion"))}}w(),Ae=!1}function jo(){Ae=!1,w()}function Ot(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof f)return new c(e.x-t.origin.x,e.y-t.origin.y)}let G=null,Fe,me,Ve,se;function Jo(e){se=new c(e.x-s.x,e.y-s.y),me=j(),Ve=new L(me.sheet),G=me.getLowestNode(se),Sn()}function Ko(e){se=new c(e.x-s.x,e.y-s.y),G!==null&&(G=me.getLowestNode(se),w(),Sn())}function Zo(e){if(Fe){const t=new z(me,"Erasure");se=new c(e.x-s.x,e.y-s.y);const n=t.tree.getLowestParent(se);n!==null&&n.remove(se),r.pushToProof(t),w()}G=null,Fe=!1}function Qo(){Fe&&G!==null&&ke(Ve,G),G=null,Fe=!1,w()}function Sn(){if(G!==me.sheet&&G!==null&&me.getLevel(G)%2===0){Fe=!0;const e=Ve.getLowestParent(se);e!==null&&e.remove(se),d(Ve),te(G,h()),Ve.insert(G)}else Fe=!1}let re,A=null,Xe,Rt=new c(1,1);function _o(e){if(re=new c(e.x-s.x,e.y-s.y),A=r.tree.getLowestNode(re),A instanceof a&&A.ellipse!==null){Xe=!0;const t=r.tree.getLowestParent(re);t!==null&&t.remove(re);for(let n=0;n<A.children.length;n++)r.tree.insert(A.children[n]);Rt=pn(A,re),A.children=[]}}function er(e){if(Xe){const t=new c((e.x-s.x-re.x)/2,(e.y-s.y-re.y)/2);if(A instanceof a){const n=ct(A,t,Rt);if(n.ellipse!==null){d(r.tree);const i=r.tree.canInsert(n)&&ae(n.ellipse)?g():h();N(n,i)}}}}function tr(e){if(Xe){const t=new c((e.x-s.x-re.x)/2,(e.y-s.y-re.y)/2);if(A instanceof a){const n=ct(A,t,Rt);n.ellipse!==null&&(r.tree.canInsert(n)&&ae(n.ellipse)?r.tree.insert(n):r.tree.insert(A))}d(r.tree),Xe=!1}}function nr(){Xe&&A!==null&&r.tree.insert(A),Xe=!1,d(r.tree)}let he,P=null,be,q;function or(e){if(q=j(),he=new c(e.x-s.x,e.y-s.y),P=q.getLowestNode(he),P!==q.sheet&&P!==null){const t=q.getLowestParent(he);if(t!==null&&t.remove(he),P instanceof a&&P.children.length!==0){for(let n=0;n<P.children.length;n++)q.insert(P.children[n]);P.children=[]}be=!0,d(q),P instanceof f?O(P,g(),!0):N(P,g())}else be=!1}function rr(e){if(be){const t=new c(e.x-he.x,e.y-he.y);if(d(q),P instanceof a){const n=W(P,t),o=Re(q,n)?g():h();N(n,o)}else if(P instanceof f){const n=S(P,t),o=Re(q,n)?g():h();O(n,o,!0)}}}function ir(e){if(be){const t=new z(q,"Single Move"),n=new c(e.x-he.x,e.y-he.y);let o=null;P instanceof a?o=W(P,n):P instanceof f&&(o=S(P,n)),o!==null&&Re(q,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),be=!1}function lr(){be&&P!==null&&q.insert(P),be=!1,w()}let we,R=null,Tt=null,Se,K;function sr(e){K=j(),we=new c(e.x-s.x,e.y-s.y),R=K.getLowestNode(we),R!==K.sheet&&R!==null?(Tt=K.getLowestParent(we),Tt!==null&&Tt.remove(we),Se=!0,d(K),te(R,g())):Se=!1}function cr(e){if(Se){const t=new c(e.x-we.x,e.y-we.y);if(d(K),R instanceof a){const n=vt(R,t),o=Re(K,n)?g():h();X(R,o,t)}else if(R instanceof f){const n=S(R,t),o=Re(K,n)?g():h();O(n,o,!0)}}}function ar(e){if(Se){const t=new z(K,"Multi Move"),n=new c(e.x-we.x,e.y-we.y);let o=null;R instanceof a?o=vt(R,n):R instanceof f&&(o=S(R,n)),o!==null&&Re(K,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),Se=!1}function ur(){Se&&R!==null&&K.insert(R),Se=!1,w()}let It,lt,Je;function fr(){lt=j(),It=r.selectForProof.sheet,It.children.length>0&&r.proof.length===1&&lt.sheet.isEmptySheet()&&(Je=!0)}function dr(){Je=!1,w()}function hr(){Je&&(lt.sheet=It,r.pushToProof(new z(lt,"Pasted"))),Je=!1,w()}function wr(){Je=!1,w()}let Me,B=null,Lt=null,Ke,_;function pr(e){_=j(),Me=new c(e.x-s.x,e.y-s.y),B=_.getLowestNode(Me),Lt=_.getLowestParent(Me),Ke=B!==_.sheet&&B!==null}function gr(e){if(Ke){const t=new c(e.x-Me.x,e.y-Me.y);w();const n=new c(e.x-s.x,e.y-s.y),o=kn(t,n)?g():h();if(B instanceof a)X(B,o,t);else if(B instanceof f){const i=S(B,t);O(i,o,!0)}}}function yr(e){if(Ke){const t=new c(e.x-Me.x,e.y-Me.y);if(kn(t,new c(e.x-s.x,e.y-s.y))){if(B instanceof a)Ze(B,t,_);else if(B instanceof f){const n=S(B,t);_.insert(n)}r.pushToProof(new z(_,"Iteration"))}}w(),Ke=!1}function xr(){Ke=!1,w()}function kn(e,t){return Lt!==null&&Lt.containsPoint(t)&&(B instanceof a&&ge(_,B,e)&&Cn(_.sheet,W(B,e).ellipse)||B instanceof f&&_.canInsert(S(B,e)))}function Cn(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof oe&&(t.contains(e.children[n].ellipse)||!Cn(e.children[n],t)))return!1}else if(e.children[n]instanceof f&&t.contains(e.children[n].calcRect()))return!1;return!0}let ie,Y=null,ze,At=new c(1,1),ee;function mr(e){if(ee=j(),ie=new c(e.x-s.x,e.y-s.y),Y=ee.getLowestNode(ie),Y instanceof a&&Y.ellipse!==null){ze=!0;const t=ee.getLowestParent(ie);t!==null&&t.remove(ie);for(let n=0;n<Y.children.length;n++)ee.insert(Y.children[n]);At=pn(Y,ie),Y.children=[]}}function Mr(e){if(ze){const t=new c((e.x-s.x-ie.x)/2,(e.y-s.y-ie.y)/2);if(Y instanceof a){const n=ct(Y,t,At);if(n.ellipse!==null){d(ee);const o=En(n)?g():h();N(n,o)}}}}function Tr(e){if(ze){const t=new c((e.x-s.x-ie.x)/2,(e.y-s.y-ie.y)/2);if(Y instanceof a){const n=ct(Y,t,At);n.ellipse!==null&&En(n)&&(ee.insert(n),r.pushToProof(new z(ee,"Resize")))}w(),ze=!1}}function Pr(){ze&&Y!==null&&ee.insert(Y),ze=!1,w()}function En(e){return ee.canInsert(e)&&ae(e.ellipse)&&Tn(new L(ee.sheet),e)}let b=null,Ye,Ge,ce,Z;function br(e){ce=new c(e.x-s.x,e.y-s.y),Z=j(),Ge=new L(Z.sheet),b=Z.getLowestNode(ce),In()}function Sr(e){ce=new c(e.x-s.x,e.y-s.y),b!==null&&(b=Z.getLowestNode(ce),w(),In())}function kr(e){if(Ye&&(ce=new c(e.x-s.x,e.y-s.y),b!==null&&Ft(Z.sheet,Z.getLevel(b)))){const t=Z.getLowestParent(ce);t instanceof a&&t.remove(ce),r.pushToProof(new z(Z,"Deiteration"))}Ye=!1,w()}function In(){if(b!==null&&!(b instanceof a&&b.ellipse===null)&&Ft(Z.sheet,Z.getLevel(b))){Ye=!0;const e=Ge.getLowestParent(ce);e!==null&&e.remove(ce),d(Ge),te(b,h()),Ge.insert(b)}else Ye=!1}function Cr(){Ye&&b!==null&&ke(Ge,b),Ye=!1,b=null,w()}function Ft(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&b instanceof a&&b.isEqualTo(e.children[o])&&b.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof f&&b instanceof f&&e.children[o].identifier===b.identifier&&e.children[o].toString()!==b.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(b)&&Z.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Ft(n,t):!1}let Zt,Xt;function Er(){Zt=j(),Xt=!0,st(),te(Zt.sheet,h())}function Ir(){Xt&&(Ct(-1),r.clearProof(),w())}function Lr(){Xt=!1,w()}const ne=document.getElementById("canvas");ne.width=window.innerWidth;ne.height=window.innerHeight;const Ln=ne.getContext("2d");if(Ln===null)throw Error("2d rendering context not supported");const Dr=Ln;Dr.font="35pt arial";const Pt=document.getElementById("cutTools"),Qt=document.getElementById("atomTools"),_t=document.getElementById("graphString"),en=document.getElementById("proofString"),tn=document.getElementById("toProofTools");window.addEventListener("keydown",Nr);ne.addEventListener("mousedown",Or);ne.addEventListener("mousemove",Rr);ne.addEventListener("mouseup",Ar);ne.addEventListener("mouseout",Fr);ne.addEventListener("mouseenter",Xr);let zt=!1,Yt=!0;window.tree=r.tree;window.treeString=ht(window.tree);window.atomTool=l.atomTool;window.cutTool=l.cutTool;window.dragTool=l.dragTool;window.aegStringify=ht;window.saveMode=Dn;window.loadMode=Br;window.moveSingleTool=l.moveSingleTool;window.moveMultiTool=l.moveMultiTool;window.copySingleTool=l.copySingleTool;window.copyMultiTool=l.copyMultiTool;window.deleteSingleTool=l.deleteSingleTool;window.deleteMultiTool=l.deleteMultiTool;window.copyFromDrawTool=l.copyFromDrawTool;window.pasteInProofTool=l.pasteInProofTool;window.doubleCutInsertionTool=l.doubleCutInsertionTool;window.resizeTool=l.resizeTool;window.doubleCutDeletionTool=l.doubleCutDeletionTool;window.insertionTool=l.insertionTool;window.erasureTool=l.erasureTool;window.proofMoveSingleTool=l.proofMoveSingleTool;window.proofMoveMultiTool=l.proofMoveMultiTool;window.proofResizeTool=l.proofResizeTool;window.iterationTool=l.iterationTool;window.deiterationTool=l.deiterationTool;window.clearProofTool=l.clearProofTool;window.setTool=vr;window.setHighlight=$r;window.toggleHandler=Un;function $r(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const nn=document.querySelectorAll(".toolButton");nn.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),nn.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function vr(e){switch(r.toolState=e,Pt.style.display="none",Qt.style.display="none",tn.style.display="none",r.toolState){case l.atomTool:Qt.style.display="block";break;case l.cutTool:Pt.style.display="block";break;case l.copyFromDrawTool:tn.style.display="block";break;case l.doubleCutInsertionTool:Pt.style.display="block";break}}function ht(e){return JSON.stringify(e,null,"	")}async function Dn(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Hn(n,t)}else{const n=document.createElement("a");n.href=ht(t),n.download=e+".json",n.click()}}catch{}}async function Br(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const u=Et(r.modeState,o);if(r.modeState==="Draw")r.tree=u,d(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=u,(i=document.getElementById("Row: 1"))==null||i.remove();for(let p=0;p<r.proof.length;p++)gn(r.proof[p],p+1);r.currentProofStep=r.proof[r.proof.length-1],w()}}else console.log("Loading failed because reading the file was unsuccessful")}),n.readAsText(t)}catch{}}function Nr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),Dn();else switch(r.toolState){case l.atomTool:_n(e);break}}function Or(e){switch(r.toolState){case l.cutTool:Gn(e);break;case l.atomTool:eo(e);break;case l.dragTool:vn(e);break;case l.moveSingleTool:ro(e);break;case l.moveMultiTool:co(e);break;case l.copySingleTool:ho(e);break;case l.copyMultiTool:yo(e);break;case l.deleteSingleTool:To(e);break;case l.deleteMultiTool:ko(e);break;case l.resizeTool:_o(e);break;case l.copyFromDrawTool:Do(e);break;case l.pasteInProofTool:fr();break;case l.doubleCutInsertionTool:Oo(e);break;case l.doubleCutDeletionTool:Xo(e);break;case l.insertionTool:Vo(e);break;case l.erasureTool:Jo(e);break;case l.proofMoveSingleTool:or(e);break;case l.proofMoveMultiTool:sr(e);break;case l.proofResizeTool:mr(e);break;case l.iterationTool:pr(e);break;case l.deiterationTool:br(e);break;case l.clearProofTool:Er();break}zt=!0}function Rr(e){if(zt&&Yt)switch(r.toolState){case l.cutTool:Wn(e);break;case l.atomTool:to(e);break;case l.dragTool:Bn(e);break;case l.moveSingleTool:io(e);break;case l.moveMultiTool:ao(e);break;case l.copySingleTool:wo(e);break;case l.copyMultiTool:xo(e);break;case l.deleteSingleTool:Po(e);break;case l.deleteMultiTool:Co(e);break;case l.resizeTool:er(e);break;case l.copyFromDrawTool:$o(e);break;case l.pasteInProofTool:dr();break;case l.doubleCutInsertionTool:Ro(e);break;case l.doubleCutDeletionTool:zo(e);break;case l.insertionTool:Go(e);break;case l.erasureTool:Ko(e);break;case l.proofMoveSingleTool:rr(e);break;case l.proofMoveMultiTool:cr(e);break;case l.proofResizeTool:Mr(e);break;case l.iterationTool:gr(e);break;case l.deiterationTool:Sr(e);break}}function Ar(e){switch(r.toolState){case l.cutTool:jn(e);break;case l.atomTool:no(e);break;case l.moveSingleTool:lo(e);break;case l.moveMultiTool:uo(e);break;case l.copySingleTool:po(e);break;case l.copyMultiTool:mo(e);break;case l.deleteSingleTool:bo(e);break;case l.deleteMultiTool:Eo(e);break;case l.resizeTool:tr(e);break;case l.copyFromDrawTool:vo();break;case l.pasteInProofTool:hr();break;case l.doubleCutInsertionTool:Ao(e);break;case l.doubleCutDeletionTool:Yo(e);break;case l.insertionTool:Wo(e);break;case l.erasureTool:Zo(e);break;case l.proofMoveSingleTool:ir(e);break;case l.proofMoveMultiTool:ar(e);break;case l.proofResizeTool:Tr(e);break;case l.iterationTool:yr(e);break;case l.deiterationTool:kr(e);break;case l.clearProofTool:Ir();break}zt=!1}function Fr(){switch(r.toolState){case l.cutTool:Jn();break;case l.atomTool:oo();break;case l.dragTool:Nn();break;case l.moveSingleTool:so();break;case l.moveMultiTool:fo();break;case l.copySingleTool:go();break;case l.copyMultiTool:Mo();break;case l.deleteSingleTool:So();break;case l.deleteMultiTool:Io();break;case l.resizeTool:nr();break;case l.copyFromDrawTool:Bo();break;case l.pasteInProofTool:wr();break;case l.doubleCutInsertionTool:Fo();break;case l.doubleCutDeletionTool:Ho();break;case l.insertionTool:jo();break;case l.erasureTool:Qo();break;case l.proofMoveSingleTool:lr();break;case l.proofMoveMultiTool:ur();break;case l.proofResizeTool:Pr();break;case l.iterationTool:xr();break;case l.deiterationTool:Cr();break;case l.clearProofTool:Lr();break}Yt=!1}function Xr(){Yt=!0}function zr(){ne.width=window.innerWidth,ne.height=window.innerHeight}window.onresize=zr;
