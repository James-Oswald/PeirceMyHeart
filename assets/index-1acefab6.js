/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const D of d.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&r(D)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}toString(){return"("+this.x+", "+this.y+")"}}function U(e,t){return Ue(e,t)||W(t,e)}function Ue(e,t){if(e instanceof X)return t instanceof X?Be(e,t):ve(t,e);if(t instanceof X)return ve(e,t);if(Be(e.boundingBox,t.boundingBox)||W(t.boundingBox,e.boundingBox)){const n=Ve(e);let r;for(let i=0;i<n.length;i++)if(r=ie(t,n[i]),r<=0)return!0;return!1}return!1}function ve(e,t){const n=t.getCorners(),r=ne(e,n[0].x,1),i=ne(e,n[1].x,1),d=ne(e,n[0].x,-1),D=ne(e,n[1].x,-1);if(n[0].y<r&&r<n[2].y||n[0].y<d&&d<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<D&&D<n[2].y)return!0;const E=-1/Math.pow(e.radiusX,2),T=2*e.center.x/Math.pow(e.radiusX,2),te=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),De=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),we=(-T+Math.sqrt(Math.pow(T,2)-4*E*te))/(2*E),ye=(-T-Math.sqrt(Math.pow(T,2)-4*E*te))/(2*E),ge=(-T+Math.sqrt(Math.pow(T,2)-4*E*De))/(2*E),pe=(-T-Math.sqrt(Math.pow(T,2)-4*E*De))/(2*E);return!isNaN(we)&&n[0].x<we&&we<n[1].x||!isNaN(ye)&&n[0].x<ye&&ye<n[1].x||!isNaN(ge)&&n[0].x<ge&&ge<n[1].x||!isNaN(pe)&&n[0].x<pe&&pe<n[1].x}function W(e,t){if(e instanceof X)if(t instanceof X){const n=t.getCorners();for(let r=0;r<4;r++)if(!Me(e,n[r]))return!1;return!0}else{const n=ft(t);for(let r=0;r<4;r++)if(!Me(e,n[r]))return!1;return!0}else if(t instanceof X){const n=t.getCorners();let r;for(let i=0;i<4;i++)if(r=ie(e,n[i]),!(r<0))return!1;return!0}else{const n=Ve(t);let r;for(let i=0;i<n.length;i++)if(r=ie(e,n[i]),!(r<0))return!1;return!0}}function Be(e,t){const n=e.getCorners(),r=t.getCorners();return(n[0].y<=r[0].y&&n[2].y>=r[0].y||n[0].y<=r[2].y&&n[2].y>=r[2].y||r[0].y<=n[0].y&&r[2].y>=n[0].y||r[0].y<=n[2].y&&r[2].y>=n[2].y)&&(n[0].x<=r[0].x&&n[1].x>=r[0].x||n[0].x<=r[1].x&&n[1].x>=r[1].x||r[0].x<=n[0].x&&r[1].x>=n[0].x||r[0].x<=n[1].x&&r[1].x>=n[1].x)}function Me(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function ie(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function ft(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function Ve(e){const t=[];let n,r,i=1;for(let d=0;d<360;d++)n=e.center.x+e.radiusX*Math.cos(d*(Math.PI/180)),d>180&&(i=-1),r=ne(e,n,i),t[d]=new c(n,r);return t}function ne(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class X{constructor(t,n,r){if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(r!==void 0&&r<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=r}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Me(this,t)}overlaps(t){return U(this,t)}contains(t){return W(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,r,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=r,this.internalHeight=i}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new X(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const r=this.internalChildren[n];if(r instanceof a&&r.containsNode(t))return r.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?W(this.internalEllipse,t.calcRect()):W(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const r=this.internalChildren[n];for(let i=0;i<r.children.length;i++)if(r.children[i].containsPoint(t))return r.getLowestParent(t);return this}}return null}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let r=0;r<this.children[n].children.length;r++)if(this.children[n].children[r].containsPoint(t))if(this.children[n].children[r]instanceof f)this.children[n].children.splice(r,1);else return this.children[n].children[r].remove(t);return this.children.splice(n,1),!0}return!1}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class ee{constructor(t){this.internalSheet=new a(null),t instanceof a&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let r=n+1;r<t.children.length;r++)if(this.overlaps(t.children[n],t.children[r]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let r=0;r<n.children.length;r++)if(this.intersects(t,n.children[r]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),r=[...n.children];if(n.child=t,t instanceof a)for(let i=r.length-1;i>=0;i--)t.containsNode(r[i])&&(t.child=r[i],n.children.splice(i,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}remove(t){return this.internalSheet.remove(t)}intersects(t,n){const r=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return Ue(r,i)}overlaps(t,n){let r,i;return t instanceof f?n instanceof f?U(t.calcRect(),n.calcRect()):(r=n.ellipse,U(t.calcRect(),r)):n instanceof f?(r=t.ellipse,U(r,n.calcRect())):(r=t.ellipse,i=n.ellipse,U(r,i))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.toProofMode=11]="toProofMode",e[e.doubleCutInsertionTool=12]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=13]="doubleCutDeletionTool",e))(s||{});class o{}o.tree=new ee;o.selectForProof=new ee;o.toolState=0;class z{constructor(t,n,r){if(this.center=t,this.radiusX=n,this.radiusY=r,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new X(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return ie(this,t)<0}overlaps(t){return U(this,t)}contains(t){return W(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const dt=document.getElementById("theme-select");function G(e){return getComputedStyle(document.body).getPropertyValue(e)}let Ge=G("--good-placement"),We=G("--bad-placement"),je=G("--canvas-items");function qe(){setTimeout(()=>{Ge=G("--good-placement"),We=G("--bad-placement"),je=G("--canvas-items"),u(o.tree)})}dt.addEventListener("input",()=>{qe()});window.addEventListener("DOMContentLoaded",()=>{qe()});function w(){return We}function m(){return Ge}function Je(){return je}const be=document.getElementById("canvas"),Ke=be.getContext("2d");if(Ke===null)throw Error("2d rendering context not supported");const h=Ke;h.font="35pt arial";const ht=document.getElementById("graphString"),wt=document.getElementById("atomBox"),Ze=document.getElementById("atomBoxes");Ze.addEventListener("input",yt);function C(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const r=n.center;h.beginPath(),h.ellipse(r.x+l.x,r.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function M(e,t,n){h.textBaseline="bottom";const r=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(Ze.checked||wt.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-r.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function Qe(e,t,n){h.beginPath(),h.strokeStyle=n;const r=e.x-t.x+l.x,i=e.y-t.y+l.y;h.rect(e.x,e.y,-r,-i),h.stroke()}function yt(){u(o.tree)}function _e(){h.clearRect(0,0,be.width,be.height)}function u(e){ht.innerHTML=e.toString(),_e(),et(e.sheet)}function et(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof f?gt(e.children[t]):et(e.children[t]);e.ellipse instanceof z&&(h.strokeStyle=Je(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function gt(e){M(e,Je(),!1)}let Ce,l=new c(0,0),Te;function pt(e){Ce=new c(e.x-l.x,e.y-l.y),Te=!1}function xt(e){Te||(l=new c(e.x-Ce.x,e.y-Ce.y),u(o.tree))}function mt(){Te=!0,u(o.tree)}const Mt=document.getElementById("showRect"),bt=document.getElementById("mode");let se,ae;function Ct(e){se=new c(e.clientX-l.x,e.clientY-l.y),ae=!1}function Et(e){const t=new a(new z(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(u(o.tree),t.ellipse=ue(se,n),!ae){const i=o.tree.canInsert(t)&&Y(t.ellipse)?m():w();C(t,i),Mt.checked&&Qe(se,n,i)}}function Tt(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(ue(se,t));o.tree.canInsert(n)&&!ae&&Y(n.ellipse)&&o.tree.insert(n),u(o.tree)}function Pt(){ae=!0,u(o.tree)}function ue(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),r=e.x-t.x,i=e.y-t.y,d=Math.abs(r),D=Math.abs(i);let E,T;if(bt.value==="circumscribed"){const te=Math.floor(n.distance(t));T=Math.floor(te*(D/d)),E=Math.floor(te*(d/D))}else E=d/2,T=D/2;return new z(n,E,T)}function Y(e){return e.radiusX>15&&e.radiusY>15}const kt=document.getElementById("canvas"),tt=kt.getContext("2d");if(tt===null)throw Error("2d rendering context not supported");const St=tt,nt=document.getElementById("atomDisplay");let v,fe,N="A";nt.innerHTML=N;function It(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=e.key,nt.innerHTML=N)}function Lt(e){v=St.measureText(N),fe=!1;const t=new f(N,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);u(o.tree);const n=o.tree.canInsert(t)?m():w();M(t,n,!0)}function Dt(e){const t=new f(N,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);u(o.tree),fe||(o.tree.canInsert(t)?M(t,m(),!0):M(t,w(),!0))}function vt(e){const t=new f(N,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);o.tree.canInsert(t)&&!fe&&o.tree.insert(t),u(o.tree)}function Bt(){fe=!0,u(o.tree)}async function Ot(e,t){const n=JSON.stringify(t,null,"	"),r=await e.createWritable();await r.write(n),await r.close()}function Ee(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,r=new ee,i=[];return n.forEach(d=>{Object.prototype.hasOwnProperty.call(d,"internalEllipse")?i.push(rt(d)):i.push(ot(d))}),r.sheet.children=i,r}return null}function rt(e){const t=new z(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(r=>{"internalEllipse"in r?n.push(rt(r)):n.push(ot(r))}),new a(t,n)}function ot(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}function re(e,t){if(e.ellipse!==null){const n=F(e,t);if(!o.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof a&&e.children[n].ellipse!==null&&!re(e.children[n],t))return!1;if(e.children[n]instanceof f){let r=e.children[n];if(r=L(r,t),!o.tree.canInsert(r))return!1}}return!0}function Pe(e,t,n){if(e instanceof a&&e.ellipse!==null){const r=F(e,n);if(C(r,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Pe(e.children[i],t,n)}else if(e instanceof f){const r=L(e,n);M(r,t,!0)}}function ke(e,t){if(e instanceof a&&e.ellipse!==null){const n=F(e,t);if(o.tree.insert(n),e.children.length!==0)for(let r=0;r<e.children.length;r++)ke(e.children[r],t)}else if(e instanceof f){const n=L(e,t);o.tree.insert(n)}}function F(e,t){if(e.ellipse!==null)return new a(new z(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function L(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}let O,y=null,H;function At(e){if(O=new c(e.x-l.x,e.y-l.y),y=o.tree.getLowestNode(O),y!==o.tree.sheet&&y!==null){const t=o.tree.getLowestParent(O);if(t!==null&&t.remove(O),y instanceof a&&y.children.length!==0){for(let n=0;n<y.children.length;n++)o.tree.insert(y.children[n]);y.children=[]}H=!0}else H=!1}function Xt(e){if(H){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof a){const n=F(y,t);u(o.tree);const r=o.tree.canInsert(n)?m():w();C(n,r)}else if(y instanceof f){const n=L(y,t);u(o.tree);const r=o.tree.canInsert(n)?m():w();M(n,r,!0)}}}function $t(e){if(H){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof a){const n=F(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}else if(y instanceof f){const n=L(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}u(o.tree)}H=!1}function Yt(){H&&y!==null&&o.tree.insert(y),H=!1,u(o.tree)}let A,p=null,R;function Ft(e){if(A=new c(e.x-l.x,e.y-l.y),p=o.tree.getLowestNode(A),p!==o.tree.sheet&&p!==null){const t=o.tree.getLowestParent(A);t!==null&&t.remove(A),R=!0}else R=!1}function Nt(e){if(R){const t=new c(e.x-A.x,e.y-A.y);if(u(o.tree),p instanceof a){const n=re(p,t)?m():w();Pe(p,n,t)}else if(p instanceof f){const n=L(p,t),r=o.tree.canInsert(n)?m():w();M(n,r,!0)}}}function Ht(e){if(R){const t=new c(e.x-A.x,e.y-A.y);if(p instanceof a)re(p,t)?ke(p,t):o.tree.insert(p);else if(p instanceof f){const n=L(p,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(p)}}u(o.tree),R=!1}function Rt(){R&&p!==null&&o.tree.insert(p),R=!1,u(o.tree)}let j,P=null,q;function zt(e){j=new c(e.x-l.x,e.y-l.y);const t=o.tree.getLowestNode(j);t!==o.tree.sheet&&t!==null?(t instanceof a?(P=F(t,new c(0,0)),P.children=[]):t instanceof f&&(P=t),q=!0):q=!1}function Ut(e){if(q){const t=new c(e.x-j.x,e.y-j.y);if(P instanceof a){const n=F(P,t);u(o.tree);const r=o.tree.canInsert(n)?m():w();C(n,r)}else if(P instanceof f){const n=L(P,t);u(o.tree);const r=o.tree.canInsert(n)?m():w();M(n,r,!0)}}}function Vt(e){if(q){const t=new c(e.x-j.x,e.y-j.y);if(P instanceof a&&P.ellipse!==null){const n=F(P,t);o.tree.canInsert(n)&&o.tree.insert(n)}else if(P instanceof f){const n=L(P,t);o.tree.canInsert(n)&&o.tree.insert(n)}u(o.tree)}q=!1}function Gt(){q=!1,u(o.tree)}let J,b=null,K;function Wt(e){J=new c(e.x-l.x,e.y-l.y),b=o.tree.getLowestNode(J),b!==o.tree.sheet&&b!==null?K=!0:K=!1}function jt(e){if(K){const t=new c(e.x-J.x,e.y-J.y);if(u(o.tree),b instanceof a){const n=re(b,t)?m():w();Pe(b,n,t)}else if(b instanceof f){const n=L(b,t),r=o.tree.canInsert(n)?m():w();M(n,r,!0)}}}function qt(e){if(K){const t=new c(e.x-J.x,e.y-J.y);if(b instanceof a)re(b,t)&&ke(b,t);else if(b instanceof f){const n=L(b,t);o.tree.canInsert(n)&&o.tree.insert(n)}}u(o.tree),K=!1}function Jt(){K=!1,u(o.tree)}let Oe,g=null,Z;function Kt(e){Oe=new c(e.x-l.x,e.y-l.y),g=o.tree.getLowestNode(Oe),g!==o.tree.sheet&&g!==null&&(Z=!0,g instanceof f?M(g,w(),!0):C(g,w()))}function Zt(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);g!==null&&g!==n&&(Z=!0,u(o.tree),n===o.tree.sheet||n===null?(g=null,Z=!1):(g=n,g instanceof f?M(g,w(),!0):C(g,w())))}function Qt(e){const t=new c(e.x-l.x,e.y-l.y);if(Z){const n=o.tree.getLowestParent(t);if(n!==null&&n.remove(t),g instanceof a&&g.children.length!==0)for(let r=0;r<g.children.length;r++)o.tree.insert(g.children[r])}u(o.tree),g=null,Z=!1}function _t(){g=null,Z=!1}let Ae,I=null,Q;function en(e){Ae=new c(e.x-l.x,e.y-l.y),I=o.tree.getLowestNode(Ae),I!==o.tree.sheet&&I!==null&&(Q=!0,Se(I,w()))}function tn(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);I!==null&&I!==o.tree.getLowestNode(t)&&(Q=!0,u(o.tree),n===o.tree.sheet||n===null?(I=null,Q=!1):(I=n,Se(I,w())))}function nn(e){const t=new c(e.x-l.x,e.y-l.y);if(Q){const n=o.tree.getLowestParent(t);n!==null&&n.remove(t),u(o.tree)}I=null,Q=!1}function rn(){I=null,Q=!1}function Se(e,t){if(e instanceof f)M(e,t,!0);else if(e instanceof a){C(e,t);for(let n=0;n<e.children.length;n++)Se(e.children[n],t)}}let oe,S=null,de;function on(e){if(o.selectForProof.sheet=new ee().sheet,oe=new c(e.x,e.y),S=o.tree.getLowestNode(oe),S!==null){if(de=!0,S!==o.tree.sheet){const t=o.tree.getLowestParent(oe);t!==null&&t.remove(oe),u(o.tree)}else _e();S instanceof f?M(S,m(),!0):it(S,m()),S!==o.tree.sheet&&o.tree.insert(S)}}function sn(){S=null,de=!1,u(o.tree)}function ln(){de&&(o.selectForProof.insert(S),u(o.tree),alert("Graph selected, you may now toggle to proof mode"))}function cn(){S=null,de=!1,u(o.tree)}function it(e,t){if(e instanceof f)M(e,t,!0);else if(e instanceof a){C(e,t);for(let n=0;n<e.children.length;n++)it(e.children[n],t)}}const an=document.getElementById("showRect");let le,he;function un(e){le=new c(e.clientX-l.x,e.clientY-l.y),he=!1}function fn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(ue(le,t)),r=new a(st(n.ellipse));if(u(o.tree),!he&&n.ellipse!==null&&r.ellipse!==null){const d=o.tree.canInsert(n)&&Y(n.ellipse)&&o.tree.canInsert(r)&&Y(r.ellipse)?m():w();C(n,d),C(r,d),an.checked&&Qe(le,t,d)}}function dn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(ue(le,t)),r=new a(st(n.ellipse));!he&&n.ellipse!==null&&r.ellipse!==null&&o.tree.canInsert(n)&&Y(n.ellipse)&&o.tree.canInsert(r)&&Y(r.ellipse)&&(o.tree.insert(n),o.tree.insert(r)),u(o.tree)}function hn(){he=!0,u(o.tree)}function st(e){return new z(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let $=null,ce;function wn(e){const t=new c(e.x-l.x,e.y-l.y);$=o.tree.getLowestNode(t),lt()}function yn(e){const t=new c(e.x-l.x,e.y-l.y);$=o.tree.getLowestNode(t),u(o.tree),lt()}function gn(e){const t=new c(e.x-l.x,e.y-l.y);if(ce&&$ instanceof a){const n=o.tree.getLowestParent(t),r=$.children[0];if(n!==null&&r instanceof a){n.remove(t);for(let i=0;i<r.children.length;i++)o.tree.insert(r.children[i])}}u(o.tree)}function pn(){ce=!1,u(o.tree)}function xn(e){return e.children.length===1&&e.children[0]instanceof a&&$!==o.tree.sheet}function mn(e){C(e,w()),e.children[0]instanceof a&&C(e.children[0],w())}function lt(){$ instanceof a&&xn($)?(ce=!0,mn($)):ce=!1}let xe=!0,Xe=null,$e=null,Ye=s.none,Fe=s.none;const Ne=document.getElementById("DrawButtons"),He=document.getElementById("ProofButtons");function Mn(){if(xe=!xe,xe){Ne.style.display="block",He.style.display="none",$e=JSON.stringify(o.tree),Fe=o.toolState;const e=Ee(Xe);if(e!==null)o.tree.sheet=e.sheet;else throw Error("invalid cached AEG");o.toolState=Ye}else{Ne.style.display="none",He.style.display="block",Xe=JSON.stringify(o.tree),Ye=o.toolState;const e=Ee($e);if(e!==null){o.tree.sheet=e.sheet;for(let t=0;t<o.selectForProof.sheet.children.length;t++){const n=o.selectForProof.sheet.children[t];try{o.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else o.tree.sheet=o.selectForProof.sheet;o.toolState=Fe,o.selectForProof.sheet=new ee().sheet}u(o.tree)}let k,x=null,_;const V=new c(1,1);function bn(e){if(k=new c(e.x-l.x,e.y-l.y),x=o.tree.getLowestNode(k),x!==o.tree.sheet&&x instanceof a){_=!0;const t=o.tree.getLowestParent(k);t!==null&&t.remove(k);for(let n=0;n<x.children.length;n++)o.tree.insert(x.children[n]);Pn(),x.children=[]}}function Cn(e){if(_){const t=new c((e.x-k.x)/2,(e.y-k.y)/2);if(x instanceof a){const n=ct(x,t);if(n.ellipse!==null){u(o.tree);const i=o.tree.canInsert(n)&&Y(n.ellipse)?m():w();C(n,i)}}}}function En(e){if(_){const t=new c((e.x-k.x)/2,(e.y-k.y)/2);if(x instanceof a){const n=ct(x,t);n.ellipse!==null&&(o.tree.canInsert(n)&&Y(n.ellipse)?o.tree.insert(n):o.tree.insert(x))}u(o.tree),_=!1}}function Tn(){_&&x!==null&&o.tree.insert(x),_=!1,u(o.tree)}function ct(e,t){if(e.ellipse!==null)return new a(new z(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX+t.x*V.x,e.ellipse.radiusY+t.y*V.y));throw new Error("Cannot alter the position of a cut without an ellipse.")}function Pn(){if(x instanceof a&&x.ellipse!==null){const e=x.ellipse,t=[new c(e.center.x-e.radiusX,e.center.y),new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY)];t[0].distance(k)>=t[2].distance(k)?V.x=1:V.x=-1,t[1].distance(k)>=t[3].distance(k)?V.y=1:V.y=-1}}const B=document.getElementById("canvas");B.width=window.innerWidth;B.height=window.innerHeight;const at=B.getContext("2d");if(at===null)throw Error("2d rendering context not supported");const kn=at;kn.font="35pt arial";const me=document.getElementById("cutTools"),Re=document.getElementById("atomTools");window.addEventListener("keydown",Dn);B.addEventListener("mousedown",vn);B.addEventListener("mousemove",Bn);B.addEventListener("mouseup",On);B.addEventListener("mouseout",An);B.addEventListener("mouseenter",Xn);let Ie=!1,Le=!0;window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.saveMode=ut;window.loadMode=Ln;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.setTool=In;window.setHighlight=Sn;window.toggleHandler=Mn;function Sn(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const ze=document.querySelectorAll(".modeButton");ze.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),ze.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function In(e){switch(o.toolState=e,me.style.display="none",Re.style.display="none",o.toolState){case s.atomTool:Re.style.display="block";break;case s.cutTool:me.style.display="block";break;case s.doubleCutInsertionTool:me.style.display="block";break}}async function ut(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Ot(e,o.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(o.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function Ln(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const r=n.result,i=Ee(r);i instanceof ee&&(o.tree=i,u(o.tree))}),n.readAsText(t)}function Dn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),ut();else switch(o.toolState){case s.atomTool:It(e);break}}function vn(e){switch(o.toolState){case s.cutTool:Ct(e);break;case s.atomTool:Lt(e);break;case s.dragTool:pt(e);break;case s.moveSingleTool:At(e);break;case s.moveMultiTool:Ft(e);break;case s.copySingleTool:zt(e);break;case s.copyMultiTool:Wt(e);break;case s.deleteSingleTool:Kt(e);break;case s.deleteMultiTool:en(e);break;case s.resizeTool:bn(e);break;case s.toProofMode:on(e);break;case s.doubleCutInsertionTool:un(e);break;case s.doubleCutDeletionTool:wn(e);break}Ie=!0}function Bn(e){if(Ie&&Le)switch(o.toolState){case s.cutTool:Et(e);break;case s.atomTool:Dt(e);break;case s.dragTool:xt(e);break;case s.moveSingleTool:Xt(e);break;case s.moveMultiTool:Nt(e);break;case s.copySingleTool:Ut(e);break;case s.copyMultiTool:jt(e);break;case s.deleteSingleTool:Zt(e);break;case s.deleteMultiTool:tn(e);break;case s.resizeTool:Cn(e);break;case s.toProofMode:sn();break;case s.doubleCutInsertionTool:fn(e);break;case s.doubleCutDeletionTool:yn(e);break}}function On(e){switch(o.toolState){case s.cutTool:Tt(e);break;case s.atomTool:vt(e);break;case s.moveSingleTool:$t(e);break;case s.moveMultiTool:Ht(e);break;case s.copySingleTool:Vt(e);break;case s.copyMultiTool:qt(e);break;case s.deleteSingleTool:Qt(e);break;case s.deleteMultiTool:nn(e);break;case s.resizeTool:En(e);break;case s.toProofMode:ln();break;case s.doubleCutInsertionTool:dn(e);break;case s.doubleCutDeletionTool:gn(e);break}Ie=!1}function An(){switch(o.toolState){case s.cutTool:Pt();break;case s.atomTool:Bt();break;case s.dragTool:mt();break;case s.moveSingleTool:Yt();break;case s.moveMultiTool:Rt();break;case s.copySingleTool:Gt();break;case s.copyMultiTool:Jt();break;case s.deleteSingleTool:_t();break;case s.deleteMultiTool:rn();break;case s.resizeTool:Tn();break;case s.toProofMode:cn();break;case s.doubleCutInsertionTool:hn();break;case s.doubleCutDeletionTool:pn();break}Le=!1}function Xn(){Le=!0}function $n(){B.width=window.innerWidth,B.height=window.innerHeight}window.onresize=$n;
