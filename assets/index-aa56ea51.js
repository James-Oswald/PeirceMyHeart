/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const L of f.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&r(L)}).observe(document,{childList:!0,subtree:!0});function n(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(o){if(o.ep)return;o.ep=!0;const f=n(o);fetch(o.href,f)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}toString(){return"("+this.x+", "+this.y+")"}}function R(e,t){return Re(e,t)||T(t,e)}function Re(e,t){if(e instanceof A)return t instanceof A?Le(e,t):Ie(t,e);if(t instanceof A)return Ie(e,t);if(Le(e.boundingBox,t.boundingBox)||T(t.boundingBox,e.boundingBox)){const n=Ne(e);let r;for(let o=0;o<n.length;o++)if(r=te(t,n[o]),r<=0)return!0;return!1}return!1}function Ie(e,t){const n=t.getCorners(),r=Q(e,n[0].x,1),o=Q(e,n[1].x,1),f=Q(e,n[0].x,-1),L=Q(e,n[1].x,-1);if(n[0].y<r&&r<n[2].y||n[0].y<f&&f<n[2].y||n[0].y<o&&o<n[2].y||n[0].y<L&&L<n[2].y)return!0;const b=-1/Math.pow(e.radiusX,2),C=2*e.center.x/Math.pow(e.radiusX,2),Z=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),ke=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),ue=(-C+Math.sqrt(Math.pow(C,2)-4*b*Z))/(2*b),de=(-C-Math.sqrt(Math.pow(C,2)-4*b*Z))/(2*b),fe=(-C+Math.sqrt(Math.pow(C,2)-4*b*ke))/(2*b),he=(-C-Math.sqrt(Math.pow(C,2)-4*b*ke))/(2*b);return!isNaN(ue)&&n[0].x<ue&&ue<n[1].x||!isNaN(de)&&n[0].x<de&&de<n[1].x||!isNaN(fe)&&n[0].x<fe&&fe<n[1].x||!isNaN(he)&&n[0].x<he&&he<n[1].x}function T(e,t){if(e instanceof A)if(t instanceof A){const n=t.getCorners();for(let r=0;r<4;r++)if(!ye(e,n[r]))return!1;return!0}else{const n=st(t);for(let r=0;r<4;r++)if(!ye(e,n[r]))return!1;return!0}else if(t instanceof A){const n=t.getCorners();let r;for(let o=0;o<4;o++)if(r=te(e,n[o]),!(r<0))return!1;return!0}else{const n=Ne(t);let r;for(let o=0;o<n.length;o++)if(r=te(e,n[o]),!(r<0))return!1;return!0}}function Le(e,t){const n=e.getCorners(),r=t.getCorners();return(n[0].y<=r[0].y&&n[2].y>=r[0].y||n[0].y<=r[2].y&&n[2].y>=r[2].y||r[0].y<=n[0].y&&r[2].y>=n[0].y||r[0].y<=n[2].y&&r[2].y>=n[2].y)&&(n[0].x<=r[0].x&&n[1].x>=r[0].x||n[0].x<=r[1].x&&n[1].x>=r[1].x||r[0].x<=n[0].x&&r[1].x>=n[0].x||r[0].x<=n[1].x&&r[1].x>=n[1].x)}function ye(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function te(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function st(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function Ne(e){const t=[];let n,r,o=1;for(let f=0;f<360;f++)n=e.center.x+e.radiusX*Math.cos(f*(Math.PI/180)),f>180&&(o=-1),r=Q(e,n,o),t[f]=new c(n,r);return t}function Q(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class A{constructor(t,n,r){if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(r!==void 0&&r<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=r}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return ye(this,t)}overlaps(t){return R(this,t)}contains(t){return T(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class d{constructor(t,n,r,o){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=r,this.internalHeight=o}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new A(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class u{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const r=this.internalChildren[n];if(r instanceof u&&r.containsNode(t))return r.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof d?T(this.internalEllipse,t.calcRect()):T(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0)return this;{const r=this.internalChildren[n];for(let o=0;o<r.children.length;o++)if(r.children[o].containsPoint(t))return r.getLowestParent(t);return this}}return null}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof d||this.children[n]instanceof u&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let r=0;r<this.children[n].children.length;r++)if(this.children[n].children[r].containsPoint(t))if(this.children[n].children[r]instanceof d)this.children[n].children.splice(r,1);else return this.children[n].children[r].remove(t);return this.children.splice(n,1),!0}return!1}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof d?t+=n.identifier:n instanceof u&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class z{constructor(t){this.internalSheet=new u(null),t instanceof u&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let r=n+1;r<t.children.length;r++)if(this.overlaps(t.children[n],t.children[r]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof u&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let r=0;r<n.children.length;r++)if(this.intersects(t,n.children[r]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),r=[...n.children];if(n.child=t,t instanceof u)for(let o=r.length-1;o>=0;o--)t.containsNode(r[o])&&(t.child=r[o],n.children.splice(o,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}remove(t){return this.internalSheet.remove(t)}intersects(t,n){const r=t instanceof d?t.calcRect():t.ellipse,o=n instanceof d?n.calcRect():n.ellipse;return Re(r,o)}overlaps(t,n){let r,o;return t instanceof d?n instanceof d?R(t.calcRect(),n.calcRect()):(r=n.ellipse,R(t.calcRect(),r)):n instanceof d?(r=t.ellipse,R(r,n.calcRect())):(r=t.ellipse,o=n.ellipse,R(r,o))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomMode=1]="atomMode",e[e.cutMode=2]="cutMode",e[e.dragMode=3]="dragMode",e[e.moveSingleMode=4]="moveSingleMode",e[e.moveMultiMode=5]="moveMultiMode",e[e.copySingleMode=6]="copySingleMode",e[e.copyMultiMode=7]="copyMultiMode",e[e.deleteSingleMode=8]="deleteSingleMode",e[e.deleteMultiMode=9]="deleteMultiMode",e[e.toProofMode=10]="toProofMode",e[e.doubleCutInsertionTool=11]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=12]="doubleCutDeletionTool",e))(s||{});class i{}i.tree=new z;i.selectForProof=new z;i.toolState=0;class K{constructor(t,n,r){if(this.center=t,this.radiusX=n,this.radiusY=r,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const o=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new A(o,this.radiusX*2,this.radiusY*2)}containsPoint(t){return te(this,t)<0}overlaps(t){return R(this,t)}contains(t){return T(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const lt=document.getElementById("theme-select");function N(e){return getComputedStyle(document.body).getPropertyValue(e)}let Te=N("--good-placement"),Ue=N("--bad-placement"),Ve=N("--canvas-items");function Ge(){setTimeout(()=>{Te=N("--good-placement"),Ue=N("--bad-placement"),Ve=N("--canvas-items"),a(i.tree)})}lt.addEventListener("input",()=>{Ge()});window.addEventListener("DOMContentLoaded",()=>{Ge()});function g(){return Ue}function p(){return Te}function We(){return Ve}const Me=document.getElementById("canvas"),je=Me.getContext("2d");if(je===null)throw Error("2d rendering context not supported");const h=je;h.font="35pt arial";const ct=document.getElementById("graphString"),at=document.getElementById("atomBox"),qe=document.getElementById("atomBoxes");qe.addEventListener("input",ut);function P(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const r=n.center;h.beginPath(),h.ellipse(r.x+l.x,r.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function x(e,t,n){h.textBaseline="bottom";const r=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(qe.checked||at.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-r.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function Je(e,t,n){h.beginPath(),h.strokeStyle=n;const r=e.x-t.x+l.x,o=e.y-t.y+l.y;h.rect(e.x,e.y,-r,-o),h.stroke()}function ut(){a(i.tree)}function ze(){h.clearRect(0,0,Me.width,Me.height)}function a(e){ct.innerHTML=e.toString(),ze(),Ke(e.sheet)}function Ke(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof d?dt(e.children[t]):Ke(e.children[t]);e.ellipse instanceof K&&(h.strokeStyle=We(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function dt(e){x(e,We(),!1)}let pe,l=new c(0,0),me;function ft(e){pe=new c(e.x-l.x,e.y-l.y),me=!1}function ht(e){me||(l=new c(e.x-pe.x,e.y-pe.y),a(i.tree))}function wt(){me=!0,a(i.tree)}const gt=document.getElementById("showRect"),yt=document.getElementById("mode");let ne,oe;function Mt(e){ne=new c(e.clientX-l.x,e.clientY-l.y),oe=!1}function pt(e){const t=new u(new K(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(a(i.tree),t.ellipse=se(ne,n),!oe){const o=i.tree.canInsert(t)&&U(t.ellipse)?p():g();P(t,o),gt.checked&&Je(ne,n,o)}}function xt(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(ne,t));i.tree.canInsert(n)&&!oe&&U(n.ellipse)&&i.tree.insert(n),a(i.tree)}function mt(){oe=!0,a(i.tree)}function se(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),r=e.x-t.x,o=e.y-t.y,f=Math.abs(r),L=Math.abs(o);let b,C;if(yt.value==="circumscribed"){const Z=Math.floor(n.distance(t));C=Math.floor(Z*(L/f)),b=Math.floor(Z*(f/L))}else b=f/2,C=L/2;return new K(n,b,C)}function U(e){return e.radiusX>15&&e.radiusY>15}const bt=document.getElementById("canvas"),Ze=bt.getContext("2d");if(Ze===null)throw Error("2d rendering context not supported");const Ct=Ze,Qe=document.getElementById("atomDisplay");let v,le,F="A";Qe.innerHTML=F;function Et(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(F=e.key,Qe.innerHTML=F)}function Pt(e){v=Ct.measureText(F),le=!1;const t=new d(F,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(i.tree);const n=i.tree.canInsert(t)?p():g();x(t,n,!0)}function St(e){const t=new d(F,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(i.tree),le||(i.tree.canInsert(t)?x(t,p(),!0):x(t,g(),!0))}function kt(e){const t=new d(F,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);i.tree.canInsert(t)&&!le&&i.tree.insert(t),a(i.tree)}function It(){le=!0,a(i.tree)}async function Lt(e,t){const n=JSON.stringify(t,null,"	"),r=await e.createWritable();await r.write(n),await r.close()}function xe(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,r=new z,o=[];return n.forEach(f=>{Object.prototype.hasOwnProperty.call(f,"internalEllipse")?o.push(_e(f)):o.push(et(f))}),r.sheet.children=o,r}return null}function _e(e){const t=new K(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(r=>{"internalEllipse"in r?n.push(_e(r)):n.push(et(r))}),new u(t,n)}function et(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new d(t,n,e.internalWidth,e.internalHeight)}function _(e,t){if(e.ellipse!==null){const n=$(e,t);if(!i.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof u&&e.children[n].ellipse!==null&&!_(e.children[n],t))return!1;if(e.children[n]instanceof d){let r=e.children[n];if(r=I(r,t),!i.tree.canInsert(r))return!1}}return!0}function be(e,t,n){if(e instanceof u&&e.ellipse!==null){const r=$(e,n);if(P(r,t),e.children.length!==0)for(let o=0;o<e.children.length;o++)be(e.children[o],t,n)}else if(e instanceof d){const r=I(e,n);x(r,t,!0)}}function Ce(e,t){if(e instanceof u&&e.ellipse!==null){const n=$(e,t);if(i.tree.insert(n),e.children.length!==0)for(let r=0;r<e.children.length;r++)Ce(e.children[r],t)}else if(e instanceof d){const n=I(e,t);i.tree.insert(n)}}function $(e,t){if(e.ellipse!==null)return new u(new K(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function I(e,t){return new d(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}let D,w=null,Y;function vt(e){if(D=new c(e.x-l.x,e.y-l.y),w=i.tree.getLowestNode(D),w!==i.tree.sheet&&w!==null){const t=i.tree.getLowestParent(D);if(t!==null&&t.remove(D),w instanceof u&&w.children.length!==0){for(let n=0;n<w.children.length;n++)i.tree.insert(w.children[n]);w.children=[]}Y=!0}else Y=!1}function Bt(e){if(Y){const t=new c(e.x-D.x,e.y-D.y);if(w instanceof u){const n=$(w,t);a(i.tree);const r=i.tree.canInsert(n)?p():g();P(n,r)}else if(w instanceof d){const n=I(w,t);a(i.tree);const r=i.tree.canInsert(n)?p():g();x(n,r,!0)}}}function Dt(e){if(Y){const t=new c(e.x-D.x,e.y-D.y);if(w instanceof u){const n=$(w,t);i.tree.canInsert(n)?i.tree.insert(n):i.tree.insert(w)}else if(w instanceof d){const n=I(w,t);i.tree.canInsert(n)?i.tree.insert(n):i.tree.insert(w)}a(i.tree)}Y=!1}function Ot(){Y&&w!==null&&i.tree.insert(w),Y=!1,a(i.tree)}let O,M=null,H;function At(e){if(O=new c(e.x-l.x,e.y-l.y),M=i.tree.getLowestNode(O),M!==i.tree.sheet&&M!==null){const t=i.tree.getLowestParent(O);t!==null&&t.remove(O),H=!0}else H=!1}function Xt(e){if(H){const t=new c(e.x-O.x,e.y-O.y);if(a(i.tree),M instanceof u){const n=_(M,t)?p():g();be(M,n,t)}else if(M instanceof d){const n=I(M,t),r=i.tree.canInsert(n)?p():g();x(n,r,!0)}}}function $t(e){if(H){const t=new c(e.x-O.x,e.y-O.y);if(M instanceof u)_(M,t)?Ce(M,t):i.tree.insert(M);else if(M instanceof d){const n=I(M,t);i.tree.canInsert(n)?i.tree.insert(n):i.tree.insert(M)}}a(i.tree),H=!1}function Ft(){H&&M!==null&&i.tree.insert(M),H=!1,a(i.tree)}let V,E=null,G;function Yt(e){V=new c(e.x-l.x,e.y-l.y);const t=i.tree.getLowestNode(V);t!==i.tree.sheet&&t!==null?(t instanceof u?(E=$(t,new c(0,0)),E.children=[]):t instanceof d&&(E=t),G=!0):G=!1}function Ht(e){if(G){const t=new c(e.x-V.x,e.y-V.y);if(E instanceof u){const n=$(E,t);a(i.tree);const r=i.tree.canInsert(n)?p():g();P(n,r)}else if(E instanceof d){const n=I(E,t);a(i.tree);const r=i.tree.canInsert(n)?p():g();x(n,r,!0)}}}function Rt(e){if(G){const t=new c(e.x-V.x,e.y-V.y);if(E instanceof u&&E.ellipse!==null){const n=$(E,t);i.tree.canInsert(n)&&i.tree.insert(n)}else if(E instanceof d){const n=I(E,t);i.tree.canInsert(n)&&i.tree.insert(n)}a(i.tree)}G=!1}function Nt(){G=!1,a(i.tree)}let W,m=null,j;function Tt(e){W=new c(e.x-l.x,e.y-l.y),m=i.tree.getLowestNode(W),m!==i.tree.sheet&&m!==null?j=!0:j=!1}function Ut(e){if(j){const t=new c(e.x-W.x,e.y-W.y);if(a(i.tree),m instanceof u){const n=_(m,t)?p():g();be(m,n,t)}else if(m instanceof d){const n=I(m,t),r=i.tree.canInsert(n)?p():g();x(n,r,!0)}}}function Vt(e){if(j){const t=new c(e.x-W.x,e.y-W.y);if(m instanceof u)_(m,t)&&Ce(m,t);else if(m instanceof d){const n=I(m,t);i.tree.canInsert(n)&&i.tree.insert(n)}}a(i.tree),j=!1}function Gt(){j=!1,a(i.tree)}let ve,y=null,q;function Wt(e){ve=new c(e.x-l.x,e.y-l.y),y=i.tree.getLowestNode(ve),y!==i.tree.sheet&&y!==null&&(q=!0,y instanceof d?x(y,g(),!0):P(y,g()))}function jt(e){const t=new c(e.x-l.x,e.y-l.y),n=i.tree.getLowestNode(t);y!==null&&y!==n&&(q=!0,a(i.tree),n===i.tree.sheet||n===null?(y=null,q=!1):(y=n,y instanceof d?x(y,g(),!0):P(y,g())))}function qt(e){const t=new c(e.x-l.x,e.y-l.y);if(q){const n=i.tree.getLowestParent(t);if(n!==null&&n.remove(t),y instanceof u&&y.children.length!==0)for(let r=0;r<y.children.length;r++)i.tree.insert(y.children[r])}a(i.tree),y=null,q=!1}function Jt(){y=null,q=!1}let Be,k=null,J;function zt(e){Be=new c(e.x-l.x,e.y-l.y),k=i.tree.getLowestNode(Be),k!==i.tree.sheet&&k!==null&&(J=!0,Ee(k,g()))}function Kt(e){const t=new c(e.x-l.x,e.y-l.y),n=i.tree.getLowestNode(t);k!==null&&k!==i.tree.getLowestNode(t)&&(J=!0,a(i.tree),n===i.tree.sheet||n===null?(k=null,J=!1):(k=n,Ee(k,g())))}function Zt(e){const t=new c(e.x-l.x,e.y-l.y);if(J){const n=i.tree.getLowestParent(t);n!==null&&n.remove(t),a(i.tree)}k=null,J=!1}function Qt(){k=null,J=!1}function Ee(e,t){if(e instanceof d)x(e,t,!0);else if(e instanceof u){P(e,t);for(let n=0;n<e.children.length;n++)Ee(e.children[n],t)}}let ee,S=null,ce;function _t(e){if(i.selectForProof.sheet=new z().sheet,ee=new c(e.x,e.y),S=i.tree.getLowestNode(ee),S!==null){if(ce=!0,S!==i.tree.sheet){const t=i.tree.getLowestParent(ee);t!==null&&t.remove(ee),a(i.tree)}else ze();S instanceof d?x(S,p(),!0):tt(S,p()),S!==i.tree.sheet&&i.tree.insert(S)}}function en(){S=null,ce=!1,a(i.tree)}function tn(){ce&&(i.selectForProof.insert(S),a(i.tree),alert("Graph selected, you may now toggle to proof mode"))}function nn(){S=null,ce=!1,a(i.tree)}function tt(e,t){if(e instanceof d)x(e,t,!0);else if(e instanceof u){P(e,t);for(let n=0;n<e.children.length;n++)tt(e.children[n],t)}}const rn=document.getElementById("showRect");let re,ae;function on(e){re=new c(e.clientX-l.x,e.clientY-l.y),ae=!1}function sn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(re,t)),r=new u(nt(n.ellipse));if(a(i.tree),!ae&&n.ellipse!==null&&r.ellipse!==null){const f=i.tree.canInsert(n)&&U(n.ellipse)&&i.tree.canInsert(r)&&U(r.ellipse)?p():g();P(n,f),P(r,f),rn.checked&&Je(re,t,f)}}function ln(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(re,t)),r=new u(nt(n.ellipse));!ae&&n.ellipse!==null&&r.ellipse!==null&&i.tree.canInsert(n)&&U(n.ellipse)&&i.tree.canInsert(r)&&U(r.ellipse)&&(i.tree.insert(n),i.tree.insert(r)),a(i.tree)}function cn(){ae=!0,a(i.tree)}function nt(e){return new K(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let X=null,ie;function an(e){const t=new c(e.x-l.x,e.y-l.y);X=i.tree.getLowestNode(t),rt()}function un(e){const t=new c(e.x-l.x,e.y-l.y);X=i.tree.getLowestNode(t),a(i.tree),rt()}function dn(e){const t=new c(e.x-l.x,e.y-l.y);if(ie&&X instanceof u){const n=i.tree.getLowestParent(t),r=X.children[0];if(n!==null&&r instanceof u){n.remove(t);for(let o=0;o<r.children.length;o++)i.tree.insert(r.children[o])}}a(i.tree)}function fn(){ie=!1,a(i.tree)}function hn(e){return e.children.length===1&&e.children[0]instanceof u&&X!==i.tree.sheet}function wn(e){P(e,g()),e.children[0]instanceof u&&P(e.children[0],g())}function rt(){X instanceof u&&hn(X)?(ie=!0,wn(X)):ie=!1}let we=!0,De=null,Oe=null,Ae=s.none,Xe=s.none;const $e=document.getElementById("DrawButtons"),Fe=document.getElementById("ProofButtons");function gn(){if(we=!we,we){$e.style.display="block",Fe.style.display="none",Oe=JSON.stringify(i.tree),Xe=i.toolState;const e=xe(De);if(e!==null)i.tree.sheet=e.sheet;else throw Error("invalid cached AEG");i.toolState=Ae}else{$e.style.display="none",Fe.style.display="block",De=JSON.stringify(i.tree),Ae=i.toolState;const e=xe(Oe);if(e!==null){i.tree.sheet=e.sheet;for(let t=0;t<i.selectForProof.sheet.children.length;t++){const n=i.selectForProof.sheet.children[t];try{i.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else i.tree.sheet=i.selectForProof.sheet;i.toolState=Xe,i.selectForProof.sheet=new z().sheet}a(i.tree)}const B=document.getElementById("canvas");B.width=window.innerWidth;B.height=window.innerHeight;const it=B.getContext("2d");if(it===null)throw Error("2d rendering context not supported");const yn=it;yn.font="35pt arial";const ge=document.getElementById("cutTools"),Ye=document.getElementById("atomTools");window.addEventListener("keydown",mn);B.addEventListener("mousedown",bn);B.addEventListener("mousemove",Cn);B.addEventListener("mouseup",En);B.addEventListener("mouseout",Pn);B.addEventListener("mouseenter",Sn);let Pe=!1,Se=!0;window.atomMode=s.atomMode;window.cutMode=s.cutMode;window.dragMode=s.dragMode;window.saveMode=ot;window.loadMode=xn;window.moveSingleMode=s.moveSingleMode;window.moveMultiMode=s.moveMultiMode;window.copySingleMode=s.copySingleMode;window.copyMultiMode=s.copyMultiMode;window.deleteSingleMode=s.deleteSingleMode;window.deleteMultiMode=s.deleteMultiMode;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.setMode=pn;window.setHighlight=Mn;window.toggleHandler=gn;function Mn(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const He=document.querySelectorAll(".modeButton");He.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),He.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function pn(e){switch(i.toolState=e,ge.style.display="none",Ye.style.display="none",i.toolState){case s.atomMode:Ye.style.display="block";break;case s.cutMode:ge.style.display="block";break;case s.doubleCutInsertionTool:ge.style.display="block";break}}async function ot(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Lt(e,i.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(i.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function xn(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const r=n.result,o=xe(r);o instanceof z&&(i.tree=o,a(i.tree))}),n.readAsText(t)}function mn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),ot();else switch(i.toolState){case s.atomMode:Et(e);break}}function bn(e){switch(i.toolState){case s.cutMode:Mt(e);break;case s.atomMode:Pt(e);break;case s.dragMode:ft(e);break;case s.moveSingleMode:vt(e);break;case s.moveMultiMode:At(e);break;case s.copySingleMode:Yt(e);break;case s.copyMultiMode:Tt(e);break;case s.deleteSingleMode:Wt(e);break;case s.deleteMultiMode:zt(e);break;case s.toProofMode:_t(e);break;case s.doubleCutInsertionTool:on(e);break;case s.doubleCutDeletionTool:an(e);break}Pe=!0}function Cn(e){if(Pe&&Se)switch(i.toolState){case s.cutMode:pt(e);break;case s.atomMode:St(e);break;case s.dragMode:ht(e);break;case s.moveSingleMode:Bt(e);break;case s.moveMultiMode:Xt(e);break;case s.copySingleMode:Ht(e);break;case s.copyMultiMode:Ut(e);break;case s.deleteSingleMode:jt(e);break;case s.deleteMultiMode:Kt(e);break;case s.toProofMode:en();break;case s.doubleCutInsertionTool:sn(e);break;case s.doubleCutDeletionTool:un(e);break}}function En(e){switch(i.toolState){case s.cutMode:xt(e);break;case s.atomMode:kt(e);break;case s.moveSingleMode:Dt(e);break;case s.moveMultiMode:$t(e);break;case s.copySingleMode:Rt(e);break;case s.copyMultiMode:Vt(e);break;case s.deleteSingleMode:qt(e);break;case s.deleteMultiMode:Zt(e);break;case s.toProofMode:tn();break;case s.doubleCutInsertionTool:ln(e);break;case s.doubleCutDeletionTool:dn(e);break}Pe=!1}function Pn(){switch(i.toolState){case s.cutMode:mt();break;case s.atomMode:It();break;case s.dragMode:wt();break;case s.moveSingleMode:Ot();break;case s.moveMultiMode:Ft();break;case s.copySingleMode:Nt();break;case s.copyMultiMode:Gt();break;case s.deleteSingleMode:Jt();break;case s.deleteMultiMode:Qt();break;case s.toProofMode:nn();break;case s.doubleCutInsertionTool:cn();break;case s.doubleCutDeletionTool:fn();break}Se=!1}function Sn(){Se=!0}function kn(){B.width=window.innerWidth,B.height=window.innerHeight}window.onresize=kn;
