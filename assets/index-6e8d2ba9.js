/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const D of d.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&o(D)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function V(e,t){return Ge(e,t)||j(t,e)}function Ge(e,t){if(e instanceof $)return t instanceof $?Ae(e,t):Oe(t,e);if(t instanceof $)return Oe(e,t);if(Ae(e.boundingBox,t.boundingBox)||j(t.boundingBox,e.boundingBox)){const n=We(e);let o;for(let i=0;i<n.length;i++)if(o=le(t,n[i]),o<=0)return!0;return!1}return!1}function Oe(e,t){const n=t.getCorners(),o=re(e,n[0].x,1),i=re(e,n[1].x,1),d=re(e,n[0].x,-1),D=re(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<d&&d<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<D&&D<n[2].y)return!0;const E=-1/Math.pow(e.radiusX,2),P=2*e.center.x/Math.pow(e.radiusX,2),ne=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),Be=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),pe=(-P+Math.sqrt(Math.pow(P,2)-4*E*ne))/(2*E),xe=(-P-Math.sqrt(Math.pow(P,2)-4*E*ne))/(2*E),me=(-P+Math.sqrt(Math.pow(P,2)-4*E*Be))/(2*E),Me=(-P-Math.sqrt(Math.pow(P,2)-4*E*Be))/(2*E);return!isNaN(pe)&&n[0].x<pe&&pe<n[1].x||!isNaN(xe)&&n[0].x<xe&&xe<n[1].x||!isNaN(me)&&n[0].x<me&&me<n[1].x||!isNaN(Me)&&n[0].x<Me&&Me<n[1].x}function j(e,t){if(e instanceof $)if(t instanceof $){const n=t.getCorners();for(let o=0;o<4;o++)if(!Te(e,n[o]))return!1;return!0}else{const n=wt(t);for(let o=0;o<4;o++)if(!Te(e,n[o]))return!1;return!0}else if(t instanceof $){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=le(e,n[i]),!(o<0))return!1;return!0}else{const n=We(t);let o;for(let i=0;i<n.length;i++)if(o=le(e,n[i]),!(o<0))return!1;return!0}}function Ae(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function Te(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function le(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function wt(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function We(e){const t=[];let n,o,i=1;for(let d=0;d<360;d++)n=e.center.x+e.radiusX*Math.cos(d*(Math.PI/180)),d>180&&(i=-1),o=re(e,n,i),t[d]=new c(n,o);return t}function re(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class ${constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Te(this,t)}overlaps(t){return V(this,t)}contains(t){return j(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new $(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class u{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof u&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?j(this.internalEllipse,t.calcRect()):j(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof u&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof u&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof u&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class te{constructor(t){this.internalSheet=new u(null),t instanceof u&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof u&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof u)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}remove(t){return this.internalSheet.remove(t)}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return Ge(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?V(t.calcRect(),n.calcRect()):(o=n.ellipse,V(t.calcRect(),o)):n instanceof f?(o=t.ellipse,V(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,V(o,i))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.toProofMode=11]="toProofMode",e[e.doubleCutInsertionTool=12]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=13]="doubleCutDeletionTool",e[e.erasureTool=14]="erasureTool",e))(s||{});class r{}r.tree=new te;r.selectForProof=new te;r.toolState=0;class U{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new $(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return le(this,t)<0}overlaps(t){return V(this,t)}contains(t){return j(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const yt=document.getElementById("theme-select");function W(e){return getComputedStyle(document.body).getPropertyValue(e)}let je=W("--good-placement"),qe=W("--bad-placement"),Je=W("--canvas-items");function Ke(){setTimeout(()=>{je=W("--good-placement"),qe=W("--bad-placement"),Je=W("--canvas-items"),a(r.tree)})}yt.addEventListener("input",()=>{Ke()});window.addEventListener("DOMContentLoaded",()=>{Ke()});function w(){return qe}function M(){return je}function Ze(){return Je}const Ee=document.getElementById("canvas"),Qe=Ee.getContext("2d");if(Qe===null)throw Error("2d rendering context not supported");const h=Qe;h.font="35pt arial";const gt=document.getElementById("graphString"),pt=document.getElementById("atomBox"),_e=document.getElementById("atomBoxes");_e.addEventListener("input",xt);function T(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const o=n.center;h.beginPath(),h.ellipse(o.x+l.x,o.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function b(e,t,n){h.textBaseline="bottom";const o=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(_e.checked||pt.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-o.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function et(e,t,n){h.beginPath(),h.strokeStyle=n;const o=e.x-t.x+l.x,i=e.y-t.y+l.y;h.rect(e.x,e.y,-o,-i),h.stroke()}function xt(){a(r.tree)}function tt(){h.clearRect(0,0,Ee.width,Ee.height)}function a(e){gt.innerHTML=e.toString(),tt(),nt(e.sheet)}function nt(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof f?mt(e.children[t]):nt(e.children[t]);e.ellipse instanceof U&&(h.strokeStyle=Ze(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function mt(e){b(e,Ze(),!1)}let Pe,l=new c(0,0),Se;function Mt(e){Pe=new c(e.x-l.x,e.y-l.y),Se=!1}function bt(e){Se||(l=new c(e.x-Pe.x,e.y-Pe.y),a(r.tree))}function Ct(){Se=!0,a(r.tree)}const Tt=document.getElementById("showRect"),Et=document.getElementById("mode");let ce,fe;function Pt(e){ce=new c(e.clientX-l.x,e.clientY-l.y),fe=!1}function kt(e){const t=new u(new U(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(a(r.tree),t.ellipse=de(ce,n),!fe){const i=r.tree.canInsert(t)&&F(t.ellipse)?M():w();T(t,i),Tt.checked&&et(ce,n,i)}}function St(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ce,t));r.tree.canInsert(n)&&!fe&&F(n.ellipse)&&r.tree.insert(n),a(r.tree)}function It(){fe=!0,a(r.tree)}function de(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,d=Math.abs(o),D=Math.abs(i);let E,P;if(Et.value==="circumscribed"){const ne=Math.floor(n.distance(t));P=Math.floor(ne*(D/d)),E=Math.floor(ne*(d/D))}else E=d/2,P=D/2;return new U(n,E,P)}function F(e){return e.radiusX>15&&e.radiusY>15}const Lt=document.getElementById("canvas"),rt=Lt.getContext("2d");if(rt===null)throw Error("2d rendering context not supported");const Dt=rt,ot=document.getElementById("atomDisplay");let v,he,H="A";ot.innerHTML=H;function vt(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(H=e.key,ot.innerHTML=H)}function Bt(e){v=Dt.measureText(H),he=!1;const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(r.tree);const n=r.tree.canInsert(t)?M():w();b(t,n,!0)}function Ot(e){const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(r.tree),he||(r.tree.canInsert(t)?b(t,M(),!0):b(t,w(),!0))}function At(e){const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);r.tree.canInsert(t)&&!he&&r.tree.insert(t),a(r.tree)}function Xt(){he=!0,a(r.tree)}async function $t(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function ke(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,o=new te,i=[];return n.forEach(d=>{Object.prototype.hasOwnProperty.call(d,"internalEllipse")?i.push(it(d)):i.push(st(d))}),o.sheet.children=i,o}return null}function it(e){const t=new U(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(o=>{"internalEllipse"in o?n.push(it(o)):n.push(st(o))}),new u(t,n)}function st(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}function ie(e,t){if(e.ellipse!==null){const n=N(e,t);if(!r.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof u&&e.children[n].ellipse!==null&&!ie(e.children[n],t))return!1;if(e.children[n]instanceof f){let o=e.children[n];if(o=L(o,t),!r.tree.canInsert(o))return!1}}return!0}function Ie(e,t,n){if(e instanceof u&&e.ellipse!==null){const o=N(e,n);if(T(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Ie(e.children[i],t,n)}else if(e instanceof f){const o=L(e,n);b(o,t,!0)}}function Le(e,t){if(e instanceof u&&e.ellipse!==null){const n=N(e,t);if(r.tree.insert(n),e.children.length!==0)for(let o=0;o<e.children.length;o++)Le(e.children[o],t)}else if(e instanceof f){const n=L(e,t);r.tree.insert(n)}}function N(e,t){if(e.ellipse!==null)return new u(new U(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function L(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function we(e,t){if(e instanceof f)b(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)we(e.children[n],t)}}let O,y=null,R;function Yt(e){if(O=new c(e.x-l.x,e.y-l.y),y=r.tree.getLowestNode(O),y!==r.tree.sheet&&y!==null){const t=r.tree.getLowestParent(O);if(t!==null&&t.remove(O),y instanceof u&&y.children.length!==0){for(let n=0;n<y.children.length;n++)r.tree.insert(y.children[n]);y.children=[]}R=!0}else R=!1}function Ft(e){if(R){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof u){const n=N(y,t);a(r.tree);const o=r.tree.canInsert(n)?M():w();T(n,o)}else if(y instanceof f){const n=L(y,t);a(r.tree);const o=r.tree.canInsert(n)?M():w();b(n,o,!0)}}}function Nt(e){if(R){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof u){const n=N(y,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(y)}else if(y instanceof f){const n=L(y,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(y)}a(r.tree)}R=!1}function Ht(){R&&y!==null&&r.tree.insert(y),R=!1,a(r.tree)}let A,p=null,z;function Rt(e){if(A=new c(e.x-l.x,e.y-l.y),p=r.tree.getLowestNode(A),p!==r.tree.sheet&&p!==null){const t=r.tree.getLowestParent(A);t!==null&&t.remove(A),z=!0}else z=!1}function zt(e){if(z){const t=new c(e.x-A.x,e.y-A.y);if(a(r.tree),p instanceof u){const n=ie(p,t)?M():w();Ie(p,n,t)}else if(p instanceof f){const n=L(p,t),o=r.tree.canInsert(n)?M():w();b(n,o,!0)}}}function Ut(e){if(z){const t=new c(e.x-A.x,e.y-A.y);if(p instanceof u)ie(p,t)?Le(p,t):r.tree.insert(p);else if(p instanceof f){const n=L(p,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(p)}}a(r.tree),z=!1}function Vt(){z&&p!==null&&r.tree.insert(p),z=!1,a(r.tree)}let q,k=null,J;function Gt(e){q=new c(e.x-l.x,e.y-l.y);const t=r.tree.getLowestNode(q);t!==r.tree.sheet&&t!==null?(t instanceof u?(k=N(t,new c(0,0)),k.children=[]):t instanceof f&&(k=t),J=!0):J=!1}function Wt(e){if(J){const t=new c(e.x-q.x,e.y-q.y);if(k instanceof u){const n=N(k,t);a(r.tree);const o=r.tree.canInsert(n)?M():w();T(n,o)}else if(k instanceof f){const n=L(k,t);a(r.tree);const o=r.tree.canInsert(n)?M():w();b(n,o,!0)}}}function jt(e){if(J){const t=new c(e.x-q.x,e.y-q.y);if(k instanceof u&&k.ellipse!==null){const n=N(k,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(k instanceof f){const n=L(k,t);r.tree.canInsert(n)&&r.tree.insert(n)}a(r.tree)}J=!1}function qt(){J=!1,a(r.tree)}let K,C=null,Z;function Jt(e){K=new c(e.x-l.x,e.y-l.y),C=r.tree.getLowestNode(K),C!==r.tree.sheet&&C!==null?Z=!0:Z=!1}function Kt(e){if(Z){const t=new c(e.x-K.x,e.y-K.y);if(a(r.tree),C instanceof u){const n=ie(C,t)?M():w();Ie(C,n,t)}else if(C instanceof f){const n=L(C,t),o=r.tree.canInsert(n)?M():w();b(n,o,!0)}}}function Zt(e){if(Z){const t=new c(e.x-K.x,e.y-K.y);if(C instanceof u)ie(C,t)&&Le(C,t);else if(C instanceof f){const n=L(C,t);r.tree.canInsert(n)&&r.tree.insert(n)}}a(r.tree),Z=!1}function Qt(){Z=!1,a(r.tree)}let Xe,g=null,Q;function _t(e){Xe=new c(e.x-l.x,e.y-l.y),g=r.tree.getLowestNode(Xe),g!==r.tree.sheet&&g!==null&&(Q=!0,g instanceof f?b(g,w(),!0):T(g,w()))}function en(e){const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t);g!==null&&g!==n&&(Q=!0,a(r.tree),n===r.tree.sheet||n===null?(g=null,Q=!1):(g=n,g instanceof f?b(g,w(),!0):T(g,w())))}function tn(e){const t=new c(e.x-l.x,e.y-l.y);if(Q){const n=r.tree.getLowestParent(t);if(n!==null&&n.remove(t),g instanceof u&&g.children.length!==0)for(let o=0;o<g.children.length;o++)r.tree.insert(g.children[o])}a(r.tree),g=null,Q=!1}function nn(){g=null,Q=!1}let $e,I=null,_;function rn(e){$e=new c(e.x-l.x,e.y-l.y),I=r.tree.getLowestNode($e),I!==r.tree.sheet&&I!==null&&(_=!0,we(I,w()))}function on(e){const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t);I!==null&&I!==r.tree.getLowestNode(t)&&(_=!0,a(r.tree),n===r.tree.sheet||n===null?(I=null,_=!1):(I=n,we(I,w())))}function sn(e){const t=new c(e.x-l.x,e.y-l.y);if(_){const n=r.tree.getLowestParent(t);n!==null&&n.remove(t),a(r.tree)}I=null,_=!1}function ln(){I=null,_=!1}let se,m=null,ye;function cn(e){if(r.selectForProof.sheet=new te().sheet,se=new c(e.x,e.y),m=r.tree.getLowestNode(se),m!==null){if(ye=!0,m!==r.tree.sheet){const t=r.tree.getLowestParent(se);t!==null&&t.remove(se),a(r.tree)}else tt();m instanceof f?b(m,M(),!0):lt(m,M()),m!==r.tree.sheet&&r.tree.insert(m)}}function an(){m=null,ye=!1,a(r.tree)}function un(){if(ye){if(m instanceof u&&m.ellipse===null)for(let e=0;e<m.children.length;e++)r.selectForProof.insert(m.children[e]);else r.selectForProof.insert(m);a(r.tree),alert("Graph selected, you may now toggle to proof mode")}}function fn(){m=null,ye=!1,a(r.tree)}function lt(e,t){if(e instanceof f)b(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)lt(e.children[n],t)}}const dn=document.getElementById("showRect");let ae,ge;function hn(e){ae=new c(e.clientX-l.x,e.clientY-l.y),ge=!1}function wn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ae,t)),o=new u(ct(n.ellipse));if(a(r.tree),!ge&&n.ellipse!==null&&o.ellipse!==null){const d=r.tree.canInsert(n)&&F(n.ellipse)&&r.tree.canInsert(o)&&F(o.ellipse)?M():w();T(n,d),T(o,d),dn.checked&&et(ae,t,d)}}function yn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ae,t)),o=new u(ct(n.ellipse));!ge&&n.ellipse!==null&&o.ellipse!==null&&r.tree.canInsert(n)&&F(n.ellipse)&&r.tree.canInsert(o)&&F(o.ellipse)&&(r.tree.insert(n),r.tree.insert(o)),a(r.tree)}function gn(){ge=!0,a(r.tree)}function ct(e){return new U(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let Y=null,ue;function pn(e){const t=new c(e.x-l.x,e.y-l.y);Y=r.tree.getLowestNode(t),at()}function xn(e){const t=new c(e.x-l.x,e.y-l.y);Y=r.tree.getLowestNode(t),a(r.tree),at()}function mn(e){const t=new c(e.x-l.x,e.y-l.y);if(ue&&Y instanceof u){const n=r.tree.getLowestParent(t),o=Y.children[0];if(n!==null&&o instanceof u){n.remove(t);for(let i=0;i<o.children.length;i++)r.tree.insert(o.children[i])}}a(r.tree)}function Mn(){ue=!1,a(r.tree)}function bn(e){return e.children.length===1&&e.children[0]instanceof u&&Y!==r.tree.sheet}function Cn(e){T(e,w()),e.children[0]instanceof u&&T(e.children[0],w())}function at(){Y instanceof u&&bn(Y)?(ue=!0,Cn(Y)):ue=!1}let X=null,oe;function Tn(e){const t=new c(e.x-l.x,e.y-l.y);X=r.tree.getLowestNode(t),ut()}function En(e){const t=new c(e.x-l.x,e.y-l.y);X=r.tree.getLowestNode(t),a(r.tree),ut()}function Pn(e){if(oe){const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestParent(t);n!==null&&n.remove(t),a(r.tree)}X=null,oe=!1}function kn(){X=null,oe=!1,a(r.tree)}function ut(){X!==r.tree.sheet&&X!==null&&r.tree.getLevel(X)%2===0?(oe=!0,we(X,w())):oe=!1}let be=!0,Ye=null,Fe=null,Ne=s.none,He=s.none;const Re=document.getElementById("DrawButtons"),ze=document.getElementById("ProofButtons");function Sn(){if(be=!be,be){Re.style.display="block",ze.style.display="none",Fe=JSON.stringify(r.tree),He=r.toolState;const e=ke(Ye);if(e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=Ne}else{Re.style.display="none",ze.style.display="block",Ye=JSON.stringify(r.tree),Ne=r.toolState;const e=ke(Fe);if(e!==null){r.tree.sheet=e.sheet;for(let t=0;t<r.selectForProof.sheet.children.length;t++){const n=r.selectForProof.sheet.children[t];try{r.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else r.tree.sheet=r.selectForProof.sheet;r.toolState=He,r.selectForProof.sheet=new te().sheet}a(r.tree)}let S,x=null,ee;const G=new c(1,1);function In(e){if(S=new c(e.x-l.x,e.y-l.y),x=r.tree.getLowestNode(S),x!==r.tree.sheet&&x instanceof u){ee=!0;const t=r.tree.getLowestParent(S);t!==null&&t.remove(S);for(let n=0;n<x.children.length;n++)r.tree.insert(x.children[n]);Bn(),x.children=[]}}function Ln(e){if(ee){const t=new c((e.x-l.x-S.x)/2,(e.y-l.y-S.y)/2);if(x instanceof u){const n=ft(x,t);if(n.ellipse!==null){a(r.tree);const i=r.tree.canInsert(n)&&F(n.ellipse)?M():w();T(n,i)}}}}function Dn(e){if(ee){const t=new c((e.x-l.x-S.x)/2,(e.y-l.y-S.y)/2);if(x instanceof u){const n=ft(x,t);n.ellipse!==null&&(r.tree.canInsert(n)&&F(n.ellipse)?r.tree.insert(n):r.tree.insert(x))}a(r.tree),ee=!1}}function vn(){ee&&x!==null&&r.tree.insert(x),ee=!1,a(r.tree)}function ft(e,t){if(e.ellipse!==null)return new u(new U(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),e.ellipse.radiusX+t.x*G.x,e.ellipse.radiusY+t.y*G.y));throw new Error("Cannot alter the position of a cut without an ellipse.")}function Bn(){if(x instanceof u&&x.ellipse!==null){const e=x.ellipse,t=[new c(e.center.x-e.radiusX,e.center.y),new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY)];t[0].distance(S)>=t[2].distance(S)?G.x=1:G.x=-1,t[1].distance(S)>=t[3].distance(S)?G.y=1:G.y=-1}}const B=document.getElementById("canvas");B.width=window.innerWidth;B.height=window.innerHeight;const dt=B.getContext("2d");if(dt===null)throw Error("2d rendering context not supported");const On=dt;On.font="35pt arial";const Ce=document.getElementById("cutTools"),Ue=document.getElementById("atomTools");window.addEventListener("keydown",Yn);B.addEventListener("mousedown",Fn);B.addEventListener("mousemove",Nn);B.addEventListener("mouseup",Hn);B.addEventListener("mouseout",Rn);B.addEventListener("mouseenter",zn);let De=!1,ve=!0;window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.saveMode=ht;window.loadMode=$n;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.erasureTool=s.erasureTool;window.setTool=Xn;window.setHighlight=An;window.toggleHandler=Sn;function An(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const Ve=document.querySelectorAll(".modeButton");Ve.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),Ve.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function Xn(e){switch(r.toolState=e,Ce.style.display="none",Ue.style.display="none",r.toolState){case s.atomTool:Ue.style.display="block";break;case s.cutTool:Ce.style.display="block";break;case s.doubleCutInsertionTool:Ce.style.display="block";break}}async function ht(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});$t(e,r.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(r.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function $n(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const o=n.result,i=ke(o);i instanceof te&&(r.tree=i,a(r.tree))}),n.readAsText(t)}function Yn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),ht();else switch(r.toolState){case s.atomTool:vt(e);break}}function Fn(e){switch(r.toolState){case s.cutTool:Pt(e);break;case s.atomTool:Bt(e);break;case s.dragTool:Mt(e);break;case s.moveSingleTool:Yt(e);break;case s.moveMultiTool:Rt(e);break;case s.copySingleTool:Gt(e);break;case s.copyMultiTool:Jt(e);break;case s.deleteSingleTool:_t(e);break;case s.deleteMultiTool:rn(e);break;case s.resizeTool:In(e);break;case s.toProofMode:cn(e);break;case s.doubleCutInsertionTool:hn(e);break;case s.doubleCutDeletionTool:pn(e);break;case s.erasureTool:Tn(e);break}De=!0}function Nn(e){if(De&&ve)switch(r.toolState){case s.cutTool:kt(e);break;case s.atomTool:Ot(e);break;case s.dragTool:bt(e);break;case s.moveSingleTool:Ft(e);break;case s.moveMultiTool:zt(e);break;case s.copySingleTool:Wt(e);break;case s.copyMultiTool:Kt(e);break;case s.deleteSingleTool:en(e);break;case s.deleteMultiTool:on(e);break;case s.resizeTool:Ln(e);break;case s.toProofMode:an();break;case s.doubleCutInsertionTool:wn(e);break;case s.doubleCutDeletionTool:xn(e);break;case s.erasureTool:En(e);break}}function Hn(e){switch(r.toolState){case s.cutTool:St(e);break;case s.atomTool:At(e);break;case s.moveSingleTool:Nt(e);break;case s.moveMultiTool:Ut(e);break;case s.copySingleTool:jt(e);break;case s.copyMultiTool:Zt(e);break;case s.deleteSingleTool:tn(e);break;case s.deleteMultiTool:sn(e);break;case s.resizeTool:Dn(e);break;case s.toProofMode:un();break;case s.doubleCutInsertionTool:yn(e);break;case s.doubleCutDeletionTool:mn(e);break;case s.erasureTool:Pn(e);break}De=!1}function Rn(){switch(r.toolState){case s.cutTool:It();break;case s.atomTool:Xt();break;case s.dragTool:Ct();break;case s.moveSingleTool:Ht();break;case s.moveMultiTool:Vt();break;case s.copySingleTool:qt();break;case s.copyMultiTool:Qt();break;case s.deleteSingleTool:nn();break;case s.deleteMultiTool:ln();break;case s.resizeTool:vn();break;case s.toProofMode:fn();break;case s.doubleCutInsertionTool:gn();break;case s.doubleCutDeletionTool:Mn();break;case s.erasureTool:kn();break}ve=!1}function zn(){ve=!0}function Un(){B.width=window.innerWidth,B.height=window.innerHeight}window.onresize=Un;
