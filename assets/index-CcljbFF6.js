(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const p of i)if(p.type==="childList")for(const w of p.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&o(w)}).observe(document,{childList:!0,subtree:!0});function n(i){const p={};return i.integrity&&(p.integrity=i.integrity),i.referrerPolicy&&(p.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?p.credentials="include":i.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(i){if(i.ep)return;i.ep=!0;const p=n(i);fetch(i.href,p)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function De(e,t){return un(e,t)||$e(t,e)}function un(e,t){if(e instanceof Se)return t instanceof Se?jt(e,t):Wt(t,e);if(t instanceof Se)return Wt(e,t);if(jt(e.boundingBox,t.boundingBox)||$e(t.boundingBox,e.boundingBox)){const n=fn(e);let o;for(let i=0;i<n.length;i++)if(o=at(t,n[i]),o<=0)return!0;return!1}return!1}function Wt(e,t){const n=t.getCorners(),o=Ze(e,n[0].x,1),i=Ze(e,n[1].x,1),p=Ze(e,n[0].x,-1),w=Ze(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<p&&p<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<w&&w<n[2].y)return!0;const f=-1/Math.pow(e.radiusX,2),y=2*e.center.x/Math.pow(e.radiusX,2),x=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),X=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),je=(-y+Math.sqrt(Math.pow(y,2)-4*f*x))/(2*f),xt=(-y-Math.sqrt(Math.pow(y,2)-4*f*x))/(2*f),St=(-y+Math.sqrt(Math.pow(y,2)-4*f*X))/(2*f),Et=(-y-Math.sqrt(Math.pow(y,2)-4*f*X))/(2*f);return!isNaN(je)&&n[0].x<je&&je<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x||!isNaN(St)&&n[0].x<St&&St<n[1].x||!isNaN(Et)&&n[0].x<Et&&Et<n[1].x}function $e(e,t){if(e instanceof Se)if(t instanceof Se){const n=t.getCorners();for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else{const n=Bn(t);for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else if(t instanceof Se){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=at(e,n[i]),!(o<0))return!1;return!0}else{const n=fn(t);let o;for(let i=0;i<n.length;i++)if(o=at(e,n[i]),!(o<0))return!1;return!0}}function jt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function Ct(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function at(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function Bn(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function fn(e){const t=[];let n,o,i=1;for(let p=0;p<360;p++)n=e.center.x+e.radiusX*Math.cos(p*(Math.PI/180)),p>180&&(i=-1),o=Ze(e,n,i),t[p]=new c(n,o);return t}function Ze(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class Se{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Ct(this,t)}overlaps(t){return De(this,t)}contains(t){return $e(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class d{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new d(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new Se(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class ue{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new Se(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return at(this,t)<0}overlaps(t){return De(this,t)}contains(t){return $e(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new ue(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof d,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof d?$e(this.internalEllipse,t.calcRect()):$e(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof d||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof d||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof d)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let p=0;p<o.length;p++){if(n[i]instanceof d&&o[p]instanceof d&&n[i].isEqualTo(o[p])||n[i]instanceof a&&o[p]instanceof a&&n[i].isEqualTo(o[p])){n.splice(i,1),o.splice(p,1),i--;break}if(p===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof d?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class b{constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof d?t.calcRect():t.ellipse,i=n instanceof d?n.calcRect():n.ellipse;return un(o,i)}overlaps(t,n){let o,i;return t instanceof d?n instanceof d?De(t.calcRect(),n.calcRect()):(o=n.ellipse,De(t.calcRect(),o)):n instanceof d?(o=t.ellipse,De(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,De(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}var Q=(e=>(e[e.CLEAR=0]="CLEAR",e[e.DRAW_ATOM=1]="DRAW_ATOM",e[e.DRAW_CUT=2]="DRAW_CUT",e[e.MOVE_SINGLE=3]="MOVE_SINGLE",e[e.MOVE_MULTI=4]="MOVE_MULTI",e[e.COPY_SINGLE=5]="COPY_SINGLE",e[e.COPY_MULTI=6]="COPY_MULTI",e[e.DELETE_SINGLE=7]="DELETE_SINGLE",e[e.DELETE_MULTI=8]="DELETE_MULTI",e[e.RESIZE=9]="RESIZE",e[e.COPY_GRAPH=10]="COPY_GRAPH",e))(Q||{});class Yn{constructor(t,n){this.tree=new b(t==null?void 0:t.sheet)??new b,this.appliedMove=n??0}}let Lt,l=new c(0,0),$t;function Fn(){h("cursor: grab")}function Xn(e){h("cursor: grabbing"),Lt=new c(e.x-l.x,e.y-l.y),$t=!1}function qn(e){$t||(h("cursor: grabbing"),l=new c(e.x-Lt.x,e.y-Lt.y),dn())}function Gn(){h("cursor: grab")}function zn(){h("cursor: default"),$t=!0,dn()}function dn(){r.modeState==="Proof"?m():u(r.tree)}var hn={exports:{}};(function(e,t){function n(){var w=document.querySelector("[data-toggle-theme]"),f=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(f||"theme")){localStorage.getItem(f||"theme")&&(document.documentElement.setAttribute("data-theme",y),w&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(x=>{x.classList.add(w.getAttribute("data-act-class"))}))})(),w&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(y=>{y.addEventListener("click",function(){var x=y.getAttribute("data-toggle-theme");if(x){var X=x.split(",");document.documentElement.getAttribute("data-theme")==X[0]?X.length==1?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem(f||"theme")):(document.documentElement.setAttribute("data-theme",X[1]),localStorage.setItem(f||"theme",X[1])):(document.documentElement.setAttribute("data-theme",X[0]),localStorage.setItem(f||"theme",X[0]))}[...document.querySelectorAll("[data-toggle-theme]")].forEach(je=>{je.classList.toggle(this.getAttribute("data-act-class"))})})})}function o(){var w=document.querySelector("[data-set-theme='']"),f=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(f||"theme")){if(y!=null&&y!="")if(localStorage.getItem(f||"theme")&&localStorage.getItem(f||"theme")!=""){document.documentElement.setAttribute("data-theme",y);var x=document.querySelector("[data-set-theme='"+y.toString()+"']");x&&([...document.querySelectorAll("[data-set-theme]")].forEach(X=>{X.classList.remove(X.getAttribute("data-act-class"))}),x.getAttribute("data-act-class")&&x.classList.add(x.getAttribute("data-act-class")))}else{var x=document.querySelector("[data-set-theme='']");x.getAttribute("data-act-class")&&x.classList.add(x.getAttribute("data-act-class"))}})(),[...document.querySelectorAll("[data-set-theme]")].forEach(y=>{y.addEventListener("click",function(){document.documentElement.setAttribute("data-theme",this.getAttribute("data-set-theme")),localStorage.setItem(f||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("[data-set-theme]")].forEach(x=>{x.classList.remove(x.getAttribute("data-act-class"))}),y.getAttribute("data-act-class")&&y.classList.add(y.getAttribute("data-act-class"))})})}function i(){var w=document.querySelector("select[data-choose-theme]"),f=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(f||"theme")){if(localStorage.getItem(f||"theme")){document.documentElement.setAttribute("data-theme",y);var x=document.querySelector("select[data-choose-theme] [value='"+y.toString()+"']");x&&[...document.querySelectorAll("select[data-choose-theme] [value='"+y.toString()+"']")].forEach(X=>{X.selected=!0})}})(),w&&[...document.querySelectorAll("select[data-choose-theme]")].forEach(y=>{y.addEventListener("change",function(){document.documentElement.setAttribute("data-theme",this.value),localStorage.setItem(f||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("select[data-choose-theme] [value='"+localStorage.getItem(f||"theme")+"']")].forEach(x=>{x.selected=!0})})})}function p(w=!0){w===!0?document.addEventListener("DOMContentLoaded",function(f){n(),i(),o()}):(n(),i(),o())}e.exports={themeChange:p}})(hn);var Vn=hn.exports;const _n=document.getElementById("theme-select");Vn.themeChange();let pn=Oe("--good-placement"),wn=Oe("--bad-placement"),gn=Oe("--canvas-items");function Oe(e){return getComputedStyle(document.body).getPropertyValue(e)}function yn(){setTimeout(()=>{pn=Oe("--good-placement"),wn=Oe("--bad-placement"),gn=Oe("--canvas-items"),r.modeState==="Draw"?u(r.tree):m()})}_n.addEventListener("input",()=>{yn()});window.addEventListener("DOMContentLoaded",()=>{yn()});function g(){return wn}function T(){return pn}function mn(){return gn}const ut=document.getElementById("canvas"),Tn=ut.getContext("2d");if(Tn===null)throw Error("2d rendering context not supported.");const P=Tn;P.font="35pt arial";const Wn=document.getElementById("graphString"),jn=document.getElementById("proofString"),Zn=document.getElementById("atomBox"),xn=document.getElementById("atomBoxes");xn.addEventListener("input",Kn);function U(e,t){const n=e.ellipse;if(n!==null){P.strokeStyle=t;const o=n.center;P.beginPath(),P.ellipse(o.x+l.x,o.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),P.stroke()}}function B(e,t,n){P.textBaseline="bottom";const o=P.measureText(e.identifier);P.fillStyle=t,P.strokeStyle=t,P.beginPath(),P.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(xn.checked||Zn.checked&&n)&&P.rect(e.origin.x+l.x,e.origin.y+l.y-o.actualBoundingBoxAscent,e.width,e.height),P.stroke()}function Sn(e,t,n){P.beginPath(),P.strokeStyle=n;const o=e.x-t.x+l.x,i=e.y-t.y+l.y;P.rect(e.x,e.y,-o,-i),P.stroke()}function h(e){ut.style.cssText=e}function Jn(e,t,n){return e===T()?t:n}function R(e,t,n){h(Jn(e,t,n))}function Kn(){u(r.tree)}function ot(){P.clearRect(0,0,ut.width,ut.height)}function u(e,t){Wn.innerHTML=e.toString(),ot(),vt(e.sheet,t),window.treeString=Tt(e)}function vt(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof d?Qn(e.children[n]):vt(e.children[n]);e.ellipse instanceof ue&&(P.strokeStyle=t||mn(),P.beginPath(),P.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),P.stroke())}function Qn(e){B(e,mn(),!1)}function m(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new b:e=r.currentProofStep.tree,ot(),jn.innerHTML=e.toString(),vt(e.sheet)}function ie(e,t){if(e instanceof d)B(e,t,!1);else if(e instanceof a){U(e,t);for(let n=0;n<e.children.length;n++)ie(e.children[n],t)}}function En(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.drawMoveSingleTool=4]="drawMoveSingleTool",e[e.drawMoveMultiTool=5]="drawMoveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.proofClearTool=22]="proofClearTool",e[e.drawClearTool=23]="drawClearTool",e))(s||{});const Y=class Y{static pushToDrawStack(t){this.recentlyUndoneOrRedoneDrawMove&&(this.drawHistoryRedoStack=[],this.recentlyUndoneOrRedoneDrawMove=!1),this.drawHistoryUndoStack.push(new Yn(this.tree,t))}static undoDrawStep(){const t=this.drawHistoryUndoStack.pop();if(t!==void 0){if(this.drawHistoryUndoStack[this.drawHistoryUndoStack.length-1]===void 0){this.tree=new b,u(this.tree),this.drawHistoryRedoStack.push(t);return}this.drawHistoryRedoStack.push(t),this.tree=new b(this.drawHistoryUndoStack[this.drawHistoryUndoStack.length-1].tree.sheet),u(this.tree),this.recentlyUndoneOrRedoneDrawMove=!0}}static redoDrawStep(){const t=this.drawHistoryRedoStack.pop();if(t!==void 0){if(this.drawHistoryRedoStack[this.drawHistoryRedoStack.length-1]===void 0){this.tree=new b(t.tree.sheet),u(this.tree),this.drawHistoryUndoStack.push(t);return}this.drawHistoryUndoStack.push(t),this.tree=new b(t.tree.sheet),u(this.tree),this.recentlyUndoneOrRedoneDrawMove=!0}}static undoProofStep(){if(this.proof.length<=1)return;const t=this.proof.pop();if(t!==void 0){if(this.proof.length===0){Zt();return}Zt(),this.proofHistoryRedoStack.push(t),Rt(this.proof[this.proof.length-1]),m(),this.recentlyUndoneOrRedoneProofMove=!0}}static redoProofStep(){if(this.proofHistoryRedoStack.length===0)return;const t=this.proofHistoryRedoStack.pop();if(t!==void 0){if(this.proofHistoryRedoStack[this.proofHistoryRedoStack.length-1]===void 0){this.pushToProof(t),m();return}this.recentlyUndoneOrRedoneProofMove=!1,this.pushToProof(t),Rt(t),m()}}static getLastProofStep(){return Y.proof.length===0?new V(new b):Y.proof[Y.proof.length-1]}static pushToProof(t){var n;if(this.recentlyUndoneOrRedoneProofMove&&(this.proofHistoryRedoStack=[],this.recentlyUndoneOrRedoneProofMove=!1),t.appliedRule===M.PASTE_GRAPH)this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;At(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),bn(t)}static clearProof(){At(-1),this.proof=[],this.pushToProof(new V),this.currentProofStep=this.proof[0]}};Y.tree=new b,Y.drawHistoryUndoStack=[],Y.drawHistoryRedoStack=[],Y.recentlyUndoneOrRedoneDrawMove=!1,Y.proof=[],Y.proofHistoryRedoStack=[],Y.recentlyUndoneOrRedoneProofMove=!1,Y.selectForProof=new b,Y.toolState=0,Y.modeState="Draw";let r=Y;var M=(e=>(e[e.CLEAR=0]="CLEAR",e[e.DC_INSERT=1]="DC_INSERT",e[e.DC_DELETE=2]="DC_DELETE",e[e.MOVE_SINGLE=3]="MOVE_SINGLE",e[e.MOVE_MULTI=4]="MOVE_MULTI",e[e.ITERATION=5]="ITERATION",e[e.DEITERATION=6]="DEITERATION",e[e.INSERTION=7]="INSERTION",e[e.ERASURE=8]="ERASURE",e[e.RESIZE=9]="RESIZE",e[e.PASTE_GRAPH=10]="PASTE_GRAPH",e))(M||{});class V{constructor(t,n){this.appliedRule=n??0,this.tree=new b(t==null?void 0:t.sheet),this.index=r.proof.length}}const eo={[M.CLEAR]:"",[M.DC_INSERT]:"dot-circle-o",[M.DC_DELETE]:"times-circle",[M.MOVE_SINGLE]:"mouse-pointer",[M.MOVE_MULTI]:"arrows",[M.ITERATION]:"expand",[M.DEITERATION]:"compress",[M.INSERTION]:"plus",[M.ERASURE]:"trash",[M.RESIZE]:"arrows-alt",[M.PASTE_GRAPH]:"files-o"};function bn(e,t){var f;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Rt(e)};const p=document.createElement("Text"),w=eo[e.appliedRule];p.className="fa fa-"+w,i.appendChild(p),n.appendChild(i),(f=document.getElementById("proofHistoryBar"))==null||f.appendChild(n)}function Rt(e){r.currentProofStep=e,m()}function At(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}function Zt(){var e;(e=document.getElementById("Row: "+(r.proof.length+1)))==null||e.remove()}async function to(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Dt(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Jt(o)}else{const o=[];let i;for(i of n){const p=i.tree.internalSheet.internalChildren;o.push(new V(Jt(p),i.appliedRule))}return o}}function Jt(e){const t=new b,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(Mn(o)):n.push(In(o));return t.sheet.children=n,t}function Mn(e){const t=new ue(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(Mn(o)):n.push(In(o));return new a(t,n)}function In(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new d(t,n,e.internalWidth,e.internalHeight)}let bt=!0,Mt=null,It=null,Kt=s.none,Qt=s.none;const en=document.getElementById("DrawButtons"),tn=document.getElementById("ProofButtons"),nn=document.getElementById("proofHistoryBar");function no(){if(bt=!bt,bt){en.style.display="block",sn.style.display="block",tn.style.display="none",ln.style.display="none",nn.style.display="none",r.modeState="Draw",It=JSON.stringify(r.proof),Qt=r.toolState;let e=null;if(Mt!==null&&(e=Dt(r.modeState,Mt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=Kt,u(r.tree)}else{en.style.display="none",sn.style.display="none",tn.style.display="block",ln.style.display="block",nn.style.display="block",r.modeState="Proof",Mt=JSON.stringify(r.tree),Kt=r.toolState,r.proof.length===0&&r.pushToProof(new V);let e=null;It!==null&&(e=Dt(r.modeState,It)),e!==null&&(r.proof=e),r.toolState=Qt,m()}}let Ht;function oo(){Ht=!0,ot(),ie(r.tree.sheet,g())}function ro(){Ht&&(r.tree=new b,u(r.tree),r.pushToDrawStack(Q.CLEAR))}function io(){Ht=!1,u(r.tree)}const so=document.getElementById("canvas"),Pn=so.getContext("2d");if(Pn===null)throw Error("2d rendering context not supported.");const lo=Pn,co=document.getElementById("atomDisplay");let pt,Ut,v=rt("A",new c(0,0));function ao(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(v=rt(e.key,new c(v.origin.x,v.origin.y)),v.origin.x!==0&&v.origin.y!==0&&Ut&&Bt())}function uo(e){pt=!1,Ut=!0,v=rt(v.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Bt()}function fo(e){v=rt(v.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Bt()}function ho(e){h("cursor: default"),v=rt(v.identifier,new c(e.clientX-l.x,e.clientY-l.y)),r.tree.canInsert(v)&&!pt&&(r.tree.insert(v),r.pushToDrawStack(Q.DRAW_ATOM)),u(r.tree),Ut=!1}function po(){h("cursor: default"),pt=!0,u(r.tree)}function rt(e,t){co.innerHTML=e;const n=lo.measureText(e);return new d(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Bt(){u(r.tree),pt||(r.tree.canInsert(v)?(h("cursor: default"),B(v,T(),!0)):(h("cursor: no-drop"),B(v,g(),!0)))}const wo=document.getElementById("mode");function Ee(e,t,n){if(t.ellipse!==null){const o=ee(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!Ee(e,t.children[o],n))return!1;if(t.children[o]instanceof d){let i=t.children[o];if(i=L(i,n),!e.canInsert(i))return!1}}return!0}function z(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=ee(e,n);if(U(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)z(e.children[i],t,n)}else if(e instanceof d){const o=L(e,n);B(o,t,!0)}}function it(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=ee(e,t);if(o.insert(i),e.children.length!==0)for(let p=0;p<e.children.length;p++)it(e.children[p],t,n)}else if(e instanceof d){const i=L(e,t);o.insert(i)}}function et(e,t){return e instanceof d?L(e,t):ee(e,t)}function ee(e,t){if(e.ellipse!==null)return new a(new ue(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Yt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(Yt(e.children[o],t)):e.children[o]instanceof d&&n.push(L(e.children[o],t));return new a(new ue(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function L(e,t){return new d(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function wt(e,t,n){if(e.ellipse!==null)return new a(new ue(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),Math.abs(e.ellipse.radiusX+t.x*n.x),Math.abs(e.ellipse.radiusY+t.y*n.y)));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function st(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function Ae(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&st(e,t),u(e))}function gt(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,p=Math.abs(o),w=Math.abs(i);let f,y;if(wo.value==="circumscribed"){const x=Math.floor(n.distance(t));y=Math.floor(x*(w/p)),f=Math.floor(x*(p/w))}else f=p/2,y=w/2;return new ue(n,f,y)}function Pe(e){return e.radiusX>15&&e.radiusY>15}const go=document.getElementById("showRect");let ft,yt;function yo(){h("cursor: crosshair")}function mo(e){ft=new c(e.clientX-l.x,e.clientY-l.y),yt=!1}function To(e){const t=new a(new ue(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(u(r.tree),t.ellipse=gt(ft,n),!yt){const i=r.tree.canInsert(t)&&Pe(t.ellipse)?T():g();R(i,"cursor: crosshair","cursor: no-drop"),U(t,i),go.checked&&Sn(ft,n,i)}}function xo(e){h("cursor: crosshair");const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(gt(ft,t));r.tree.canInsert(n)&&!yt&&Pe(n.ellipse)&&(r.tree.insert(n),r.pushToDrawStack(Q.DRAW_CUT)),u(r.tree)}function So(){h("cursor: default"),yt=!0,u(r.tree)}let ge,I=null,ke;function Eo(e){if(ge=new c(e.x-l.x,e.y-l.y),I=r.tree.getLowestNode(ge),I!==r.tree.sheet&&I!==null){h("cursor: grabbing");const t=r.tree.getLowestParent(ge);if(t!==null&&t.remove(ge),I instanceof a&&I.children.length!==0){for(let n=0;n<I.children.length;n++)r.tree.insert(I.children[n]);I.children=[]}ke=!0,u(r.tree),I instanceof d?B(I,T(),!0):U(I,T())}else ke=!1}function bo(e){if(ke){const t=new c(e.x-ge.x,e.y-ge.y);if(I instanceof a){const n=ee(I,t);u(r.tree);const o=r.tree.canInsert(n)?T():g();U(n,o),R(o,"cursor: grabbing","cursor: no-drop")}else if(I instanceof d){const n=L(I,t);u(r.tree);const o=r.tree.canInsert(n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function Mo(e){if(h("cursor: default"),ke){const t=new c(e.x-ge.x,e.y-ge.y);if(I instanceof a){const n=ee(I,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(I)}else if(I instanceof d){const n=L(I,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(I)}u(r.tree),r.pushToDrawStack(Q.MOVE_SINGLE)}ke=!1}function Io(){h("cursor: default"),ke&&I!==null&&r.tree.insert(I),ke=!1,u(r.tree)}let ye,D=null,Ce;function Po(e){if(ye=new c(e.x-l.x,e.y-l.y),D=r.tree.getLowestNode(ye),D!==r.tree.sheet&&D!==null){h("cursor: grabbing");const t=r.tree.getLowestParent(ye);t!==null&&t.remove(ye),Ce=!0,u(r.tree),ie(D,T())}else Ce=!1}function ko(e){if(Ce){const t=new c(e.x-ye.x,e.y-ye.y);if(u(r.tree),D instanceof a){const n=Ee(r.tree,D,t)?T():g();z(D,n,t),R(n,"cursor: grabbing","cursor: no-drop")}else if(D instanceof d){const n=L(D,t),o=r.tree.canInsert(n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function Co(e){if(h("cursor: default"),Ce){const t=new c(e.x-ye.x,e.y-ye.y);if(D instanceof a)Ee(r.tree,D,t)?it(D,t):r.tree.insert(D);else if(D instanceof d){const n=L(D,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(D)}r.pushToDrawStack(Q.MOVE_MULTI)}u(r.tree),Ce=!1}function Lo(){h("cursor: default"),Ce&&D!==null&&r.tree.insert(D),Ce=!1,u(r.tree)}let me,J=null,ve;function Ro(e){me=new c(e.x-l.x,e.y-l.y);const t=r.tree.getLowestNode(me),n=new c(e.x-me.x,e.y-me.y);t!==r.tree.sheet&&t!==null?(h("cursor: copy"),t instanceof a?(J=ee(t,n),J.children=[]):t instanceof d&&(J=t),ve=!0):ve=!1}function Ao(e){if(ve){const t=new c(e.x-me.x,e.y-me.y);if(J instanceof a){const n=ee(J,t);u(r.tree);const o=r.tree.canInsert(n)?T():g();U(n,o),R(o,"cursor: grabbing","cursor: no-drop")}else if(J instanceof d){const n=L(J,t);u(r.tree);const o=r.tree.canInsert(n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function Do(e){if(h("cursor: default"),ve){const t=new c(e.x-me.x,e.y-me.y);if(J instanceof a&&J.ellipse!==null){const n=ee(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(J instanceof d){const n=L(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}u(r.tree),r.pushToDrawStack(Q.COPY_SINGLE)}ve=!1}function Oo(){h("cursor: default"),ve=!1,u(r.tree)}let He,W=null,Ue;function No(e){He=new c(e.x-l.x,e.y-l.y),W=r.tree.getLowestNode(He),W!==r.tree.sheet&&W!==null?(h("cursor: copy"),Ue=!0):Ue=!1}function $o(e){if(Ue){const t=new c(e.x-He.x,e.y-He.y);if(u(r.tree),W instanceof a){const n=Ee(r.tree,W,t)?T():g();z(W,n,t),R(n,"cursor: grabbing","cursor: no-drop")}else if(W instanceof d){const n=L(W,t),o=r.tree.canInsert(n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function vo(e){if(h("cursor: default"),Ue){const t=new c(e.x-He.x,e.y-He.y);if(W instanceof a)Ee(r.tree,W,t)&&it(W,t);else if(W instanceof d){const n=L(W,t);r.tree.canInsert(n)&&r.tree.insert(n)}r.pushToDrawStack(Q.COPY_MULTI)}u(r.tree),Ue=!1}function Ho(){h("cursor: default"),Ue=!1,u(r.tree)}let lt,E=null,se;function Uo(e){if(lt=new c(e.x-l.x,e.y-l.y),E=r.tree.getLowestNode(lt),E!==null){const t=r.tree.getLowestParent(lt);t!==null&&t.remove(lt),E instanceof a&&E.children.length!==0&&E!==r.tree.sheet&&st(r.tree,E),u(r.tree),E instanceof d?B(E,g(),!0):U(E,g()),se=!0}else se=!1}function Bo(e){se&&E!==null&&E.ellipse!==null&&Ae(r.tree,E);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);se&&E!==null&&o!==null&&(se=!0,u(r.tree),n===null?(E=null,se=!1):(o.remove(t),E=n,E instanceof a&&E.children.length!==0&&(st(r.tree,E),E.children=[]),u(r.tree),E instanceof d?B(E,g(),!0):U(E,g())))}function Yo(e){const t=new c(e.x-l.x,e.y-l.y);if(se){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&st(r.tree,n),u(r.tree),r.pushToDrawStack(Q.DELETE_SINGLE)}E=null,se=!1}function Fo(){se&&E!==null&&Ae(r.tree,E),E=null,se=!1,u(r.tree)}let ct,$=null,ne;function Xo(e){if(ct=new c(e.x-l.x,e.y-l.y),$=r.tree.getLowestNode(ct),$!==null){const t=r.tree.getLowestParent(ct);t!==null?t.remove(ct):($=r.tree.sheet.copy(),r.tree.clear()),ne=!0,u(r.tree),ie($,g())}}function qo(e){ne&&$!==null&&Ae(r.tree,$);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);ne&&$!==null&&o!==null?(ne=!0,n===null?($=null,ne=!1):(o.remove(t),$=n,ne=!0,u(r.tree),ie($,g()))):ne&&o===null&&($=r.tree.sheet.copy(),r.tree.clear(),u(r.tree),ie($,g()))}function Go(e){const t=new c(e.x-l.x,e.y-l.y);if(ne){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),u(r.tree),r.pushToDrawStack(Q.DELETE_MULTI)}$=null,ne=!1}function zo(){ne&&$!==null&&Ae(r.tree,$),$=null,ne=!1,u(r.tree)}let fe,q=null,Be,Ft=new c(1,1);function Vo(e){if(fe=new c(e.x-l.x,e.y-l.y),q=r.tree.getLowestNode(fe),q instanceof a&&q.ellipse!==null){Be=!0;const t=r.tree.getLowestParent(fe);t!==null&&t.remove(fe);for(let n=0;n<q.children.length;n++)r.tree.insert(q.children[n]);Ft=En(q,fe),q.children=[]}}function _o(e){if(Be){const t=new c((e.x-l.x-fe.x)/2,(e.y-l.y-fe.y)/2);if(q instanceof a){const n=wt(q,t,Ft);if(n.ellipse!==null){u(r.tree);const i=r.tree.canInsert(n)&&Pe(n.ellipse)?T():g();R(i,"cursor: crosshair","cursor: no-drop"),U(n,i)}}}}function Wo(e){if(h("cursor: default"),Be){const t=new c((e.x-l.x-fe.x)/2,(e.y-l.y-fe.y)/2);if(q instanceof a){const n=wt(q,t,Ft);n.ellipse!==null&&(r.tree.canInsert(n)&&Pe(n.ellipse)?r.tree.insert(n):r.tree.insert(q))}u(r.tree),Be=!1,r.pushToDrawStack(Q.RESIZE)}}function jo(){h("cursor: default"),Be&&q!==null&&r.tree.insert(q),Be=!1,u(r.tree)}let Ye,N=null,Fe,Je;const Zo=document.getElementById("selectionString");function Jo(e){Je=new b(r.tree.sheet),r.selectForProof.sheet=new b().sheet,Ye=new c(e.x-l.x,e.y-l.y),N=r.tree.getLowestNode(Ye),kn()}function Ko(e){Fe&&(u(r.tree),Ye=new c(e.x-l.x,e.y-l.y),N=r.tree.getLowestNode(Ye),kn())}function Qo(){if(h("cursor: default"),Fe&&N!==null){if(N instanceof a&&N.ellipse===null)for(let e=0;e<N.children.length;e++)r.selectForProof.insert(N.children[e]);else r.selectForProof.insert(N);u(r.tree),r.pushToDrawStack(Q.COPY_GRAPH)}N=null,Fe=!1}function er(){h("cursor: default"),N=null,Fe=!1,u(r.tree)}function kn(){const e=new b;let t=!1;if(N!==null){if(Fe=!0,N instanceof d||!N.isEqualTo(Je.sheet)){e.insert(N);const n=Je.getLowestParent(Ye);n!==null&&(n.remove(Ye),t=!0),u(Je)}else e.sheet=N,ot();ie(N,T()),h("cursor: copy"),t&&Je.insert(N)}else Fe=!1;Zo.innerHTML=e.toString()}function te(){const e=new b;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function Xe(e,t){return e.canInsert(t)&&Cn(new b(e.sheet),t)}function Cn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new b(r.currentProofStep.tree.sheet))):!1}let on,Xt;function tr(){on=te(),Xt=!0,ot(),ie(on.sheet,g())}function nr(){Xt&&(At(-1),r.clearProof(),m())}function or(){Xt=!1,m()}const rr=document.getElementById("showRect");let dt,mt,qe;function ir(){h("cursor: crosshair")}function sr(e){dt=new c(e.clientX-l.x,e.clientY-l.y),qe=te(),mt=!1}function lr(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(gt(dt,t)),o=new a(Ln(n.ellipse));if(m(),!mt){const i=Rn(n,o)?T():g();U(n,i),U(o,i),R(i,"cursor: crosshair","cursor: no-drop"),rr.checked&&Sn(dt,t,i)}}function cr(e){h("cursor: crosshair");const t=new c(e.clientX-l.x,e.clientY-l.y);qe=te();const n=new a(gt(dt,t)),o=new a(Ln(n.ellipse)),i=new V(qe,M.DC_INSERT);!mt&&Rn(n,o)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),m()}function ar(){h("cursor: default"),mt=!0,m()}function Ln(e){return new ue(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}function Rn(e,t){return e.ellipse!==null&&t.ellipse!==null&&qe.canInsert(e)&&Pe(e.ellipse)&&qe.canInsert(t)&&Pe(t.ellipse)&&ur(e,t)}function ur(e,t){const n=new b(qe.sheet),o=new a(e.ellipse),i=new a(t.ellipse);return n.insert(o),n.insert(i),o.children.length===1}let he,j=null,tt,be,Ne;function fr(e){he=new c(e.x-l.x,e.y-l.y),be=te(),Ne=new b(be.sheet),j=be.getLowestNode(he),An()}function dr(e){he=new c(e.x-l.x,e.y-l.y),Ne=new b(be.sheet),j!==null&&(j=be.getLowestNode(he),m(),An())}function hr(e){const t=new V(be,M.DC_DELETE);if(he=new c(e.x-l.x,e.y-l.y),tt&&j instanceof a){const n=t.tree.getLowestParent(he),o=j.children[0];if(n!==null&&o instanceof a){n.remove(he);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}m()}function pr(){tt&&j!==null&&Ae(Ne,j),j=null,tt=!1,m()}function wr(e){return e.children.length===1&&e.children[0]instanceof a&&j!==be.sheet}function gr(e){U(e,g()),e.children[0]instanceof a&&U(e.children[0],g())}function An(){if(j instanceof a&&wr(j)){tt=!0;const e=Ne.getLowestParent(he);if(e!==null){e.remove(he);const t=j.children[0].copy();st(Ne,t),t.children=[]}u(Ne),gr(j)}else tt=!1}let Te,k=null,Le,Z;function yr(e){if(Z=te(),Te=new c(e.x-l.x,e.y-l.y),k=Z.getLowestNode(Te),k!==Z.sheet&&k!==null){h("cursor: grabbing");const t=Z.getLowestParent(Te);if(t!==null&&t.remove(Te),k instanceof a&&k.children.length!==0){for(let n=0;n<k.children.length;n++)Z.insert(k.children[n]);k.children=[]}Le=!0,u(Z),k instanceof d?B(k,T(),!0):U(k,T())}else Le=!1}function mr(e){if(Le){const t=new c(e.x-Te.x,e.y-Te.y);if(u(Z),k instanceof a){const n=ee(k,t),o=Xe(Z,n)?T():g();U(n,o),R(o,"cursor: grabbing","cursor: no-drop")}else if(k instanceof d){const n=L(k,t),o=Xe(Z,n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function Tr(e){if(Le){h("cursor: default");const t=new V(Z,M.MOVE_SINGLE),n=new c(e.x-Te.x,e.y-Te.y);let o=null;k instanceof a?o=ee(k,n):k instanceof d&&(o=L(k,n)),o!==null&&Xe(Z,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Le=!1}function xr(){h("cursor: default"),Le&&k!==null&&Z.insert(k),Le=!1,m()}let xe,F=null,Pt=null,Re,oe;function Sr(e){oe=te(),xe=new c(e.x-l.x,e.y-l.y),F=oe.getLowestNode(xe),F!==oe.sheet&&F!==null?(h("cursor: grabbing"),Pt=oe.getLowestParent(xe),Pt!==null&&Pt.remove(xe),Re=!0,u(oe),ie(F,T())):Re=!1}function Er(e){if(Re){const t=new c(e.x-xe.x,e.y-xe.y);if(u(oe),F instanceof a){const n=Yt(F,t),o=Xe(oe,n)?T():g();z(F,o,t),R(o,"cursor: grabbing","cursor: no-drop")}else if(F instanceof d){const n=L(F,t),o=Xe(oe,n)?T():g();B(n,o,!0),R(o,"cursor: grabbing","cursor: no-drop")}}}function br(e){if(Re){h("cursor: default");const t=new V(oe,M.MOVE_MULTI),n=new c(e.x-xe.x,e.y-xe.y);let o=null;F instanceof a?o=Yt(F,n):F instanceof d&&(o=L(F,n)),o!==null&&Xe(oe,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Re=!1}function Mr(){h("cursor: default"),Re&&F!==null&&oe.insert(F),Re=!1,m()}let Me,H=null,Ot=null,Ge,le;function Ir(e){le=te(),Me=new c(e.x-l.x,e.y-l.y),H=le.getLowestNode(Me),Ot=le.getLowestParent(Me),Ge=H!==le.sheet&&H!==null,Ge&&h("cursor: copy")}function Pr(e){if(Ge){const t=new c(e.x-Me.x,e.y-Me.y);m();const n=new c(e.x-l.x,e.y-l.y),o=Dn(t,n)?T():g();if(H instanceof a)z(H,o,t);else if(H instanceof d){const i=L(H,t);B(i,o,!0)}R(o,"cursor: grabbing","cursor: no-drop")}}function kr(e){if(Ge){h("cursor: default");const t=new c(e.x-Me.x,e.y-Me.y);if(Dn(t,new c(e.x-l.x,e.y-l.y))){if(H instanceof a)it(H,t,le);else if(H instanceof d){const n=L(H,t);le.insert(n)}r.pushToProof(new V(le,M.ITERATION))}}m(),Ge=!1}function Cr(){h("cursor: default"),Ge=!1,m()}function Dn(e,t){return Ot!==null&&Ot.containsPoint(t)&&(H instanceof a&&Ee(le,H,e)&&On(le.sheet,ee(H,e).ellipse)||H instanceof d&&le.canInsert(L(H,e)))}function On(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof ue&&(t.contains(e.children[n].ellipse)||!On(e.children[n],t)))return!1}else if(e.children[n]instanceof d&&t.contains(e.children[n].calcRect()))return!1;return!0}let pe,C=null,ze,re,Ke;function Lr(e){pe=new c(e.x-l.x,e.y-l.y),re=te(),Ke=new b(re.sheet),C=re.getLowestNode(pe),Nn()}function Rr(e){pe=new c(e.x-l.x,e.y-l.y),C!==null&&(C=re.getLowestNode(pe),m(),Nn())}function Ar(e){if(ze&&(pe=new c(e.x-l.x,e.y-l.y),C!==null&&qt(re.sheet,re.getLevel(C)))){const t=re.getLowestParent(pe);t instanceof a&&t.remove(pe),r.pushToProof(new V(re,M.DEITERATION))}ze=!1,m()}function Dr(){ze&&C!==null&&Ae(Ke,C),ze=!1,C=null,m()}function Nn(){if(C!==null&&!(C instanceof a&&C.ellipse===null)&&qt(re.sheet,re.getLevel(C))){ze=!0;const e=Ke.getLowestParent(pe);e!==null&&e.remove(pe),u(Ke),ie(C,g()),Ke.insert(C)}else ze=!1}function qt(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&C instanceof a&&C.isEqualTo(e.children[o])&&C.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof d&&C instanceof d&&e.children[o].identifier===C.identifier&&e.children[o].toString()!==C.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(C)&&re.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?qt(n,t):!1}let S,A,G,O,Ve;function Or(e){G=te();const t=r.selectForProof.sheet.children,n=new c(e.x-l.x,e.y-l.y);if(r.proof.length>0&&t.length===1){Ve=!0,S=t[0];const o=Gt(e,S),i=G.getLowestNode(n),p=G.getLowestParent(n);if(A=i instanceof d?p:i,o){const w=et(S,o);if(A!==null&&!A.containsNode(w))h("cursor: no-drop"),O=!1,z(S,g(),o);else if(A!==null&&A instanceof a&&A.ellipse!==null&&G.getLevel(A)%2===0){if(w instanceof a){O=!0;for(let f=0;f<A.children.length;f++)if(w.containsNode(A.children[f])){O=!1;break}}else O=!0;if(O){let f="";if(S instanceof a)f=Ee(G,S,o)?T():g();else if(S instanceof d){const y=et(S,o);f=G.canInsert(y)?T():g()}O=f===T(),z(S,f,o),R(f,"cursor: copy","cursor: no-drop")}else h("cursor: no-drop"),z(S,g(),o)}else h("cursor: no-drop"),O=!1,z(S,g(),o)}}else O=!1,Ve=!1,z(S,g(),n)}function Nr(e){if(Ve){const t=new c(e.x-l.x,e.y-l.y);m();const n=Gt(e,S),o=G.getLowestNode(t),i=G.getLowestParent(t);if(A=o instanceof d?i:o,n){const p=et(S,n);if(A!==null&&!A.containsNode(p))h("cursor: no-drop"),O=!1,z(S,g(),n);else if(A!==null&&A instanceof a&&A.ellipse!==null&&G.getLevel(A)%2===0){if(p instanceof a){O=!0;for(let w=0;w<A.children.length;w++)if(p.containsNode(A.children[w])){O=!1;break}}else O=!0;if(O){let w="";if(S instanceof a)w=Ee(G,S,n)?T():g();else if(S instanceof d){const f=et(S,n);w=G.canInsert(f)?T():g()}O=w===T(),z(S,w,n),R(w,"cursor: copy","cursor: no-drop")}else h("cursor: no-drop"),z(S,g(),n)}else h("cursor: no-drop"),O=!1,z(S,g(),n)}}else O=!1}function $r(e){if(h("cursor: default"),Ve&&O){const t=Gt(e,S);if(t){if(S instanceof a)it(S,t,G);else if(S instanceof d){const n=et(S,t);G.insert(n)}r.pushToProof(new V(G,M.INSERTION))}}m(),Ve=!1}function vr(){h("cursor: default"),Ve=!1,m()}function Gt(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof d)return new c(e.x-t.origin.x,e.y-t.origin.y)}let we,K=null,_e,Ie,Qe;function Hr(e){we=new c(e.x-l.x,e.y-l.y),Ie=te(),Qe=new b(Ie.sheet),K=Ie.getLowestNode(we),$n()}function Ur(e){we=new c(e.x-l.x,e.y-l.y),K!==null&&(K=Ie.getLowestNode(we),m(),$n())}function Br(e){if(_e){const t=new V(Ie,M.ERASURE);we=new c(e.x-l.x,e.y-l.y);const n=t.tree.getLowestParent(we);n!==null&&n.remove(we),r.pushToProof(t),m()}K=null,_e=!1}function Yr(){_e&&K!==null&&Ae(Qe,K),K=null,_e=!1,m()}function $n(){if(K!==Ie.sheet&&K!==null&&Ie.getLevel(K)%2===0){_e=!0;const e=Qe.getLowestParent(we);e!==null&&e.remove(we),u(Qe),ie(K,g()),Qe.insert(K)}else _e=!1}let de,_=null,We,zt=new c(1,1),ce;function Fr(e){if(ce=te(),de=new c(e.x-l.x,e.y-l.y),_=ce.getLowestNode(de),_ instanceof a&&_.ellipse!==null){We=!0;const t=ce.getLowestParent(de);t!==null&&t.remove(de);for(let n=0;n<_.children.length;n++)ce.insert(_.children[n]);zt=En(_,de),_.children=[]}}function Xr(e){if(We){const t=new c((e.x-l.x-de.x)/2,(e.y-l.y-de.y)/2);if(_ instanceof a){const n=wt(_,t,zt);if(n.ellipse!==null){u(ce);const o=vn(n)?T():g();U(n,o),R(o,"cursor: crosshair","cursor: no-drop")}}}}function qr(e){if(We){h("cursor: default");const t=new c((e.x-l.x-de.x)/2,(e.y-l.y-de.y)/2);if(_ instanceof a){const n=wt(_,t,zt);n.ellipse!==null&&vn(n)&&(ce.insert(n),r.pushToProof(new V(ce,M.RESIZE)))}m(),We=!1}}function Gr(){h("cursor: default"),We&&_!==null&&ce.insert(_),We=!1,m()}function vn(e){return ce.canInsert(e)&&Pe(e.ellipse)&&Cn(new b(ce.sheet),e)}let Nt,ht,nt;function zr(){ht=te(),Nt=r.selectForProof.sheet,Nt.children.length>0&&r.proof.length===1&&ht.sheet.isEmptySheet()&&(nt=!0,h("cursor: copy"))}function Vr(){h("cursor: default"),nt=!1,m()}function _r(){nt&&(h("cursor: default"),ht.sheet=Nt,r.pushToProof(new V(ht,M.PASTE_GRAPH))),nt=!1,m()}function Wr(){h("cursor: default"),nt=!1,m()}const ae=document.getElementById("canvas");ae.width=window.innerWidth;ae.height=window.innerHeight;const Hn=ae.getContext("2d");if(Hn===null)throw Error("2d rendering context not supported");const jr=Hn;jr.font="35pt arial";const kt=document.getElementById("cutTools"),rn=document.getElementById("atomTools"),sn=document.getElementById("graphString"),ln=document.getElementById("proofString"),cn=document.getElementById("toProofTools");window.addEventListener("keydown",ti);ae.addEventListener("mouseenter",ni);ae.addEventListener("mousedown",oi);ae.addEventListener("mousemove",ri);ae.addEventListener("mouseup",ii);ae.addEventListener("mouseout",si);let Vt=!1,_t=!0;window.tree=r.tree;window.treeString=Tt(window.tree);window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.aegStringify=Tt;window.saveMode=Un;window.loadMode=Kr;window.drawMoveSingleTool=s.drawMoveSingleTool;window.drawMoveMultiTool=s.drawMoveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.copyFromDrawTool=s.copyFromDrawTool;window.pasteInProofTool=s.pasteInProofTool;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.insertionTool=s.insertionTool;window.erasureTool=s.erasureTool;window.proofMoveSingleTool=s.proofMoveSingleTool;window.proofMoveMultiTool=s.proofMoveMultiTool;window.proofResizeTool=s.proofResizeTool;window.iterationTool=s.iterationTool;window.deiterationTool=s.deiterationTool;window.proofClearTool=s.proofClearTool;window.drawClearTool=s.drawClearTool;window.setTool=Jr;window.setHighlight=Zr;window.toggleHandler=no;function Zr(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const an=document.querySelectorAll(".toolButton");an.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),an.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Jr(e){switch(r.toolState=e,kt.style.display="none",rn.style.display="none",cn.style.display="none",r.toolState){case s.atomTool:rn.style.display="block";break;case s.cutTool:kt.style.display="block";break;case s.copyFromDrawTool:cn.style.display="block";break;case s.doubleCutInsertionTool:kt.style.display="block";break}}function Tt(e){return JSON.stringify(e,null,"	")}async function Un(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});to(n,t)}else{const n=document.createElement("a");n.href=Tt(t),n.download=e+".json",n.click()}}catch{}}async function Kr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const p=Dt(r.modeState,o);if(r.modeState==="Draw")r.tree=p,u(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=p,(i=document.getElementById("Row: 1"))==null||i.remove();for(let w=0;w<r.proof.length;w++)bn(r.proof[w],w+1);r.currentProofStep=r.proof[r.proof.length-1],m()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}async function Qr(){r.modeState==="Draw"?r.undoDrawStep():r.undoProofStep()}async function ei(){r.modeState==="Draw"?r.redoDrawStep():r.redoProofStep()}function ti(e){if(e.ctrlKey)e.preventDefault(),e.key==="s"?Un():e.key==="z"?Qr():e.key==="y"&&ei();else switch(r.toolState){case s.atomTool:ao(e);break}}function ni(){switch(r.toolState){case s.cutTool:yo();break;case s.dragTool:Fn();break;case s.doubleCutInsertionTool:ir();break}_t=!0}function oi(e){if(e.button===0){switch(r.toolState){case s.cutTool:mo(e);break;case s.atomTool:uo(e);break;case s.dragTool:Xn(e);break;case s.drawMoveSingleTool:Eo(e);break;case s.drawMoveMultiTool:Po(e);break;case s.copySingleTool:Ro(e);break;case s.copyMultiTool:No(e);break;case s.deleteSingleTool:Uo(e);break;case s.deleteMultiTool:Xo(e);break;case s.resizeTool:Vo(e);break;case s.copyFromDrawTool:Jo(e);break;case s.pasteInProofTool:zr();break;case s.doubleCutInsertionTool:sr(e);break;case s.doubleCutDeletionTool:fr(e);break;case s.insertionTool:Or(e);break;case s.erasureTool:Hr(e);break;case s.proofMoveSingleTool:yr(e);break;case s.proofMoveMultiTool:Sr(e);break;case s.proofResizeTool:Fr(e);break;case s.iterationTool:Ir(e);break;case s.deiterationTool:Lr(e);break;case s.proofClearTool:tr();break;case s.drawClearTool:oo();break}Vt=!0}}function ri(e){if(Vt&&_t)switch(r.toolState){case s.cutTool:To(e);break;case s.atomTool:fo(e);break;case s.dragTool:qn(e);break;case s.drawMoveSingleTool:bo(e);break;case s.drawMoveMultiTool:ko(e);break;case s.copySingleTool:Ao(e);break;case s.copyMultiTool:$o(e);break;case s.deleteSingleTool:Bo(e);break;case s.deleteMultiTool:qo(e);break;case s.resizeTool:_o(e);break;case s.copyFromDrawTool:Ko(e);break;case s.pasteInProofTool:Vr();break;case s.doubleCutInsertionTool:lr(e);break;case s.doubleCutDeletionTool:dr(e);break;case s.insertionTool:Nr(e);break;case s.erasureTool:Ur(e);break;case s.proofMoveSingleTool:mr(e);break;case s.proofMoveMultiTool:Er(e);break;case s.proofResizeTool:Xr(e);break;case s.iterationTool:Pr(e);break;case s.deiterationTool:Rr(e);break}}function ii(e){if(e.button===0){switch(r.toolState){case s.cutTool:xo(e);break;case s.atomTool:ho(e);break;case s.dragTool:Gn();break;case s.drawMoveSingleTool:Mo(e);break;case s.drawMoveMultiTool:Co(e);break;case s.copySingleTool:Do(e);break;case s.copyMultiTool:vo(e);break;case s.deleteSingleTool:Yo(e);break;case s.deleteMultiTool:Go(e);break;case s.resizeTool:Wo(e);break;case s.copyFromDrawTool:Qo();break;case s.pasteInProofTool:_r();break;case s.doubleCutInsertionTool:cr(e);break;case s.doubleCutDeletionTool:hr(e);break;case s.insertionTool:$r(e);break;case s.erasureTool:Br(e);break;case s.proofMoveSingleTool:Tr(e);break;case s.proofMoveMultiTool:br(e);break;case s.proofResizeTool:qr(e);break;case s.iterationTool:kr(e);break;case s.deiterationTool:Ar(e);break;case s.proofClearTool:nr();break;case s.drawClearTool:ro();break}Vt=!1}}function si(){switch(r.toolState){case s.cutTool:So();break;case s.atomTool:po();break;case s.dragTool:zn();break;case s.drawMoveSingleTool:Io();break;case s.drawMoveMultiTool:Lo();break;case s.copySingleTool:Oo();break;case s.copyMultiTool:Ho();break;case s.deleteSingleTool:Fo();break;case s.deleteMultiTool:zo();break;case s.resizeTool:jo();break;case s.copyFromDrawTool:er();break;case s.pasteInProofTool:Wr();break;case s.doubleCutInsertionTool:ar();break;case s.doubleCutDeletionTool:pr();break;case s.insertionTool:vr();break;case s.erasureTool:Yr();break;case s.proofMoveSingleTool:xr();break;case s.proofMoveMultiTool:Mr();break;case s.proofResizeTool:Gr();break;case s.iterationTool:Cr();break;case s.deiterationTool:Dr();break;case s.proofClearTool:or();break;case s.drawClearTool:io();break}_t=!1}function li(){ae.width=window.innerWidth,ae.height=window.innerHeight}window.onresize=li;
