/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const L of d.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&r(L)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}toString(){return"("+this.x+", "+this.y+")"}}function V(e,t){return Ge(e,t)||j(t,e)}function Ge(e,t){if(e instanceof $)return t instanceof $?Ae(e,t):Oe(t,e);if(t instanceof $)return Oe(e,t);if(Ae(e.boundingBox,t.boundingBox)||j(t.boundingBox,e.boundingBox)){const n=We(e);let r;for(let i=0;i<n.length;i++)if(r=le(t,n[i]),r<=0)return!0;return!1}return!1}function Oe(e,t){const n=t.getCorners(),r=re(e,n[0].x,1),i=re(e,n[1].x,1),d=re(e,n[0].x,-1),L=re(e,n[1].x,-1);if(n[0].y<r&&r<n[2].y||n[0].y<d&&d<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<L&&L<n[2].y)return!0;const E=-1/Math.pow(e.radiusX,2),P=2*e.center.x/Math.pow(e.radiusX,2),ne=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),Be=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),pe=(-P+Math.sqrt(Math.pow(P,2)-4*E*ne))/(2*E),xe=(-P-Math.sqrt(Math.pow(P,2)-4*E*ne))/(2*E),me=(-P+Math.sqrt(Math.pow(P,2)-4*E*Be))/(2*E),Me=(-P-Math.sqrt(Math.pow(P,2)-4*E*Be))/(2*E);return!isNaN(pe)&&n[0].x<pe&&pe<n[1].x||!isNaN(xe)&&n[0].x<xe&&xe<n[1].x||!isNaN(me)&&n[0].x<me&&me<n[1].x||!isNaN(Me)&&n[0].x<Me&&Me<n[1].x}function j(e,t){if(e instanceof $)if(t instanceof $){const n=t.getCorners();for(let r=0;r<4;r++)if(!Te(e,n[r]))return!1;return!0}else{const n=wt(t);for(let r=0;r<4;r++)if(!Te(e,n[r]))return!1;return!0}else if(t instanceof $){const n=t.getCorners();let r;for(let i=0;i<4;i++)if(r=le(e,n[i]),!(r<0))return!1;return!0}else{const n=We(t);let r;for(let i=0;i<n.length;i++)if(r=le(e,n[i]),!(r<0))return!1;return!0}}function Ae(e,t){const n=e.getCorners(),r=t.getCorners();return(n[0].y<=r[0].y&&n[2].y>=r[0].y||n[0].y<=r[2].y&&n[2].y>=r[2].y||r[0].y<=n[0].y&&r[2].y>=n[0].y||r[0].y<=n[2].y&&r[2].y>=n[2].y)&&(n[0].x<=r[0].x&&n[1].x>=r[0].x||n[0].x<=r[1].x&&n[1].x>=r[1].x||r[0].x<=n[0].x&&r[1].x>=n[0].x||r[0].x<=n[1].x&&r[1].x>=n[1].x)}function Te(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function le(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function wt(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function We(e){const t=[];let n,r,i=1;for(let d=0;d<360;d++)n=e.center.x+e.radiusX*Math.cos(d*(Math.PI/180)),d>180&&(i=-1),r=re(e,n,i),t[d]=new c(n,r);return t}function re(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class ${constructor(t,n,r){if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(r!==void 0&&r<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=r}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Te(this,t)}overlaps(t){return V(this,t)}contains(t){return j(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,r,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=r,this.internalHeight=i}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new $(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class u{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const r=this.internalChildren[n];if(r instanceof u&&r.containsNode(t))return r.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?j(this.internalEllipse,t.calcRect()):j(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0)return this;{const r=this.internalChildren[n];for(let i=0;i<r.children.length;i++)if(r.children[i].containsPoint(t))return r.getLowestParent(t);return this}}return null}getLevel(t,n){for(let r=0;r<this.internalChildren.length;r++){if(this.internalChildren[r]===t)return n;if(this.internalChildren[r]instanceof u&&this.internalChildren[r].containsNode(t))return this.internalChildren[r].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof u&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let r=0;r<this.children[n].children.length;r++)if(this.children[n].children[r].containsPoint(t))if(this.children[n].children[r]instanceof f)this.children[n].children.splice(r,1);else return this.children[n].children[r].remove(t);return this.children.splice(n,1),!0}return!1}clear(){this.internalChildren=[]}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof u&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class te{constructor(t){this.internalSheet=new u(null),t instanceof u&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let r=n+1;r<t.children.length;r++)if(this.overlaps(t.children[n],t.children[r]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof u&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let r=0;r<n.children.length;r++)if(this.intersects(t,n.children[r]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),r=[...n.children];if(n.child=t,t instanceof u)for(let i=r.length-1;i>=0;i--)t.containsNode(r[i])&&(t.child=r[i],n.children.splice(i,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const r=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return Ge(r,i)}overlaps(t,n){let r,i;return t instanceof f?n instanceof f?V(t.calcRect(),n.calcRect()):(r=n.ellipse,V(t.calcRect(),r)):n instanceof f?(r=t.ellipse,V(r,n.calcRect())):(r=t.ellipse,i=n.ellipse,V(r,i))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.toProofMode=11]="toProofMode",e[e.doubleCutInsertionTool=12]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=13]="doubleCutDeletionTool",e[e.erasureTool=14]="erasureTool",e))(s||{});class o{}o.tree=new te;o.selectForProof=new te;o.toolState=0;class U{constructor(t,n,r){if(this.center=t,this.radiusX=n,this.radiusY=r,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new $(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return le(this,t)<0}overlaps(t){return V(this,t)}contains(t){return j(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const yt=document.getElementById("theme-select");function W(e){return getComputedStyle(document.body).getPropertyValue(e)}let je=W("--good-placement"),qe=W("--bad-placement"),Je=W("--canvas-items");function Ke(){setTimeout(()=>{je=W("--good-placement"),qe=W("--bad-placement"),Je=W("--canvas-items"),a(o.tree)})}yt.addEventListener("input",()=>{Ke()});window.addEventListener("DOMContentLoaded",()=>{Ke()});function w(){return qe}function M(){return je}function Ze(){return Je}const Ee=document.getElementById("canvas"),Qe=Ee.getContext("2d");if(Qe===null)throw Error("2d rendering context not supported");const h=Qe;h.font="35pt arial";const gt=document.getElementById("graphString"),pt=document.getElementById("atomBox"),_e=document.getElementById("atomBoxes");_e.addEventListener("input",xt);function T(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const r=n.center;h.beginPath(),h.ellipse(r.x+l.x,r.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function b(e,t,n){h.textBaseline="bottom";const r=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(_e.checked||pt.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-r.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function et(e,t,n){h.beginPath(),h.strokeStyle=n;const r=e.x-t.x+l.x,i=e.y-t.y+l.y;h.rect(e.x,e.y,-r,-i),h.stroke()}function xt(){a(o.tree)}function tt(){h.clearRect(0,0,Ee.width,Ee.height)}function a(e){gt.innerHTML=e.toString(),tt(),nt(e.sheet)}function nt(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof f?mt(e.children[t]):nt(e.children[t]);e.ellipse instanceof U&&(h.strokeStyle=Ze(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function mt(e){b(e,Ze(),!1)}let Pe,l=new c(0,0),Se;function Mt(e){Pe=new c(e.x-l.x,e.y-l.y),Se=!1}function bt(e){Se||(l=new c(e.x-Pe.x,e.y-Pe.y),a(o.tree))}function Ct(){Se=!0,a(o.tree)}const Tt=document.getElementById("showRect"),Et=document.getElementById("mode");let ce,fe;function Pt(e){ce=new c(e.clientX-l.x,e.clientY-l.y),fe=!1}function kt(e){const t=new u(new U(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(a(o.tree),t.ellipse=de(ce,n),!fe){const i=o.tree.canInsert(t)&&F(t.ellipse)?M():w();T(t,i),Tt.checked&&et(ce,n,i)}}function St(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ce,t));o.tree.canInsert(n)&&!fe&&F(n.ellipse)&&o.tree.insert(n),a(o.tree)}function It(){fe=!0,a(o.tree)}function de(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),r=e.x-t.x,i=e.y-t.y,d=Math.abs(r),L=Math.abs(i);let E,P;if(Et.value==="circumscribed"){const ne=Math.floor(n.distance(t));P=Math.floor(ne*(L/d)),E=Math.floor(ne*(d/L))}else E=d/2,P=L/2;return new U(n,E,P)}function F(e){return e.radiusX>15&&e.radiusY>15}const Lt=document.getElementById("canvas"),rt=Lt.getContext("2d");if(rt===null)throw Error("2d rendering context not supported");const Dt=rt,ot=document.getElementById("atomDisplay");let v,he,H="A";ot.innerHTML=H;function vt(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(H=e.key,ot.innerHTML=H)}function Bt(e){v=Dt.measureText(H),he=!1;const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(o.tree);const n=o.tree.canInsert(t)?M():w();b(t,n,!0)}function Ot(e){const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);a(o.tree),he||(o.tree.canInsert(t)?b(t,M(),!0):b(t,w(),!0))}function At(e){const t=new f(H,new c(e.clientX-l.x,e.clientY-l.y),v.width,v.fontBoundingBoxDescent+v.actualBoundingBoxAscent);o.tree.canInsert(t)&&!he&&o.tree.insert(t),a(o.tree)}function Xt(){he=!0,a(o.tree)}async function $t(e,t){const n=JSON.stringify(t,null,"	"),r=await e.createWritable();await r.write(n),await r.close()}function ke(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,r=new te,i=[];return n.forEach(d=>{Object.prototype.hasOwnProperty.call(d,"internalEllipse")?i.push(it(d)):i.push(st(d))}),r.sheet.children=i,r}return null}function it(e){const t=new U(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(r=>{"internalEllipse"in r?n.push(it(r)):n.push(st(r))}),new u(t,n)}function st(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}function ie(e,t){if(e.ellipse!==null){const n=N(e,t);if(!o.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof u&&e.children[n].ellipse!==null&&!ie(e.children[n],t))return!1;if(e.children[n]instanceof f){let r=e.children[n];if(r=I(r,t),!o.tree.canInsert(r))return!1}}return!0}function Ie(e,t,n){if(e instanceof u&&e.ellipse!==null){const r=N(e,n);if(T(r,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Ie(e.children[i],t,n)}else if(e instanceof f){const r=I(e,n);b(r,t,!0)}}function Le(e,t){if(e instanceof u&&e.ellipse!==null){const n=N(e,t);if(o.tree.insert(n),e.children.length!==0)for(let r=0;r<e.children.length;r++)Le(e.children[r],t)}else if(e instanceof f){const n=I(e,t);o.tree.insert(n)}}function N(e,t){if(e.ellipse!==null)return new u(new U(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function I(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function we(e,t){if(e instanceof f)b(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)we(e.children[n],t)}}let O,y=null,R;function Yt(e){if(O=new c(e.x-l.x,e.y-l.y),y=o.tree.getLowestNode(O),y!==o.tree.sheet&&y!==null){const t=o.tree.getLowestParent(O);if(t!==null&&t.remove(O),y instanceof u&&y.children.length!==0){for(let n=0;n<y.children.length;n++)o.tree.insert(y.children[n]);y.children=[]}R=!0}else R=!1}function Ft(e){if(R){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof u){const n=N(y,t);a(o.tree);const r=o.tree.canInsert(n)?M():w();T(n,r)}else if(y instanceof f){const n=I(y,t);a(o.tree);const r=o.tree.canInsert(n)?M():w();b(n,r,!0)}}}function Nt(e){if(R){const t=new c(e.x-O.x,e.y-O.y);if(y instanceof u){const n=N(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}else if(y instanceof f){const n=I(y,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(y)}a(o.tree)}R=!1}function Ht(){R&&y!==null&&o.tree.insert(y),R=!1,a(o.tree)}let A,p=null,z;function Rt(e){if(A=new c(e.x-l.x,e.y-l.y),p=o.tree.getLowestNode(A),p!==o.tree.sheet&&p!==null){const t=o.tree.getLowestParent(A);t!==null&&t.remove(A),z=!0}else z=!1}function zt(e){if(z){const t=new c(e.x-A.x,e.y-A.y);if(a(o.tree),p instanceof u){const n=ie(p,t)?M():w();Ie(p,n,t)}else if(p instanceof f){const n=I(p,t),r=o.tree.canInsert(n)?M():w();b(n,r,!0)}}}function Ut(e){if(z){const t=new c(e.x-A.x,e.y-A.y);if(p instanceof u)ie(p,t)?Le(p,t):o.tree.insert(p);else if(p instanceof f){const n=I(p,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(p)}}a(o.tree),z=!1}function Vt(){z&&p!==null&&o.tree.insert(p),z=!1,a(o.tree)}let q,k=null,J;function Gt(e){q=new c(e.x-l.x,e.y-l.y);const t=o.tree.getLowestNode(q);t!==o.tree.sheet&&t!==null?(t instanceof u?(k=N(t,new c(0,0)),k.children=[]):t instanceof f&&(k=t),J=!0):J=!1}function Wt(e){if(J){const t=new c(e.x-q.x,e.y-q.y);if(k instanceof u){const n=N(k,t);a(o.tree);const r=o.tree.canInsert(n)?M():w();T(n,r)}else if(k instanceof f){const n=I(k,t);a(o.tree);const r=o.tree.canInsert(n)?M():w();b(n,r,!0)}}}function jt(e){if(J){const t=new c(e.x-q.x,e.y-q.y);if(k instanceof u&&k.ellipse!==null){const n=N(k,t);o.tree.canInsert(n)&&o.tree.insert(n)}else if(k instanceof f){const n=I(k,t);o.tree.canInsert(n)&&o.tree.insert(n)}a(o.tree)}J=!1}function qt(){J=!1,a(o.tree)}let K,C=null,Z;function Jt(e){K=new c(e.x-l.x,e.y-l.y),C=o.tree.getLowestNode(K),C!==o.tree.sheet&&C!==null?Z=!0:Z=!1}function Kt(e){if(Z){const t=new c(e.x-K.x,e.y-K.y);if(a(o.tree),C instanceof u){const n=ie(C,t)?M():w();Ie(C,n,t)}else if(C instanceof f){const n=I(C,t),r=o.tree.canInsert(n)?M():w();b(n,r,!0)}}}function Zt(e){if(Z){const t=new c(e.x-K.x,e.y-K.y);if(C instanceof u)ie(C,t)&&Le(C,t);else if(C instanceof f){const n=I(C,t);o.tree.canInsert(n)&&o.tree.insert(n)}}a(o.tree),Z=!1}function Qt(){Z=!1,a(o.tree)}let Xe,g=null,Q;function _t(e){Xe=new c(e.x-l.x,e.y-l.y),g=o.tree.getLowestNode(Xe),g!==null&&(Q=!0,g instanceof f?b(g,w(),!0):T(g,w()))}function en(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);g!==null&&g!==n&&(Q=!0,a(o.tree),n===null?(g=null,Q=!1):(g=n,g instanceof f?b(g,w(),!0):T(g,w())))}function tn(e){const t=new c(e.x-l.x,e.y-l.y);if(Q){const n=o.tree.getLowestParent(t);if(n!==null&&n.remove(t),g!==o.tree.sheet&&g instanceof u&&g.children.length!==0)for(let r=0;r<g.children.length;r++)o.tree.insert(g.children[r])}a(o.tree),g=null,Q=!1}function nn(){g=null,Q=!1}let $e,D=null,_;function rn(e){$e=new c(e.x-l.x,e.y-l.y),D=o.tree.getLowestNode($e),D!==null&&(_=!0,we(D,w()))}function on(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);D!==null&&D!==o.tree.getLowestNode(t)&&(_=!0,a(o.tree),n===null?(D=null,_=!1):(D=n,we(D,w())))}function sn(e){const t=new c(e.x-l.x,e.y-l.y);if(_){const n=o.tree.getLowestParent(t);n!==null?n.remove(t):o.tree.clear(),a(o.tree)}D=null,_=!1}function ln(){D=null,_=!1}let se,m=null,ye;function cn(e){if(o.selectForProof.sheet=new te().sheet,se=new c(e.x,e.y),m=o.tree.getLowestNode(se),m!==null){if(ye=!0,m!==o.tree.sheet){const t=o.tree.getLowestParent(se);t!==null&&t.remove(se),a(o.tree)}else tt();m instanceof f?b(m,M(),!0):lt(m,M()),m!==o.tree.sheet&&o.tree.insert(m)}}function an(){m=null,ye=!1,a(o.tree)}function un(){if(ye){if(m instanceof u&&m.ellipse===null)for(let e=0;e<m.children.length;e++)o.selectForProof.insert(m.children[e]);else o.selectForProof.insert(m);a(o.tree),alert("Graph selected, you may now toggle to proof mode")}}function fn(){m=null,ye=!1,a(o.tree)}function lt(e,t){if(e instanceof f)b(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)lt(e.children[n],t)}}const dn=document.getElementById("showRect");let ae,ge;function hn(e){ae=new c(e.clientX-l.x,e.clientY-l.y),ge=!1}function wn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ae,t)),r=new u(ct(n.ellipse));if(a(o.tree),!ge&&n.ellipse!==null&&r.ellipse!==null){const d=o.tree.canInsert(n)&&F(n.ellipse)&&o.tree.canInsert(r)&&F(r.ellipse)?M():w();T(n,d),T(r,d),dn.checked&&et(ae,t,d)}}function yn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(de(ae,t)),r=new u(ct(n.ellipse));!ge&&n.ellipse!==null&&r.ellipse!==null&&o.tree.canInsert(n)&&F(n.ellipse)&&o.tree.canInsert(r)&&F(r.ellipse)&&(o.tree.insert(n),o.tree.insert(r)),a(o.tree)}function gn(){ge=!0,a(o.tree)}function ct(e){return new U(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let Y=null,ue;function pn(e){const t=new c(e.x-l.x,e.y-l.y);Y=o.tree.getLowestNode(t),at()}function xn(e){const t=new c(e.x-l.x,e.y-l.y);Y=o.tree.getLowestNode(t),a(o.tree),at()}function mn(e){const t=new c(e.x-l.x,e.y-l.y);if(ue&&Y instanceof u){const n=o.tree.getLowestParent(t),r=Y.children[0];if(n!==null&&r instanceof u){n.remove(t);for(let i=0;i<r.children.length;i++)o.tree.insert(r.children[i])}}a(o.tree)}function Mn(){ue=!1,a(o.tree)}function bn(e){return e.children.length===1&&e.children[0]instanceof u&&Y!==o.tree.sheet}function Cn(e){T(e,w()),e.children[0]instanceof u&&T(e.children[0],w())}function at(){Y instanceof u&&bn(Y)?(ue=!0,Cn(Y)):ue=!1}let X=null,oe;function Tn(e){const t=new c(e.x-l.x,e.y-l.y);X=o.tree.getLowestNode(t),ut()}function En(e){const t=new c(e.x-l.x,e.y-l.y);X=o.tree.getLowestNode(t),a(o.tree),ut()}function Pn(e){if(oe){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestParent(t);n!==null&&n.remove(t),a(o.tree)}X=null,oe=!1}function kn(){X=null,oe=!1,a(o.tree)}function ut(){X!==o.tree.sheet&&X!==null&&o.tree.getLevel(X)%2===0?(oe=!0,we(X,w())):oe=!1}let be=!0,Ye=null,Fe=null,Ne=s.none,He=s.none;const Re=document.getElementById("DrawButtons"),ze=document.getElementById("ProofButtons");function Sn(){if(be=!be,be){Re.style.display="block",ze.style.display="none",Fe=JSON.stringify(o.tree),He=o.toolState;const e=ke(Ye);if(e!==null)o.tree.sheet=e.sheet;else throw Error("invalid cached AEG");o.toolState=Ne}else{Re.style.display="none",ze.style.display="block",Ye=JSON.stringify(o.tree),Ne=o.toolState;const e=ke(Fe);if(e!==null){o.tree.sheet=e.sheet;for(let t=0;t<o.selectForProof.sheet.children.length;t++){const n=o.selectForProof.sheet.children[t];try{o.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else o.tree.sheet=o.selectForProof.sheet;o.toolState=He,o.selectForProof.sheet=new te().sheet}a(o.tree)}let S,x=null,ee;const G=new c(1,1);function In(e){if(S=new c(e.x-l.x,e.y-l.y),x=o.tree.getLowestNode(S),x!==o.tree.sheet&&x instanceof u){ee=!0;const t=o.tree.getLowestParent(S);t!==null&&t.remove(S);for(let n=0;n<x.children.length;n++)o.tree.insert(x.children[n]);Bn(),x.children=[]}}function Ln(e){if(ee){const t=new c((e.x-l.x-S.x)/2,(e.y-l.y-S.y)/2);if(x instanceof u){const n=ft(x,t);if(n.ellipse!==null){a(o.tree);const i=o.tree.canInsert(n)&&F(n.ellipse)?M():w();T(n,i)}}}}function Dn(e){if(ee){const t=new c((e.x-l.x-S.x)/2,(e.y-l.y-S.y)/2);if(x instanceof u){const n=ft(x,t);n.ellipse!==null&&(o.tree.canInsert(n)&&F(n.ellipse)?o.tree.insert(n):o.tree.insert(x))}a(o.tree),ee=!1}}function vn(){ee&&x!==null&&o.tree.insert(x),ee=!1,a(o.tree)}function ft(e,t){if(e.ellipse!==null)return new u(new U(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),e.ellipse.radiusX+t.x*G.x,e.ellipse.radiusY+t.y*G.y));throw new Error("Cannot alter the position of a cut without an ellipse.")}function Bn(){if(x instanceof u&&x.ellipse!==null){const e=x.ellipse,t=[new c(e.center.x-e.radiusX,e.center.y),new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY)];t[0].distance(S)>=t[2].distance(S)?G.x=1:G.x=-1,t[1].distance(S)>=t[3].distance(S)?G.y=1:G.y=-1}}const B=document.getElementById("canvas");B.width=window.innerWidth;B.height=window.innerHeight;const dt=B.getContext("2d");if(dt===null)throw Error("2d rendering context not supported");const On=dt;On.font="35pt arial";const Ce=document.getElementById("cutTools"),Ue=document.getElementById("atomTools");window.addEventListener("keydown",Yn);B.addEventListener("mousedown",Fn);B.addEventListener("mousemove",Nn);B.addEventListener("mouseup",Hn);B.addEventListener("mouseout",Rn);B.addEventListener("mouseenter",zn);let De=!1,ve=!0;window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.saveMode=ht;window.loadMode=$n;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.erasureTool=s.erasureTool;window.setTool=Xn;window.setHighlight=An;window.toggleHandler=Sn;function An(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const Ve=document.querySelectorAll(".modeButton");Ve.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),Ve.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function Xn(e){switch(o.toolState=e,Ce.style.display="none",Ue.style.display="none",o.toolState){case s.atomTool:Ue.style.display="block";break;case s.cutTool:Ce.style.display="block";break;case s.doubleCutInsertionTool:Ce.style.display="block";break}}async function ht(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});$t(e,o.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(o.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function $n(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const r=n.result,i=ke(r);i instanceof te&&(o.tree=i,a(o.tree))}),n.readAsText(t)}function Yn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),ht();else switch(o.toolState){case s.atomTool:vt(e);break}}function Fn(e){switch(o.toolState){case s.cutTool:Pt(e);break;case s.atomTool:Bt(e);break;case s.dragTool:Mt(e);break;case s.moveSingleTool:Yt(e);break;case s.moveMultiTool:Rt(e);break;case s.copySingleTool:Gt(e);break;case s.copyMultiTool:Jt(e);break;case s.deleteSingleTool:_t(e);break;case s.deleteMultiTool:rn(e);break;case s.resizeTool:In(e);break;case s.toProofMode:cn(e);break;case s.doubleCutInsertionTool:hn(e);break;case s.doubleCutDeletionTool:pn(e);break;case s.erasureTool:Tn(e);break}De=!0}function Nn(e){if(De&&ve)switch(o.toolState){case s.cutTool:kt(e);break;case s.atomTool:Ot(e);break;case s.dragTool:bt(e);break;case s.moveSingleTool:Ft(e);break;case s.moveMultiTool:zt(e);break;case s.copySingleTool:Wt(e);break;case s.copyMultiTool:Kt(e);break;case s.deleteSingleTool:en(e);break;case s.deleteMultiTool:on(e);break;case s.resizeTool:Ln(e);break;case s.toProofMode:an();break;case s.doubleCutInsertionTool:wn(e);break;case s.doubleCutDeletionTool:xn(e);break;case s.erasureTool:En(e);break}}function Hn(e){switch(o.toolState){case s.cutTool:St(e);break;case s.atomTool:At(e);break;case s.moveSingleTool:Nt(e);break;case s.moveMultiTool:Ut(e);break;case s.copySingleTool:jt(e);break;case s.copyMultiTool:Zt(e);break;case s.deleteSingleTool:tn(e);break;case s.deleteMultiTool:sn(e);break;case s.resizeTool:Dn(e);break;case s.toProofMode:un();break;case s.doubleCutInsertionTool:yn(e);break;case s.doubleCutDeletionTool:mn(e);break;case s.erasureTool:Pn(e);break}De=!1}function Rn(){switch(o.toolState){case s.cutTool:It();break;case s.atomTool:Xt();break;case s.dragTool:Ct();break;case s.moveSingleTool:Ht();break;case s.moveMultiTool:Vt();break;case s.copySingleTool:qt();break;case s.copyMultiTool:Qt();break;case s.deleteSingleTool:nn();break;case s.deleteMultiTool:ln();break;case s.resizeTool:vn();break;case s.toProofMode:fn();break;case s.doubleCutInsertionTool:gn();break;case s.doubleCutDeletionTool:Mn();break;case s.erasureTool:kn();break}ve=!1}function zn(){ve=!0}function Un(){B.width=window.innerWidth,B.height=window.innerHeight}window.onresize=Un;
