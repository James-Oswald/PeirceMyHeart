/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function Le(e,t){return sn(e,t)||ve(t,e)}function sn(e,t){if(e instanceof ye)return t instanceof ye?Gt(e,t):Vt(t,e);if(t instanceof ye)return Vt(e,t);if(Gt(e.boundingBox,t.boundingBox)||ve(t.boundingBox,e.boundingBox)){const n=ln(e);let o;for(let i=0;i<n.length;i++)if(o=it(t,n[i]),o<=0)return!0;return!1}return!1}function Vt(e,t){const n=t.getCorners(),o=Ge(e,n[0].x,1),i=Ge(e,n[1].x,1),u=Ge(e,n[0].x,-1),g=Ge(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<u&&u<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<g&&g<n[2].y)return!0;const M=-1/Math.pow(e.radiusX,2),v=2*e.center.x/Math.pow(e.radiusX,2),Ie=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),qt=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),yt=(-v+Math.sqrt(Math.pow(v,2)-4*M*Ie))/(2*M),xt=(-v-Math.sqrt(Math.pow(v,2)-4*M*Ie))/(2*M),mt=(-v+Math.sqrt(Math.pow(v,2)-4*M*qt))/(2*M),Mt=(-v-Math.sqrt(Math.pow(v,2)-4*M*qt))/(2*M);return!isNaN(yt)&&n[0].x<yt&&yt<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x||!isNaN(mt)&&n[0].x<mt&&mt<n[1].x||!isNaN(Mt)&&n[0].x<Mt&&Mt<n[1].x}function ve(e,t){if(e instanceof ye)if(t instanceof ye){const n=t.getCorners();for(let o=0;o<4;o++)if(!kt(e,n[o]))return!1;return!0}else{const n=Bn(t);for(let o=0;o<4;o++)if(!kt(e,n[o]))return!1;return!0}else if(t instanceof ye){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=it(e,n[i]),!(o<0))return!1;return!0}else{const n=ln(t);let o;for(let i=0;i<n.length;i++)if(o=it(e,n[i]),!(o<0))return!1;return!0}}function Gt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function kt(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function it(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function Bn(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function ln(e){const t=[];let n,o,i=1;for(let u=0;u<360;u++)n=e.center.x+e.radiusX*Math.cos(u*(Math.PI/180)),u>180&&(i=-1),o=Ge(e,n,i),t[u]=new c(n,o);return t}function Ge(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class ye{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return kt(this,t)}overlaps(t){return Le(this,t)}contains(t){return ve(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new f(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new ye(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class ie{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new ye(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return it(this,t)<0}overlaps(t){return Le(this,t)}contains(t){return ve(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new ie(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof f,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?ve(this.internalEllipse,t.calcRect()):ve(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let u=0;u<o.length;u++){if(n[i]instanceof f&&o[u]instanceof f&&n[i].isEqualTo(o[u])||n[i]instanceof a&&o[u]instanceof a&&n[i].isEqualTo(o[u])){n.splice(i,1),o.splice(u,1),i--;break}if(u===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class ${constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return sn(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?Le(t.calcRect(),n.calcRect()):(o=n.ellipse,Le(t.calcRect(),o)):n instanceof f?(o=t.ellipse,Le(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,Le(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class Y{constructor(t,n){this.appliedRule=n??"",this.tree=new $(t==null?void 0:t.sheet),this.index=r.proof.length}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.clearProofTool=22]="clearProofTool",e))(s||{});const Ve=class rt{static getLastProofStep(){return rt.proof.length===0?new Y(new $):rt.proof[rt.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;It(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),xn(t)}static clearProof(){It(-1),this.proof=[],this.pushToProof(new Y),this.currentProofStep=this.proof[0]}};Ve.tree=new $;Ve.proof=[];Ve.selectForProof=new $;Ve.toolState=0;Ve.modeState="Draw";let r=Ve,Et,l=new c(0,0),vt;function Nn(){d("cursor: grab")}function On(e){d("cursor: grabbing"),Et=new c(e.x-l.x,e.y-l.y),vt=!1}function Rn(e){vt||(d("cursor: grabbing"),l=new c(e.x-Et.x,e.y-Et.y),cn())}function An(){d("cursor: grab")}function Fn(){d("cursor: default"),vt=!0,cn()}function cn(){r.modeState==="Proof"?w():h(r.tree)}const Xn=document.getElementById("theme-select");function De(e){return getComputedStyle(document.body).getPropertyValue(e)}let an=De("--good-placement"),un=De("--bad-placement"),fn=De("--canvas-items");function dn(){setTimeout(()=>{an=De("--good-placement"),un=De("--bad-placement"),fn=De("--canvas-items"),r.modeState==="Draw"?h(r.tree):w()})}Xn.addEventListener("input",()=>{dn()});window.addEventListener("DOMContentLoaded",()=>{dn()});function p(){return un}function y(){return an}function hn(){return fn}const st=document.getElementById("canvas"),pn=st.getContext("2d");if(pn===null)throw Error("2d rendering context not supported.");const T=pn;T.font="35pt arial";const Hn=document.getElementById("graphString"),zn=document.getElementById("proofString"),Yn=document.getElementById("atomBox"),wn=document.getElementById("atomBoxes");wn.addEventListener("input",qn);function R(e,t){const n=e.ellipse;if(n!==null){T.strokeStyle=t;const o=n.center;T.beginPath(),T.ellipse(o.x+l.x,o.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),T.stroke()}}function A(e,t,n){T.textBaseline="bottom";const o=T.measureText(e.identifier);T.fillStyle=t,T.strokeStyle=t,T.beginPath(),T.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(wn.checked||Yn.checked&&n)&&T.rect(e.origin.x+l.x,e.origin.y+l.y-o.actualBoundingBoxAscent,e.width,e.height),T.stroke()}function gn(e,t,n){T.beginPath(),T.strokeStyle=n;const o=e.x-t.x+l.x,i=e.y-t.y+l.y;T.rect(e.x,e.y,-o,-i),T.stroke()}function d(e){st.style.cssText=e}function Un(e,t,n){return e===y()?t:n}function k(e,t,n){d(Un(e,t,n))}function qn(){h(r.tree)}function ut(){T.clearRect(0,0,st.width,st.height)}function h(e,t){Hn.innerHTML=e.toString(),ut(),Bt(e.sheet,t),window.treeString=gt(e)}function Bt(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof f?Vn(e.children[n]):Bt(e.children[n]);e.ellipse instanceof ie&&(T.strokeStyle=t||hn(),T.beginPath(),T.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),T.stroke())}function Vn(e){A(e,hn(),!1)}function w(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new $:e=r.currentProofStep.tree,ut(),zn.innerHTML=e.toString(),Bt(e.sheet)}function oe(e,t){if(e instanceof f)A(e,t,!1);else if(e instanceof a){R(e,t);for(let n=0;n<e.children.length;n++)oe(e.children[n],t)}}function yn(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function xn(e,t){var g;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Gn(e)};const u=document.createElement("Text");u.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(u),n.appendChild(i),(g=document.getElementById("proofHistoryBar"))==null||g.appendChild(n)}function Gn(e){r.currentProofStep=e,w()}function It(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}async function Wn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Lt(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Wt(o)}else{const o=[];let i;for(i of n){const u=i.tree.internalSheet.internalChildren;o.push(new Y(Wt(u),i.appliedRule))}return o}}function Wt(e){const t=new $,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(mn(o)):n.push(Mn(o));return t.sheet.children=n,t}function mn(e){const t=new ie(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(mn(o)):n.push(Mn(o));return new a(t,n)}function Mn(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}let bt=!0,Tt=null,Pt=null,jt=s.none,Jt=s.none;const Kt=document.getElementById("DrawButtons"),Zt=document.getElementById("ProofButtons"),Qt=document.getElementById("proofHistoryBar");function jn(){if(bt=!bt,bt){Kt.style.display="block",tn.style.display="block",Zt.style.display="none",nn.style.display="none",Qt.style.display="none",r.modeState="Draw",Pt=JSON.stringify(r.proof),Jt=r.toolState;let e=null;if(Tt!==null&&(e=Lt(r.modeState,Tt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=jt,h(r.tree)}else{Kt.style.display="none",tn.style.display="none",Zt.style.display="block",nn.style.display="block",Qt.style.display="block",r.modeState="Proof",Tt=JSON.stringify(r.tree),jt=r.toolState,r.proof.length===0&&r.pushToProof(new Y);let e=null;Pt!==null&&(e=Lt(r.modeState,Pt)),e!==null&&(r.proof=e),r.toolState=Jt,w()}}const Jn=document.getElementById("mode");function xe(e,t,n){if(t.ellipse!==null){const o=J(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!xe(e,t.children[o],n))return!1;if(t.children[o]instanceof f){let i=t.children[o];if(i=C(i,n),!e.canInsert(i))return!1}}return!0}function z(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=J(e,n);if(R(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)z(e.children[i],t,n)}else if(e instanceof f){const o=C(e,n);A(o,t,!0)}}function _e(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=J(e,t);if(o.insert(i),e.children.length!==0)for(let u=0;u<e.children.length;u++)_e(e.children[u],t,n)}else if(e instanceof f){const i=C(e,t);o.insert(i)}}function Ke(e,t){return e instanceof f?C(e,t):J(e,t)}function J(e,t){if(e.ellipse!==null)return new a(new ie(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Nt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(Nt(e.children[o],t)):e.children[o]instanceof f&&n.push(C(e.children[o],t));return new a(new ie(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function C(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function ft(e,t,n){if(e.ellipse!==null)return new a(new ie(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),e.ellipse.radiusX+t.x*n.x,e.ellipse.radiusY+t.y*n.y));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function et(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function Ee(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&et(e,t),h(e))}function dt(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,u=Math.abs(o),g=Math.abs(i);let M,v;if(Jn.value==="circumscribed"){const Ie=Math.floor(n.distance(t));v=Math.floor(Ie*(g/u)),M=Math.floor(Ie*(u/g))}else M=u/2,v=g/2;return new ie(n,M,v)}function fe(e){return e.radiusX>15&&e.radiusY>15}const Kn=document.getElementById("showRect");let lt,ht;function Zn(){d("cursor: crosshair")}function Qn(e){lt=new c(e.clientX-l.x,e.clientY-l.y),ht=!1}function _n(e){const t=new a(new ie(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(h(r.tree),t.ellipse=dt(lt,n),!ht){const i=r.tree.canInsert(t)&&fe(t.ellipse)?y():p();k(i,"cursor: crosshair","cursor: no-drop"),R(t,i),Kn.checked&&gn(lt,n,i)}}function eo(e){d("cursor: default");const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(dt(lt,t));r.tree.canInsert(n)&&!ht&&fe(n.ellipse)&&r.tree.insert(n),h(r.tree)}function to(){d("cursor: default"),ht=!0,h(r.tree)}const no=document.getElementById("canvas"),bn=no.getContext("2d");if(bn===null)throw Error("2d rendering context not supported.");const oo=bn,ro=document.getElementById("atomDisplay");let pt,Ot,N=tt("A",new c(0,0));function io(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=tt(e.key,new c(N.origin.x,N.origin.y)),N.origin.x!==0&&N.origin.y!==0&&Ot&&Rt())}function so(e){pt=!1,Ot=!0,N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Rt()}function lo(e){N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Rt()}function co(e){d("cursor: default"),N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),r.tree.canInsert(N)&&!pt&&r.tree.insert(N),h(r.tree),Ot=!1}function ao(){d("cursor: default"),pt=!0,h(r.tree)}function tt(e,t){ro.innerHTML=e;const n=oo.measureText(e);return new f(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Rt(){h(r.tree),pt||(r.tree.canInsert(N)?(d("cursor: default"),A(N,y(),!0)):(d("cursor: no-drop"),A(N,p(),!0)))}let de,b=null,Pe;function uo(e){if(de=new c(e.x-l.x,e.y-l.y),b=r.tree.getLowestNode(de),b!==r.tree.sheet&&b!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(de);if(t!==null&&t.remove(de),b instanceof a&&b.children.length!==0){for(let n=0;n<b.children.length;n++)r.tree.insert(b.children[n]);b.children=[]}Pe=!0,h(r.tree),b instanceof f?A(b,y(),!0):R(b,y())}else Pe=!1}function fo(e){if(Pe){const t=new c(e.x-de.x,e.y-de.y);if(b instanceof a){const n=J(b,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();R(n,o),k(o,"cursor: grabbing","cursor: no-drop")}else if(b instanceof f){const n=C(b,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function ho(e){if(d("cursor: default"),Pe){const t=new c(e.x-de.x,e.y-de.y);if(b instanceof a){const n=J(b,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(b)}else if(b instanceof f){const n=C(b,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(b)}h(r.tree)}Pe=!1}function po(){d("cursor: default"),Pe&&b!==null&&r.tree.insert(b),Pe=!1,h(r.tree)}let he,I=null,Se;function wo(e){if(he=new c(e.x-l.x,e.y-l.y),I=r.tree.getLowestNode(he),I!==r.tree.sheet&&I!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(he);t!==null&&t.remove(he),Se=!0,h(r.tree),oe(I,y())}else Se=!1}function go(e){if(Se){const t=new c(e.x-he.x,e.y-he.y);if(h(r.tree),I instanceof a){const n=xe(r.tree,I,t)?y():p();z(I,n,t),k(n,"cursor: grabbing","cursor: no-drop")}else if(I instanceof f){const n=C(I,t),o=r.tree.canInsert(n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function yo(e){if(d("cursor: default"),Se){const t=new c(e.x-he.x,e.y-he.y);if(I instanceof a)xe(r.tree,I,t)?_e(I,t):r.tree.insert(I);else if(I instanceof f){const n=C(I,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(I)}}h(r.tree),Se=!1}function xo(){d("cursor: default"),Se&&I!==null&&r.tree.insert(I),Se=!1,h(r.tree)}let pe,W=null,Be;function mo(e){pe=new c(e.x-l.x,e.y-l.y);const t=r.tree.getLowestNode(pe),n=new c(e.x-pe.x,e.y-pe.y);t!==r.tree.sheet&&t!==null?(d("cursor: copy"),t instanceof a?(W=J(t,n),W.children=[]):t instanceof f&&(W=t),Be=!0):Be=!1}function Mo(e){if(Be){const t=new c(e.x-pe.x,e.y-pe.y);if(W instanceof a){const n=J(W,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();R(n,o),k(o,"cursor: grabbing","cursor: no-drop")}else if(W instanceof f){const n=C(W,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function bo(e){if(d("cursor: default"),Be){const t=new c(e.x-pe.x,e.y-pe.y);if(W instanceof a&&W.ellipse!==null){const n=J(W,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(W instanceof f){const n=C(W,t);r.tree.canInsert(n)&&r.tree.insert(n)}h(r.tree)}Be=!1}function To(){d("cursor: default"),Be=!1,h(r.tree)}let Ne,q=null,Oe;function Po(e){Ne=new c(e.x-l.x,e.y-l.y),q=r.tree.getLowestNode(Ne),q!==r.tree.sheet&&q!==null?(d("cursor: copy"),Oe=!0):Oe=!1}function So(e){if(Oe){const t=new c(e.x-Ne.x,e.y-Ne.y);if(h(r.tree),q instanceof a){const n=xe(r.tree,q,t)?y():p();z(q,n,t),k(n,"cursor: grabbing","cursor: no-drop")}else if(q instanceof f){const n=C(q,t),o=r.tree.canInsert(n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function Co(e){if(d("cursor: default"),Oe){const t=new c(e.x-Ne.x,e.y-Ne.y);if(q instanceof a)xe(r.tree,q,t)&&_e(q,t);else if(q instanceof f){const n=C(q,t);r.tree.canInsert(n)&&r.tree.insert(n)}}h(r.tree),Oe=!1}function ko(){d("cursor: default"),Oe=!1,h(r.tree)}let nt,m=null,ee;function Eo(e){if(nt=new c(e.x-l.x,e.y-l.y),m=r.tree.getLowestNode(nt),m!==null){const t=r.tree.getLowestParent(nt);t!==null&&t.remove(nt),m instanceof a&&m.children.length!==0&&m!==r.tree.sheet&&et(r.tree,m),h(r.tree),m instanceof f?A(m,p(),!0):R(m,p()),ee=!0}else ee=!1}function Io(e){ee&&m!==null&&m.ellipse!==null&&Ee(r.tree,m);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);ee&&m!==null&&o!==null&&(ee=!0,h(r.tree),n===null?(m=null,ee=!1):(o.remove(t),m=n,m instanceof a&&m.children.length!==0&&(et(r.tree,m),m.children=[]),h(r.tree),m instanceof f?A(m,p(),!0):R(m,p())))}function Lo(e){const t=new c(e.x-l.x,e.y-l.y);if(ee){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&et(r.tree,n),h(r.tree)}m=null,ee=!1}function Do(){ee&&m!==null&&Ee(r.tree,m),m=null,ee=!1,h(r.tree)}let ot,B=null,Z;function $o(e){if(ot=new c(e.x-l.x,e.y-l.y),B=r.tree.getLowestNode(ot),B!==null){const t=r.tree.getLowestParent(ot);t!==null?t.remove(ot):(B=r.tree.sheet.copy(),r.tree.clear()),Z=!0,h(r.tree),oe(B,p())}}function vo(e){Z&&B!==null&&Ee(r.tree,B);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);Z&&B!==null&&o!==null?(Z=!0,n===null?(B=null,Z=!1):(o.remove(t),B=n,Z=!0,h(r.tree),oe(B,p()))):Z&&o===null&&(B=r.tree.sheet.copy(),r.tree.clear(),h(r.tree),oe(B,p()))}function Bo(e){const t=new c(e.x-l.x,e.y-l.y);if(Z){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),h(r.tree)}B=null,Z=!1}function No(){Z&&B!==null&&Ee(r.tree,B),B=null,Z=!1,h(r.tree)}let Re,D=null,Ae,We;const Oo=document.getElementById("selectionString");function Ro(e){We=new $(r.tree.sheet),r.selectForProof.sheet=new $().sheet,Re=new c(e.x-l.x,e.y-l.y),D=r.tree.getLowestNode(Re),Tn()}function Ao(e){Ae&&(h(r.tree),Re=new c(e.x-l.x,e.y-l.y),D=r.tree.getLowestNode(Re),Tn())}function Fo(){if(d("cursor: default"),Ae&&D!==null){if(D instanceof a&&D.ellipse===null)for(let e=0;e<D.children.length;e++)r.selectForProof.insert(D.children[e]);else r.selectForProof.insert(D);h(r.tree)}D=null,Ae=!1}function Xo(){d("cursor: default"),D=null,Ae=!1,h(r.tree)}function Tn(){const e=new $;let t=!1;if(D!==null){if(Ae=!0,D instanceof f||!D.isEqualTo(We.sheet)){e.insert(D);const n=We.getLowestParent(Re);n!==null&&(n.remove(Re),t=!0),h(We)}else e.sheet=D,ut();oe(D,y()),d("cursor: copy"),t&&We.insert(D)}else Ae=!1;Oo.innerHTML=e.toString()}function K(){const e=new $;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function Fe(e,t){return e.canInsert(t)&&Pn(new $(e.sheet),t)}function Pn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new $(r.currentProofStep.tree.sheet))):!1}const Ho=document.getElementById("showRect");let ct,wt,me;function zo(){d("cursor: crosshair")}function Yo(e){ct=new c(e.clientX-l.x,e.clientY-l.y),me=K(),wt=!1}function Uo(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(dt(ct,t)),o=new a(Sn(n.ellipse));if(w(),!wt&&n.ellipse!==null&&o.ellipse!==null){const u=me.canInsert(n)&&fe(n.ellipse)&&me.canInsert(o)&&fe(o.ellipse)?y():p();R(n,u),R(o,u),k(u,"cursor: crosshair","cursor: no-drop"),Ho.checked&&gn(ct,t,u)}}function qo(e){d("cursor: crosshair");const t=new c(e.clientX-l.x,e.clientY-l.y);me=K();const n=new a(dt(ct,t)),o=new a(Sn(n.ellipse)),i=new Y(me,"DC Insert");!wt&&n.ellipse!==null&&o.ellipse!==null&&me.canInsert(n)&&fe(n.ellipse)&&me.canInsert(o)&&fe(o.ellipse)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),w()}function Vo(){d("cursor: default"),wt=!0,w()}function Sn(e){return new ie(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let ce,V=null,Ze,Me,$e;function Go(e){ce=new c(e.x-l.x,e.y-l.y),Me=K(),$e=new $(Me.sheet),V=Me.getLowestNode(ce),Cn()}function Wo(e){ce=new c(e.x-l.x,e.y-l.y),$e=new $(Me.sheet),V!==null&&(V=Me.getLowestNode(ce),w(),Cn())}function jo(e){const t=new Y(Me,"DC Delete");if(ce=new c(e.x-l.x,e.y-l.y),Ze&&V instanceof a){const n=t.tree.getLowestParent(ce),o=V.children[0];if(n!==null&&o instanceof a){n.remove(ce);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}w()}function Jo(){Ze&&V!==null&&Ee($e,V),V=null,Ze=!1,w()}function Ko(e){return e.children.length===1&&e.children[0]instanceof a&&V!==Me.sheet}function Zo(e){R(e,p()),e.children[0]instanceof a&&R(e.children[0],p())}function Cn(){if(V instanceof a&&Ko(V)){Ze=!0;const e=$e.getLowestParent(ce);if(e!==null){e.remove(ce);const t=V.children[0].copy();et($e,t),t.children=[]}h($e),Zo(V)}else Ze=!1}let x,E,H,L,Xe;function Qo(e){H=K();const t=r.selectForProof.sheet.children,n=new c(e.x-l.x,e.y-l.y);if(r.proof.length>0&&t.length===1){Xe=!0,x=t[0];const o=At(e,x),i=H.getLowestNode(n),u=H.getLowestParent(n);if(E=i instanceof f?u:i,o){const g=Ke(x,o);if(E!==null&&!E.containsNode(g))d("cursor: no-drop"),L=!1,z(x,p(),o);else if(E!==null&&E instanceof a&&E.ellipse!==null&&H.getLevel(E)%2===0){if(g instanceof a){L=!0;for(let M=0;M<E.children.length;M++)if(g.containsNode(E.children[M])){L=!1;break}}else L=!0;if(L){let M="";if(x instanceof a)M=xe(H,x,o)?y():p();else if(x instanceof f){const v=Ke(x,o);M=H.canInsert(v)?y():p()}L=M===y(),z(x,M,o),k(M,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),z(x,p(),o)}else d("cursor: no-drop"),L=!1,z(x,p(),o)}}else L=!1,Xe=!1,z(x,p(),n)}function _o(e){if(Xe){const t=new c(e.x-l.x,e.y-l.y);w();const n=At(e,x),o=H.getLowestNode(t),i=H.getLowestParent(t);if(E=o instanceof f?i:o,n){const u=Ke(x,n);if(E!==null&&!E.containsNode(u))d("cursor: no-drop"),L=!1,z(x,p(),n);else if(E!==null&&E instanceof a&&E.ellipse!==null&&H.getLevel(E)%2===0){if(u instanceof a){L=!0;for(let g=0;g<E.children.length;g++)if(u.containsNode(E.children[g])){L=!1;break}}else L=!0;if(L){let g="";if(x instanceof a)g=xe(H,x,n)?y():p();else if(x instanceof f){const M=Ke(x,n);g=H.canInsert(M)?y():p()}L=g===y(),z(x,g,n),k(g,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),z(x,p(),n)}else d("cursor: no-drop"),L=!1,z(x,p(),n)}}else L=!1}function er(e){if(d("cursor: default"),Xe&&L){const t=At(e,x);if(t){if(x instanceof a)_e(x,t,H);else if(x instanceof f){const n=Ke(x,t);H.insert(n)}r.pushToProof(new Y(H,"Insertion"))}}w(),Xe=!1}function tr(){d("cursor: default"),Xe=!1,w()}function At(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof f)return new c(e.x-t.origin.x,e.y-t.origin.y)}let ae,j=null,He,be,je;function nr(e){ae=new c(e.x-l.x,e.y-l.y),be=K(),je=new $(be.sheet),j=be.getLowestNode(ae),kn()}function or(e){ae=new c(e.x-l.x,e.y-l.y),j!==null&&(j=be.getLowestNode(ae),w(),kn())}function rr(e){if(He){const t=new Y(be,"Erasure");ae=new c(e.x-l.x,e.y-l.y);const n=t.tree.getLowestParent(ae);n!==null&&n.remove(ae),r.pushToProof(t),w()}j=null,He=!1}function ir(){He&&j!==null&&Ee(je,j),j=null,He=!1,w()}function kn(){if(j!==be.sheet&&j!==null&&be.getLevel(j)%2===0){He=!0;const e=je.getLowestParent(ae);e!==null&&e.remove(ae),h(je),oe(j,p()),je.insert(j)}else He=!1}let se,X=null,ze,Ft=new c(1,1);function sr(e){if(se=new c(e.x-l.x,e.y-l.y),X=r.tree.getLowestNode(se),X instanceof a&&X.ellipse!==null){ze=!0;const t=r.tree.getLowestParent(se);t!==null&&t.remove(se);for(let n=0;n<X.children.length;n++)r.tree.insert(X.children[n]);Ft=yn(X,se),X.children=[]}}function lr(e){if(ze){const t=new c((e.x-l.x-se.x)/2,(e.y-l.y-se.y)/2);if(X instanceof a){const n=ft(X,t,Ft);if(n.ellipse!==null){h(r.tree);const i=r.tree.canInsert(n)&&fe(n.ellipse)?y():p();k(i,"cursor: crosshair","cursor: no-drop"),R(n,i)}}}}function cr(e){if(d("cursor: default"),ze){const t=new c((e.x-l.x-se.x)/2,(e.y-l.y-se.y)/2);if(X instanceof a){const n=ft(X,t,Ft);n.ellipse!==null&&(r.tree.canInsert(n)&&fe(n.ellipse)?r.tree.insert(n):r.tree.insert(X))}h(r.tree),ze=!1}}function ar(){d("cursor: default"),ze&&X!==null&&r.tree.insert(X),ze=!1,h(r.tree)}let we,P=null,Ce,G;function ur(e){if(G=K(),we=new c(e.x-l.x,e.y-l.y),P=G.getLowestNode(we),P!==G.sheet&&P!==null){d("cursor: grabbing");const t=G.getLowestParent(we);if(t!==null&&t.remove(we),P instanceof a&&P.children.length!==0){for(let n=0;n<P.children.length;n++)G.insert(P.children[n]);P.children=[]}Ce=!0,h(G),P instanceof f?A(P,y(),!0):R(P,y())}else Ce=!1}function fr(e){if(Ce){const t=new c(e.x-we.x,e.y-we.y);if(h(G),P instanceof a){const n=J(P,t),o=Fe(G,n)?y():p();R(n,o),k(o,"cursor: grabbing","cursor: no-drop")}else if(P instanceof f){const n=C(P,t),o=Fe(G,n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function dr(e){if(Ce){d("cursor: default");const t=new Y(G,"Single Move"),n=new c(e.x-we.x,e.y-we.y);let o=null;P instanceof a?o=J(P,n):P instanceof f&&(o=C(P,n)),o!==null&&Fe(G,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),Ce=!1}function hr(){d("cursor: default"),Ce&&P!==null&&G.insert(P),Ce=!1,w()}let ge,F=null,St=null,ke,Q;function pr(e){Q=K(),ge=new c(e.x-l.x,e.y-l.y),F=Q.getLowestNode(ge),F!==Q.sheet&&F!==null?(d("cursor: grabbing"),St=Q.getLowestParent(ge),St!==null&&St.remove(ge),ke=!0,h(Q),oe(F,y())):ke=!1}function wr(e){if(ke){const t=new c(e.x-ge.x,e.y-ge.y);if(h(Q),F instanceof a){const n=Nt(F,t),o=Fe(Q,n)?y():p();z(F,o,t),k(o,"cursor: grabbing","cursor: no-drop")}else if(F instanceof f){const n=C(F,t),o=Fe(Q,n)?y():p();A(n,o,!0),k(o,"cursor: grabbing","cursor: no-drop")}}}function gr(e){if(ke){d("cursor: default");const t=new Y(Q,"Multi Move"),n=new c(e.x-ge.x,e.y-ge.y);let o=null;F instanceof a?o=Nt(F,n):F instanceof f&&(o=C(F,n)),o!==null&&Fe(Q,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),ke=!1}function yr(){d("cursor: default"),ke&&F!==null&&Q.insert(F),ke=!1,w()}let Dt,at,Qe;function xr(){at=K(),Dt=r.selectForProof.sheet,Dt.children.length>0&&r.proof.length===1&&at.sheet.isEmptySheet()&&(Qe=!0,d("cursor: copy"))}function mr(){d("cursor: default"),Qe=!1,w()}function Mr(){Qe&&(d("cursor: default"),at.sheet=Dt,r.pushToProof(new Y(at,"Pasted"))),Qe=!1,w()}function br(){d("cursor: default"),Qe=!1,w()}let Te,O=null,$t=null,Ye,te;function Tr(e){te=K(),Te=new c(e.x-l.x,e.y-l.y),O=te.getLowestNode(Te),$t=te.getLowestParent(Te),Ye=O!==te.sheet&&O!==null,Ye&&d("cursor: copy")}function Pr(e){if(Ye){const t=new c(e.x-Te.x,e.y-Te.y);w();const n=new c(e.x-l.x,e.y-l.y),o=En(t,n)?y():p();if(O instanceof a)z(O,o,t);else if(O instanceof f){const i=C(O,t);A(i,o,!0)}k(o,"cursor: grabbing","cursor: no-drop")}}function Sr(e){if(Ye){d("cursor: default");const t=new c(e.x-Te.x,e.y-Te.y);if(En(t,new c(e.x-l.x,e.y-l.y))){if(O instanceof a)_e(O,t,te);else if(O instanceof f){const n=C(O,t);te.insert(n)}r.pushToProof(new Y(te,"Iteration"))}}w(),Ye=!1}function Cr(){d("cursor: default"),Ye=!1,w()}function En(e,t){return $t!==null&&$t.containsPoint(t)&&(O instanceof a&&xe(te,O,e)&&In(te.sheet,J(O,e).ellipse)||O instanceof f&&te.canInsert(C(O,e)))}function In(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof ie&&(t.contains(e.children[n].ellipse)||!In(e.children[n],t)))return!1}else if(e.children[n]instanceof f&&t.contains(e.children[n].calcRect()))return!1;return!0}let le,U=null,Ue,Xt=new c(1,1),ne;function kr(e){if(ne=K(),le=new c(e.x-l.x,e.y-l.y),U=ne.getLowestNode(le),U instanceof a&&U.ellipse!==null){Ue=!0;const t=ne.getLowestParent(le);t!==null&&t.remove(le);for(let n=0;n<U.children.length;n++)ne.insert(U.children[n]);Xt=yn(U,le),U.children=[]}}function Er(e){if(Ue){const t=new c((e.x-l.x-le.x)/2,(e.y-l.y-le.y)/2);if(U instanceof a){const n=ft(U,t,Xt);if(n.ellipse!==null){h(ne);const o=Ln(n)?y():p();R(n,o),k(o,"cursor: crosshair","cursor: no-drop")}}}}function Ir(e){if(Ue){d("cursor: default");const t=new c((e.x-l.x-le.x)/2,(e.y-l.y-le.y)/2);if(U instanceof a){const n=ft(U,t,Xt);n.ellipse!==null&&Ln(n)&&(ne.insert(n),r.pushToProof(new Y(ne,"Resize")))}w(),Ue=!1}}function Lr(){d("cursor: default"),Ue&&U!==null&&ne.insert(U),Ue=!1,w()}function Ln(e){return ne.canInsert(e)&&fe(e.ellipse)&&Pn(new $(ne.sheet),e)}let ue,S=null,qe,_,Je;function Dr(e){ue=new c(e.x-l.x,e.y-l.y),_=K(),Je=new $(_.sheet),S=_.getLowestNode(ue),Dn()}function $r(e){ue=new c(e.x-l.x,e.y-l.y),S!==null&&(S=_.getLowestNode(ue),w(),Dn())}function vr(e){if(qe&&(ue=new c(e.x-l.x,e.y-l.y),S!==null&&Ht(_.sheet,_.getLevel(S)))){const t=_.getLowestParent(ue);t instanceof a&&t.remove(ue),r.pushToProof(new Y(_,"Deiteration"))}qe=!1,w()}function Br(){qe&&S!==null&&Ee(Je,S),qe=!1,S=null,w()}function Dn(){if(S!==null&&!(S instanceof a&&S.ellipse===null)&&Ht(_.sheet,_.getLevel(S))){qe=!0;const e=Je.getLowestParent(ue);e!==null&&e.remove(ue),h(Je),oe(S,p()),Je.insert(S)}else qe=!1}function Ht(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&S instanceof a&&S.isEqualTo(e.children[o])&&S.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof f&&S instanceof f&&e.children[o].identifier===S.identifier&&e.children[o].toString()!==S.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(S)&&_.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Ht(n,t):!1}let _t,zt;function Nr(){_t=K(),zt=!0,ut(),oe(_t.sheet,p())}function Or(){zt&&(It(-1),r.clearProof(),w())}function Rr(){zt=!1,w()}const re=document.getElementById("canvas");re.width=window.innerWidth;re.height=window.innerHeight;const $n=re.getContext("2d");if($n===null)throw Error("2d rendering context not supported");const Ar=$n;Ar.font="35pt arial";const Ct=document.getElementById("cutTools"),en=document.getElementById("atomTools"),tn=document.getElementById("graphString"),nn=document.getElementById("proofString"),on=document.getElementById("toProofTools");window.addEventListener("keydown",zr);re.addEventListener("mousedown",Ur);re.addEventListener("mousemove",qr);re.addEventListener("mouseup",Vr);re.addEventListener("mouseout",Gr);re.addEventListener("mouseenter",Yr);let Yt=!1,Ut=!0;window.tree=r.tree;window.treeString=gt(window.tree);window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.aegStringify=gt;window.saveMode=vn;window.loadMode=Hr;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.copyFromDrawTool=s.copyFromDrawTool;window.pasteInProofTool=s.pasteInProofTool;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.insertionTool=s.insertionTool;window.erasureTool=s.erasureTool;window.proofMoveSingleTool=s.proofMoveSingleTool;window.proofMoveMultiTool=s.proofMoveMultiTool;window.proofResizeTool=s.proofResizeTool;window.iterationTool=s.iterationTool;window.deiterationTool=s.deiterationTool;window.clearProofTool=s.clearProofTool;window.setTool=Xr;window.setHighlight=Fr;window.toggleHandler=jn;function Fr(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const rn=document.querySelectorAll(".toolButton");rn.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),rn.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Xr(e){switch(r.toolState=e,Ct.style.display="none",en.style.display="none",on.style.display="none",r.toolState){case s.atomTool:en.style.display="block";break;case s.cutTool:Ct.style.display="block";break;case s.copyFromDrawTool:on.style.display="block";break;case s.doubleCutInsertionTool:Ct.style.display="block";break}}function gt(e){return JSON.stringify(e,null,"	")}async function vn(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Wn(n,t)}else{const n=document.createElement("a");n.href=gt(t),n.download=e+".json",n.click()}}catch{}}async function Hr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const u=Lt(r.modeState,o);if(r.modeState==="Draw")r.tree=u,h(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=u,(i=document.getElementById("Row: 1"))==null||i.remove();for(let g=0;g<r.proof.length;g++)xn(r.proof[g],g+1);r.currentProofStep=r.proof[r.proof.length-1],w()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}function zr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),vn();else switch(r.toolState){case s.atomTool:io(e);break}}function Yr(){switch(r.toolState){case s.cutTool:Zn();break;case s.dragTool:Nn();break;case s.doubleCutInsertionTool:zo();break}Ut=!0}function Ur(e){switch(r.toolState){case s.cutTool:Qn(e);break;case s.atomTool:so(e);break;case s.dragTool:On(e);break;case s.moveSingleTool:uo(e);break;case s.moveMultiTool:wo(e);break;case s.copySingleTool:mo(e);break;case s.copyMultiTool:Po(e);break;case s.deleteSingleTool:Eo(e);break;case s.deleteMultiTool:$o(e);break;case s.resizeTool:sr(e);break;case s.copyFromDrawTool:Ro(e);break;case s.pasteInProofTool:xr();break;case s.doubleCutInsertionTool:Yo(e);break;case s.doubleCutDeletionTool:Go(e);break;case s.insertionTool:Qo(e);break;case s.erasureTool:nr(e);break;case s.proofMoveSingleTool:ur(e);break;case s.proofMoveMultiTool:pr(e);break;case s.proofResizeTool:kr(e);break;case s.iterationTool:Tr(e);break;case s.deiterationTool:Dr(e);break;case s.clearProofTool:Nr();break}Yt=!0}function qr(e){if(Yt&&Ut)switch(r.toolState){case s.cutTool:_n(e);break;case s.atomTool:lo(e);break;case s.dragTool:Rn(e);break;case s.moveSingleTool:fo(e);break;case s.moveMultiTool:go(e);break;case s.copySingleTool:Mo(e);break;case s.copyMultiTool:So(e);break;case s.deleteSingleTool:Io(e);break;case s.deleteMultiTool:vo(e);break;case s.resizeTool:lr(e);break;case s.copyFromDrawTool:Ao(e);break;case s.pasteInProofTool:mr();break;case s.doubleCutInsertionTool:Uo(e);break;case s.doubleCutDeletionTool:Wo(e);break;case s.insertionTool:_o(e);break;case s.erasureTool:or(e);break;case s.proofMoveSingleTool:fr(e);break;case s.proofMoveMultiTool:wr(e);break;case s.proofResizeTool:Er(e);break;case s.iterationTool:Pr(e);break;case s.deiterationTool:$r(e);break}}function Vr(e){switch(r.toolState){case s.cutTool:eo(e);break;case s.atomTool:co(e);break;case s.dragTool:An();break;case s.moveSingleTool:ho(e);break;case s.moveMultiTool:yo(e);break;case s.copySingleTool:bo(e);break;case s.copyMultiTool:Co(e);break;case s.deleteSingleTool:Lo(e);break;case s.deleteMultiTool:Bo(e);break;case s.resizeTool:cr(e);break;case s.copyFromDrawTool:Fo();break;case s.pasteInProofTool:Mr();break;case s.doubleCutInsertionTool:qo(e);break;case s.doubleCutDeletionTool:jo(e);break;case s.insertionTool:er(e);break;case s.erasureTool:rr(e);break;case s.proofMoveSingleTool:dr(e);break;case s.proofMoveMultiTool:gr(e);break;case s.proofResizeTool:Ir(e);break;case s.iterationTool:Sr(e);break;case s.deiterationTool:vr(e);break;case s.clearProofTool:Or();break}Yt=!1}function Gr(){switch(r.toolState){case s.cutTool:to();break;case s.atomTool:ao();break;case s.dragTool:Fn();break;case s.moveSingleTool:po();break;case s.moveMultiTool:xo();break;case s.copySingleTool:To();break;case s.copyMultiTool:ko();break;case s.deleteSingleTool:Do();break;case s.deleteMultiTool:No();break;case s.resizeTool:ar();break;case s.copyFromDrawTool:Xo();break;case s.pasteInProofTool:br();break;case s.doubleCutInsertionTool:Vo();break;case s.doubleCutDeletionTool:Jo();break;case s.insertionTool:tr();break;case s.erasureTool:ir();break;case s.proofMoveSingleTool:hr();break;case s.proofMoveMultiTool:yr();break;case s.proofResizeTool:Lr();break;case s.iterationTool:Cr();break;case s.deiterationTool:Br();break;case s.clearProofTool:Rr();break}Ut=!1}function Wr(){re.width=window.innerWidth,re.height=window.innerHeight}window.onresize=Wr;
