/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const I of d.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&r(I)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}toString(){return"("+this.x+", "+this.y+")"}}function H(e,t){return He(e,t)||N(t,e)}function He(e,t){if(e instanceof O)return t instanceof O?Ie(e,t):ke(t,e);if(t instanceof O)return ke(e,t);if(Ie(e.boundingBox,t.boundingBox)||N(t.boundingBox,e.boundingBox)){const n=Re(e);let r;for(let i=0;i<n.length;i++)if(r=te(t,n[i]),r<=0)return!0;return!1}return!1}function ke(e,t){const n=t.getCorners(),r=Q(e,n[0].x,1),i=Q(e,n[1].x,1),d=Q(e,n[0].x,-1),I=Q(e,n[1].x,-1);if(n[0].y<r&&r<n[2].y||n[0].y<d&&d<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<I&&I<n[2].y)return!0;const b=-1/Math.pow(e.radiusX,2),C=2*e.center.x/Math.pow(e.radiusX,2),Z=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),Se=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),ue=(-C+Math.sqrt(Math.pow(C,2)-4*b*Z))/(2*b),fe=(-C-Math.sqrt(Math.pow(C,2)-4*b*Z))/(2*b),de=(-C+Math.sqrt(Math.pow(C,2)-4*b*Se))/(2*b),he=(-C-Math.sqrt(Math.pow(C,2)-4*b*Se))/(2*b);return!isNaN(ue)&&n[0].x<ue&&ue<n[1].x||!isNaN(fe)&&n[0].x<fe&&fe<n[1].x||!isNaN(de)&&n[0].x<de&&de<n[1].x||!isNaN(he)&&n[0].x<he&&he<n[1].x}function N(e,t){if(e instanceof O)if(t instanceof O){const n=t.getCorners();for(let r=0;r<4;r++)if(!ye(e,n[r]))return!1;return!0}else{const n=st(t);for(let r=0;r<4;r++)if(!ye(e,n[r]))return!1;return!0}else if(t instanceof O){const n=t.getCorners();let r;for(let i=0;i<4;i++)if(r=te(e,n[i]),!(r<0))return!1;return!0}else{const n=Re(t);let r;for(let i=0;i<n.length;i++)if(r=te(e,n[i]),!(r<0))return!1;return!0}}function Ie(e,t){const n=e.getCorners(),r=t.getCorners();return(n[0].y<=r[0].y&&n[2].y>=r[0].y||n[0].y<=r[2].y&&n[2].y>=r[2].y||r[0].y<=n[0].y&&r[2].y>=n[0].y||r[0].y<=n[2].y&&r[2].y>=n[2].y)&&(n[0].x<=r[0].x&&n[1].x>=r[0].x||n[0].x<=r[1].x&&n[1].x>=r[1].x||r[0].x<=n[0].x&&r[1].x>=n[0].x||r[0].x<=n[1].x&&r[1].x>=n[1].x)}function ye(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function te(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function st(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function Re(e){const t=[];let n,r,i=1;for(let d=0;d<360;d++)n=e.center.x+e.radiusX*Math.cos(d*(Math.PI/180)),d>180&&(i=-1),r=Q(e,n,i),t[d]=new c(n,r);return t}function Q(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class O{constructor(t,n,r){if(!Number.isFinite(n)||!Number.isFinite(r))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(r!==void 0&&r<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=r}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return ye(this,t)}overlaps(t){return H(this,t)}contains(t){return N(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,r,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=r,this.internalHeight=i}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}calcRect(){return new O(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}}class u{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const r=this.internalChildren[n];if(r instanceof u&&r.containsNode(t))return r.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?N(this.internalEllipse,t.calcRect()):N(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof u&&this.internalChildren[n].children.length===0)return this;{const r=this.internalChildren[n];for(let i=0;i<r.children.length;i++)if(r.children[i].containsPoint(t))return r.getLowestParent(t);return this}}return null}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof u&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let r=0;r<this.children[n].children.length;r++)if(this.children[n].children[r].containsPoint(t))if(this.children[n].children[r]instanceof f)this.children[n].children.splice(r,1);else return this.children[n].children[r].remove(t);return this.children.splice(n,1),!0}return!1}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof u&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}}class z{constructor(t){this.internalSheet=new u(null),t instanceof u&&t.children.length>0&&(this.internalSheet.children=[...t.children])}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let r=n+1;r<t.children.length;r++)if(this.overlaps(t.children[n],t.children[r]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof u&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let r=0;r<n.children.length;r++)if(this.intersects(t,n.children[r]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),r=[...n.children];if(n.child=t,t instanceof u)for(let i=r.length-1;i>=0;i--)t.containsNode(r[i])&&(t.child=r[i],n.children.splice(i,1));return!0}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLowestParent(t){return this.internalSheet.getLowestParent(t)}remove(t){return this.internalSheet.remove(t)}intersects(t,n){const r=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return He(r,i)}overlaps(t,n){let r,i;return t instanceof f?n instanceof f?H(t.calcRect(),n.calcRect()):(r=n.ellipse,H(t.calcRect(),r)):n instanceof f?(r=t.ellipse,H(r,n.calcRect())):(r=t.ellipse,i=n.ellipse,H(r,i))}toString(){return this.internalSheet.toFormulaString()}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.toProofMode=10]="toProofMode",e[e.doubleCutInsertionTool=11]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=12]="doubleCutDeletionTool",e))(s||{});class o{}o.tree=new z;o.selectForProof=new z;o.toolState=0;class K{constructor(t,n,r){if(this.center=t,this.radiusX=n,this.radiusY=r,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new O(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return te(this,t)<0}overlaps(t){return H(this,t)}contains(t){return N(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}const lt=document.getElementById("theme-select");function R(e){return getComputedStyle(document.body).getPropertyValue(e)}let Ne=R("--good-placement"),Ue=R("--bad-placement"),Ve=R("--canvas-items");function Ge(){setTimeout(()=>{Ne=R("--good-placement"),Ue=R("--bad-placement"),Ve=R("--canvas-items"),a(o.tree)})}lt.addEventListener("input",()=>{Ge()});window.addEventListener("DOMContentLoaded",()=>{Ge()});function g(){return Ue}function x(){return Ne}function We(){return Ve}const pe=document.getElementById("canvas"),je=pe.getContext("2d");if(je===null)throw Error("2d rendering context not supported");const h=je;h.font="35pt arial";const ct=document.getElementById("graphString"),at=document.getElementById("atomBox"),qe=document.getElementById("atomBoxes");qe.addEventListener("input",ut);function T(e,t){const n=e.ellipse;if(n!==null){h.strokeStyle=t;const r=n.center;h.beginPath(),h.ellipse(r.x+l.x,r.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),h.stroke()}}function m(e,t,n){h.textBaseline="bottom";const r=h.measureText(e.identifier);h.fillStyle=t,h.strokeStyle=t,h.beginPath(),h.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(qe.checked||at.checked&&n)&&h.rect(e.origin.x+l.x,e.origin.y+l.y-r.actualBoundingBoxAscent,e.width,e.height),h.stroke()}function Je(e,t,n){h.beginPath(),h.strokeStyle=n;const r=e.x-t.x+l.x,i=e.y-t.y+l.y;h.rect(e.x,e.y,-r,-i),h.stroke()}function ut(){a(o.tree)}function ze(){h.clearRect(0,0,pe.width,pe.height)}function a(e){ct.innerHTML=e.toString(),ze(),Ke(e.sheet)}function Ke(e){for(let t=0;e.children.length>t;t++)e.children[t]instanceof f?ft(e.children[t]):Ke(e.children[t]);e.ellipse instanceof K&&(h.strokeStyle=We(),h.beginPath(),h.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),h.stroke())}function ft(e){m(e,We(),!1)}let xe,l=new c(0,0),Me;function dt(e){xe=new c(e.x-l.x,e.y-l.y),Me=!1}function ht(e){Me||(l=new c(e.x-xe.x,e.y-xe.y),a(o.tree))}function wt(){Me=!0,a(o.tree)}const gt=document.getElementById("showRect"),yt=document.getElementById("mode");let ne,ie;function pt(e){ne=new c(e.clientX-l.x,e.clientY-l.y),ie=!1}function xt(e){const t=new u(new K(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(a(o.tree),t.ellipse=se(ne,n),!ie){const i=o.tree.canInsert(t)&&U(t.ellipse)?x():g();T(t,i),gt.checked&&Je(ne,n,i)}}function mt(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(ne,t));o.tree.canInsert(n)&&!ie&&U(n.ellipse)&&o.tree.insert(n),a(o.tree)}function Mt(){ie=!0,a(o.tree)}function se(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),r=e.x-t.x,i=e.y-t.y,d=Math.abs(r),I=Math.abs(i);let b,C;if(yt.value==="circumscribed"){const Z=Math.floor(n.distance(t));C=Math.floor(Z*(I/d)),b=Math.floor(Z*(d/I))}else b=d/2,C=I/2;return new K(n,b,C)}function U(e){return e.radiusX>15&&e.radiusY>15}const bt=document.getElementById("canvas"),Ze=bt.getContext("2d");if(Ze===null)throw Error("2d rendering context not supported");const Ct=Ze,Qe=document.getElementById("atomDisplay");let L,le,$="A";Qe.innerHTML=$;function Et(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&($=e.key,Qe.innerHTML=$)}function Tt(e){L=Ct.measureText($),le=!1;const t=new f($,new c(e.clientX-l.x,e.clientY-l.y),L.width,L.fontBoundingBoxDescent+L.actualBoundingBoxAscent);a(o.tree);const n=o.tree.canInsert(t)?x():g();m(t,n,!0)}function Pt(e){const t=new f($,new c(e.clientX-l.x,e.clientY-l.y),L.width,L.fontBoundingBoxDescent+L.actualBoundingBoxAscent);a(o.tree),le||(o.tree.canInsert(t)?m(t,x(),!0):m(t,g(),!0))}function St(e){const t=new f($,new c(e.clientX-l.x,e.clientY-l.y),L.width,L.fontBoundingBoxDescent+L.actualBoundingBoxAscent);o.tree.canInsert(t)&&!le&&o.tree.insert(t),a(o.tree)}function kt(){le=!0,a(o.tree)}async function It(e,t){const n=JSON.stringify(t,null,"	"),r=await e.createWritable();await r.write(n),await r.close()}function me(e){if(typeof e=="string"){const n=JSON.parse(e).internalSheet.internalChildren,r=new z,i=[];return n.forEach(d=>{Object.prototype.hasOwnProperty.call(d,"internalEllipse")?i.push(_e(d)):i.push(et(d))}),r.sheet.children=i,r}return null}function _e(e){const t=new K(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];return e.internalChildren.forEach(r=>{"internalEllipse"in r?n.push(_e(r)):n.push(et(r))}),new u(t,n)}function et(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}function _(e,t){if(e.ellipse!==null){const n=X(e,t);if(!o.tree.canInsert(n))return!1}for(let n=0;n<e.children.length;n++){if(e.children[n]instanceof u&&e.children[n].ellipse!==null&&!_(e.children[n],t))return!1;if(e.children[n]instanceof f){let r=e.children[n];if(r=k(r,t),!o.tree.canInsert(r))return!1}}return!0}function be(e,t,n){if(e instanceof u&&e.ellipse!==null){const r=X(e,n);if(T(r,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)be(e.children[i],t,n)}else if(e instanceof f){const r=k(e,n);m(r,t,!0)}}function Ce(e,t){if(e instanceof u&&e.ellipse!==null){const n=X(e,t);if(o.tree.insert(n),e.children.length!==0)for(let r=0;r<e.children.length;r++)Ce(e.children[r],t)}else if(e instanceof f){const n=k(e,t);o.tree.insert(n)}}function X(e,t){if(e.ellipse!==null)return new u(new K(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a cut without an ellipse.")}function k(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}let B,w=null,F;function Lt(e){if(B=new c(e.x-l.x,e.y-l.y),w=o.tree.getLowestNode(B),w!==o.tree.sheet&&w!==null){const t=o.tree.getLowestParent(B);if(t!==null&&t.remove(B),w instanceof u&&w.children.length!==0){for(let n=0;n<w.children.length;n++)o.tree.insert(w.children[n]);w.children=[]}F=!0}else F=!1}function vt(e){if(F){const t=new c(e.x-B.x,e.y-B.y);if(w instanceof u){const n=X(w,t);a(o.tree);const r=o.tree.canInsert(n)?x():g();T(n,r)}else if(w instanceof f){const n=k(w,t);a(o.tree);const r=o.tree.canInsert(n)?x():g();m(n,r,!0)}}}function Bt(e){if(F){const t=new c(e.x-B.x,e.y-B.y);if(w instanceof u){const n=X(w,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(w)}else if(w instanceof f){const n=k(w,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(w)}a(o.tree)}F=!1}function Dt(){F&&w!==null&&o.tree.insert(w),F=!1,a(o.tree)}let D,p=null,Y;function Ot(e){if(D=new c(e.x-l.x,e.y-l.y),p=o.tree.getLowestNode(D),p!==o.tree.sheet&&p!==null){const t=o.tree.getLowestParent(D);t!==null&&t.remove(D),Y=!0}else Y=!1}function At(e){if(Y){const t=new c(e.x-D.x,e.y-D.y);if(a(o.tree),p instanceof u){const n=_(p,t)?x():g();be(p,n,t)}else if(p instanceof f){const n=k(p,t),r=o.tree.canInsert(n)?x():g();m(n,r,!0)}}}function Xt(e){if(Y){const t=new c(e.x-D.x,e.y-D.y);if(p instanceof u)_(p,t)?Ce(p,t):o.tree.insert(p);else if(p instanceof f){const n=k(p,t);o.tree.canInsert(n)?o.tree.insert(n):o.tree.insert(p)}}a(o.tree),Y=!1}function $t(){Y&&p!==null&&o.tree.insert(p),Y=!1,a(o.tree)}let V,E=null,G;function Ft(e){V=new c(e.x-l.x,e.y-l.y);const t=o.tree.getLowestNode(V);t!==o.tree.sheet&&t!==null?(t instanceof u?(E=X(t,new c(0,0)),E.children=[]):t instanceof f&&(E=t),G=!0):G=!1}function Yt(e){if(G){const t=new c(e.x-V.x,e.y-V.y);if(E instanceof u){const n=X(E,t);a(o.tree);const r=o.tree.canInsert(n)?x():g();T(n,r)}else if(E instanceof f){const n=k(E,t);a(o.tree);const r=o.tree.canInsert(n)?x():g();m(n,r,!0)}}}function Ht(e){if(G){const t=new c(e.x-V.x,e.y-V.y);if(E instanceof u&&E.ellipse!==null){const n=X(E,t);o.tree.canInsert(n)&&o.tree.insert(n)}else if(E instanceof f){const n=k(E,t);o.tree.canInsert(n)&&o.tree.insert(n)}a(o.tree)}G=!1}function Rt(){G=!1,a(o.tree)}let W,M=null,j;function Nt(e){W=new c(e.x-l.x,e.y-l.y),M=o.tree.getLowestNode(W),M!==o.tree.sheet&&M!==null?j=!0:j=!1}function Ut(e){if(j){const t=new c(e.x-W.x,e.y-W.y);if(a(o.tree),M instanceof u){const n=_(M,t)?x():g();be(M,n,t)}else if(M instanceof f){const n=k(M,t),r=o.tree.canInsert(n)?x():g();m(n,r,!0)}}}function Vt(e){if(j){const t=new c(e.x-W.x,e.y-W.y);if(M instanceof u)_(M,t)&&Ce(M,t);else if(M instanceof f){const n=k(M,t);o.tree.canInsert(n)&&o.tree.insert(n)}}a(o.tree),j=!1}function Gt(){j=!1,a(o.tree)}let Le,y=null,q;function Wt(e){Le=new c(e.x-l.x,e.y-l.y),y=o.tree.getLowestNode(Le),y!==o.tree.sheet&&y!==null&&(q=!0,y instanceof f?m(y,g(),!0):T(y,g()))}function jt(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);y!==null&&y!==n&&(q=!0,a(o.tree),n===o.tree.sheet||n===null?(y=null,q=!1):(y=n,y instanceof f?m(y,g(),!0):T(y,g())))}function qt(e){const t=new c(e.x-l.x,e.y-l.y);if(q){const n=o.tree.getLowestParent(t);if(n!==null&&n.remove(t),y instanceof u&&y.children.length!==0)for(let r=0;r<y.children.length;r++)o.tree.insert(y.children[r])}a(o.tree),y=null,q=!1}function Jt(){y=null,q=!1}let ve,S=null,J;function zt(e){ve=new c(e.x-l.x,e.y-l.y),S=o.tree.getLowestNode(ve),S!==o.tree.sheet&&S!==null&&(J=!0,Ee(S,g()))}function Kt(e){const t=new c(e.x-l.x,e.y-l.y),n=o.tree.getLowestNode(t);S!==null&&S!==o.tree.getLowestNode(t)&&(J=!0,a(o.tree),n===o.tree.sheet||n===null?(S=null,J=!1):(S=n,Ee(S,g())))}function Zt(e){const t=new c(e.x-l.x,e.y-l.y);if(J){const n=o.tree.getLowestParent(t);n!==null&&n.remove(t),a(o.tree)}S=null,J=!1}function Qt(){S=null,J=!1}function Ee(e,t){if(e instanceof f)m(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)Ee(e.children[n],t)}}let ee,P=null,ce;function _t(e){if(o.selectForProof.sheet=new z().sheet,ee=new c(e.x,e.y),P=o.tree.getLowestNode(ee),P!==null){if(ce=!0,P!==o.tree.sheet){const t=o.tree.getLowestParent(ee);t!==null&&t.remove(ee),a(o.tree)}else ze();P instanceof f?m(P,x(),!0):tt(P,x()),P!==o.tree.sheet&&o.tree.insert(P)}}function en(){P=null,ce=!1,a(o.tree)}function tn(){ce&&(o.selectForProof.insert(P),a(o.tree),alert("Graph selected, you may now toggle to proof mode"))}function nn(){P=null,ce=!1,a(o.tree)}function tt(e,t){if(e instanceof f)m(e,t,!0);else if(e instanceof u){T(e,t);for(let n=0;n<e.children.length;n++)tt(e.children[n],t)}}const rn=document.getElementById("showRect");let re,ae;function on(e){re=new c(e.clientX-l.x,e.clientY-l.y),ae=!1}function sn(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(re,t)),r=new u(nt(n.ellipse));if(a(o.tree),!ae&&n.ellipse!==null&&r.ellipse!==null){const d=o.tree.canInsert(n)&&U(n.ellipse)&&o.tree.canInsert(r)&&U(r.ellipse)?x():g();T(n,d),T(r,d),rn.checked&&Je(re,t,d)}}function ln(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new u(se(re,t)),r=new u(nt(n.ellipse));!ae&&n.ellipse!==null&&r.ellipse!==null&&o.tree.canInsert(n)&&U(n.ellipse)&&o.tree.canInsert(r)&&U(r.ellipse)&&(o.tree.insert(n),o.tree.insert(r)),a(o.tree)}function cn(){ae=!0,a(o.tree)}function nt(e){return new K(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let A=null,oe;function an(e){const t=new c(e.x-l.x,e.y-l.y);A=o.tree.getLowestNode(t),rt()}function un(e){const t=new c(e.x-l.x,e.y-l.y);A=o.tree.getLowestNode(t),a(o.tree),rt()}function fn(e){const t=new c(e.x-l.x,e.y-l.y);if(oe&&A instanceof u){const n=o.tree.getLowestParent(t),r=A.children[0];if(n!==null&&r instanceof u){n.remove(t);for(let i=0;i<r.children.length;i++)o.tree.insert(r.children[i])}}a(o.tree)}function dn(){oe=!1,a(o.tree)}function hn(e){return e.children.length===1&&e.children[0]instanceof u&&A!==o.tree.sheet}function wn(e){T(e,g()),e.children[0]instanceof u&&T(e.children[0],g())}function rt(){A instanceof u&&hn(A)?(oe=!0,wn(A)):oe=!1}let we=!0,Be=null,De=null,Oe=s.none,Ae=s.none;const Xe=document.getElementById("DrawButtons"),$e=document.getElementById("ProofButtons");function gn(){if(we=!we,we){Xe.style.display="block",$e.style.display="none",De=JSON.stringify(o.tree),Ae=o.toolState;const e=me(Be);if(e!==null)o.tree.sheet=e.sheet;else throw Error("invalid cached AEG");o.toolState=Oe}else{Xe.style.display="none",$e.style.display="block",Be=JSON.stringify(o.tree),Oe=o.toolState;const e=me(De);if(e!==null){o.tree.sheet=e.sheet;for(let t=0;t<o.selectForProof.sheet.children.length;t++){const n=o.selectForProof.sheet.children[t];try{o.tree.insert(n)}catch{console.log("Could not insert "+n)}}}else o.tree.sheet=o.selectForProof.sheet;o.toolState=Ae,o.selectForProof.sheet=new z().sheet}a(o.tree)}const v=document.getElementById("canvas");v.width=window.innerWidth;v.height=window.innerHeight;const ot=v.getContext("2d");if(ot===null)throw Error("2d rendering context not supported");const yn=ot;yn.font="35pt arial";const ge=document.getElementById("cutTools"),Fe=document.getElementById("atomTools");window.addEventListener("keydown",Mn);v.addEventListener("mousedown",bn);v.addEventListener("mousemove",Cn);v.addEventListener("mouseup",En);v.addEventListener("mouseout",Tn);v.addEventListener("mouseenter",Pn);let Te=!1,Pe=!0;window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.saveMode=it;window.loadMode=mn;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.toProofMode=s.toProofMode;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.setTool=xn;window.setHighlight=pn;window.toggleHandler=gn;function pn(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const Ye=document.querySelectorAll(".modeButton");Ye.forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("modeButtonPressed"),Ye.forEach(t=>{t!==e&&t.classList.remove("modeButtonPressed")})})});function xn(e){switch(o.toolState=e,ge.style.display="none",Fe.style.display="none",o.toolState){case s.atomTool:Fe.style.display="block";break;case s.cutTool:ge.style.display="block";break;case s.doubleCutInsertionTool:ge.style.display="block";break}}async function it(){if("showSaveFilePicker"in window){const e=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:"AEG Tree",startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});It(e,o.tree)}else{const e=document.createElement("a");e.href=JSON.stringify(o.tree,null,"	"),e.download="AEGTree.json",e.click()}}async function mn(){const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{const r=n.result,i=me(r);i instanceof z&&(o.tree=i,a(o.tree))}),n.readAsText(t)}function Mn(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),it();else switch(o.toolState){case s.atomTool:Et(e);break}}function bn(e){switch(o.toolState){case s.cutTool:pt(e);break;case s.atomTool:Tt(e);break;case s.dragTool:dt(e);break;case s.moveSingleTool:Lt(e);break;case s.moveMultiTool:Ot(e);break;case s.copySingleTool:Ft(e);break;case s.copyMultiTool:Nt(e);break;case s.deleteSingleTool:Wt(e);break;case s.deleteMultiTool:zt(e);break;case s.toProofMode:_t(e);break;case s.doubleCutInsertionTool:on(e);break;case s.doubleCutDeletionTool:an(e);break}Te=!0}function Cn(e){if(Te&&Pe)switch(o.toolState){case s.cutTool:xt(e);break;case s.atomTool:Pt(e);break;case s.dragTool:ht(e);break;case s.moveSingleTool:vt(e);break;case s.moveMultiTool:At(e);break;case s.copySingleTool:Yt(e);break;case s.copyMultiTool:Ut(e);break;case s.deleteSingleTool:jt(e);break;case s.deleteMultiTool:Kt(e);break;case s.toProofMode:en();break;case s.doubleCutInsertionTool:sn(e);break;case s.doubleCutDeletionTool:un(e);break}}function En(e){switch(o.toolState){case s.cutTool:mt(e);break;case s.atomTool:St(e);break;case s.moveSingleTool:Bt(e);break;case s.moveMultiTool:Xt(e);break;case s.copySingleTool:Ht(e);break;case s.copyMultiTool:Vt(e);break;case s.deleteSingleTool:qt(e);break;case s.deleteMultiTool:Zt(e);break;case s.toProofMode:tn();break;case s.doubleCutInsertionTool:ln(e);break;case s.doubleCutDeletionTool:fn(e);break}Te=!1}function Tn(){switch(o.toolState){case s.cutTool:Mt();break;case s.atomTool:kt();break;case s.dragTool:wt();break;case s.moveSingleTool:Dt();break;case s.moveMultiTool:$t();break;case s.copySingleTool:Rt();break;case s.copyMultiTool:Gt();break;case s.deleteSingleTool:Jt();break;case s.deleteMultiTool:Qt();break;case s.toProofMode:nn();break;case s.doubleCutInsertionTool:cn();break;case s.doubleCutDeletionTool:dn();break}Pe=!1}function Pn(){Pe=!0}function Sn(){v.width=window.innerWidth,v.height=window.innerHeight}window.onresize=Sn;
