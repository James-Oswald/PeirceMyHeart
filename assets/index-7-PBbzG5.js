(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const w of u.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&o(w)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();class a{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function De(e,t){return ln(e,t)||Be(t,e)}function ln(e,t){if(e instanceof Me)return t instanceof Me?Gt(e,t):Vt(t,e);if(t instanceof Me)return Vt(e,t);if(Gt(e.boundingBox,t.boundingBox)||Be(t.boundingBox,e.boundingBox)){const n=sn(e);let o;for(let i=0;i<n.length;i++)if(o=st(t,n[i]),o<=0)return!0;return!1}return!1}function Vt(e,t){const n=t.getCorners(),o=je(e,n[0].x,1),i=je(e,n[1].x,1),u=je(e,n[0].x,-1),w=je(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<u&&u<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<w&&w<n[2].y)return!0;const h=-1/Math.pow(e.radiusX,2),y=2*e.center.x/Math.pow(e.radiusX,2),M=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),H=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),We=(-y+Math.sqrt(Math.pow(y,2)-4*h*M))/(2*h),mt=(-y-Math.sqrt(Math.pow(y,2)-4*h*M))/(2*h),xt=(-y+Math.sqrt(Math.pow(y,2)-4*h*H))/(2*h),Mt=(-y-Math.sqrt(Math.pow(y,2)-4*h*H))/(2*h);return!isNaN(We)&&n[0].x<We&&We<n[1].x||!isNaN(mt)&&n[0].x<mt&&mt<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x||!isNaN(Mt)&&n[0].x<Mt&&Mt<n[1].x}function Be(e,t){if(e instanceof Me)if(t instanceof Me){const n=t.getCorners();for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else{const n=Bn(t);for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else if(t instanceof Me){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=st(e,n[i]),!(o<0))return!1;return!0}else{const n=sn(t);let o;for(let i=0;i<n.length;i++)if(o=st(e,n[i]),!(o<0))return!1;return!0}}function Gt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function Ct(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function st(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function Bn(e){return[new a(e.center.x,e.center.y-e.radiusY),new a(e.center.x+e.radiusX,e.center.y),new a(e.center.x,e.center.y+e.radiusY),new a(e.center.x-e.radiusX,e.center.y)]}function sn(e){const t=[];let n,o,i=1;for(let u=0;u<360;u++)n=e.center.x+e.radiusX*Math.cos(u*(Math.PI/180)),u>180&&(i=-1),o=je(e,n,i),t[u]=new a(n,o);return t}function je(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class Me{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new a(this.startVertex.x+this.width,this.startVertex.y)),t.push(new a(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new a(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Ct(this,t)}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new f(this.internalIdentifier,new a(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new Me(new a(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class ae{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new a(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new Me(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return st(this,t)<0}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class c{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new ae(new a(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof f,n.push(i.copy())}return new c(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof c&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?Be(this.internalEllipse,t.calcRect()):Be(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof c&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof c&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof c&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof c&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let u=0;u<o.length;u++){if(n[i]instanceof f&&o[u]instanceof f&&n[i].isEqualTo(o[u])||n[i]instanceof c&&o[u]instanceof c&&n[i].isEqualTo(o[u])){n.splice(i,1),o.splice(u,1),i--;break}if(u===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof c&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class D{constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new c(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof c&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof c)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return ln(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?De(t.calcRect(),n.calcRect()):(o=n.ellipse,De(t.calcRect(),o)):n instanceof f?(o=t.ellipse,De(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,De(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class U{constructor(t,n){this.appliedRule=n??"",this.tree=new D(t==null?void 0:t.sheet),this.index=r.proof.length}}var l=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.drawMoveSingleTool=4]="drawMoveSingleTool",e[e.drawMoveMultiTool=5]="drawMoveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.proofClearTool=22]="proofClearTool",e[e.drawClearTool=23]="drawClearTool",e))(l||{});const oe=class oe{static getLastProofStep(){return oe.proof.length===0?new U(new D):oe.proof[oe.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;It(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),xn(t)}static clearProof(){It(-1),this.proof=[],this.pushToProof(new U),this.currentProofStep=this.proof[0]}};oe.tree=new D,oe.proof=[],oe.selectForProof=new D,oe.toolState=0,oe.modeState="Draw";let r=oe,kt,s=new a(0,0),At;function Nn(){d("cursor: grab")}function On(e){d("cursor: grabbing"),kt=new a(e.x-s.x,e.y-s.y),At=!1}function Rn(e){At||(d("cursor: grabbing"),s=new a(e.x-kt.x,e.y-kt.y),an())}function Fn(){d("cursor: grab")}function Xn(){d("cursor: default"),At=!0,an()}function an(){r.modeState==="Proof"?m():g(r.tree)}var cn={exports:{}};(function(e,t){function n(){var w=document.querySelector("[data-toggle-theme]"),h=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){localStorage.getItem(h||"theme")&&(document.documentElement.setAttribute("data-theme",y),w&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(M=>{M.classList.add(w.getAttribute("data-act-class"))}))})(),w&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(y=>{y.addEventListener("click",function(){var M=y.getAttribute("data-toggle-theme");if(M){var H=M.split(",");document.documentElement.getAttribute("data-theme")==H[0]?H.length==1?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem(h||"theme")):(document.documentElement.setAttribute("data-theme",H[1]),localStorage.setItem(h||"theme",H[1])):(document.documentElement.setAttribute("data-theme",H[0]),localStorage.setItem(h||"theme",H[0]))}[...document.querySelectorAll("[data-toggle-theme]")].forEach(We=>{We.classList.toggle(this.getAttribute("data-act-class"))})})})}function o(){var w=document.querySelector("[data-set-theme='']"),h=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){if(y!=null&&y!="")if(localStorage.getItem(h||"theme")&&localStorage.getItem(h||"theme")!=""){document.documentElement.setAttribute("data-theme",y);var M=document.querySelector("[data-set-theme='"+y.toString()+"']");M&&([...document.querySelectorAll("[data-set-theme]")].forEach(H=>{H.classList.remove(H.getAttribute("data-act-class"))}),M.getAttribute("data-act-class")&&M.classList.add(M.getAttribute("data-act-class")))}else{var M=document.querySelector("[data-set-theme='']");M.getAttribute("data-act-class")&&M.classList.add(M.getAttribute("data-act-class"))}})(),[...document.querySelectorAll("[data-set-theme]")].forEach(y=>{y.addEventListener("click",function(){document.documentElement.setAttribute("data-theme",this.getAttribute("data-set-theme")),localStorage.setItem(h||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("[data-set-theme]")].forEach(M=>{M.classList.remove(M.getAttribute("data-act-class"))}),y.getAttribute("data-act-class")&&y.classList.add(y.getAttribute("data-act-class"))})})}function i(){var w=document.querySelector("select[data-choose-theme]"),h=w?w.getAttribute("data-key"):null;(function(y=localStorage.getItem(h||"theme")){if(localStorage.getItem(h||"theme")){document.documentElement.setAttribute("data-theme",y);var M=document.querySelector("select[data-choose-theme] [value='"+y.toString()+"']");M&&[...document.querySelectorAll("select[data-choose-theme] [value='"+y.toString()+"']")].forEach(H=>{H.selected=!0})}})(),w&&[...document.querySelectorAll("select[data-choose-theme]")].forEach(y=>{y.addEventListener("change",function(){document.documentElement.setAttribute("data-theme",this.value),localStorage.setItem(h||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("select[data-choose-theme] [value='"+localStorage.getItem(h||"theme")+"']")].forEach(M=>{M.selected=!0})})})}function u(w=!0){w===!0?document.addEventListener("DOMContentLoaded",function(h){n(),i(),o()}):(n(),i(),o())}e.exports={themeChange:u}})(cn);var Hn=cn.exports;const qn=document.getElementById("theme-select");Hn.themeChange();let un=Ae("--good-placement"),fn=Ae("--bad-placement"),dn=Ae("--canvas-items");function Ae(e){return getComputedStyle(document.body).getPropertyValue(e)}function hn(){setTimeout(()=>{un=Ae("--good-placement"),fn=Ae("--bad-placement"),dn=Ae("--canvas-items"),r.modeState==="Draw"?g(r.tree):m()})}qn.addEventListener("input",()=>{hn()});window.addEventListener("DOMContentLoaded",()=>{hn()});function p(){return fn}function x(){return un}function gn(){return dn}const at=document.getElementById("canvas"),wn=at.getContext("2d");if(wn===null)throw Error("2d rendering context not supported.");const P=wn;P.font="35pt arial";const zn=document.getElementById("graphString"),Yn=document.getElementById("proofString"),Un=document.getElementById("atomBox"),pn=document.getElementById("atomBoxes");pn.addEventListener("input",Gn);function R(e,t){const n=e.ellipse;if(n!==null){P.strokeStyle=t;const o=n.center;P.beginPath(),P.ellipse(o.x+s.x,o.y+s.y,n.radiusX,n.radiusY,0,0,2*Math.PI),P.stroke()}}function F(e,t,n){P.textBaseline="bottom";const o=P.measureText(e.identifier);P.fillStyle=t,P.strokeStyle=t,P.beginPath(),P.fillText(e.identifier,e.origin.x+s.x,e.origin.y+s.y),(pn.checked||Un.checked&&n)&&P.rect(e.origin.x+s.x,e.origin.y+s.y-o.actualBoundingBoxAscent,e.width,e.height),P.stroke()}function yn(e,t,n){P.beginPath(),P.strokeStyle=n;const o=e.x-t.x+s.x,i=e.y-t.y+s.y;P.rect(e.x,e.y,-o,-i),P.stroke()}function d(e){at.style.cssText=e}function Vn(e,t,n){return e===x()?t:n}function I(e,t,n){d(Vn(e,t,n))}function Gn(){g(r.tree)}function tt(){P.clearRect(0,0,at.width,at.height)}function g(e,t){zn.innerHTML=e.toString(),tt(),$t(e.sheet,t),window.treeString=yt(e)}function $t(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof f?Wn(e.children[n]):$t(e.children[n]);e.ellipse instanceof ae&&(P.strokeStyle=t||gn(),P.beginPath(),P.ellipse(e.ellipse.center.x+s.x,e.ellipse.center.y+s.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),P.stroke())}function Wn(e){F(e,gn(),!1)}function m(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new D:e=r.currentProofStep.tree,tt(),Yn.innerHTML=e.toString(),$t(e.sheet)}function ne(e,t){if(e instanceof f)F(e,t,!1);else if(e instanceof c){R(e,t);for(let n=0;n<e.children.length;n++)ne(e.children[n],t)}}function mn(e,t){const n=new a(1,1);if(e instanceof c&&e.ellipse!==null){const o=e.ellipse,i=[new a(o.center.x-o.radiusX,o.center.y),new a(o.center.x,o.center.y-o.radiusY),new a(o.center.x+o.radiusX,o.center.y),new a(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function xn(e,t){var w;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){jn(e)};const u=document.createElement("Text");u.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(u),n.appendChild(i),(w=document.getElementById("proofHistoryBar"))==null||w.appendChild(n)}function jn(e){r.currentProofStep=e,m()}function It(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}async function Jn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Lt(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Wt(o)}else{const o=[];let i;for(i of n){const u=i.tree.internalSheet.internalChildren;o.push(new U(Wt(u),i.appliedRule))}return o}}function Wt(e){const t=new D,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(Mn(o)):n.push(bn(o));return t.sheet.children=n,t}function Mn(e){const t=new ae(new a(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(Mn(o)):n.push(bn(o));return new c(t,n)}function bn(e){const t=e.internalIdentifier,n=new a(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}let bt=!0,Tt=null,St=null,jt=l.none,Jt=l.none;const Kt=document.getElementById("DrawButtons"),Zt=document.getElementById("ProofButtons"),Qt=document.getElementById("proofHistoryBar");function Kn(){if(bt=!bt,bt){Kt.style.display="block",tn.style.display="block",Zt.style.display="none",nn.style.display="none",Qt.style.display="none",r.modeState="Draw",St=JSON.stringify(r.proof),Jt=r.toolState;let e=null;if(Tt!==null&&(e=Lt(r.modeState,Tt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=jt,g(r.tree)}else{Kt.style.display="none",tn.style.display="none",Zt.style.display="block",nn.style.display="block",Qt.style.display="block",r.modeState="Proof",Tt=JSON.stringify(r.tree),jt=r.toolState,r.proof.length===0&&r.pushToProof(new U);let e=null;St!==null&&(e=Lt(r.modeState,St)),e!==null&&(r.proof=e),r.toolState=Jt,m()}}let Bt;function Zn(){Bt=!0,tt(),ne(r.tree.sheet,p())}function Qn(){Bt&&(r.tree=new D,g(r.tree))}function _n(){Bt=!1,g(r.tree)}const eo=document.getElementById("canvas"),Tn=eo.getContext("2d");if(Tn===null)throw Error("2d rendering context not supported.");const to=Tn,no=document.getElementById("atomDisplay");let dt,Nt,N=nt("A",new a(0,0));function oo(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=nt(e.key,new a(N.origin.x,N.origin.y)),N.origin.x!==0&&N.origin.y!==0&&Nt&&Ot())}function ro(e){dt=!1,Nt=!0,N=nt(N.identifier,new a(e.clientX-s.x,e.clientY-s.y)),Ot()}function io(e){N=nt(N.identifier,new a(e.clientX-s.x,e.clientY-s.y)),Ot()}function lo(e){d("cursor: default"),N=nt(N.identifier,new a(e.clientX-s.x,e.clientY-s.y)),r.tree.canInsert(N)&&!dt&&r.tree.insert(N),g(r.tree),Nt=!1}function so(){d("cursor: default"),dt=!0,g(r.tree)}function nt(e,t){no.innerHTML=e;const n=to.measureText(e);return new f(e,new a(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Ot(){g(r.tree),dt||(r.tree.canInsert(N)?(d("cursor: default"),F(N,x(),!0)):(d("cursor: no-drop"),F(N,p(),!0)))}const ao=document.getElementById("mode");function be(e,t,n){if(t.ellipse!==null){const o=Z(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof c&&t.children[o].ellipse!==null&&!be(e,t.children[o],n))return!1;if(t.children[o]instanceof f){let i=t.children[o];if(i=k(i,n),!e.canInsert(i))return!1}}return!0}function Y(e,t,n){if(e instanceof c&&e.ellipse!==null){const o=Z(e,n);if(R(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Y(e.children[i],t,n)}else if(e instanceof f){const o=k(e,n);F(o,t,!0)}}function ot(e,t,n){const o=n||r.tree;if(e instanceof c&&e.ellipse!==null){const i=Z(e,t);if(o.insert(i),e.children.length!==0)for(let u=0;u<e.children.length;u++)ot(e.children[u],t,n)}else if(e instanceof f){const i=k(e,t);o.insert(i)}}function Qe(e,t){return e instanceof f?k(e,t):Z(e,t)}function Z(e,t){if(e.ellipse!==null)return new c(new ae(new a(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Rt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof c?n.push(Rt(e.children[o],t)):e.children[o]instanceof f&&n.push(k(e.children[o],t));return new c(new ae(new a(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function k(e,t){return new f(e.identifier,new a(e.origin.x+t.x-s.x,e.origin.y+t.y-s.y),e.width,e.height)}function ht(e,t,n){if(e.ellipse!==null)return new c(new ae(new a(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),Math.abs(e.ellipse.radiusX+t.x*n.x),Math.abs(e.ellipse.radiusY+t.y*n.y)));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function rt(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function ve(e,t){t instanceof c&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof c&&t.children.length!==0&&rt(e,t),g(e))}function gt(e,t){const n=new a((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,u=Math.abs(o),w=Math.abs(i);let h,y;if(ao.value==="circumscribed"){const M=Math.floor(n.distance(t));y=Math.floor(M*(w/u)),h=Math.floor(M*(u/w))}else h=u/2,y=w/2;return new ae(n,h,y)}function ge(e){return e.radiusX>15&&e.radiusY>15}const co=document.getElementById("showRect");let ct,wt;function uo(){d("cursor: crosshair")}function fo(e){ct=new a(e.clientX-s.x,e.clientY-s.y),wt=!1}function ho(e){const t=new c(new ae(new a(0,0),0,0)),n=new a(e.clientX-s.x,e.clientY-s.y);if(g(r.tree),t.ellipse=gt(ct,n),!wt){const i=r.tree.canInsert(t)&&ge(t.ellipse)?x():p();I(i,"cursor: crosshair","cursor: no-drop"),R(t,i),co.checked&&yn(ct,n,i)}}function go(e){d("cursor: crosshair");const t=new a(e.clientX-s.x,e.clientY-s.y),n=new c(gt(ct,t));r.tree.canInsert(n)&&!wt&&ge(n.ellipse)&&r.tree.insert(n),g(r.tree)}function wo(){d("cursor: default"),wt=!0,g(r.tree)}let we,S=null,Ce;function po(e){if(we=new a(e.x-s.x,e.y-s.y),S=r.tree.getLowestNode(we),S!==r.tree.sheet&&S!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(we);if(t!==null&&t.remove(we),S instanceof c&&S.children.length!==0){for(let n=0;n<S.children.length;n++)r.tree.insert(S.children[n]);S.children=[]}Ce=!0,g(r.tree),S instanceof f?F(S,x(),!0):R(S,x())}else Ce=!1}function yo(e){if(Ce){const t=new a(e.x-we.x,e.y-we.y);if(S instanceof c){const n=Z(S,t);g(r.tree);const o=r.tree.canInsert(n)?x():p();R(n,o),I(o,"cursor: grabbing","cursor: no-drop")}else if(S instanceof f){const n=k(S,t);g(r.tree);const o=r.tree.canInsert(n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function mo(e){if(d("cursor: default"),Ce){const t=new a(e.x-we.x,e.y-we.y);if(S instanceof c){const n=Z(S,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(S)}else if(S instanceof f){const n=k(S,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(S)}g(r.tree)}Ce=!1}function xo(){d("cursor: default"),Ce&&S!==null&&r.tree.insert(S),Ce=!1,g(r.tree)}let pe,v=null,ke;function Mo(e){if(pe=new a(e.x-s.x,e.y-s.y),v=r.tree.getLowestNode(pe),v!==r.tree.sheet&&v!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(pe);t!==null&&t.remove(pe),ke=!0,g(r.tree),ne(v,x())}else ke=!1}function bo(e){if(ke){const t=new a(e.x-pe.x,e.y-pe.y);if(g(r.tree),v instanceof c){const n=be(r.tree,v,t)?x():p();Y(v,n,t),I(n,"cursor: grabbing","cursor: no-drop")}else if(v instanceof f){const n=k(v,t),o=r.tree.canInsert(n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function To(e){if(d("cursor: default"),ke){const t=new a(e.x-pe.x,e.y-pe.y);if(v instanceof c)be(r.tree,v,t)?ot(v,t):r.tree.insert(v);else if(v instanceof f){const n=k(v,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(v)}}g(r.tree),ke=!1}function So(){d("cursor: default"),ke&&v!==null&&r.tree.insert(v),ke=!1,g(r.tree)}let ye,J=null,Ne;function Po(e){ye=new a(e.x-s.x,e.y-s.y);const t=r.tree.getLowestNode(ye),n=new a(e.x-ye.x,e.y-ye.y);t!==r.tree.sheet&&t!==null?(d("cursor: copy"),t instanceof c?(J=Z(t,n),J.children=[]):t instanceof f&&(J=t),Ne=!0):Ne=!1}function Eo(e){if(Ne){const t=new a(e.x-ye.x,e.y-ye.y);if(J instanceof c){const n=Z(J,t);g(r.tree);const o=r.tree.canInsert(n)?x():p();R(n,o),I(o,"cursor: grabbing","cursor: no-drop")}else if(J instanceof f){const n=k(J,t);g(r.tree);const o=r.tree.canInsert(n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function Co(e){if(d("cursor: default"),Ne){const t=new a(e.x-ye.x,e.y-ye.y);if(J instanceof c&&J.ellipse!==null){const n=Z(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(J instanceof f){const n=k(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}g(r.tree)}Ne=!1}function ko(){d("cursor: default"),Ne=!1,g(r.tree)}let Oe,G=null,Re;function Io(e){Oe=new a(e.x-s.x,e.y-s.y),G=r.tree.getLowestNode(Oe),G!==r.tree.sheet&&G!==null?(d("cursor: copy"),Re=!0):Re=!1}function Lo(e){if(Re){const t=new a(e.x-Oe.x,e.y-Oe.y);if(g(r.tree),G instanceof c){const n=be(r.tree,G,t)?x():p();Y(G,n,t),I(n,"cursor: grabbing","cursor: no-drop")}else if(G instanceof f){const n=k(G,t),o=r.tree.canInsert(n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function vo(e){if(d("cursor: default"),Re){const t=new a(e.x-Oe.x,e.y-Oe.y);if(G instanceof c)be(r.tree,G,t)&&ot(G,t);else if(G instanceof f){const n=k(G,t);r.tree.canInsert(n)&&r.tree.insert(n)}}g(r.tree),Re=!1}function Do(){d("cursor: default"),Re=!1,g(r.tree)}let it,T=null,re;function Ao(e){if(it=new a(e.x-s.x,e.y-s.y),T=r.tree.getLowestNode(it),T!==null){const t=r.tree.getLowestParent(it);t!==null&&t.remove(it),T instanceof c&&T.children.length!==0&&T!==r.tree.sheet&&rt(r.tree,T),g(r.tree),T instanceof f?F(T,p(),!0):R(T,p()),re=!0}else re=!1}function $o(e){re&&T!==null&&T.ellipse!==null&&ve(r.tree,T);const t=new a(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);re&&T!==null&&o!==null&&(re=!0,g(r.tree),n===null?(T=null,re=!1):(o.remove(t),T=n,T instanceof c&&T.children.length!==0&&(rt(r.tree,T),T.children=[]),g(r.tree),T instanceof f?F(T,p(),!0):R(T,p())))}function Bo(e){const t=new a(e.x-s.x,e.y-s.y);if(re){const n=r.tree.getLowestNode(t);n!==null&&n instanceof c&&n.remove(t),n!==r.tree.sheet&&n instanceof c&&n.children.length!==0&&rt(r.tree,n),g(r.tree)}T=null,re=!1}function No(){re&&T!==null&&ve(r.tree,T),T=null,re=!1,g(r.tree)}let lt,B=null,_;function Oo(e){if(lt=new a(e.x-s.x,e.y-s.y),B=r.tree.getLowestNode(lt),B!==null){const t=r.tree.getLowestParent(lt);t!==null?t.remove(lt):(B=r.tree.sheet.copy(),r.tree.clear()),_=!0,g(r.tree),ne(B,p())}}function Ro(e){_&&B!==null&&ve(r.tree,B);const t=new a(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);_&&B!==null&&o!==null?(_=!0,n===null?(B=null,_=!1):(o.remove(t),B=n,_=!0,g(r.tree),ne(B,p()))):_&&o===null&&(B=r.tree.sheet.copy(),r.tree.clear(),g(r.tree),ne(B,p()))}function Fo(e){const t=new a(e.x-s.x,e.y-s.y);if(_){const n=r.tree.getLowestNode(t);n!==null&&n instanceof c?n.remove(t):r.tree.clear(),g(r.tree)}B=null,_=!1}function Xo(){_&&B!==null&&ve(r.tree,B),B=null,_=!1,g(r.tree)}let ce,q=null,Fe,Ft=new a(1,1);function Ho(e){if(ce=new a(e.x-s.x,e.y-s.y),q=r.tree.getLowestNode(ce),q instanceof c&&q.ellipse!==null){Fe=!0;const t=r.tree.getLowestParent(ce);t!==null&&t.remove(ce);for(let n=0;n<q.children.length;n++)r.tree.insert(q.children[n]);Ft=mn(q,ce),q.children=[]}}function qo(e){if(Fe){const t=new a((e.x-s.x-ce.x)/2,(e.y-s.y-ce.y)/2);if(q instanceof c){const n=ht(q,t,Ft);if(n.ellipse!==null){g(r.tree);const i=r.tree.canInsert(n)&&ge(n.ellipse)?x():p();I(i,"cursor: crosshair","cursor: no-drop"),R(n,i)}}}}function zo(e){if(d("cursor: default"),Fe){const t=new a((e.x-s.x-ce.x)/2,(e.y-s.y-ce.y)/2);if(q instanceof c){const n=ht(q,t,Ft);n.ellipse!==null&&(r.tree.canInsert(n)&&ge(n.ellipse)?r.tree.insert(n):r.tree.insert(q))}g(r.tree),Fe=!1}}function Yo(){d("cursor: default"),Fe&&q!==null&&r.tree.insert(q),Fe=!1,g(r.tree)}let Xe,$=null,He,Je;const Uo=document.getElementById("selectionString");function Vo(e){Je=new D(r.tree.sheet),r.selectForProof.sheet=new D().sheet,Xe=new a(e.x-s.x,e.y-s.y),$=r.tree.getLowestNode(Xe),Sn()}function Go(e){He&&(g(r.tree),Xe=new a(e.x-s.x,e.y-s.y),$=r.tree.getLowestNode(Xe),Sn())}function Wo(){if(d("cursor: default"),He&&$!==null){if($ instanceof c&&$.ellipse===null)for(let e=0;e<$.children.length;e++)r.selectForProof.insert($.children[e]);else r.selectForProof.insert($);g(r.tree)}$=null,He=!1}function jo(){d("cursor: default"),$=null,He=!1,g(r.tree)}function Sn(){const e=new D;let t=!1;if($!==null){if(He=!0,$ instanceof f||!$.isEqualTo(Je.sheet)){e.insert($);const n=Je.getLowestParent(Xe);n!==null&&(n.remove(Xe),t=!0),g(Je)}else e.sheet=$,tt();ne($,x()),d("cursor: copy"),t&&Je.insert($)}else He=!1;Uo.innerHTML=e.toString()}function Q(){const e=new D;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function qe(e,t){return e.canInsert(t)&&Pn(new D(e.sheet),t)}function Pn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new D(r.currentProofStep.tree.sheet))):!1}let _t,Xt;function Jo(){_t=Q(),Xt=!0,tt(),ne(_t.sheet,p())}function Ko(){Xt&&(It(-1),r.clearProof(),m())}function Zo(){Xt=!1,m()}const Qo=document.getElementById("showRect");let ut,pt,Te;function _o(){d("cursor: crosshair")}function er(e){ut=new a(e.clientX-s.x,e.clientY-s.y),Te=Q(),pt=!1}function tr(e){const t=new a(e.clientX-s.x,e.clientY-s.y),n=new c(gt(ut,t)),o=new c(En(n.ellipse));if(m(),!pt&&n.ellipse!==null&&o.ellipse!==null){const u=Te.canInsert(n)&&ge(n.ellipse)&&Te.canInsert(o)&&ge(o.ellipse)?x():p();R(n,u),R(o,u),I(u,"cursor: crosshair","cursor: no-drop"),Qo.checked&&yn(ut,t,u)}}function nr(e){d("cursor: crosshair");const t=new a(e.clientX-s.x,e.clientY-s.y);Te=Q();const n=new c(gt(ut,t)),o=new c(En(n.ellipse)),i=new U(Te,"DC Insert");!pt&&n.ellipse!==null&&o.ellipse!==null&&Te.canInsert(n)&&ge(n.ellipse)&&Te.canInsert(o)&&ge(o.ellipse)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),m()}function or(){d("cursor: default"),pt=!0,m()}function En(e){return new ae(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let fe,W=null,_e,Se,$e;function rr(e){fe=new a(e.x-s.x,e.y-s.y),Se=Q(),$e=new D(Se.sheet),W=Se.getLowestNode(fe),Cn()}function ir(e){fe=new a(e.x-s.x,e.y-s.y),$e=new D(Se.sheet),W!==null&&(W=Se.getLowestNode(fe),m(),Cn())}function lr(e){const t=new U(Se,"DC Delete");if(fe=new a(e.x-s.x,e.y-s.y),_e&&W instanceof c){const n=t.tree.getLowestParent(fe),o=W.children[0];if(n!==null&&o instanceof c){n.remove(fe);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}m()}function sr(){_e&&W!==null&&ve($e,W),W=null,_e=!1,m()}function ar(e){return e.children.length===1&&e.children[0]instanceof c&&W!==Se.sheet}function cr(e){R(e,p()),e.children[0]instanceof c&&R(e.children[0],p())}function Cn(){if(W instanceof c&&ar(W)){_e=!0;const e=$e.getLowestParent(fe);if(e!==null){e.remove(fe);const t=W.children[0].copy();rt($e,t),t.children=[]}g($e),cr(W)}else _e=!1}let me,E=null,Ie,j;function ur(e){if(j=Q(),me=new a(e.x-s.x,e.y-s.y),E=j.getLowestNode(me),E!==j.sheet&&E!==null){d("cursor: grabbing");const t=j.getLowestParent(me);if(t!==null&&t.remove(me),E instanceof c&&E.children.length!==0){for(let n=0;n<E.children.length;n++)j.insert(E.children[n]);E.children=[]}Ie=!0,g(j),E instanceof f?F(E,x(),!0):R(E,x())}else Ie=!1}function fr(e){if(Ie){const t=new a(e.x-me.x,e.y-me.y);if(g(j),E instanceof c){const n=Z(E,t),o=qe(j,n)?x():p();R(n,o),I(o,"cursor: grabbing","cursor: no-drop")}else if(E instanceof f){const n=k(E,t),o=qe(j,n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function dr(e){if(Ie){d("cursor: default");const t=new U(j,"Single Move"),n=new a(e.x-me.x,e.y-me.y);let o=null;E instanceof c?o=Z(E,n):E instanceof f&&(o=k(E,n)),o!==null&&qe(j,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Ie=!1}function hr(){d("cursor: default"),Ie&&E!==null&&j.insert(E),Ie=!1,m()}let xe,X=null,Pt=null,Le,ee;function gr(e){ee=Q(),xe=new a(e.x-s.x,e.y-s.y),X=ee.getLowestNode(xe),X!==ee.sheet&&X!==null?(d("cursor: grabbing"),Pt=ee.getLowestParent(xe),Pt!==null&&Pt.remove(xe),Le=!0,g(ee),ne(X,x())):Le=!1}function wr(e){if(Le){const t=new a(e.x-xe.x,e.y-xe.y);if(g(ee),X instanceof c){const n=Rt(X,t),o=qe(ee,n)?x():p();Y(X,o,t),I(o,"cursor: grabbing","cursor: no-drop")}else if(X instanceof f){const n=k(X,t),o=qe(ee,n)?x():p();F(n,o,!0),I(o,"cursor: grabbing","cursor: no-drop")}}}function pr(e){if(Le){d("cursor: default");const t=new U(ee,"Multi Move"),n=new a(e.x-xe.x,e.y-xe.y);let o=null;X instanceof c?o=Rt(X,n):X instanceof f&&(o=k(X,n)),o!==null&&qe(ee,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Le=!1}function yr(){d("cursor: default"),Le&&X!==null&&ee.insert(X),Le=!1,m()}let Pe,O=null,vt=null,ze,ie;function mr(e){ie=Q(),Pe=new a(e.x-s.x,e.y-s.y),O=ie.getLowestNode(Pe),vt=ie.getLowestParent(Pe),ze=O!==ie.sheet&&O!==null,ze&&d("cursor: copy")}function xr(e){if(ze){const t=new a(e.x-Pe.x,e.y-Pe.y);m();const n=new a(e.x-s.x,e.y-s.y),o=kn(t,n)?x():p();if(O instanceof c)Y(O,o,t);else if(O instanceof f){const i=k(O,t);F(i,o,!0)}I(o,"cursor: grabbing","cursor: no-drop")}}function Mr(e){if(ze){d("cursor: default");const t=new a(e.x-Pe.x,e.y-Pe.y);if(kn(t,new a(e.x-s.x,e.y-s.y))){if(O instanceof c)ot(O,t,ie);else if(O instanceof f){const n=k(O,t);ie.insert(n)}r.pushToProof(new U(ie,"Iteration"))}}m(),ze=!1}function br(){d("cursor: default"),ze=!1,m()}function kn(e,t){return vt!==null&&vt.containsPoint(t)&&(O instanceof c&&be(ie,O,e)&&In(ie.sheet,Z(O,e).ellipse)||O instanceof f&&ie.canInsert(k(O,e)))}function In(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof c){if(e.children[n].ellipse instanceof ae&&(t.contains(e.children[n].ellipse)||!In(e.children[n],t)))return!1}else if(e.children[n]instanceof f&&t.contains(e.children[n].calcRect()))return!1;return!0}let de,C=null,Ye,te,Ke;function Tr(e){de=new a(e.x-s.x,e.y-s.y),te=Q(),Ke=new D(te.sheet),C=te.getLowestNode(de),Ln()}function Sr(e){de=new a(e.x-s.x,e.y-s.y),C!==null&&(C=te.getLowestNode(de),m(),Ln())}function Pr(e){if(Ye&&(de=new a(e.x-s.x,e.y-s.y),C!==null&&Ht(te.sheet,te.getLevel(C)))){const t=te.getLowestParent(de);t instanceof c&&t.remove(de),r.pushToProof(new U(te,"Deiteration"))}Ye=!1,m()}function Er(){Ye&&C!==null&&ve(Ke,C),Ye=!1,C=null,m()}function Ln(){if(C!==null&&!(C instanceof c&&C.ellipse===null)&&Ht(te.sheet,te.getLevel(C))){Ye=!0;const e=Ke.getLowestParent(de);e!==null&&e.remove(de),g(Ke),ne(C,p()),Ke.insert(C)}else Ye=!1}function Ht(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof c&&C instanceof c&&C.isEqualTo(e.children[o])&&C.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof f&&C instanceof f&&e.children[o].identifier===C.identifier&&e.children[o].toString()!==C.toString())return!0;e.children[o]instanceof c&&e.children[o].containsNode(C)&&te.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Ht(n,t):!1}let b,L,z,A,Ue;function Cr(e){z=Q();const t=r.selectForProof.sheet.children,n=new a(e.x-s.x,e.y-s.y);if(r.proof.length>0&&t.length===1){Ue=!0,b=t[0];const o=qt(e,b),i=z.getLowestNode(n),u=z.getLowestParent(n);if(L=i instanceof f?u:i,o){const w=Qe(b,o);if(L!==null&&!L.containsNode(w))d("cursor: no-drop"),A=!1,Y(b,p(),o);else if(L!==null&&L instanceof c&&L.ellipse!==null&&z.getLevel(L)%2===0){if(w instanceof c){A=!0;for(let h=0;h<L.children.length;h++)if(w.containsNode(L.children[h])){A=!1;break}}else A=!0;if(A){let h="";if(b instanceof c)h=be(z,b,o)?x():p();else if(b instanceof f){const y=Qe(b,o);h=z.canInsert(y)?x():p()}A=h===x(),Y(b,h,o),I(h,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),Y(b,p(),o)}else d("cursor: no-drop"),A=!1,Y(b,p(),o)}}else A=!1,Ue=!1,Y(b,p(),n)}function kr(e){if(Ue){const t=new a(e.x-s.x,e.y-s.y);m();const n=qt(e,b),o=z.getLowestNode(t),i=z.getLowestParent(t);if(L=o instanceof f?i:o,n){const u=Qe(b,n);if(L!==null&&!L.containsNode(u))d("cursor: no-drop"),A=!1,Y(b,p(),n);else if(L!==null&&L instanceof c&&L.ellipse!==null&&z.getLevel(L)%2===0){if(u instanceof c){A=!0;for(let w=0;w<L.children.length;w++)if(u.containsNode(L.children[w])){A=!1;break}}else A=!0;if(A){let w="";if(b instanceof c)w=be(z,b,n)?x():p();else if(b instanceof f){const h=Qe(b,n);w=z.canInsert(h)?x():p()}A=w===x(),Y(b,w,n),I(w,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),Y(b,p(),n)}else d("cursor: no-drop"),A=!1,Y(b,p(),n)}}else A=!1}function Ir(e){if(d("cursor: default"),Ue&&A){const t=qt(e,b);if(t){if(b instanceof c)ot(b,t,z);else if(b instanceof f){const n=Qe(b,t);z.insert(n)}r.pushToProof(new U(z,"Insertion"))}}m(),Ue=!1}function Lr(){d("cursor: default"),Ue=!1,m()}function qt(e,t){if(t instanceof c&&t.ellipse!==null)return new a(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof f)return new a(e.x-t.origin.x,e.y-t.origin.y)}let he,K=null,Ve,Ee,Ze;function vr(e){he=new a(e.x-s.x,e.y-s.y),Ee=Q(),Ze=new D(Ee.sheet),K=Ee.getLowestNode(he),vn()}function Dr(e){he=new a(e.x-s.x,e.y-s.y),K!==null&&(K=Ee.getLowestNode(he),m(),vn())}function Ar(e){if(Ve){const t=new U(Ee,"Erasure");he=new a(e.x-s.x,e.y-s.y);const n=t.tree.getLowestParent(he);n!==null&&n.remove(he),r.pushToProof(t),m()}K=null,Ve=!1}function $r(){Ve&&K!==null&&ve(Ze,K),K=null,Ve=!1,m()}function vn(){if(K!==Ee.sheet&&K!==null&&Ee.getLevel(K)%2===0){Ve=!0;const e=Ze.getLowestParent(he);e!==null&&e.remove(he),g(Ze),ne(K,p()),Ze.insert(K)}else Ve=!1}let ue,V=null,Ge,zt=new a(1,1),le;function Br(e){if(le=Q(),ue=new a(e.x-s.x,e.y-s.y),V=le.getLowestNode(ue),V instanceof c&&V.ellipse!==null){Ge=!0;const t=le.getLowestParent(ue);t!==null&&t.remove(ue);for(let n=0;n<V.children.length;n++)le.insert(V.children[n]);zt=mn(V,ue),V.children=[]}}function Nr(e){if(Ge){const t=new a((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof c){const n=ht(V,t,zt);if(n.ellipse!==null){g(le);const o=Dn(n)?x():p();R(n,o),I(o,"cursor: crosshair","cursor: no-drop")}}}}function Or(e){if(Ge){d("cursor: default");const t=new a((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof c){const n=ht(V,t,zt);n.ellipse!==null&&Dn(n)&&(le.insert(n),r.pushToProof(new U(le,"Resize")))}m(),Ge=!1}}function Rr(){d("cursor: default"),Ge&&V!==null&&le.insert(V),Ge=!1,m()}function Dn(e){return le.canInsert(e)&&ge(e.ellipse)&&Pn(new D(le.sheet),e)}let Dt,ft,et;function Fr(){ft=Q(),Dt=r.selectForProof.sheet,Dt.children.length>0&&r.proof.length===1&&ft.sheet.isEmptySheet()&&(et=!0,d("cursor: copy"))}function Xr(){d("cursor: default"),et=!1,m()}function Hr(){et&&(d("cursor: default"),ft.sheet=Dt,r.pushToProof(new U(ft,"Pasted"))),et=!1,m()}function qr(){d("cursor: default"),et=!1,m()}const se=document.getElementById("canvas");se.width=window.innerWidth;se.height=window.innerHeight;const An=se.getContext("2d");if(An===null)throw Error("2d rendering context not supported");const zr=An;zr.font="35pt arial";const Et=document.getElementById("cutTools"),en=document.getElementById("atomTools"),tn=document.getElementById("graphString"),nn=document.getElementById("proofString"),on=document.getElementById("toProofTools");window.addEventListener("keydown",Gr);se.addEventListener("mousedown",jr);se.addEventListener("mousemove",Jr);se.addEventListener("mouseup",Kr);se.addEventListener("mouseout",Zr);se.addEventListener("mouseenter",Wr);let Yt=!1,Ut=!0;window.tree=r.tree;window.treeString=yt(window.tree);window.atomTool=l.atomTool;window.cutTool=l.cutTool;window.dragTool=l.dragTool;window.aegStringify=yt;window.saveMode=$n;window.loadMode=Vr;window.drawMoveSingleTool=l.drawMoveSingleTool;window.drawMoveMultiTool=l.drawMoveMultiTool;window.copySingleTool=l.copySingleTool;window.copyMultiTool=l.copyMultiTool;window.deleteSingleTool=l.deleteSingleTool;window.deleteMultiTool=l.deleteMultiTool;window.copyFromDrawTool=l.copyFromDrawTool;window.pasteInProofTool=l.pasteInProofTool;window.doubleCutInsertionTool=l.doubleCutInsertionTool;window.resizeTool=l.resizeTool;window.doubleCutDeletionTool=l.doubleCutDeletionTool;window.insertionTool=l.insertionTool;window.erasureTool=l.erasureTool;window.proofMoveSingleTool=l.proofMoveSingleTool;window.proofMoveMultiTool=l.proofMoveMultiTool;window.proofResizeTool=l.proofResizeTool;window.iterationTool=l.iterationTool;window.deiterationTool=l.deiterationTool;window.proofClearTool=l.proofClearTool;window.drawClearTool=l.drawClearTool;window.setTool=Ur;window.setHighlight=Yr;window.toggleHandler=Kn;function Yr(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const rn=document.querySelectorAll(".toolButton");rn.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),rn.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Ur(e){switch(r.toolState=e,Et.style.display="none",en.style.display="none",on.style.display="none",r.toolState){case l.atomTool:en.style.display="block";break;case l.cutTool:Et.style.display="block";break;case l.copyFromDrawTool:on.style.display="block";break;case l.doubleCutInsertionTool:Et.style.display="block";break}}function yt(e){return JSON.stringify(e,null,"	")}async function $n(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Jn(n,t)}else{const n=document.createElement("a");n.href=yt(t),n.download=e+".json",n.click()}}catch{}}async function Vr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const u=Lt(r.modeState,o);if(r.modeState==="Draw")r.tree=u,g(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=u,(i=document.getElementById("Row: 1"))==null||i.remove();for(let w=0;w<r.proof.length;w++)xn(r.proof[w],w+1);r.currentProofStep=r.proof[r.proof.length-1],m()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}function Gr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),$n();else switch(r.toolState){case l.atomTool:oo(e);break}}function Wr(){switch(r.toolState){case l.cutTool:uo();break;case l.dragTool:Nn();break;case l.doubleCutInsertionTool:_o();break}Ut=!0}function jr(e){if(e.button===0){switch(r.toolState){case l.cutTool:fo(e);break;case l.atomTool:ro(e);break;case l.dragTool:On(e);break;case l.drawMoveSingleTool:po(e);break;case l.drawMoveMultiTool:Mo(e);break;case l.copySingleTool:Po(e);break;case l.copyMultiTool:Io(e);break;case l.deleteSingleTool:Ao(e);break;case l.deleteMultiTool:Oo(e);break;case l.resizeTool:Ho(e);break;case l.copyFromDrawTool:Vo(e);break;case l.pasteInProofTool:Fr();break;case l.doubleCutInsertionTool:er(e);break;case l.doubleCutDeletionTool:rr(e);break;case l.insertionTool:Cr(e);break;case l.erasureTool:vr(e);break;case l.proofMoveSingleTool:ur(e);break;case l.proofMoveMultiTool:gr(e);break;case l.proofResizeTool:Br(e);break;case l.iterationTool:mr(e);break;case l.deiterationTool:Tr(e);break;case l.proofClearTool:Jo();break;case l.drawClearTool:Zn();break}Yt=!0}}function Jr(e){if(Yt&&Ut)switch(r.toolState){case l.cutTool:ho(e);break;case l.atomTool:io(e);break;case l.dragTool:Rn(e);break;case l.drawMoveSingleTool:yo(e);break;case l.drawMoveMultiTool:bo(e);break;case l.copySingleTool:Eo(e);break;case l.copyMultiTool:Lo(e);break;case l.deleteSingleTool:$o(e);break;case l.deleteMultiTool:Ro(e);break;case l.resizeTool:qo(e);break;case l.copyFromDrawTool:Go(e);break;case l.pasteInProofTool:Xr();break;case l.doubleCutInsertionTool:tr(e);break;case l.doubleCutDeletionTool:ir(e);break;case l.insertionTool:kr(e);break;case l.erasureTool:Dr(e);break;case l.proofMoveSingleTool:fr(e);break;case l.proofMoveMultiTool:wr(e);break;case l.proofResizeTool:Nr(e);break;case l.iterationTool:xr(e);break;case l.deiterationTool:Sr(e);break}}function Kr(e){if(e.button===0){switch(r.toolState){case l.cutTool:go(e);break;case l.atomTool:lo(e);break;case l.dragTool:Fn();break;case l.drawMoveSingleTool:mo(e);break;case l.drawMoveMultiTool:To(e);break;case l.copySingleTool:Co(e);break;case l.copyMultiTool:vo(e);break;case l.deleteSingleTool:Bo(e);break;case l.deleteMultiTool:Fo(e);break;case l.resizeTool:zo(e);break;case l.copyFromDrawTool:Wo();break;case l.pasteInProofTool:Hr();break;case l.doubleCutInsertionTool:nr(e);break;case l.doubleCutDeletionTool:lr(e);break;case l.insertionTool:Ir(e);break;case l.erasureTool:Ar(e);break;case l.proofMoveSingleTool:dr(e);break;case l.proofMoveMultiTool:pr(e);break;case l.proofResizeTool:Or(e);break;case l.iterationTool:Mr(e);break;case l.deiterationTool:Pr(e);break;case l.proofClearTool:Ko();break;case l.drawClearTool:Qn();break}Yt=!1}}function Zr(){switch(r.toolState){case l.cutTool:wo();break;case l.atomTool:so();break;case l.dragTool:Xn();break;case l.drawMoveSingleTool:xo();break;case l.drawMoveMultiTool:So();break;case l.copySingleTool:ko();break;case l.copyMultiTool:Do();break;case l.deleteSingleTool:No();break;case l.deleteMultiTool:Xo();break;case l.resizeTool:Yo();break;case l.copyFromDrawTool:jo();break;case l.pasteInProofTool:qr();break;case l.doubleCutInsertionTool:or();break;case l.doubleCutDeletionTool:sr();break;case l.insertionTool:Lr();break;case l.erasureTool:$r();break;case l.proofMoveSingleTool:hr();break;case l.proofMoveMultiTool:yr();break;case l.proofResizeTool:Rr();break;case l.iterationTool:br();break;case l.deiterationTool:Er();break;case l.proofClearTool:Zo();break;case l.drawClearTool:_n();break}Ut=!1}function Qr(){se.width=window.innerWidth,se.height=window.innerHeight}window.onresize=Qr;
