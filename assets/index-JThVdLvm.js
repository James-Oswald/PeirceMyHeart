(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(i){if(i.ep)return;i.ep=!0;const u=n(i);fetch(i.href,u)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function De(e,t){return rn(e,t)||Be(t,e)}function rn(e,t){if(e instanceof me)return t instanceof me?Vt(e,t):qt(t,e);if(t instanceof me)return qt(e,t);if(Vt(e.boundingBox,t.boundingBox)||Be(t.boundingBox,e.boundingBox)){const n=sn(e);let o;for(let i=0;i<n.length;i++)if(o=rt(t,n[i]),o<=0)return!0;return!1}return!1}function qt(e,t){const n=t.getCorners(),o=Ge(e,n[0].x,1),i=Ge(e,n[1].x,1),u=Ge(e,n[0].x,-1),g=Ge(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<u&&u<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<g&&g<n[2].y)return!0;const M=-1/Math.pow(e.radiusX,2),v=2*e.center.x/Math.pow(e.radiusX,2),Le=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),Ut=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),gt=(-v+Math.sqrt(Math.pow(v,2)-4*M*Le))/(2*M),yt=(-v-Math.sqrt(Math.pow(v,2)-4*M*Le))/(2*M),mt=(-v+Math.sqrt(Math.pow(v,2)-4*M*Ut))/(2*M),xt=(-v-Math.sqrt(Math.pow(v,2)-4*M*Ut))/(2*M);return!isNaN(gt)&&n[0].x<gt&&gt<n[1].x||!isNaN(yt)&&n[0].x<yt&&yt<n[1].x||!isNaN(mt)&&n[0].x<mt&&mt<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x}function Be(e,t){if(e instanceof me)if(t instanceof me){const n=t.getCorners();for(let o=0;o<4;o++)if(!kt(e,n[o]))return!1;return!0}else{const n=vn(t);for(let o=0;o<4;o++)if(!kt(e,n[o]))return!1;return!0}else if(t instanceof me){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=rt(e,n[i]),!(o<0))return!1;return!0}else{const n=sn(t);let o;for(let i=0;i<n.length;i++)if(o=rt(e,n[i]),!(o<0))return!1;return!0}}function Vt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function kt(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function rt(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function vn(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function sn(e){const t=[];let n,o,i=1;for(let u=0;u<360;u++)n=e.center.x+e.radiusX*Math.cos(u*(Math.PI/180)),u>180&&(i=-1),o=Ge(e,n,i),t[u]=new c(n,o);return t}function Ge(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class me{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return kt(this,t)}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class f{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new f(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new me(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class se{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new me(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return rt(this,t)<0}overlaps(t){return De(this,t)}contains(t){return Be(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new se(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof f,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof f?Be(this.internalEllipse,t.calcRect()):Be(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof f||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof f||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof f)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let u=0;u<o.length;u++){if(n[i]instanceof f&&o[u]instanceof f&&n[i].isEqualTo(o[u])||n[i]instanceof a&&o[u]instanceof a&&n[i].isEqualTo(o[u])){n.splice(i,1),o.splice(u,1),i--;break}if(u===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof f?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class ${constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof f?t.calcRect():t.ellipse,i=n instanceof f?n.calcRect():n.ellipse;return rn(o,i)}overlaps(t,n){let o,i;return t instanceof f?n instanceof f?De(t.calcRect(),n.calcRect()):(o=n.ellipse,De(t.calcRect(),o)):n instanceof f?(o=t.ellipse,De(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,De(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class Y{constructor(t,n){this.appliedRule=n??"",this.tree=new $(t==null?void 0:t.sheet),this.index=r.proof.length}}var s=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.moveSingleTool=4]="moveSingleTool",e[e.moveMultiTool=5]="moveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.clearProofTool=22]="clearProofTool",e))(s||{});const ee=class ee{static getLastProofStep(){return ee.proof.length===0?new Y(new $):ee.proof[ee.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;It(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),yn(t)}static clearProof(){It(-1),this.proof=[],this.pushToProof(new Y),this.currentProofStep=this.proof[0]}};ee.tree=new $,ee.proof=[],ee.selectForProof=new $,ee.toolState=0,ee.modeState="Draw";let r=ee,Et,l=new c(0,0),$t;function Bn(){d("cursor: grab")}function Nn(e){d("cursor: grabbing"),Et=new c(e.x-l.x,e.y-l.y),$t=!1}function On(e){$t||(d("cursor: grabbing"),l=new c(e.x-Et.x,e.y-Et.y),ln())}function Rn(){d("cursor: grab")}function An(){d("cursor: default"),$t=!0,ln()}function ln(){r.modeState==="Proof"?w():h(r.tree)}const Fn=document.getElementById("theme-select");function $e(e){return getComputedStyle(document.body).getPropertyValue(e)}let cn=$e("--good-placement"),an=$e("--bad-placement"),un=$e("--canvas-items");function fn(){setTimeout(()=>{cn=$e("--good-placement"),an=$e("--bad-placement"),un=$e("--canvas-items"),r.modeState==="Draw"?h(r.tree):w()})}Fn.addEventListener("input",()=>{fn()});window.addEventListener("DOMContentLoaded",()=>{fn()});function p(){return an}function y(){return cn}function dn(){return un}const it=document.getElementById("canvas"),hn=it.getContext("2d");if(hn===null)throw Error("2d rendering context not supported.");const T=hn;T.font="35pt arial";const Xn=document.getElementById("graphString"),Hn=document.getElementById("proofString"),zn=document.getElementById("atomBox"),pn=document.getElementById("atomBoxes");pn.addEventListener("input",Un);function R(e,t){const n=e.ellipse;if(n!==null){T.strokeStyle=t;const o=n.center;T.beginPath(),T.ellipse(o.x+l.x,o.y+l.y,n.radiusX,n.radiusY,0,0,2*Math.PI),T.stroke()}}function A(e,t,n){T.textBaseline="bottom";const o=T.measureText(e.identifier);T.fillStyle=t,T.strokeStyle=t,T.beginPath(),T.fillText(e.identifier,e.origin.x+l.x,e.origin.y+l.y),(pn.checked||zn.checked&&n)&&T.rect(e.origin.x+l.x,e.origin.y+l.y-o.actualBoundingBoxAscent,e.width,e.height),T.stroke()}function wn(e,t,n){T.beginPath(),T.strokeStyle=n;const o=e.x-t.x+l.x,i=e.y-t.y+l.y;T.rect(e.x,e.y,-o,-i),T.stroke()}function d(e){it.style.cssText=e}function Yn(e,t,n){return e===y()?t:n}function E(e,t,n){d(Yn(e,t,n))}function Un(){h(r.tree)}function at(){T.clearRect(0,0,it.width,it.height)}function h(e,t){Xn.innerHTML=e.toString(),at(),vt(e.sheet,t),window.treeString=wt(e)}function vt(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof f?qn(e.children[n]):vt(e.children[n]);e.ellipse instanceof se&&(T.strokeStyle=t||dn(),T.beginPath(),T.ellipse(e.ellipse.center.x+l.x,e.ellipse.center.y+l.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),T.stroke())}function qn(e){A(e,dn(),!1)}function w(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new $:e=r.currentProofStep.tree,at(),Hn.innerHTML=e.toString(),vt(e.sheet)}function re(e,t){if(e instanceof f)A(e,t,!1);else if(e instanceof a){R(e,t);for(let n=0;n<e.children.length;n++)re(e.children[n],t)}}function gn(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function yn(e,t){var g;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Vn(e)};const u=document.createElement("Text");u.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(u),n.appendChild(i),(g=document.getElementById("proofHistoryBar"))==null||g.appendChild(n)}function Vn(e){r.currentProofStep=e,w()}function It(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}async function Gn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Ct(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Gt(o)}else{const o=[];let i;for(i of n){const u=i.tree.internalSheet.internalChildren;o.push(new Y(Gt(u),i.appliedRule))}return o}}function Gt(e){const t=new $,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(mn(o)):n.push(xn(o));return t.sheet.children=n,t}function mn(e){const t=new se(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(mn(o)):n.push(xn(o));return new a(t,n)}function xn(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new f(t,n,e.internalWidth,e.internalHeight)}let Mt=!0,bt=null,Tt=null,Wt=s.none,jt=s.none;const Jt=document.getElementById("DrawButtons"),Kt=document.getElementById("ProofButtons"),Zt=document.getElementById("proofHistoryBar");function Wn(){if(Mt=!Mt,Mt){Jt.style.display="block",en.style.display="block",Kt.style.display="none",tn.style.display="none",Zt.style.display="none",r.modeState="Draw",Tt=JSON.stringify(r.proof),jt=r.toolState;let e=null;if(bt!==null&&(e=Ct(r.modeState,bt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=Wt,h(r.tree)}else{Jt.style.display="none",en.style.display="none",Kt.style.display="block",tn.style.display="block",Zt.style.display="block",r.modeState="Proof",bt=JSON.stringify(r.tree),Wt=r.toolState,r.proof.length===0&&r.pushToProof(new Y);let e=null;Tt!==null&&(e=Ct(r.modeState,Tt)),e!==null&&(r.proof=e),r.toolState=jt,w()}}const jn=document.getElementById("mode");function xe(e,t,n){if(t.ellipse!==null){const o=J(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!xe(e,t.children[o],n))return!1;if(t.children[o]instanceof f){let i=t.children[o];if(i=k(i,n),!e.canInsert(i))return!1}}return!0}function z(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=J(e,n);if(R(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)z(e.children[i],t,n)}else if(e instanceof f){const o=k(e,n);A(o,t,!0)}}function _e(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=J(e,t);if(o.insert(i),e.children.length!==0)for(let u=0;u<e.children.length;u++)_e(e.children[u],t,n)}else if(e instanceof f){const i=k(e,t);o.insert(i)}}function Ke(e,t){return e instanceof f?k(e,t):J(e,t)}function J(e,t){if(e.ellipse!==null)return new a(new se(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Bt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(Bt(e.children[o],t)):e.children[o]instanceof f&&n.push(k(e.children[o],t));return new a(new se(new c(e.ellipse.center.x+t.x-l.x,e.ellipse.center.y+t.y-l.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function k(e,t){return new f(e.identifier,new c(e.origin.x+t.x-l.x,e.origin.y+t.y-l.y),e.width,e.height)}function ut(e,t,n){if(e.ellipse!==null)return new a(new se(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),Math.abs(e.ellipse.radiusX+t.x*n.x),Math.abs(e.ellipse.radiusY+t.y*n.y)));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function et(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function Ce(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&et(e,t),h(e))}function ft(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,u=Math.abs(o),g=Math.abs(i);let M,v;if(jn.value==="circumscribed"){const Le=Math.floor(n.distance(t));v=Math.floor(Le*(g/u)),M=Math.floor(Le*(u/g))}else M=u/2,v=g/2;return new se(n,M,v)}function de(e){return e.radiusX>15&&e.radiusY>15}const Jn=document.getElementById("showRect");let st,dt;function Kn(){d("cursor: crosshair")}function Zn(e){st=new c(e.clientX-l.x,e.clientY-l.y),dt=!1}function Qn(e){const t=new a(new se(new c(0,0),0,0)),n=new c(e.clientX-l.x,e.clientY-l.y);if(h(r.tree),t.ellipse=ft(st,n),!dt){const i=r.tree.canInsert(t)&&de(t.ellipse)?y():p();E(i,"cursor: crosshair","cursor: no-drop"),R(t,i),Jn.checked&&wn(st,n,i)}}function _n(e){d("cursor: default");const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(ft(st,t));r.tree.canInsert(n)&&!dt&&de(n.ellipse)&&r.tree.insert(n),h(r.tree)}function eo(){d("cursor: default"),dt=!0,h(r.tree)}const to=document.getElementById("canvas"),Mn=to.getContext("2d");if(Mn===null)throw Error("2d rendering context not supported.");const no=Mn,oo=document.getElementById("atomDisplay");let ht,Nt,N=tt("A",new c(0,0));function ro(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=tt(e.key,new c(N.origin.x,N.origin.y)),N.origin.x!==0&&N.origin.y!==0&&Nt&&Ot())}function io(e){ht=!1,Nt=!0,N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Ot()}function so(e){N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),Ot()}function lo(e){d("cursor: default"),N=tt(N.identifier,new c(e.clientX-l.x,e.clientY-l.y)),r.tree.canInsert(N)&&!ht&&r.tree.insert(N),h(r.tree),Nt=!1}function co(){d("cursor: default"),ht=!0,h(r.tree)}function tt(e,t){oo.innerHTML=e;const n=no.measureText(e);return new f(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Ot(){h(r.tree),ht||(r.tree.canInsert(N)?(d("cursor: default"),A(N,y(),!0)):(d("cursor: no-drop"),A(N,p(),!0)))}let he,b=null,Se;function ao(e){if(he=new c(e.x-l.x,e.y-l.y),b=r.tree.getLowestNode(he),b!==r.tree.sheet&&b!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(he);if(t!==null&&t.remove(he),b instanceof a&&b.children.length!==0){for(let n=0;n<b.children.length;n++)r.tree.insert(b.children[n]);b.children=[]}Se=!0,h(r.tree),b instanceof f?A(b,y(),!0):R(b,y())}else Se=!1}function uo(e){if(Se){const t=new c(e.x-he.x,e.y-he.y);if(b instanceof a){const n=J(b,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();R(n,o),E(o,"cursor: grabbing","cursor: no-drop")}else if(b instanceof f){const n=k(b,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function fo(e){if(d("cursor: default"),Se){const t=new c(e.x-he.x,e.y-he.y);if(b instanceof a){const n=J(b,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(b)}else if(b instanceof f){const n=k(b,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(b)}h(r.tree)}Se=!1}function ho(){d("cursor: default"),Se&&b!==null&&r.tree.insert(b),Se=!1,h(r.tree)}let pe,C=null,ke;function po(e){if(pe=new c(e.x-l.x,e.y-l.y),C=r.tree.getLowestNode(pe),C!==r.tree.sheet&&C!==null){d("cursor: grabbing");const t=r.tree.getLowestParent(pe);t!==null&&t.remove(pe),ke=!0,h(r.tree),re(C,y())}else ke=!1}function wo(e){if(ke){const t=new c(e.x-pe.x,e.y-pe.y);if(h(r.tree),C instanceof a){const n=xe(r.tree,C,t)?y():p();z(C,n,t),E(n,"cursor: grabbing","cursor: no-drop")}else if(C instanceof f){const n=k(C,t),o=r.tree.canInsert(n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function go(e){if(d("cursor: default"),ke){const t=new c(e.x-pe.x,e.y-pe.y);if(C instanceof a)xe(r.tree,C,t)?_e(C,t):r.tree.insert(C);else if(C instanceof f){const n=k(C,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(C)}}h(r.tree),ke=!1}function yo(){d("cursor: default"),ke&&C!==null&&r.tree.insert(C),ke=!1,h(r.tree)}let we,W=null,Ne;function mo(e){we=new c(e.x-l.x,e.y-l.y);const t=r.tree.getLowestNode(we),n=new c(e.x-we.x,e.y-we.y);t!==r.tree.sheet&&t!==null?(d("cursor: copy"),t instanceof a?(W=J(t,n),W.children=[]):t instanceof f&&(W=t),Ne=!0):Ne=!1}function xo(e){if(Ne){const t=new c(e.x-we.x,e.y-we.y);if(W instanceof a){const n=J(W,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();R(n,o),E(o,"cursor: grabbing","cursor: no-drop")}else if(W instanceof f){const n=k(W,t);h(r.tree);const o=r.tree.canInsert(n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function Mo(e){if(d("cursor: default"),Ne){const t=new c(e.x-we.x,e.y-we.y);if(W instanceof a&&W.ellipse!==null){const n=J(W,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(W instanceof f){const n=k(W,t);r.tree.canInsert(n)&&r.tree.insert(n)}h(r.tree)}Ne=!1}function bo(){d("cursor: default"),Ne=!1,h(r.tree)}let Oe,q=null,Re;function To(e){Oe=new c(e.x-l.x,e.y-l.y),q=r.tree.getLowestNode(Oe),q!==r.tree.sheet&&q!==null?(d("cursor: copy"),Re=!0):Re=!1}function Po(e){if(Re){const t=new c(e.x-Oe.x,e.y-Oe.y);if(h(r.tree),q instanceof a){const n=xe(r.tree,q,t)?y():p();z(q,n,t),E(n,"cursor: grabbing","cursor: no-drop")}else if(q instanceof f){const n=k(q,t),o=r.tree.canInsert(n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function So(e){if(d("cursor: default"),Re){const t=new c(e.x-Oe.x,e.y-Oe.y);if(q instanceof a)xe(r.tree,q,t)&&_e(q,t);else if(q instanceof f){const n=k(q,t);r.tree.canInsert(n)&&r.tree.insert(n)}}h(r.tree),Re=!1}function ko(){d("cursor: default"),Re=!1,h(r.tree)}let nt,x=null,te;function Eo(e){if(nt=new c(e.x-l.x,e.y-l.y),x=r.tree.getLowestNode(nt),x!==null){const t=r.tree.getLowestParent(nt);t!==null&&t.remove(nt),x instanceof a&&x.children.length!==0&&x!==r.tree.sheet&&et(r.tree,x),h(r.tree),x instanceof f?A(x,p(),!0):R(x,p()),te=!0}else te=!1}function Io(e){te&&x!==null&&x.ellipse!==null&&Ce(r.tree,x);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);te&&x!==null&&o!==null&&(te=!0,h(r.tree),n===null?(x=null,te=!1):(o.remove(t),x=n,x instanceof a&&x.children.length!==0&&(et(r.tree,x),x.children=[]),h(r.tree),x instanceof f?A(x,p(),!0):R(x,p())))}function Co(e){const t=new c(e.x-l.x,e.y-l.y);if(te){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&et(r.tree,n),h(r.tree)}x=null,te=!1}function Lo(){te&&x!==null&&Ce(r.tree,x),x=null,te=!1,h(r.tree)}let ot,B=null,Z;function Do(e){if(ot=new c(e.x-l.x,e.y-l.y),B=r.tree.getLowestNode(ot),B!==null){const t=r.tree.getLowestParent(ot);t!==null?t.remove(ot):(B=r.tree.sheet.copy(),r.tree.clear()),Z=!0,h(r.tree),re(B,p())}}function $o(e){Z&&B!==null&&Ce(r.tree,B);const t=new c(e.x-l.x,e.y-l.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);Z&&B!==null&&o!==null?(Z=!0,n===null?(B=null,Z=!1):(o.remove(t),B=n,Z=!0,h(r.tree),re(B,p()))):Z&&o===null&&(B=r.tree.sheet.copy(),r.tree.clear(),h(r.tree),re(B,p()))}function vo(e){const t=new c(e.x-l.x,e.y-l.y);if(Z){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),h(r.tree)}B=null,Z=!1}function Bo(){Z&&B!==null&&Ce(r.tree,B),B=null,Z=!1,h(r.tree)}let Ae,D=null,Fe,We;const No=document.getElementById("selectionString");function Oo(e){We=new $(r.tree.sheet),r.selectForProof.sheet=new $().sheet,Ae=new c(e.x-l.x,e.y-l.y),D=r.tree.getLowestNode(Ae),bn()}function Ro(e){Fe&&(h(r.tree),Ae=new c(e.x-l.x,e.y-l.y),D=r.tree.getLowestNode(Ae),bn())}function Ao(){if(d("cursor: default"),Fe&&D!==null){if(D instanceof a&&D.ellipse===null)for(let e=0;e<D.children.length;e++)r.selectForProof.insert(D.children[e]);else r.selectForProof.insert(D);h(r.tree)}D=null,Fe=!1}function Fo(){d("cursor: default"),D=null,Fe=!1,h(r.tree)}function bn(){const e=new $;let t=!1;if(D!==null){if(Fe=!0,D instanceof f||!D.isEqualTo(We.sheet)){e.insert(D);const n=We.getLowestParent(Ae);n!==null&&(n.remove(Ae),t=!0),h(We)}else e.sheet=D,at();re(D,y()),d("cursor: copy"),t&&We.insert(D)}else Fe=!1;No.innerHTML=e.toString()}function K(){const e=new $;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function Xe(e,t){return e.canInsert(t)&&Tn(new $(e.sheet),t)}function Tn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new $(r.currentProofStep.tree.sheet))):!1}const Xo=document.getElementById("showRect");let lt,pt,Me;function Ho(){d("cursor: crosshair")}function zo(e){lt=new c(e.clientX-l.x,e.clientY-l.y),Me=K(),pt=!1}function Yo(e){const t=new c(e.clientX-l.x,e.clientY-l.y),n=new a(ft(lt,t)),o=new a(Pn(n.ellipse));if(w(),!pt&&n.ellipse!==null&&o.ellipse!==null){const u=Me.canInsert(n)&&de(n.ellipse)&&Me.canInsert(o)&&de(o.ellipse)?y():p();R(n,u),R(o,u),E(u,"cursor: crosshair","cursor: no-drop"),Xo.checked&&wn(lt,t,u)}}function Uo(e){d("cursor: crosshair");const t=new c(e.clientX-l.x,e.clientY-l.y);Me=K();const n=new a(ft(lt,t)),o=new a(Pn(n.ellipse)),i=new Y(Me,"DC Insert");!pt&&n.ellipse!==null&&o.ellipse!==null&&Me.canInsert(n)&&de(n.ellipse)&&Me.canInsert(o)&&de(o.ellipse)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),w()}function qo(){d("cursor: default"),pt=!0,w()}function Pn(e){return new se(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}let ae,V=null,Ze,be,ve;function Vo(e){ae=new c(e.x-l.x,e.y-l.y),be=K(),ve=new $(be.sheet),V=be.getLowestNode(ae),Sn()}function Go(e){ae=new c(e.x-l.x,e.y-l.y),ve=new $(be.sheet),V!==null&&(V=be.getLowestNode(ae),w(),Sn())}function Wo(e){const t=new Y(be,"DC Delete");if(ae=new c(e.x-l.x,e.y-l.y),Ze&&V instanceof a){const n=t.tree.getLowestParent(ae),o=V.children[0];if(n!==null&&o instanceof a){n.remove(ae);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}w()}function jo(){Ze&&V!==null&&Ce(ve,V),V=null,Ze=!1,w()}function Jo(e){return e.children.length===1&&e.children[0]instanceof a&&V!==be.sheet}function Ko(e){R(e,p()),e.children[0]instanceof a&&R(e.children[0],p())}function Sn(){if(V instanceof a&&Jo(V)){Ze=!0;const e=ve.getLowestParent(ae);if(e!==null){e.remove(ae);const t=V.children[0].copy();et(ve,t),t.children=[]}h(ve),Ko(V)}else Ze=!1}let m,I,H,L,He;function Zo(e){H=K();const t=r.selectForProof.sheet.children,n=new c(e.x-l.x,e.y-l.y);if(r.proof.length>0&&t.length===1){He=!0,m=t[0];const o=Rt(e,m),i=H.getLowestNode(n),u=H.getLowestParent(n);if(I=i instanceof f?u:i,o){const g=Ke(m,o);if(I!==null&&!I.containsNode(g))d("cursor: no-drop"),L=!1,z(m,p(),o);else if(I!==null&&I instanceof a&&I.ellipse!==null&&H.getLevel(I)%2===0){if(g instanceof a){L=!0;for(let M=0;M<I.children.length;M++)if(g.containsNode(I.children[M])){L=!1;break}}else L=!0;if(L){let M="";if(m instanceof a)M=xe(H,m,o)?y():p();else if(m instanceof f){const v=Ke(m,o);M=H.canInsert(v)?y():p()}L=M===y(),z(m,M,o),E(M,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),z(m,p(),o)}else d("cursor: no-drop"),L=!1,z(m,p(),o)}}else L=!1,He=!1,z(m,p(),n)}function Qo(e){if(He){const t=new c(e.x-l.x,e.y-l.y);w();const n=Rt(e,m),o=H.getLowestNode(t),i=H.getLowestParent(t);if(I=o instanceof f?i:o,n){const u=Ke(m,n);if(I!==null&&!I.containsNode(u))d("cursor: no-drop"),L=!1,z(m,p(),n);else if(I!==null&&I instanceof a&&I.ellipse!==null&&H.getLevel(I)%2===0){if(u instanceof a){L=!0;for(let g=0;g<I.children.length;g++)if(u.containsNode(I.children[g])){L=!1;break}}else L=!0;if(L){let g="";if(m instanceof a)g=xe(H,m,n)?y():p();else if(m instanceof f){const M=Ke(m,n);g=H.canInsert(M)?y():p()}L=g===y(),z(m,g,n),E(g,"cursor: copy","cursor: no-drop")}else d("cursor: no-drop"),z(m,p(),n)}else d("cursor: no-drop"),L=!1,z(m,p(),n)}}else L=!1}function _o(e){if(d("cursor: default"),He&&L){const t=Rt(e,m);if(t){if(m instanceof a)_e(m,t,H);else if(m instanceof f){const n=Ke(m,t);H.insert(n)}r.pushToProof(new Y(H,"Insertion"))}}w(),He=!1}function er(){d("cursor: default"),He=!1,w()}function Rt(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof f)return new c(e.x-t.origin.x,e.y-t.origin.y)}let ue,j=null,ze,Te,je;function tr(e){ue=new c(e.x-l.x,e.y-l.y),Te=K(),je=new $(Te.sheet),j=Te.getLowestNode(ue),kn()}function nr(e){ue=new c(e.x-l.x,e.y-l.y),j!==null&&(j=Te.getLowestNode(ue),w(),kn())}function or(e){if(ze){const t=new Y(Te,"Erasure");ue=new c(e.x-l.x,e.y-l.y);const n=t.tree.getLowestParent(ue);n!==null&&n.remove(ue),r.pushToProof(t),w()}j=null,ze=!1}function rr(){ze&&j!==null&&Ce(je,j),j=null,ze=!1,w()}function kn(){if(j!==Te.sheet&&j!==null&&Te.getLevel(j)%2===0){ze=!0;const e=je.getLowestParent(ue);e!==null&&e.remove(ue),h(je),re(j,p()),je.insert(j)}else ze=!1}let le,X=null,Ye,At=new c(1,1);function ir(e){if(le=new c(e.x-l.x,e.y-l.y),X=r.tree.getLowestNode(le),X instanceof a&&X.ellipse!==null){Ye=!0;const t=r.tree.getLowestParent(le);t!==null&&t.remove(le);for(let n=0;n<X.children.length;n++)r.tree.insert(X.children[n]);At=gn(X,le),X.children=[]}}function sr(e){if(Ye){const t=new c((e.x-l.x-le.x)/2,(e.y-l.y-le.y)/2);if(X instanceof a){const n=ut(X,t,At);if(n.ellipse!==null){h(r.tree);const i=r.tree.canInsert(n)&&de(n.ellipse)?y():p();E(i,"cursor: crosshair","cursor: no-drop"),R(n,i)}}}}function lr(e){if(d("cursor: default"),Ye){const t=new c((e.x-l.x-le.x)/2,(e.y-l.y-le.y)/2);if(X instanceof a){const n=ut(X,t,At);n.ellipse!==null&&(r.tree.canInsert(n)&&de(n.ellipse)?r.tree.insert(n):r.tree.insert(X))}h(r.tree),Ye=!1}}function cr(){d("cursor: default"),Ye&&X!==null&&r.tree.insert(X),Ye=!1,h(r.tree)}let ge,P=null,Ee,G;function ar(e){if(G=K(),ge=new c(e.x-l.x,e.y-l.y),P=G.getLowestNode(ge),P!==G.sheet&&P!==null){d("cursor: grabbing");const t=G.getLowestParent(ge);if(t!==null&&t.remove(ge),P instanceof a&&P.children.length!==0){for(let n=0;n<P.children.length;n++)G.insert(P.children[n]);P.children=[]}Ee=!0,h(G),P instanceof f?A(P,y(),!0):R(P,y())}else Ee=!1}function ur(e){if(Ee){const t=new c(e.x-ge.x,e.y-ge.y);if(h(G),P instanceof a){const n=J(P,t),o=Xe(G,n)?y():p();R(n,o),E(o,"cursor: grabbing","cursor: no-drop")}else if(P instanceof f){const n=k(P,t),o=Xe(G,n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function fr(e){if(Ee){d("cursor: default");const t=new Y(G,"Single Move"),n=new c(e.x-ge.x,e.y-ge.y);let o=null;P instanceof a?o=J(P,n):P instanceof f&&(o=k(P,n)),o!==null&&Xe(G,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),Ee=!1}function dr(){d("cursor: default"),Ee&&P!==null&&G.insert(P),Ee=!1,w()}let ye,F=null,Pt=null,Ie,Q;function hr(e){Q=K(),ye=new c(e.x-l.x,e.y-l.y),F=Q.getLowestNode(ye),F!==Q.sheet&&F!==null?(d("cursor: grabbing"),Pt=Q.getLowestParent(ye),Pt!==null&&Pt.remove(ye),Ie=!0,h(Q),re(F,y())):Ie=!1}function pr(e){if(Ie){const t=new c(e.x-ye.x,e.y-ye.y);if(h(Q),F instanceof a){const n=Bt(F,t),o=Xe(Q,n)?y():p();z(F,o,t),E(o,"cursor: grabbing","cursor: no-drop")}else if(F instanceof f){const n=k(F,t),o=Xe(Q,n)?y():p();A(n,o,!0),E(o,"cursor: grabbing","cursor: no-drop")}}}function wr(e){if(Ie){d("cursor: default");const t=new Y(Q,"Multi Move"),n=new c(e.x-ye.x,e.y-ye.y);let o=null;F instanceof a?o=Bt(F,n):F instanceof f&&(o=k(F,n)),o!==null&&Xe(Q,o)&&(t.tree.insert(o),r.pushToProof(t))}w(),Ie=!1}function gr(){d("cursor: default"),Ie&&F!==null&&Q.insert(F),Ie=!1,w()}let Lt,ct,Qe;function yr(){ct=K(),Lt=r.selectForProof.sheet,Lt.children.length>0&&r.proof.length===1&&ct.sheet.isEmptySheet()&&(Qe=!0,d("cursor: copy"))}function mr(){d("cursor: default"),Qe=!1,w()}function xr(){Qe&&(d("cursor: default"),ct.sheet=Lt,r.pushToProof(new Y(ct,"Pasted"))),Qe=!1,w()}function Mr(){d("cursor: default"),Qe=!1,w()}let Pe,O=null,Dt=null,Ue,ne;function br(e){ne=K(),Pe=new c(e.x-l.x,e.y-l.y),O=ne.getLowestNode(Pe),Dt=ne.getLowestParent(Pe),Ue=O!==ne.sheet&&O!==null,Ue&&d("cursor: copy")}function Tr(e){if(Ue){const t=new c(e.x-Pe.x,e.y-Pe.y);w();const n=new c(e.x-l.x,e.y-l.y),o=En(t,n)?y():p();if(O instanceof a)z(O,o,t);else if(O instanceof f){const i=k(O,t);A(i,o,!0)}E(o,"cursor: grabbing","cursor: no-drop")}}function Pr(e){if(Ue){d("cursor: default");const t=new c(e.x-Pe.x,e.y-Pe.y);if(En(t,new c(e.x-l.x,e.y-l.y))){if(O instanceof a)_e(O,t,ne);else if(O instanceof f){const n=k(O,t);ne.insert(n)}r.pushToProof(new Y(ne,"Iteration"))}}w(),Ue=!1}function Sr(){d("cursor: default"),Ue=!1,w()}function En(e,t){return Dt!==null&&Dt.containsPoint(t)&&(O instanceof a&&xe(ne,O,e)&&In(ne.sheet,J(O,e).ellipse)||O instanceof f&&ne.canInsert(k(O,e)))}function In(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof se&&(t.contains(e.children[n].ellipse)||!In(e.children[n],t)))return!1}else if(e.children[n]instanceof f&&t.contains(e.children[n].calcRect()))return!1;return!0}let ce,U=null,qe,Ft=new c(1,1),oe;function kr(e){if(oe=K(),ce=new c(e.x-l.x,e.y-l.y),U=oe.getLowestNode(ce),U instanceof a&&U.ellipse!==null){qe=!0;const t=oe.getLowestParent(ce);t!==null&&t.remove(ce);for(let n=0;n<U.children.length;n++)oe.insert(U.children[n]);Ft=gn(U,ce),U.children=[]}}function Er(e){if(qe){const t=new c((e.x-l.x-ce.x)/2,(e.y-l.y-ce.y)/2);if(U instanceof a){const n=ut(U,t,Ft);if(n.ellipse!==null){h(oe);const o=Cn(n)?y():p();R(n,o),E(o,"cursor: crosshair","cursor: no-drop")}}}}function Ir(e){if(qe){d("cursor: default");const t=new c((e.x-l.x-ce.x)/2,(e.y-l.y-ce.y)/2);if(U instanceof a){const n=ut(U,t,Ft);n.ellipse!==null&&Cn(n)&&(oe.insert(n),r.pushToProof(new Y(oe,"Resize")))}w(),qe=!1}}function Cr(){d("cursor: default"),qe&&U!==null&&oe.insert(U),qe=!1,w()}function Cn(e){return oe.canInsert(e)&&de(e.ellipse)&&Tn(new $(oe.sheet),e)}let fe,S=null,Ve,_,Je;function Lr(e){fe=new c(e.x-l.x,e.y-l.y),_=K(),Je=new $(_.sheet),S=_.getLowestNode(fe),Ln()}function Dr(e){fe=new c(e.x-l.x,e.y-l.y),S!==null&&(S=_.getLowestNode(fe),w(),Ln())}function $r(e){if(Ve&&(fe=new c(e.x-l.x,e.y-l.y),S!==null&&Xt(_.sheet,_.getLevel(S)))){const t=_.getLowestParent(fe);t instanceof a&&t.remove(fe),r.pushToProof(new Y(_,"Deiteration"))}Ve=!1,w()}function vr(){Ve&&S!==null&&Ce(Je,S),Ve=!1,S=null,w()}function Ln(){if(S!==null&&!(S instanceof a&&S.ellipse===null)&&Xt(_.sheet,_.getLevel(S))){Ve=!0;const e=Je.getLowestParent(fe);e!==null&&e.remove(fe),h(Je),re(S,p()),Je.insert(S)}else Ve=!1}function Xt(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&S instanceof a&&S.isEqualTo(e.children[o])&&S.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof f&&S instanceof f&&e.children[o].identifier===S.identifier&&e.children[o].toString()!==S.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(S)&&_.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Xt(n,t):!1}let Qt,Ht;function Br(){Qt=K(),Ht=!0,at(),re(Qt.sheet,p())}function Nr(){Ht&&(It(-1),r.clearProof(),w())}function Or(){Ht=!1,w()}const ie=document.getElementById("canvas");ie.width=window.innerWidth;ie.height=window.innerHeight;const Dn=ie.getContext("2d");if(Dn===null)throw Error("2d rendering context not supported");const Rr=Dn;Rr.font="35pt arial";const St=document.getElementById("cutTools"),_t=document.getElementById("atomTools"),en=document.getElementById("graphString"),tn=document.getElementById("proofString"),nn=document.getElementById("toProofTools");window.addEventListener("keydown",Hr);ie.addEventListener("mousedown",Yr);ie.addEventListener("mousemove",Ur);ie.addEventListener("mouseup",qr);ie.addEventListener("mouseout",Vr);ie.addEventListener("mouseenter",zr);let zt=!1,Yt=!0;window.tree=r.tree;window.treeString=wt(window.tree);window.atomTool=s.atomTool;window.cutTool=s.cutTool;window.dragTool=s.dragTool;window.aegStringify=wt;window.saveMode=$n;window.loadMode=Xr;window.moveSingleTool=s.moveSingleTool;window.moveMultiTool=s.moveMultiTool;window.copySingleTool=s.copySingleTool;window.copyMultiTool=s.copyMultiTool;window.deleteSingleTool=s.deleteSingleTool;window.deleteMultiTool=s.deleteMultiTool;window.copyFromDrawTool=s.copyFromDrawTool;window.pasteInProofTool=s.pasteInProofTool;window.doubleCutInsertionTool=s.doubleCutInsertionTool;window.resizeTool=s.resizeTool;window.doubleCutDeletionTool=s.doubleCutDeletionTool;window.insertionTool=s.insertionTool;window.erasureTool=s.erasureTool;window.proofMoveSingleTool=s.proofMoveSingleTool;window.proofMoveMultiTool=s.proofMoveMultiTool;window.proofResizeTool=s.proofResizeTool;window.iterationTool=s.iterationTool;window.deiterationTool=s.deiterationTool;window.clearProofTool=s.clearProofTool;window.setTool=Fr;window.setHighlight=Ar;window.toggleHandler=Wn;function Ar(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const on=document.querySelectorAll(".toolButton");on.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),on.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Fr(e){switch(r.toolState=e,St.style.display="none",_t.style.display="none",nn.style.display="none",r.toolState){case s.atomTool:_t.style.display="block";break;case s.cutTool:St.style.display="block";break;case s.copyFromDrawTool:nn.style.display="block";break;case s.doubleCutInsertionTool:St.style.display="block";break}}function wt(e){return JSON.stringify(e,null,"	")}async function $n(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Gn(n,t)}else{const n=document.createElement("a");n.href=wt(t),n.download=e+".json",n.click()}}catch{}}async function Xr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const u=Ct(r.modeState,o);if(r.modeState==="Draw")r.tree=u,h(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=u,(i=document.getElementById("Row: 1"))==null||i.remove();for(let g=0;g<r.proof.length;g++)yn(r.proof[g],g+1);r.currentProofStep=r.proof[r.proof.length-1],w()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}function Hr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),$n();else switch(r.toolState){case s.atomTool:ro(e);break}}function zr(){switch(r.toolState){case s.cutTool:Kn();break;case s.dragTool:Bn();break;case s.doubleCutInsertionTool:Ho();break}Yt=!0}function Yr(e){switch(r.toolState){case s.cutTool:Zn(e);break;case s.atomTool:io(e);break;case s.dragTool:Nn(e);break;case s.moveSingleTool:ao(e);break;case s.moveMultiTool:po(e);break;case s.copySingleTool:mo(e);break;case s.copyMultiTool:To(e);break;case s.deleteSingleTool:Eo(e);break;case s.deleteMultiTool:Do(e);break;case s.resizeTool:ir(e);break;case s.copyFromDrawTool:Oo(e);break;case s.pasteInProofTool:yr();break;case s.doubleCutInsertionTool:zo(e);break;case s.doubleCutDeletionTool:Vo(e);break;case s.insertionTool:Zo(e);break;case s.erasureTool:tr(e);break;case s.proofMoveSingleTool:ar(e);break;case s.proofMoveMultiTool:hr(e);break;case s.proofResizeTool:kr(e);break;case s.iterationTool:br(e);break;case s.deiterationTool:Lr(e);break;case s.clearProofTool:Br();break}zt=!0}function Ur(e){if(zt&&Yt)switch(r.toolState){case s.cutTool:Qn(e);break;case s.atomTool:so(e);break;case s.dragTool:On(e);break;case s.moveSingleTool:uo(e);break;case s.moveMultiTool:wo(e);break;case s.copySingleTool:xo(e);break;case s.copyMultiTool:Po(e);break;case s.deleteSingleTool:Io(e);break;case s.deleteMultiTool:$o(e);break;case s.resizeTool:sr(e);break;case s.copyFromDrawTool:Ro(e);break;case s.pasteInProofTool:mr();break;case s.doubleCutInsertionTool:Yo(e);break;case s.doubleCutDeletionTool:Go(e);break;case s.insertionTool:Qo(e);break;case s.erasureTool:nr(e);break;case s.proofMoveSingleTool:ur(e);break;case s.proofMoveMultiTool:pr(e);break;case s.proofResizeTool:Er(e);break;case s.iterationTool:Tr(e);break;case s.deiterationTool:Dr(e);break}}function qr(e){switch(r.toolState){case s.cutTool:_n(e);break;case s.atomTool:lo(e);break;case s.dragTool:Rn();break;case s.moveSingleTool:fo(e);break;case s.moveMultiTool:go(e);break;case s.copySingleTool:Mo(e);break;case s.copyMultiTool:So(e);break;case s.deleteSingleTool:Co(e);break;case s.deleteMultiTool:vo(e);break;case s.resizeTool:lr(e);break;case s.copyFromDrawTool:Ao();break;case s.pasteInProofTool:xr();break;case s.doubleCutInsertionTool:Uo(e);break;case s.doubleCutDeletionTool:Wo(e);break;case s.insertionTool:_o(e);break;case s.erasureTool:or(e);break;case s.proofMoveSingleTool:fr(e);break;case s.proofMoveMultiTool:wr(e);break;case s.proofResizeTool:Ir(e);break;case s.iterationTool:Pr(e);break;case s.deiterationTool:$r(e);break;case s.clearProofTool:Nr();break}zt=!1}function Vr(){switch(r.toolState){case s.cutTool:eo();break;case s.atomTool:co();break;case s.dragTool:An();break;case s.moveSingleTool:ho();break;case s.moveMultiTool:yo();break;case s.copySingleTool:bo();break;case s.copyMultiTool:ko();break;case s.deleteSingleTool:Lo();break;case s.deleteMultiTool:Bo();break;case s.resizeTool:cr();break;case s.copyFromDrawTool:Fo();break;case s.pasteInProofTool:Mr();break;case s.doubleCutInsertionTool:qo();break;case s.doubleCutDeletionTool:jo();break;case s.insertionTool:er();break;case s.erasureTool:rr();break;case s.proofMoveSingleTool:dr();break;case s.proofMoveMultiTool:gr();break;case s.proofResizeTool:Cr();break;case s.iterationTool:Sr();break;case s.deiterationTool:vr();break;case s.clearProofTool:Or();break}Yt=!1}function Gr(){ie.width=window.innerWidth,ie.height=window.innerHeight}window.onresize=Gr;
