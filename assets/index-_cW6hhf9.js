(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const w of i)if(w.type==="childList")for(const g of w.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(i){const w={};return i.integrity&&(w.integrity=i.integrity),i.referrerPolicy&&(w.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?w.credentials="include":i.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function o(i){if(i.ep)return;i.ep=!0;const w=n(i);fetch(i.href,w)}})();class c{constructor(t,n){if(this.x=t,this.y=n,!Number.isFinite(this.x)||!Number.isFinite(this.y))throw new Error("NaN or Infinity value(s) were passed in constructing a Point.")}set(t,n){if(!Number.isFinite(t)||!Number.isFinite(n))throw new Error("NaN or Infinity value(s) were passed in setting "+this+"'s coords.");this.x=t,this.y=n}distance(t){const n=this.x-t.x,o=this.y-t.y;return Math.sqrt(n*n+o*o)}toString(){return"("+this.x+", "+this.y+")"}}function ve(e,t){return ln(e,t)||$e(t,e)}function ln(e,t){if(e instanceof xe)return t instanceof xe?Gt(e,t):Vt(t,e);if(t instanceof xe)return Vt(e,t);if(Gt(e.boundingBox,t.boundingBox)||$e(t.boundingBox,e.boundingBox)){const n=sn(e);let o;for(let i=0;i<n.length;i++)if(o=st(t,n[i]),o<=0)return!0;return!1}return!1}function Vt(e,t){const n=t.getCorners(),o=je(e,n[0].x,1),i=je(e,n[1].x,1),w=je(e,n[0].x,-1),g=je(e,n[1].x,-1);if(n[0].y<o&&o<n[2].y||n[0].y<w&&w<n[2].y||n[0].y<i&&i<n[2].y||n[0].y<g&&g<n[2].y)return!0;const d=-1/Math.pow(e.radiusX,2),y=2*e.center.x/Math.pow(e.radiusX,2),M=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[0].y-e.center.y)/e.radiusY,2),H=-Math.pow(e.center.x,2)/Math.pow(e.radiusX,2)+1-Math.pow((n[2].y-e.center.y)/e.radiusY,2),We=(-y+Math.sqrt(Math.pow(y,2)-4*d*M))/(2*d),mt=(-y-Math.sqrt(Math.pow(y,2)-4*d*M))/(2*d),xt=(-y+Math.sqrt(Math.pow(y,2)-4*d*H))/(2*d),Mt=(-y-Math.sqrt(Math.pow(y,2)-4*d*H))/(2*d);return!isNaN(We)&&n[0].x<We&&We<n[1].x||!isNaN(mt)&&n[0].x<mt&&mt<n[1].x||!isNaN(xt)&&n[0].x<xt&&xt<n[1].x||!isNaN(Mt)&&n[0].x<Mt&&Mt<n[1].x}function $e(e,t){if(e instanceof xe)if(t instanceof xe){const n=t.getCorners();for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else{const n=Nn(t);for(let o=0;o<4;o++)if(!Ct(e,n[o]))return!1;return!0}else if(t instanceof xe){const n=t.getCorners();let o;for(let i=0;i<4;i++)if(o=st(e,n[i]),!(o<0))return!1;return!0}else{const n=sn(t);let o;for(let i=0;i<n.length;i++)if(o=st(e,n[i]),!(o<0))return!1;return!0}}function Gt(e,t){const n=e.getCorners(),o=t.getCorners();return(n[0].y<=o[0].y&&n[2].y>=o[0].y||n[0].y<=o[2].y&&n[2].y>=o[2].y||o[0].y<=n[0].y&&o[2].y>=n[0].y||o[0].y<=n[2].y&&o[2].y>=n[2].y)&&(n[0].x<=o[0].x&&n[1].x>=o[0].x||n[0].x<=o[1].x&&n[1].x>=o[1].x||o[0].x<=n[0].x&&o[1].x>=n[0].x||o[0].x<=n[1].x&&o[1].x>=n[1].x)}function Ct(e,t){const n=e.getCorners();return n[0].x<t.x&&n[1].x>t.x&&n[0].y<t.y&&n[2].y>t.y}function st(e,t){return Math.pow(t.x-e.center.x,2)/Math.pow(e.radiusX,2)+Math.pow(t.y-e.center.y,2)/Math.pow(e.radiusY,2)-1}function Nn(e){return[new c(e.center.x,e.center.y-e.radiusY),new c(e.center.x+e.radiusX,e.center.y),new c(e.center.x,e.center.y+e.radiusY),new c(e.center.x-e.radiusX,e.center.y)]}function sn(e){const t=[];let n,o,i=1;for(let w=0;w<360;w++)n=e.center.x+e.radiusX*Math.cos(w*(Math.PI/180)),w>180&&(i=-1),o=je(e,n,i),t[w]=new c(n,o);return t}function je(e,t,n){return e.radiusX===0||e.radiusY===0?e.center.y:n*e.radiusY*Math.sqrt(1-Math.pow((t-e.center.x)/e.radiusX,2))+e.center.y}class xe{constructor(t,n,o){if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Infinity/NaN passed in for width/height while constructing a Rectangle.");if(n!==void 0&&n<0)throw new Error("Negative value passed for width while constructing a Rectangle.");if(o!==void 0&&o<0)throw new Error("Negative value passed for height while constructing a Rectangle.");this.startVertex=t,this.width=n,this.height=o}getCorners(){const t=[this.startVertex];return t.push(new c(this.startVertex.x+this.width,this.startVertex.y)),t.push(new c(this.startVertex.x+this.width,this.startVertex.y+this.height)),t.push(new c(this.startVertex.x,this.startVertex.y+this.height)),t}containsPoint(t){return Ct(this,t)}overlaps(t){return ve(this,t)}contains(t){return $e(this,t)}toString(){return"Rectangle with top left vertex at: "+this.startVertex.toString()+", w: "+this.width+", h: "+this.height}}class u{constructor(t,n,o,i){if(t.length!==1)throw new Error("String of length "+t.length+" passed in as identifier in AtomNode constructor, which is not of length 1.");if(!/^[A-Za-z]$/.test(t))throw new Error(t+" not contained in Latin alphabet passed in as identifier in AtomNode constructor.");this.internalIdentifier=t,this.internalOrigin=n,this.internalWidth=o,this.internalHeight=i}copy(){return new u(this.internalIdentifier,new c(this.internalOrigin.x,this.internalOrigin.y),this.internalWidth,this.internalHeight)}get width(){return this.internalWidth}set width(t){this.internalWidth=t}get height(){return this.internalHeight}set height(t){this.internalHeight=t}get identifier(){return this.internalIdentifier}set identifier(t){this.internalIdentifier=t}get origin(){return this.internalOrigin}set origin(t){this.internalOrigin=t}containsPoint(t){return this.calcRect().containsPoint(t)}calcRect(){return new xe(new c(this.internalOrigin.x,this.internalOrigin.y-this.internalHeight),this.internalWidth,this.internalHeight)}isEqualTo(t){return this.identifier===t.identifier}toString(){return"An atom representing the proposition: "+this.internalIdentifier+" and Boundary box of: "+this.calcRect().toString()}}class ce{constructor(t,n,o){if(this.center=t,this.radiusX=n,this.radiusY=o,!Number.isFinite(this.radiusX)||!Number.isFinite(this.radiusY))throw new Error("A radius passed into an Ellipse construction was NaN or Infinity.");if(this.radiusX!==void 0&&this.radiusX<0)throw new Error("Horizontal radius in an Ellipse construction was negative.");if(this.radiusY!==void 0&&this.radiusY<0)throw new Error("Vertical radius in an Ellipse construction was negative.");const i=new c(this.center.x-this.radiusX,this.center.y-this.radiusY);this.boundingBox=new xe(i,this.radiusX*2,this.radiusY*2)}containsPoint(t){return st(this,t)<0}overlaps(t){return ve(this,t)}contains(t){return $e(this,t)}toString(){return"An ellipse with Center at: "+this.center.toString()+", Horizontal radius: "+this.radiusX+", Vertical radius: "+this.radiusY+", Bounding box: "+this.boundingBox.toString()}}class a{constructor(t,n){this.internalEllipse=t,this.internalChildren=n??[]}copy(){let t;const n=[];if(this.ellipse!==null?t=new ce(new c(this.ellipse.center.x,this.ellipse.center.y),this.ellipse.radiusX,this.ellipse.radiusY):t=null,this.children.length>0)for(let o=0;o<this.children.length;o++){const i=this.children[o];i instanceof u,n.push(i.copy())}return new a(t,n)}get ellipse(){return this.internalEllipse}set ellipse(t){this.internalEllipse=t}get children(){return this.internalChildren}set children(t){this.internalChildren=t}set child(t){this.internalChildren.push(t)}clear(){this.internalChildren=[]}isEmptySheet(){return this.internalEllipse===null&&this.internalChildren.length===0}getCurrentCut(t){for(let n=0;n<this.internalChildren.length;n++){const o=this.internalChildren[n];if(o instanceof a&&o.containsNode(t))return o.getCurrentCut(t)}return this}containsPoint(t){return this.internalEllipse===null?!0:this.internalEllipse.containsPoint(t)}containsNode(t){return this.internalEllipse===null?!0:t instanceof u?$e(this.internalEllipse,t.calcRect()):$e(this.internalEllipse,t.internalEllipse)}getLowestNode(t){if(!this.containsPoint(t))return null;for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t))return this.internalChildren[n]instanceof u||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0?this.internalChildren[n]:this.internalChildren[n].getLowestNode(t);return this}getLowestParent(t){if(!this.containsPoint(t))throw new Error("This parent "+this.toString+" does not contain the point.");for(let n=0;n<this.internalChildren.length;n++)if(this.internalChildren[n].containsPoint(t)){if(this.internalChildren[n]instanceof u||this.internalChildren[n]instanceof a&&this.internalChildren[n].children.length===0)return this;{const o=this.internalChildren[n];for(let i=0;i<o.children.length;i++)if(o.children[i].containsPoint(t))return o.getLowestParent(t);return this}}return null}getLevel(t,n){for(let o=0;o<this.internalChildren.length;o++){if(this.internalChildren[o]===t)return n;if(this.internalChildren[o]instanceof a&&this.internalChildren[o].containsNode(t))return this.internalChildren[o].getLevel(t,n+1)}return-1}remove(t){if(!this.containsPoint(t))return!1;for(let n=0;n<this.children.length;n++)if(this.children[n].containsPoint(t)){if(this.children[n]instanceof u||this.children[n]instanceof a&&this.children[n].children.length===0)return this.children.splice(n,1),!0;for(let o=0;o<this.children[n].children.length;o++)if(this.children[n].children[o].containsPoint(t))if(this.children[n].children[o]instanceof u)this.children[n].children.splice(o,1);else return this.children[n].children[o].remove(t);return this.children.splice(n,1),!0}return!1}isEqualTo(t){if(this.children.length===t.children.length){if(this.children.length===0)return!0;const n=this.copy().children,o=t.copy().children;for(let i=0;i<n.length;i++)for(let w=0;w<o.length;w++){if(n[i]instanceof u&&o[w]instanceof u&&n[i].isEqualTo(o[w])||n[i]instanceof a&&o[w]instanceof a&&n[i].isEqualTo(o[w])){n.splice(i,1),o.splice(w,1),i--;break}if(w===o.length-1)return!1}return n.length===0&&o.length===0}return!1}toFormulaString(){let t="";for(const n of this.internalChildren)n instanceof u?t+=n.identifier:n instanceof a&&(t+=n.toFormulaString()),t+=" ";return t=t.slice(0,-1),this.internalEllipse===null?t="["+t+"]":t="("+t+")",t}toString(){let t;return this.internalEllipse===null?t="Sheet of Assertion of the AEG Tree":t="A cut node with boundary box of "+this.internalEllipse.toString(),this.internalChildren.length>0&&(t+=", With nested nodes: "+this.internalChildren.toString()),t}}class I{constructor(t){t!==void 0?(this.internalSheet=t.copy(),this.internalSheet.ellipse=null):this.internalSheet=new a(null)}get sheet(){return this.internalSheet}set sheet(t){this.internalSheet=t}getLowestParent(t){return this.internalSheet.getLowestParent(t)}getLowestNode(t){return this.internalSheet.getLowestNode(t)}getLevel(t){return this.internalSheet.getLevel(t,0)}verify(){return this.verifyAEG(this.internalSheet)}verifyAEG(t){for(let n=0;n<t.children.length;n++){if(!t.containsNode(t.children[n]))return!1;for(let o=n+1;o<t.children.length;o++)if(this.overlaps(t.children[n],t.children[o]))return!1}for(let n=0;n<t.children.length;n++)if(t.children[n]instanceof a&&!this.verifyAEG(t.children[n]))return!1;return!0}canInsert(t){const n=this.internalSheet.getCurrentCut(t);for(let o=0;o<n.children.length;o++)if(this.intersects(t,n.children[o]))return!1;return!0}insert(t){if(!this.canInsert(t))throw new Error("Insertion failed. "+t+" had a collision.");const n=this.internalSheet.getCurrentCut(t),o=[...n.children];if(n.child=t,t instanceof a)for(let i=o.length-1;i>=0;i--)t.containsNode(o[i])&&(t.child=o[i],n.children.splice(i,1));return!0}remove(t){return this.internalSheet.remove(t)}clear(){this.internalSheet.clear()}intersects(t,n){const o=t instanceof u?t.calcRect():t.ellipse,i=n instanceof u?n.calcRect():n.ellipse;return ln(o,i)}overlaps(t,n){let o,i;return t instanceof u?n instanceof u?ve(t.calcRect(),n.calcRect()):(o=n.ellipse,ve(t.calcRect(),o)):n instanceof u?(o=t.ellipse,ve(o,n.calcRect())):(o=t.ellipse,i=n.ellipse,ve(o,i))}isEqualTo(t){return this.sheet.isEqualTo(t.sheet)}toString(){return this.internalSheet.toFormulaString()}}class U{constructor(t,n){this.appliedRule=n??"",this.tree=new I(t==null?void 0:t.sheet),this.index=r.proof.length}}var l=(e=>(e[e.none=0]="none",e[e.atomTool=1]="atomTool",e[e.cutTool=2]="cutTool",e[e.dragTool=3]="dragTool",e[e.drawMoveSingleTool=4]="drawMoveSingleTool",e[e.drawMoveMultiTool=5]="drawMoveMultiTool",e[e.copySingleTool=6]="copySingleTool",e[e.copyMultiTool=7]="copyMultiTool",e[e.deleteSingleTool=8]="deleteSingleTool",e[e.deleteMultiTool=9]="deleteMultiTool",e[e.resizeTool=10]="resizeTool",e[e.copyFromDrawTool=11]="copyFromDrawTool",e[e.pasteInProofTool=12]="pasteInProofTool",e[e.doubleCutInsertionTool=13]="doubleCutInsertionTool",e[e.doubleCutDeletionTool=14]="doubleCutDeletionTool",e[e.insertionTool=15]="insertionTool",e[e.erasureTool=16]="erasureTool",e[e.proofMoveSingleTool=17]="proofMoveSingleTool",e[e.proofMoveMultiTool=18]="proofMoveMultiTool",e[e.proofResizeTool=19]="proofResizeTool",e[e.iterationTool=20]="iterationTool",e[e.deiterationTool=21]="deiterationTool",e[e.proofClearTool=22]="proofClearTool",e[e.drawClearTool=23]="drawClearTool",e))(l||{});const oe=class oe{static getLastProofStep(){return oe.proof.length===0?new U(new I):oe.proof[oe.proof.length-1]}static pushToProof(t){var n;if(t.appliedRule==="Pasted")this.proof.pop(),(n=document.getElementById("Row: 1"))==null||n.remove(),t.index=0;else if(this.currentProofStep&&this.proof.length>0&&(!this.currentProofStep.tree.isEqualTo(this.proof[this.proof.length-1].tree)||this.currentProofStep.appliedRule!==this.proof[this.proof.length-1].appliedRule)){const o=this.currentProofStep.index;It(o),this.proof=this.proof.splice(0,o+1),t.index=this.proof.length}this.currentProofStep=t,this.proof.push(t),xn(t)}static clearProof(){It(-1),this.proof=[],this.pushToProof(new U),this.currentProofStep=this.proof[0]}};oe.tree=new I,oe.proof=[],oe.selectForProof=new I,oe.toolState=0,oe.modeState="Draw";let r=oe,kt,s=new c(0,0),At;function On(){f("cursor: grab")}function Rn(e){f("cursor: grabbing"),kt=new c(e.x-s.x,e.y-s.y),At=!1}function Fn(e){At||(f("cursor: grabbing"),s=new c(e.x-kt.x,e.y-kt.y),cn())}function Xn(){f("cursor: grab")}function Hn(){f("cursor: default"),At=!0,cn()}function cn(){r.modeState==="Proof"?m():h(r.tree)}var an={exports:{}};(function(e,t){function n(){var g=document.querySelector("[data-toggle-theme]"),d=g?g.getAttribute("data-key"):null;(function(y=localStorage.getItem(d||"theme")){localStorage.getItem(d||"theme")&&(document.documentElement.setAttribute("data-theme",y),g&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(M=>{M.classList.add(g.getAttribute("data-act-class"))}))})(),g&&[...document.querySelectorAll("[data-toggle-theme]")].forEach(y=>{y.addEventListener("click",function(){var M=y.getAttribute("data-toggle-theme");if(M){var H=M.split(",");document.documentElement.getAttribute("data-theme")==H[0]?H.length==1?(document.documentElement.removeAttribute("data-theme"),localStorage.removeItem(d||"theme")):(document.documentElement.setAttribute("data-theme",H[1]),localStorage.setItem(d||"theme",H[1])):(document.documentElement.setAttribute("data-theme",H[0]),localStorage.setItem(d||"theme",H[0]))}[...document.querySelectorAll("[data-toggle-theme]")].forEach(We=>{We.classList.toggle(this.getAttribute("data-act-class"))})})})}function o(){var g=document.querySelector("[data-set-theme='']"),d=g?g.getAttribute("data-key"):null;(function(y=localStorage.getItem(d||"theme")){if(y!=null&&y!="")if(localStorage.getItem(d||"theme")&&localStorage.getItem(d||"theme")!=""){document.documentElement.setAttribute("data-theme",y);var M=document.querySelector("[data-set-theme='"+y.toString()+"']");M&&([...document.querySelectorAll("[data-set-theme]")].forEach(H=>{H.classList.remove(H.getAttribute("data-act-class"))}),M.getAttribute("data-act-class")&&M.classList.add(M.getAttribute("data-act-class")))}else{var M=document.querySelector("[data-set-theme='']");M.getAttribute("data-act-class")&&M.classList.add(M.getAttribute("data-act-class"))}})(),[...document.querySelectorAll("[data-set-theme]")].forEach(y=>{y.addEventListener("click",function(){document.documentElement.setAttribute("data-theme",this.getAttribute("data-set-theme")),localStorage.setItem(d||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("[data-set-theme]")].forEach(M=>{M.classList.remove(M.getAttribute("data-act-class"))}),y.getAttribute("data-act-class")&&y.classList.add(y.getAttribute("data-act-class"))})})}function i(){var g=document.querySelector("select[data-choose-theme]"),d=g?g.getAttribute("data-key"):null;(function(y=localStorage.getItem(d||"theme")){if(localStorage.getItem(d||"theme")){document.documentElement.setAttribute("data-theme",y);var M=document.querySelector("select[data-choose-theme] [value='"+y.toString()+"']");M&&[...document.querySelectorAll("select[data-choose-theme] [value='"+y.toString()+"']")].forEach(H=>{H.selected=!0})}})(),g&&[...document.querySelectorAll("select[data-choose-theme]")].forEach(y=>{y.addEventListener("change",function(){document.documentElement.setAttribute("data-theme",this.value),localStorage.setItem(d||"theme",document.documentElement.getAttribute("data-theme")),[...document.querySelectorAll("select[data-choose-theme] [value='"+localStorage.getItem(d||"theme")+"']")].forEach(M=>{M.selected=!0})})})}function w(g=!0){g===!0?document.addEventListener("DOMContentLoaded",function(d){n(),i(),o()}):(n(),i(),o())}e.exports={themeChange:w}})(an);var qn=an.exports;const zn=document.getElementById("theme-select");qn.themeChange();let un=De("--good-placement"),fn=De("--bad-placement"),dn=De("--canvas-items");function De(e){return getComputedStyle(document.body).getPropertyValue(e)}function hn(){setTimeout(()=>{un=De("--good-placement"),fn=De("--bad-placement"),dn=De("--canvas-items"),r.modeState==="Draw"?h(r.tree):m()})}zn.addEventListener("input",()=>{hn()});window.addEventListener("DOMContentLoaded",()=>{hn()});function p(){return fn}function x(){return un}function wn(){return dn}const ct=document.getElementById("canvas"),gn=ct.getContext("2d");if(gn===null)throw Error("2d rendering context not supported.");const P=gn;P.font="35pt arial";const Yn=document.getElementById("graphString"),Un=document.getElementById("proofString"),Vn=document.getElementById("atomBox"),pn=document.getElementById("atomBoxes");pn.addEventListener("input",Wn);function R(e,t){const n=e.ellipse;if(n!==null){P.strokeStyle=t;const o=n.center;P.beginPath(),P.ellipse(o.x+s.x,o.y+s.y,n.radiusX,n.radiusY,0,0,2*Math.PI),P.stroke()}}function F(e,t,n){P.textBaseline="bottom";const o=P.measureText(e.identifier);P.fillStyle=t,P.strokeStyle=t,P.beginPath(),P.fillText(e.identifier,e.origin.x+s.x,e.origin.y+s.y),(pn.checked||Vn.checked&&n)&&P.rect(e.origin.x+s.x,e.origin.y+s.y-o.actualBoundingBoxAscent,e.width,e.height),P.stroke()}function yn(e,t,n){P.beginPath(),P.strokeStyle=n;const o=e.x-t.x+s.x,i=e.y-t.y+s.y;P.rect(e.x,e.y,-o,-i),P.stroke()}function f(e){ct.style.cssText=e}function Gn(e,t,n){return e===x()?t:n}function L(e,t,n){f(Gn(e,t,n))}function Wn(){h(r.tree)}function tt(){P.clearRect(0,0,ct.width,ct.height)}function h(e,t){Yn.innerHTML=e.toString(),tt(),$t(e.sheet,t),window.treeString=yt(e)}function $t(e,t){for(let n=0;e.children.length>n;n++)e.children[n]instanceof u?jn(e.children[n]):$t(e.children[n]);e.ellipse instanceof ce&&(P.strokeStyle=t||wn(),P.beginPath(),P.ellipse(e.ellipse.center.x+s.x,e.ellipse.center.y+s.y,e.ellipse.radiusX,e.ellipse.radiusY,0,0,2*Math.PI),P.stroke())}function jn(e){F(e,wn(),!1)}function m(){let e;r.proof.length===0||r.currentProofStep===void 0?e=new I:e=r.currentProofStep.tree,tt(),Un.innerHTML=e.toString(),$t(e.sheet)}function ne(e,t){if(e instanceof u)F(e,t,!1);else if(e instanceof a){R(e,t);for(let n=0;n<e.children.length;n++)ne(e.children[n],t)}}function mn(e,t){const n=new c(1,1);if(e instanceof a&&e.ellipse!==null){const o=e.ellipse,i=[new c(o.center.x-o.radiusX,o.center.y),new c(o.center.x,o.center.y-o.radiusY),new c(o.center.x+o.radiusX,o.center.y),new c(o.center.x,o.center.y+o.radiusY)];i[0].distance(t)>=i[2].distance(t)?n.x=1:n.x=-1,i[1].distance(t)>=i[3].distance(t)?n.y=1:n.y=-1}return n}function xn(e,t){var g;const n=document.createElement("div");n.className="row";const o=t||r.proof.length;n.id="Row: "+o;const i=document.createElement("button");i.type="button",i.id="Step: "+r.proof.length,i.className="proofNodeButton",i.title=e.tree.toString(),i.onclick=function(){Jn(e)};const w=document.createElement("Text");w.className="fa fa-"+{"Single Move":"mouse-pointer","Multi Move":"arrows",Resize:"arrows-alt","DC Insert":"dot-circle-o","DC Delete":"times-circle",Insertion:"plus",Erasure:"trash",Iteration:"expand",Deiteration:"compress",Pasted:"files-o"}[e.appliedRule],i.appendChild(w),n.appendChild(i),(g=document.getElementById("proofHistoryBar"))==null||g.appendChild(n)}function Jn(e){r.currentProofStep=e,m()}function It(e){var t;for(let n=r.proof.length;n>e+1;n--)(t=document.getElementById("Row: "+n))==null||t.remove()}async function Kn(e,t){const n=JSON.stringify(t,null,"	"),o=await e.createWritable();await o.write(n),await o.close()}function Lt(e,t){const n=JSON.parse(t);if(e==="Draw"){const o=n.internalSheet.internalChildren;return Wt(o)}else{const o=[];let i;for(i of n){const w=i.tree.internalSheet.internalChildren;o.push(new U(Wt(w),i.appliedRule))}return o}}function Wt(e){const t=new I,n=[];for(const o of e)Object.prototype.hasOwnProperty.call(o,"internalEllipse")?n.push(Mn(o)):n.push(bn(o));return t.sheet.children=n,t}function Mn(e){const t=new ce(new c(e.internalEllipse.center.x,e.internalEllipse.center.y),e.internalEllipse.radiusX,e.internalEllipse.radiusY),n=[];for(const o of e.internalChildren)"internalEllipse"in o?n.push(Mn(o)):n.push(bn(o));return new a(t,n)}function bn(e){const t=e.internalIdentifier,n=new c(e.internalOrigin.x,e.internalOrigin.y);return new u(t,n,e.internalWidth,e.internalHeight)}let bt=!0,Tt=null,St=null,jt=l.none,Jt=l.none;const Kt=document.getElementById("DrawButtons"),Zt=document.getElementById("ProofButtons"),Qt=document.getElementById("proofHistoryBar");function Zn(){if(bt=!bt,bt){Kt.style.display="block",tn.style.display="block",Zt.style.display="none",nn.style.display="none",Qt.style.display="none",r.modeState="Draw",St=JSON.stringify(r.proof),Jt=r.toolState;let e=null;if(Tt!==null&&(e=Lt(r.modeState,Tt)),e!==null)r.tree.sheet=e.sheet;else throw Error("invalid cached AEG");r.toolState=jt,h(r.tree)}else{Kt.style.display="none",tn.style.display="none",Zt.style.display="block",nn.style.display="block",Qt.style.display="block",r.modeState="Proof",Tt=JSON.stringify(r.tree),jt=r.toolState,r.proof.length===0&&r.pushToProof(new U);let e=null;St!==null&&(e=Lt(r.modeState,St)),e!==null&&(r.proof=e),r.toolState=Jt,m()}}let Bt;function Qn(){Bt=!0,tt(),ne(r.tree.sheet,p())}function _n(){Bt&&(r.tree=new I,h(r.tree))}function eo(){Bt=!1,h(r.tree)}const to=document.getElementById("canvas"),Tn=to.getContext("2d");if(Tn===null)throw Error("2d rendering context not supported.");const no=Tn,oo=document.getElementById("atomDisplay");let dt,Nt,N=nt("A",new c(0,0));function ro(e){new RegExp(/^[A-Za-z]$/).test(e.key)&&(N=nt(e.key,new c(N.origin.x,N.origin.y)),N.origin.x!==0&&N.origin.y!==0&&Nt&&Ot())}function io(e){dt=!1,Nt=!0,N=nt(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Ot()}function lo(e){N=nt(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),Ot()}function so(e){f("cursor: default"),N=nt(N.identifier,new c(e.clientX-s.x,e.clientY-s.y)),r.tree.canInsert(N)&&!dt&&r.tree.insert(N),h(r.tree),Nt=!1}function co(){f("cursor: default"),dt=!0,h(r.tree)}function nt(e,t){oo.innerHTML=e;const n=no.measureText(e);return new u(e,new c(t.x,t.y),n.width,n.fontBoundingBoxDescent+n.actualBoundingBoxAscent)}function Ot(){h(r.tree),dt||(r.tree.canInsert(N)?(f("cursor: default"),F(N,x(),!0)):(f("cursor: no-drop"),F(N,p(),!0)))}const ao=document.getElementById("mode");function Me(e,t,n){if(t.ellipse!==null){const o=Z(t,n);if(!e.canInsert(o))return!1}for(let o=0;o<t.children.length;o++){if(t.children[o]instanceof a&&t.children[o].ellipse!==null&&!Me(e,t.children[o],n))return!1;if(t.children[o]instanceof u){let i=t.children[o];if(i=k(i,n),!e.canInsert(i))return!1}}return!0}function Y(e,t,n){if(e instanceof a&&e.ellipse!==null){const o=Z(e,n);if(R(o,t),e.children.length!==0)for(let i=0;i<e.children.length;i++)Y(e.children[i],t,n)}else if(e instanceof u){const o=k(e,n);F(o,t,!0)}}function ot(e,t,n){const o=n||r.tree;if(e instanceof a&&e.ellipse!==null){const i=Z(e,t);if(o.insert(i),e.children.length!==0)for(let w=0;w<e.children.length;w++)ot(e.children[w],t,n)}else if(e instanceof u){const i=k(e,t);o.insert(i)}}function Qe(e,t){return e instanceof u?k(e,t):Z(e,t)}function Z(e,t){if(e.ellipse!==null)return new a(new ce(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY));throw new Error("Cannot alter the position of a CutNode without no Ellipse.")}function Rt(e,t){if(e.ellipse!==null){const n=[];for(let o=0;o<e.children.length;o++)e.children[o]instanceof a?n.push(Rt(e.children[o],t)):e.children[o]instanceof u&&n.push(k(e.children[o],t));return new a(new ce(new c(e.ellipse.center.x+t.x-s.x,e.ellipse.center.y+t.y-s.y),e.ellipse.radiusX,e.ellipse.radiusY),n)}else throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function k(e,t){return new u(e.identifier,new c(e.origin.x+t.x-s.x,e.origin.y+t.y-s.y),e.width,e.height)}function ht(e,t,n){if(e.ellipse!==null)return new a(new ce(new c(e.ellipse.center.x+t.x,e.ellipse.center.y+t.y),Math.abs(e.ellipse.radiusX+t.x*n.x),Math.abs(e.ellipse.radiusY+t.y*n.y)));throw new Error("Cannot alter the position of a CutNode without an Ellipse.")}function rt(e,t){for(let n=0;n<t.children.length;n++)e.canInsert(t.children[n])&&e.insert(t.children[n])}function Le(e,t){t instanceof a&&t.ellipse===null?e.sheet=t:e.canInsert(t)&&(e.insert(t),t instanceof a&&t.children.length!==0&&rt(e,t),h(e))}function wt(e,t){const n=new c((t.x-e.x)/2+e.x,(t.y-e.y)/2+e.y),o=e.x-t.x,i=e.y-t.y,w=Math.abs(o),g=Math.abs(i);let d,y;if(ao.value==="circumscribed"){const M=Math.floor(n.distance(t));y=Math.floor(M*(g/w)),d=Math.floor(M*(w/g))}else d=w/2,y=g/2;return new ce(n,d,y)}function Pe(e){return e.radiusX>15&&e.radiusY>15}const uo=document.getElementById("showRect");let at,gt;function fo(){f("cursor: crosshair")}function ho(e){at=new c(e.clientX-s.x,e.clientY-s.y),gt=!1}function wo(e){const t=new a(new ce(new c(0,0),0,0)),n=new c(e.clientX-s.x,e.clientY-s.y);if(h(r.tree),t.ellipse=wt(at,n),!gt){const i=r.tree.canInsert(t)&&Pe(t.ellipse)?x():p();L(i,"cursor: crosshair","cursor: no-drop"),R(t,i),uo.checked&&yn(at,n,i)}}function go(e){f("cursor: crosshair");const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(wt(at,t));r.tree.canInsert(n)&&!gt&&Pe(n.ellipse)&&r.tree.insert(n),h(r.tree)}function po(){f("cursor: default"),gt=!0,h(r.tree)}let we,S=null,Ee;function yo(e){if(we=new c(e.x-s.x,e.y-s.y),S=r.tree.getLowestNode(we),S!==r.tree.sheet&&S!==null){f("cursor: grabbing");const t=r.tree.getLowestParent(we);if(t!==null&&t.remove(we),S instanceof a&&S.children.length!==0){for(let n=0;n<S.children.length;n++)r.tree.insert(S.children[n]);S.children=[]}Ee=!0,h(r.tree),S instanceof u?F(S,x(),!0):R(S,x())}else Ee=!1}function mo(e){if(Ee){const t=new c(e.x-we.x,e.y-we.y);if(S instanceof a){const n=Z(S,t);h(r.tree);const o=r.tree.canInsert(n)?x():p();R(n,o),L(o,"cursor: grabbing","cursor: no-drop")}else if(S instanceof u){const n=k(S,t);h(r.tree);const o=r.tree.canInsert(n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function xo(e){if(f("cursor: default"),Ee){const t=new c(e.x-we.x,e.y-we.y);if(S instanceof a){const n=Z(S,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(S)}else if(S instanceof u){const n=k(S,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(S)}h(r.tree)}Ee=!1}function Mo(){f("cursor: default"),Ee&&S!==null&&r.tree.insert(S),Ee=!1,h(r.tree)}let ge,D=null,Ce;function bo(e){if(ge=new c(e.x-s.x,e.y-s.y),D=r.tree.getLowestNode(ge),D!==r.tree.sheet&&D!==null){f("cursor: grabbing");const t=r.tree.getLowestParent(ge);t!==null&&t.remove(ge),Ce=!0,h(r.tree),ne(D,x())}else Ce=!1}function To(e){if(Ce){const t=new c(e.x-ge.x,e.y-ge.y);if(h(r.tree),D instanceof a){const n=Me(r.tree,D,t)?x():p();Y(D,n,t),L(n,"cursor: grabbing","cursor: no-drop")}else if(D instanceof u){const n=k(D,t),o=r.tree.canInsert(n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function So(e){if(f("cursor: default"),Ce){const t=new c(e.x-ge.x,e.y-ge.y);if(D instanceof a)Me(r.tree,D,t)?ot(D,t):r.tree.insert(D);else if(D instanceof u){const n=k(D,t);r.tree.canInsert(n)?r.tree.insert(n):r.tree.insert(D)}}h(r.tree),Ce=!1}function Po(){f("cursor: default"),Ce&&D!==null&&r.tree.insert(D),Ce=!1,h(r.tree)}let pe,J=null,Be;function Eo(e){pe=new c(e.x-s.x,e.y-s.y);const t=r.tree.getLowestNode(pe),n=new c(e.x-pe.x,e.y-pe.y);t!==r.tree.sheet&&t!==null?(f("cursor: copy"),t instanceof a?(J=Z(t,n),J.children=[]):t instanceof u&&(J=t),Be=!0):Be=!1}function Co(e){if(Be){const t=new c(e.x-pe.x,e.y-pe.y);if(J instanceof a){const n=Z(J,t);h(r.tree);const o=r.tree.canInsert(n)?x():p();R(n,o),L(o,"cursor: grabbing","cursor: no-drop")}else if(J instanceof u){const n=k(J,t);h(r.tree);const o=r.tree.canInsert(n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function ko(e){if(f("cursor: default"),Be){const t=new c(e.x-pe.x,e.y-pe.y);if(J instanceof a&&J.ellipse!==null){const n=Z(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}else if(J instanceof u){const n=k(J,t);r.tree.canInsert(n)&&r.tree.insert(n)}h(r.tree)}Be=!1}function Io(){f("cursor: default"),Be=!1,h(r.tree)}let Ne,G=null,Oe;function Lo(e){Ne=new c(e.x-s.x,e.y-s.y),G=r.tree.getLowestNode(Ne),G!==r.tree.sheet&&G!==null?(f("cursor: copy"),Oe=!0):Oe=!1}function vo(e){if(Oe){const t=new c(e.x-Ne.x,e.y-Ne.y);if(h(r.tree),G instanceof a){const n=Me(r.tree,G,t)?x():p();Y(G,n,t),L(n,"cursor: grabbing","cursor: no-drop")}else if(G instanceof u){const n=k(G,t),o=r.tree.canInsert(n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function Do(e){if(f("cursor: default"),Oe){const t=new c(e.x-Ne.x,e.y-Ne.y);if(G instanceof a)Me(r.tree,G,t)&&ot(G,t);else if(G instanceof u){const n=k(G,t);r.tree.canInsert(n)&&r.tree.insert(n)}}h(r.tree),Oe=!1}function Ao(){f("cursor: default"),Oe=!1,h(r.tree)}let it,T=null,re;function $o(e){if(it=new c(e.x-s.x,e.y-s.y),T=r.tree.getLowestNode(it),T!==null){const t=r.tree.getLowestParent(it);t!==null&&t.remove(it),T instanceof a&&T.children.length!==0&&T!==r.tree.sheet&&rt(r.tree,T),h(r.tree),T instanceof u?F(T,p(),!0):R(T,p()),re=!0}else re=!1}function Bo(e){re&&T!==null&&T.ellipse!==null&&Le(r.tree,T);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);re&&T!==null&&o!==null&&(re=!0,h(r.tree),n===null?(T=null,re=!1):(o.remove(t),T=n,T instanceof a&&T.children.length!==0&&(rt(r.tree,T),T.children=[]),h(r.tree),T instanceof u?F(T,p(),!0):R(T,p())))}function No(e){const t=new c(e.x-s.x,e.y-s.y);if(re){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a&&n.remove(t),n!==r.tree.sheet&&n instanceof a&&n.children.length!==0&&rt(r.tree,n),h(r.tree)}T=null,re=!1}function Oo(){re&&T!==null&&Le(r.tree,T),T=null,re=!1,h(r.tree)}let lt,B=null,_;function Ro(e){if(lt=new c(e.x-s.x,e.y-s.y),B=r.tree.getLowestNode(lt),B!==null){const t=r.tree.getLowestParent(lt);t!==null?t.remove(lt):(B=r.tree.sheet.copy(),r.tree.clear()),_=!0,h(r.tree),ne(B,p())}}function Fo(e){_&&B!==null&&Le(r.tree,B);const t=new c(e.x-s.x,e.y-s.y),n=r.tree.getLowestNode(t),o=r.tree.getLowestParent(t);_&&B!==null&&o!==null?(_=!0,n===null?(B=null,_=!1):(o.remove(t),B=n,_=!0,h(r.tree),ne(B,p()))):_&&o===null&&(B=r.tree.sheet.copy(),r.tree.clear(),h(r.tree),ne(B,p()))}function Xo(e){const t=new c(e.x-s.x,e.y-s.y);if(_){const n=r.tree.getLowestNode(t);n!==null&&n instanceof a?n.remove(t):r.tree.clear(),h(r.tree)}B=null,_=!1}function Ho(){_&&B!==null&&Le(r.tree,B),B=null,_=!1,h(r.tree)}let ae,q=null,Re,Ft=new c(1,1);function qo(e){if(ae=new c(e.x-s.x,e.y-s.y),q=r.tree.getLowestNode(ae),q instanceof a&&q.ellipse!==null){Re=!0;const t=r.tree.getLowestParent(ae);t!==null&&t.remove(ae);for(let n=0;n<q.children.length;n++)r.tree.insert(q.children[n]);Ft=mn(q,ae),q.children=[]}}function zo(e){if(Re){const t=new c((e.x-s.x-ae.x)/2,(e.y-s.y-ae.y)/2);if(q instanceof a){const n=ht(q,t,Ft);if(n.ellipse!==null){h(r.tree);const i=r.tree.canInsert(n)&&Pe(n.ellipse)?x():p();L(i,"cursor: crosshair","cursor: no-drop"),R(n,i)}}}}function Yo(e){if(f("cursor: default"),Re){const t=new c((e.x-s.x-ae.x)/2,(e.y-s.y-ae.y)/2);if(q instanceof a){const n=ht(q,t,Ft);n.ellipse!==null&&(r.tree.canInsert(n)&&Pe(n.ellipse)?r.tree.insert(n):r.tree.insert(q))}h(r.tree),Re=!1}}function Uo(){f("cursor: default"),Re&&q!==null&&r.tree.insert(q),Re=!1,h(r.tree)}let Fe,$=null,Xe,Je;const Vo=document.getElementById("selectionString");function Go(e){Je=new I(r.tree.sheet),r.selectForProof.sheet=new I().sheet,Fe=new c(e.x-s.x,e.y-s.y),$=r.tree.getLowestNode(Fe),Sn()}function Wo(e){Xe&&(h(r.tree),Fe=new c(e.x-s.x,e.y-s.y),$=r.tree.getLowestNode(Fe),Sn())}function jo(){if(f("cursor: default"),Xe&&$!==null){if($ instanceof a&&$.ellipse===null)for(let e=0;e<$.children.length;e++)r.selectForProof.insert($.children[e]);else r.selectForProof.insert($);h(r.tree)}$=null,Xe=!1}function Jo(){f("cursor: default"),$=null,Xe=!1,h(r.tree)}function Sn(){const e=new I;let t=!1;if($!==null){if(Xe=!0,$ instanceof u||!$.isEqualTo(Je.sheet)){e.insert($);const n=Je.getLowestParent(Fe);n!==null&&(n.remove(Fe),t=!0),h(Je)}else e.sheet=$,tt();ne($,x()),f("cursor: copy"),t&&Je.insert($)}else Xe=!1;Vo.innerHTML=e.toString()}function Q(){const e=new I;return r.currentProofStep&&(e.sheet=r.currentProofStep.tree.sheet.copy()),e}function He(e,t){return e.canInsert(t)&&Pn(new I(e.sheet),t)}function Pn(e,t){return r.currentProofStep?(e.insert(t.copy()),e.isEqualTo(new I(r.currentProofStep.tree.sheet))):!1}let _t,Xt;function Ko(){_t=Q(),Xt=!0,tt(),ne(_t.sheet,p())}function Zo(){Xt&&(It(-1),r.clearProof(),m())}function Qo(){Xt=!1,m()}const _o=document.getElementById("showRect");let ut,pt,qe;function er(){f("cursor: crosshair")}function tr(e){ut=new c(e.clientX-s.x,e.clientY-s.y),qe=Q(),pt=!1}function nr(e){const t=new c(e.clientX-s.x,e.clientY-s.y),n=new a(wt(ut,t)),o=new a(En(n.ellipse));if(m(),!pt){const i=Cn(n,o)?x():p();R(n,i),R(o,i),L(i,"cursor: crosshair","cursor: no-drop"),_o.checked&&yn(ut,t,i)}}function or(e){f("cursor: crosshair");const t=new c(e.clientX-s.x,e.clientY-s.y);qe=Q();const n=new a(wt(ut,t)),o=new a(En(n.ellipse)),i=new U(qe,"DC Insert");!pt&&Cn(n,o)&&(i.tree.insert(n),i.tree.insert(o),r.pushToProof(i)),m()}function rr(){f("cursor: default"),pt=!0,m()}function En(e){return new ce(e.center,Math.floor(e.radiusX*.8),Math.floor(e.radiusY*.8))}function Cn(e,t){return e.ellipse!==null&&t.ellipse!==null&&qe.canInsert(e)&&Pe(e.ellipse)&&qe.canInsert(t)&&Pe(t.ellipse)&&ir(e,t)}function ir(e,t){const n=new I(qe.sheet),o=new a(e.ellipse),i=new a(t.ellipse);return n.insert(o),n.insert(i),o.children.length===1}let fe,W=null,_e,be,Ae;function lr(e){fe=new c(e.x-s.x,e.y-s.y),be=Q(),Ae=new I(be.sheet),W=be.getLowestNode(fe),kn()}function sr(e){fe=new c(e.x-s.x,e.y-s.y),Ae=new I(be.sheet),W!==null&&(W=be.getLowestNode(fe),m(),kn())}function cr(e){const t=new U(be,"DC Delete");if(fe=new c(e.x-s.x,e.y-s.y),_e&&W instanceof a){const n=t.tree.getLowestParent(fe),o=W.children[0];if(n!==null&&o instanceof a){n.remove(fe);for(let i=0;i<o.children.length;i++)t.tree.insert(o.children[i]);r.pushToProof(t)}}m()}function ar(){_e&&W!==null&&Le(Ae,W),W=null,_e=!1,m()}function ur(e){return e.children.length===1&&e.children[0]instanceof a&&W!==be.sheet}function fr(e){R(e,p()),e.children[0]instanceof a&&R(e.children[0],p())}function kn(){if(W instanceof a&&ur(W)){_e=!0;const e=Ae.getLowestParent(fe);if(e!==null){e.remove(fe);const t=W.children[0].copy();rt(Ae,t),t.children=[]}h(Ae),fr(W)}else _e=!1}let ye,E=null,ke,j;function dr(e){if(j=Q(),ye=new c(e.x-s.x,e.y-s.y),E=j.getLowestNode(ye),E!==j.sheet&&E!==null){f("cursor: grabbing");const t=j.getLowestParent(ye);if(t!==null&&t.remove(ye),E instanceof a&&E.children.length!==0){for(let n=0;n<E.children.length;n++)j.insert(E.children[n]);E.children=[]}ke=!0,h(j),E instanceof u?F(E,x(),!0):R(E,x())}else ke=!1}function hr(e){if(ke){const t=new c(e.x-ye.x,e.y-ye.y);if(h(j),E instanceof a){const n=Z(E,t),o=He(j,n)?x():p();R(n,o),L(o,"cursor: grabbing","cursor: no-drop")}else if(E instanceof u){const n=k(E,t),o=He(j,n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function wr(e){if(ke){f("cursor: default");const t=new U(j,"Single Move"),n=new c(e.x-ye.x,e.y-ye.y);let o=null;E instanceof a?o=Z(E,n):E instanceof u&&(o=k(E,n)),o!==null&&He(j,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),ke=!1}function gr(){f("cursor: default"),ke&&E!==null&&j.insert(E),ke=!1,m()}let me,X=null,Pt=null,Ie,ee;function pr(e){ee=Q(),me=new c(e.x-s.x,e.y-s.y),X=ee.getLowestNode(me),X!==ee.sheet&&X!==null?(f("cursor: grabbing"),Pt=ee.getLowestParent(me),Pt!==null&&Pt.remove(me),Ie=!0,h(ee),ne(X,x())):Ie=!1}function yr(e){if(Ie){const t=new c(e.x-me.x,e.y-me.y);if(h(ee),X instanceof a){const n=Rt(X,t),o=He(ee,n)?x():p();Y(X,o,t),L(o,"cursor: grabbing","cursor: no-drop")}else if(X instanceof u){const n=k(X,t),o=He(ee,n)?x():p();F(n,o,!0),L(o,"cursor: grabbing","cursor: no-drop")}}}function mr(e){if(Ie){f("cursor: default");const t=new U(ee,"Multi Move"),n=new c(e.x-me.x,e.y-me.y);let o=null;X instanceof a?o=Rt(X,n):X instanceof u&&(o=k(X,n)),o!==null&&He(ee,o)&&(t.tree.insert(o),r.pushToProof(t))}m(),Ie=!1}function xr(){f("cursor: default"),Ie&&X!==null&&ee.insert(X),Ie=!1,m()}let Te,O=null,vt=null,ze,ie;function Mr(e){ie=Q(),Te=new c(e.x-s.x,e.y-s.y),O=ie.getLowestNode(Te),vt=ie.getLowestParent(Te),ze=O!==ie.sheet&&O!==null,ze&&f("cursor: copy")}function br(e){if(ze){const t=new c(e.x-Te.x,e.y-Te.y);m();const n=new c(e.x-s.x,e.y-s.y),o=In(t,n)?x():p();if(O instanceof a)Y(O,o,t);else if(O instanceof u){const i=k(O,t);F(i,o,!0)}L(o,"cursor: grabbing","cursor: no-drop")}}function Tr(e){if(ze){f("cursor: default");const t=new c(e.x-Te.x,e.y-Te.y);if(In(t,new c(e.x-s.x,e.y-s.y))){if(O instanceof a)ot(O,t,ie);else if(O instanceof u){const n=k(O,t);ie.insert(n)}r.pushToProof(new U(ie,"Iteration"))}}m(),ze=!1}function Sr(){f("cursor: default"),ze=!1,m()}function In(e,t){return vt!==null&&vt.containsPoint(t)&&(O instanceof a&&Me(ie,O,e)&&Ln(ie.sheet,Z(O,e).ellipse)||O instanceof u&&ie.canInsert(k(O,e)))}function Ln(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n]instanceof a){if(e.children[n].ellipse instanceof ce&&(t.contains(e.children[n].ellipse)||!Ln(e.children[n],t)))return!1}else if(e.children[n]instanceof u&&t.contains(e.children[n].calcRect()))return!1;return!0}let de,C=null,Ye,te,Ke;function Pr(e){de=new c(e.x-s.x,e.y-s.y),te=Q(),Ke=new I(te.sheet),C=te.getLowestNode(de),vn()}function Er(e){de=new c(e.x-s.x,e.y-s.y),C!==null&&(C=te.getLowestNode(de),m(),vn())}function Cr(e){if(Ye&&(de=new c(e.x-s.x,e.y-s.y),C!==null&&Ht(te.sheet,te.getLevel(C)))){const t=te.getLowestParent(de);t instanceof a&&t.remove(de),r.pushToProof(new U(te,"Deiteration"))}Ye=!1,m()}function kr(){Ye&&C!==null&&Le(Ke,C),Ye=!1,C=null,m()}function vn(){if(C!==null&&!(C instanceof a&&C.ellipse===null)&&Ht(te.sheet,te.getLevel(C))){Ye=!0;const e=Ke.getLowestParent(de);e!==null&&e.remove(de),h(Ke),ne(C,p()),Ke.insert(C)}else Ye=!1}function Ht(e,t){let n=null;for(let o=0;o<e.children.length;o++){if(e.children[o]instanceof a&&C instanceof a&&C.isEqualTo(e.children[o])&&C.ellipse!==e.children[o].ellipse)return!0;if(e.children[o]instanceof u&&C instanceof u&&e.children[o].identifier===C.identifier&&e.children[o].toString()!==C.toString())return!0;e.children[o]instanceof a&&e.children[o].containsNode(C)&&te.getLevel(e.children[o])<t&&(n=e.children[o])}return n!==null?Ht(n,t):!1}let b,v,z,A,Ue;function Ir(e){z=Q();const t=r.selectForProof.sheet.children,n=new c(e.x-s.x,e.y-s.y);if(r.proof.length>0&&t.length===1){Ue=!0,b=t[0];const o=qt(e,b),i=z.getLowestNode(n),w=z.getLowestParent(n);if(v=i instanceof u?w:i,o){const g=Qe(b,o);if(v!==null&&!v.containsNode(g))f("cursor: no-drop"),A=!1,Y(b,p(),o);else if(v!==null&&v instanceof a&&v.ellipse!==null&&z.getLevel(v)%2===0){if(g instanceof a){A=!0;for(let d=0;d<v.children.length;d++)if(g.containsNode(v.children[d])){A=!1;break}}else A=!0;if(A){let d="";if(b instanceof a)d=Me(z,b,o)?x():p();else if(b instanceof u){const y=Qe(b,o);d=z.canInsert(y)?x():p()}A=d===x(),Y(b,d,o),L(d,"cursor: copy","cursor: no-drop")}else f("cursor: no-drop"),Y(b,p(),o)}else f("cursor: no-drop"),A=!1,Y(b,p(),o)}}else A=!1,Ue=!1,Y(b,p(),n)}function Lr(e){if(Ue){const t=new c(e.x-s.x,e.y-s.y);m();const n=qt(e,b),o=z.getLowestNode(t),i=z.getLowestParent(t);if(v=o instanceof u?i:o,n){const w=Qe(b,n);if(v!==null&&!v.containsNode(w))f("cursor: no-drop"),A=!1,Y(b,p(),n);else if(v!==null&&v instanceof a&&v.ellipse!==null&&z.getLevel(v)%2===0){if(w instanceof a){A=!0;for(let g=0;g<v.children.length;g++)if(w.containsNode(v.children[g])){A=!1;break}}else A=!0;if(A){let g="";if(b instanceof a)g=Me(z,b,n)?x():p();else if(b instanceof u){const d=Qe(b,n);g=z.canInsert(d)?x():p()}A=g===x(),Y(b,g,n),L(g,"cursor: copy","cursor: no-drop")}else f("cursor: no-drop"),Y(b,p(),n)}else f("cursor: no-drop"),A=!1,Y(b,p(),n)}}else A=!1}function vr(e){if(f("cursor: default"),Ue&&A){const t=qt(e,b);if(t){if(b instanceof a)ot(b,t,z);else if(b instanceof u){const n=Qe(b,t);z.insert(n)}r.pushToProof(new U(z,"Insertion"))}}m(),Ue=!1}function Dr(){f("cursor: default"),Ue=!1,m()}function qt(e,t){if(t instanceof a&&t.ellipse!==null)return new c(e.x-t.ellipse.center.x,e.y-t.ellipse.center.y);if(t instanceof u)return new c(e.x-t.origin.x,e.y-t.origin.y)}let he,K=null,Ve,Se,Ze;function Ar(e){he=new c(e.x-s.x,e.y-s.y),Se=Q(),Ze=new I(Se.sheet),K=Se.getLowestNode(he),Dn()}function $r(e){he=new c(e.x-s.x,e.y-s.y),K!==null&&(K=Se.getLowestNode(he),m(),Dn())}function Br(e){if(Ve){const t=new U(Se,"Erasure");he=new c(e.x-s.x,e.y-s.y);const n=t.tree.getLowestParent(he);n!==null&&n.remove(he),r.pushToProof(t),m()}K=null,Ve=!1}function Nr(){Ve&&K!==null&&Le(Ze,K),K=null,Ve=!1,m()}function Dn(){if(K!==Se.sheet&&K!==null&&Se.getLevel(K)%2===0){Ve=!0;const e=Ze.getLowestParent(he);e!==null&&e.remove(he),h(Ze),ne(K,p()),Ze.insert(K)}else Ve=!1}let ue,V=null,Ge,zt=new c(1,1),le;function Or(e){if(le=Q(),ue=new c(e.x-s.x,e.y-s.y),V=le.getLowestNode(ue),V instanceof a&&V.ellipse!==null){Ge=!0;const t=le.getLowestParent(ue);t!==null&&t.remove(ue);for(let n=0;n<V.children.length;n++)le.insert(V.children[n]);zt=mn(V,ue),V.children=[]}}function Rr(e){if(Ge){const t=new c((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof a){const n=ht(V,t,zt);if(n.ellipse!==null){h(le);const o=An(n)?x():p();R(n,o),L(o,"cursor: crosshair","cursor: no-drop")}}}}function Fr(e){if(Ge){f("cursor: default");const t=new c((e.x-s.x-ue.x)/2,(e.y-s.y-ue.y)/2);if(V instanceof a){const n=ht(V,t,zt);n.ellipse!==null&&An(n)&&(le.insert(n),r.pushToProof(new U(le,"Resize")))}m(),Ge=!1}}function Xr(){f("cursor: default"),Ge&&V!==null&&le.insert(V),Ge=!1,m()}function An(e){return le.canInsert(e)&&Pe(e.ellipse)&&Pn(new I(le.sheet),e)}let Dt,ft,et;function Hr(){ft=Q(),Dt=r.selectForProof.sheet,Dt.children.length>0&&r.proof.length===1&&ft.sheet.isEmptySheet()&&(et=!0,f("cursor: copy"))}function qr(){f("cursor: default"),et=!1,m()}function zr(){et&&(f("cursor: default"),ft.sheet=Dt,r.pushToProof(new U(ft,"Pasted"))),et=!1,m()}function Yr(){f("cursor: default"),et=!1,m()}const se=document.getElementById("canvas");se.width=window.innerWidth;se.height=window.innerHeight;const $n=se.getContext("2d");if($n===null)throw Error("2d rendering context not supported");const Ur=$n;Ur.font="35pt arial";const Et=document.getElementById("cutTools"),en=document.getElementById("atomTools"),tn=document.getElementById("graphString"),nn=document.getElementById("proofString"),on=document.getElementById("toProofTools");window.addEventListener("keydown",jr);se.addEventListener("mousedown",Kr);se.addEventListener("mousemove",Zr);se.addEventListener("mouseup",Qr);se.addEventListener("mouseout",_r);se.addEventListener("mouseenter",Jr);let Yt=!1,Ut=!0;window.tree=r.tree;window.treeString=yt(window.tree);window.atomTool=l.atomTool;window.cutTool=l.cutTool;window.dragTool=l.dragTool;window.aegStringify=yt;window.saveMode=Bn;window.loadMode=Wr;window.drawMoveSingleTool=l.drawMoveSingleTool;window.drawMoveMultiTool=l.drawMoveMultiTool;window.copySingleTool=l.copySingleTool;window.copyMultiTool=l.copyMultiTool;window.deleteSingleTool=l.deleteSingleTool;window.deleteMultiTool=l.deleteMultiTool;window.copyFromDrawTool=l.copyFromDrawTool;window.pasteInProofTool=l.pasteInProofTool;window.doubleCutInsertionTool=l.doubleCutInsertionTool;window.resizeTool=l.resizeTool;window.doubleCutDeletionTool=l.doubleCutDeletionTool;window.insertionTool=l.insertionTool;window.erasureTool=l.erasureTool;window.proofMoveSingleTool=l.proofMoveSingleTool;window.proofMoveMultiTool=l.proofMoveMultiTool;window.proofResizeTool=l.proofResizeTool;window.iterationTool=l.iterationTool;window.deiterationTool=l.deiterationTool;window.proofClearTool=l.proofClearTool;window.drawClearTool=l.drawClearTool;window.setTool=Gr;window.setHighlight=Vr;window.toggleHandler=Zn;function Vr(e,t){const n=document.getElementById(t);switch(e){case"mousedown":n==null||n.classList.remove("no-highlight");break;case"mouseleave":n==null||n.classList.add("no-highlight");break}}const rn=document.querySelectorAll(".toolButton");rn.forEach(e=>{e.addEventListener("click",()=>{e.classList.add("toolButtonPressed"),rn.forEach(t=>{t!==e&&t.classList.remove("toolButtonPressed")})})});function Gr(e){switch(r.toolState=e,Et.style.display="none",en.style.display="none",on.style.display="none",r.toolState){case l.atomTool:en.style.display="block";break;case l.cutTool:Et.style.display="block";break;case l.copyFromDrawTool:on.style.display="block";break;case l.doubleCutInsertionTool:Et.style.display="block";break}}function yt(e){return JSON.stringify(e,null,"	")}async function Bn(){let e,t;r.modeState==="Draw"?(e="AEG Tree",t=r.tree):(r.proof.length===0?e="[] → []":e=r.proof[0].tree.toString()+"→"+r.getLastProofStep().tree.toString(),t=r.proof);try{if("showSaveFilePicker"in window){const n=await window.showSaveFilePicker({excludeAcceptAllOption:!0,suggestedName:e,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]});Kn(n,t)}else{const n=document.createElement("a");n.href=yt(t),n.download=e+".json",n.click()}}catch{}}async function Wr(){try{const[e]=await window.showOpenFilePicker({excludeAcceptAllOption:!0,multiple:!1,startIn:"downloads",types:[{description:"JSON Files",accept:{"text/json":[".json"]}}]}),t=await e.getFile(),n=new FileReader;n.addEventListener("load",()=>{var i;const o=n.result;if(typeof o=="string"){const w=Lt(r.modeState,o);if(r.modeState==="Draw")r.tree=w,h(r.tree);else if(r.modeState==="Proof"){r.clearProof(),r.proof=w,(i=document.getElementById("Row: 1"))==null||i.remove();for(let g=0;g<r.proof.length;g++)xn(r.proof[g],g+1);r.currentProofStep=r.proof[r.proof.length-1],m()}}else console.log("Loading failed because reading the file was unsuccessful.")}),n.readAsText(t)}catch{}}function jr(e){if(e.ctrlKey&&e.key==="s")e.preventDefault(),Bn();else switch(r.toolState){case l.atomTool:ro(e);break}}function Jr(){switch(r.toolState){case l.cutTool:fo();break;case l.dragTool:On();break;case l.doubleCutInsertionTool:er();break}Ut=!0}function Kr(e){if(e.button===0){switch(r.toolState){case l.cutTool:ho(e);break;case l.atomTool:io(e);break;case l.dragTool:Rn(e);break;case l.drawMoveSingleTool:yo(e);break;case l.drawMoveMultiTool:bo(e);break;case l.copySingleTool:Eo(e);break;case l.copyMultiTool:Lo(e);break;case l.deleteSingleTool:$o(e);break;case l.deleteMultiTool:Ro(e);break;case l.resizeTool:qo(e);break;case l.copyFromDrawTool:Go(e);break;case l.pasteInProofTool:Hr();break;case l.doubleCutInsertionTool:tr(e);break;case l.doubleCutDeletionTool:lr(e);break;case l.insertionTool:Ir(e);break;case l.erasureTool:Ar(e);break;case l.proofMoveSingleTool:dr(e);break;case l.proofMoveMultiTool:pr(e);break;case l.proofResizeTool:Or(e);break;case l.iterationTool:Mr(e);break;case l.deiterationTool:Pr(e);break;case l.proofClearTool:Ko();break;case l.drawClearTool:Qn();break}Yt=!0}}function Zr(e){if(Yt&&Ut)switch(r.toolState){case l.cutTool:wo(e);break;case l.atomTool:lo(e);break;case l.dragTool:Fn(e);break;case l.drawMoveSingleTool:mo(e);break;case l.drawMoveMultiTool:To(e);break;case l.copySingleTool:Co(e);break;case l.copyMultiTool:vo(e);break;case l.deleteSingleTool:Bo(e);break;case l.deleteMultiTool:Fo(e);break;case l.resizeTool:zo(e);break;case l.copyFromDrawTool:Wo(e);break;case l.pasteInProofTool:qr();break;case l.doubleCutInsertionTool:nr(e);break;case l.doubleCutDeletionTool:sr(e);break;case l.insertionTool:Lr(e);break;case l.erasureTool:$r(e);break;case l.proofMoveSingleTool:hr(e);break;case l.proofMoveMultiTool:yr(e);break;case l.proofResizeTool:Rr(e);break;case l.iterationTool:br(e);break;case l.deiterationTool:Er(e);break}}function Qr(e){if(e.button===0){switch(r.toolState){case l.cutTool:go(e);break;case l.atomTool:so(e);break;case l.dragTool:Xn();break;case l.drawMoveSingleTool:xo(e);break;case l.drawMoveMultiTool:So(e);break;case l.copySingleTool:ko(e);break;case l.copyMultiTool:Do(e);break;case l.deleteSingleTool:No(e);break;case l.deleteMultiTool:Xo(e);break;case l.resizeTool:Yo(e);break;case l.copyFromDrawTool:jo();break;case l.pasteInProofTool:zr();break;case l.doubleCutInsertionTool:or(e);break;case l.doubleCutDeletionTool:cr(e);break;case l.insertionTool:vr(e);break;case l.erasureTool:Br(e);break;case l.proofMoveSingleTool:wr(e);break;case l.proofMoveMultiTool:mr(e);break;case l.proofResizeTool:Fr(e);break;case l.iterationTool:Tr(e);break;case l.deiterationTool:Cr(e);break;case l.proofClearTool:Zo();break;case l.drawClearTool:_n();break}Yt=!1}}function _r(){switch(r.toolState){case l.cutTool:po();break;case l.atomTool:co();break;case l.dragTool:Hn();break;case l.drawMoveSingleTool:Mo();break;case l.drawMoveMultiTool:Po();break;case l.copySingleTool:Io();break;case l.copyMultiTool:Ao();break;case l.deleteSingleTool:Oo();break;case l.deleteMultiTool:Ho();break;case l.resizeTool:Uo();break;case l.copyFromDrawTool:Jo();break;case l.pasteInProofTool:Yr();break;case l.doubleCutInsertionTool:rr();break;case l.doubleCutDeletionTool:ar();break;case l.insertionTool:Dr();break;case l.erasureTool:Nr();break;case l.proofMoveSingleTool:gr();break;case l.proofMoveMultiTool:xr();break;case l.proofResizeTool:Xr();break;case l.iterationTool:Sr();break;case l.deiterationTool:kr();break;case l.proofClearTool:Qo();break;case l.drawClearTool:eo();break}Ut=!1}function ei(){se.width=window.innerWidth,se.height=window.innerHeight}window.onresize=ei;
